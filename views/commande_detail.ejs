<%- include('partials/header', { title: 'D√©tail de la commande', user, role }) %>

<div class="admin-content-wrapper">
<div class="container-fluid px-3 mt-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">D√©tail de la commande</h2>
      
      <!-- Informations de la commande -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">Informations de la commande</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Catalogue :</strong> <%= commande.originalname %>
                <% if (commande.catalog_file_id) { %>
                  (N¬∞<%= commande.catalog_file_id %>)
                <% } %>
              </p>
              <p><strong>Description :</strong> <%= commande.catalog_description || 'Aucune description' %></p>
            </div>
            <div class="col-md-6">
              <p><strong>Date de commande :</strong>
                <% if (commande.created_at) { %>
                  <%= formatDateTime(commande.created_at) %>
                <% } %>
              </p>
              <% if (commande.note && commande.note.trim()) { %>
              <p><strong>üìù Note :</strong> <span style="white-space: pre-wrap;"><%= commande.note %></span></p>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <!-- Informations sur les dates du catalogue -->
      <div class="row mb-3">
        <div class="col-12">
          <div class="alert alert-info">
            <div class="row">
              <% if (commande.expiration_date) { %>
                <div class="col-md-6">
                  <strong>üìÖ Date limite commande :</strong> <%= formatDate(commande.expiration_date) %>
                </div>
              <% } %>
              <% if (commande.date_livraison) { %>
                <div class="col-md-6">
                  <strong>üöö Livraison estim√©e :</strong> <%= formatDate(commande.date_livraison) %>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau des articles -->
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Produit</th>
              <th class="d-none d-md-table-cell">Description</th>
              <th class="d-none d-sm-table-cell">Prix</th>
              <th class="d-none d-lg-table-cell">Quantit√©</th>
              <th class="d-none d-xl-table-cell">Note</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            <% let montant = 0; %>
            <% articles.forEach(function(a) { %>
              <% montant += (a.prix * a.quantity); %>
              <tr>
                <td>
                  <div class="fw-bold"><%= a.produit %></div>
                  <!-- Informations suppl√©mentaires sur mobile -->
                  <div class="d-md-none small text-muted">
                    <%= a.description %>
                  </div>
                  <div class="d-sm-none small text-muted">
                    Prix: <%= a.prix %>
                  </div>
                  <div class="d-lg-none small text-muted">
                    Quantit√©: <%= a.quantity %>
                  </div>
                  <% if (a.note && a.note.trim()) { %>
                  <div class="d-xl-none small">
                    <span class="badge bg-info">üìù <%= a.note %></span>
                  </div>
                  <% } %>
                </td>
                <td class="d-none d-md-table-cell">
                  <%= a.description %>
                </td>
                <td class="d-none d-sm-table-cell">
                  <%= a.prix %>
                </td>
                <td class="d-none d-lg-table-cell">
                  <%= a.quantity %>
                </td>
                <td class="d-none d-xl-table-cell">
                  <% if (a.note && a.note.trim()) { %>
                    <span class="badge bg-info">üìù <%= a.note %></span>
                  <% } else { %>
                    <span class="text-muted">-</span>
                  <% } %>
                </td>
                <td class="text-end">
                  <strong><%= (a.prix * a.quantity).toFixed(2) %> ‚Ç¨</strong>
                </td>
              </tr>
            <% }) %>
          </tbody>
          <tfoot>
            <tr class="table-secondary">
              <!-- Sur mobile (xs/sm) : 2 colonnes visibles donc colspan="1" -->
              <th colspan="1" class="text-end d-sm-none">Total approximatif :</th>
              <!-- Sur tablette (md/lg) : 3-4 colonnes visibles donc colspan="2" -->  
              <th colspan="2" class="text-end d-none d-sm-table-cell d-xl-none">Total approximatif :</th>
              <!-- Sur desktop (xl+) : 6 colonnes visibles donc colspan="5" -->
              <th colspan="5" class="text-end d-none d-xl-table-cell">Total approximatif :</th>
              <th class="text-end">
                <span class="badge bg-success fs-6">
                  <%= montant.toFixed(2) %> ‚Ç¨
                </span>
              </th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- R√©sum√© mobile -->
  <div class="row mt-3 d-md-none">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h6 class="card-title">R√©sum√© de la commande</h6>
          <p class="card-text">
            <strong>Nombre d'articles :</strong> <%= articles.length %><br>
            <strong>Total approximatif :</strong> <%= montant.toFixed(2) %> ‚Ç¨
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

</div>
<%- include('partials/footer') %>