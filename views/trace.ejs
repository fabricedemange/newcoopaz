<%- include('partials/header', { title: 'Articles du catalogue', user, role }) %>

<div class="admin-content-wrapper">


  <div class="container">
    <h1>Table Trace</h1>
    
    <table id="traceTable" class="display" style="width:100%">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date Action</th>
          <th>Username</th>
            <th style="width:60%">Query</th>
            <th style="width:20%">Params</th>
        </tr>
      </thead>
      <tbody>
        <% if (traces && traces.length > 0) { %>
          <% traces.forEach(trace => { %>
            <tr>
              <td><%= trace.id %></td>
              <td><%= trace.created_at %></td>
              <td><%= trace.username %></td>
              <td><%= trace.query %></td>
              <td><%= trace.params %></td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script>
$(document).ready(function() {
  $('#traceTable').DataTable({
    order: [[0, 'desc']], // Colonne "id" triée du plus récent au plus ancien
    pageLength: 50,        // 50 lignes par page
    pagingType: "simple_numbers", // Pagination améliorée
    search: {
      regex: true,         // Active la recherche par expressions régulières
      smart: true,         // Recherche intelligente activée
      search: '^(?!.*fabrice)' // Filtre par défaut : exclure les lignes contenant "fabrice"
    },
    columnDefs: [
      {
        targets: 1, // Colonne "Date Action" (index 1)
        render: function(data, type, row) {
          if (type === 'display' || type === 'type') {
            // Formatage compact : JJ/MM/AA HH:MM
            const date = new Date(data);
            if (!isNaN(date.getTime())) {
              const day = String(date.getDate()).padStart(2, '0');
              const month = String(date.getMonth() + 1).padStart(2, '0');
              const year = String(date.getFullYear()).slice(-2);
              const hours = String(date.getHours()).padStart(2, '0');
              const minutes = String(date.getMinutes()).padStart(2, '0');
              const secondes = String(date.getSeconds()).padStart(2, '0');
              return `${day}/${month}/${year} ${hours}:${minutes}:${secondes}`;
            }
          }
          return data; // Pour le tri, garder la date originale
        }
      }
    ],
    language: {
      url: "//cdn.datatables.net/plug-ins/1.13.8/i18n/fr-FR.json"
    }
  });
});
  </script>
</div>
 <%- include('partials/footer') %>
 
