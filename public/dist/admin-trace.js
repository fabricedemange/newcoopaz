import{i as P,o as a,c as l,u as n,a as r,t as c,b as m,e as y,v as C,q as k,n as g,d as v,F as f,k as b,w as p,h as S}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as T,c as x}from"./chunks/pinia-BNknc8Vm.js";import{G as $}from"./chunks/index-BkeVkIvb.js";const D=T("adminTrace",{state:()=>({traces:[],loading:!0,error:null,searchQuery:"",currentPage:1,pageSize:50,sortColumn:"id",sortDirection:"desc"}),getters:{filteredTraces(s){if(!s.searchQuery)return s.traces;const t=s.searchQuery.toLowerCase();return s.traces.filter(o=>o.id&&String(o.id).includes(t)||o.username&&o.username.toLowerCase().includes(t)||o.query&&o.query.toLowerCase().includes(t)||o.params&&o.params.toLowerCase().includes(t))},sortedTraces(s){const o=[...s.searchQuery?s.traces.filter(e=>e.id&&String(e.id).toLowerCase().includes(s.searchQuery.toLowerCase())||e.username&&e.username.toLowerCase().includes(s.searchQuery.toLowerCase())||e.query&&e.query.toLowerCase().includes(s.searchQuery.toLowerCase())||e.params&&e.params.toLowerCase().includes(s.searchQuery.toLowerCase())):s.traces];return o.sort((e,i)=>{let u=e[s.sortColumn],d=i[s.sortColumn];return u==null?1:d==null?-1:(s.sortColumn==="created_at"&&(u=new Date(u).getTime(),d=new Date(d).getTime()),s.sortColumn==="id"&&(u=parseInt(u),d=parseInt(d)),u<d?s.sortDirection==="asc"?-1:1:u>d?s.sortDirection==="asc"?1:-1:0)}),o},paginatedTraces(s){const t=this.sortedTraces,o=(s.currentPage-1)*s.pageSize;return t.slice(o,o+s.pageSize)},totalPages(s){const t=this.sortedTraces.length;return Math.ceil(t/s.pageSize)||1},paginationInfo(s){const t=this.sortedTraces.length,o=(s.currentPage-1)*s.pageSize+1,e=Math.min(s.currentPage*s.pageSize,t);return`${o}-${e} sur ${t}`}},actions:{async loadTraces(){this.loading=!0,this.error=null;try{const s=await $();if(s.success)this.traces=s.traces||[];else throw new Error(s.error)}catch(s){this.error=s.message||"Erreur de connexion au serveur"}finally{this.loading=!1}},sortBy(s){this.sortColumn===s?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=s,this.sortDirection="desc")},goToPage(s){s>=1&&s<=this.totalPages&&(this.currentPage=s)},formatDate(s){if(!s)return"";const t=new Date(s);if(isNaN(t.getTime()))return s;const o=String(t.getDate()).padStart(2,"0"),e=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getFullYear()).slice(-2),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0"),w=String(t.getSeconds()).padStart(2,"0");return`${o}/${e}/${i} ${u}:${d}:${w}`},truncate(s,t=100){return s?s.length<=t?s:s.substring(0,t)+"...":""},getSortIcon(s){return this.sortColumn!==s?"":this.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}}}),L={class:"container-fluid mt-4"},z={key:0,class:"text-center py-5"},I={key:1,class:"alert alert-danger"},Q={key:2},M={class:"d-flex justify-content-between align-items-center mb-4"},j={class:"mb-4"},q={class:"d-flex justify-content-between align-items-center mb-3"},A={class:"text-muted"},B={class:"d-flex align-items-center gap-2"},V={class:"card"},N={class:"table-responsive"},E={class:"table table-hover mb-0"},F={class:"table-light"},U={key:0},G={class:"badge bg-primary"},H={class:"text-wrap",style:{"font-size":"0.85rem"}},J={class:"text-wrap",style:{"font-size":"0.85rem"}},R={key:0,class:"d-flex justify-content-center mt-4"},Y={class:"pagination"},K=["onClick"],O={key:1,class:"page-item disabled"},W={__name:"AdminTracePage",setup(s){const t=D();return P(()=>{t.loadTraces()}),(o,e)=>(a(),l("div",L,[n(t).loading?(a(),l("div",z,[...e[12]||(e[12]=[r("div",{class:"spinner-border text-primary",role:"status"},null,-1),r("p",{class:"mt-3 text-muted"},"Chargement des traces...",-1)])])):n(t).error?(a(),l("div",I,c(n(t).error),1)):(a(),l("div",Q,[r("div",M,[e[14]||(e[14]=r("h2",null,[r("i",{class:"bi bi-activity me-2"}),m("Traces de MAJ")],-1)),r("button",{onClick:e[0]||(e[0]=i=>n(t).loadTraces()),class:"btn btn-outline-primary"},[...e[13]||(e[13]=[r("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),m("Actualiser ",-1)])])]),r("div",j,[y(r("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>n(t).searchQuery=i),type:"text",class:"form-control",placeholder:"Rechercher par ID, utilisateur, requête ou paramètres...",onInput:e[2]||(e[2]=i=>n(t).currentPage=1)},null,544),[[C,n(t).searchQuery]])]),r("div",q,[r("div",A,c(n(t).paginationInfo)+" traces",1),r("div",B,[e[16]||(e[16]=r("label",{class:"mb-0"},"Lignes par page:",-1)),y(r("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>n(t).pageSize=i),class:"form-select form-select-sm",style:{width:"auto"},onChange:e[4]||(e[4]=i=>n(t).currentPage=1)},[...e[15]||(e[15]=[r("option",{value:25},"25",-1),r("option",{value:50},"50",-1),r("option",{value:100},"100",-1),r("option",{value:200},"200",-1)])],544),[[k,n(t).pageSize,void 0,{number:!0}]])])]),r("div",V,[r("div",N,[r("table",E,[r("thead",F,[r("tr",null,[r("th",{onClick:e[5]||(e[5]=i=>n(t).sortBy("id")),style:{cursor:"pointer",width:"80px"}},[e[17]||(e[17]=m(" ID ",-1)),r("i",{class:g("bi ms-1 "+n(t).getSortIcon("id"))},null,2)]),r("th",{onClick:e[6]||(e[6]=i=>n(t).sortBy("created_at")),style:{cursor:"pointer",width:"160px"}},[e[18]||(e[18]=m(" Date Action ",-1)),r("i",{class:g("bi ms-1 "+n(t).getSortIcon("created_at"))},null,2)]),r("th",{onClick:e[7]||(e[7]=i=>n(t).sortBy("username")),style:{cursor:"pointer",width:"120px"}},[e[19]||(e[19]=m(" Username ",-1)),r("i",{class:g("bi ms-1 "+n(t).getSortIcon("username"))},null,2)]),e[20]||(e[20]=r("th",{style:{width:"50%"}},"Query",-1)),e[21]||(e[21]=r("th",{style:{width:"150px"}},"Params",-1))])]),r("tbody",null,[n(t).paginatedTraces.length===0?(a(),l("tr",U,[...e[22]||(e[22]=[r("td",{colspan:"5",class:"text-center text-muted py-4"},"Aucune trace trouvée",-1)])])):v("",!0),(a(!0),l(f,null,b(n(t).paginatedTraces,i=>(a(),l("tr",{key:i.id},[r("td",null,c(i.id),1),r("td",null,c(n(t).formatDate(i.created_at)),1),r("td",null,[r("span",G,c(i.username||"—"),1)]),r("td",null,[r("code",H,c(i.query),1)]),r("td",null,[r("code",J,c(n(t).truncate(i.params,80)),1)])]))),128))])])])]),n(t).totalPages>1?(a(),l("div",R,[r("nav",null,[r("ul",Y,[r("li",{class:g(["page-item",{disabled:n(t).currentPage===1}])},[r("a",{class:"page-link",href:"javascript:void(0)",onClick:e[8]||(e[8]=p(i=>n(t).goToPage(1),["prevent"]))},[...e[23]||(e[23]=[r("i",{class:"bi bi-chevron-double-left"},null,-1)])])],2),r("li",{class:g(["page-item",{disabled:n(t).currentPage===1}])},[r("a",{class:"page-link",href:"javascript:void(0)",onClick:e[9]||(e[9]=p(i=>n(t).goToPage(n(t).currentPage-1),["prevent"]))},[...e[24]||(e[24]=[r("i",{class:"bi bi-chevron-left"},null,-1)])])],2),(a(!0),l(f,null,b(n(t).totalPages,i=>(a(),l(f,{key:i},[i===1||i===n(t).totalPages||i>=n(t).currentPage-2&&i<=n(t).currentPage+2?(a(),l("li",{key:0,class:g(["page-item",{active:i===n(t).currentPage}])},[r("a",{class:"page-link",href:"javascript:void(0)",onClick:p(u=>n(t).goToPage(i),["prevent"])},c(i),9,K)],2)):i===n(t).currentPage-3||i===n(t).currentPage+3?(a(),l("li",O,[...e[25]||(e[25]=[r("span",{class:"page-link"},"...",-1)])])):v("",!0)],64))),128)),r("li",{class:g(["page-item",{disabled:n(t).currentPage===n(t).totalPages}])},[r("a",{class:"page-link",href:"javascript:void(0)",onClick:e[10]||(e[10]=p(i=>n(t).goToPage(n(t).currentPage+1),["prevent"]))},[...e[26]||(e[26]=[r("i",{class:"bi bi-chevron-right"},null,-1)])])],2),r("li",{class:g(["page-item",{disabled:n(t).currentPage===n(t).totalPages}])},[r("a",{class:"page-link",href:"javascript:void(0)",onClick:e[11]||(e[11]=p(i=>n(t).goToPage(n(t).totalPages),["prevent"]))},[...e[27]||(e[27]=[r("i",{class:"bi bi-chevron-double-right"},null,-1)])])],2)])])])):v("",!0)]))]))}},h=S(W);h.use(x());h.mount("#admin-trace-app");
