import{i as y,o,c as n,F as w,a as e,b as m,t as v,d as p,w as h,e as b,v as x,r as u,g as k,h as A}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{c as S}from"./chunks/pinia-8wUEIqj_.js";const T={class:"container-fluid px-3 mt-4"},I={key:0,class:"alert alert-warning"},P={class:"row"},V={class:"col-12 col-md-8 offset-md-2"},E={key:0,class:"alert alert-danger"},N={class:"card"},U={class:"card-body"},D={key:0,class:"mb-3"},M={class:"form-control-plaintext mb-0"},R={key:1,class:"mb-3"},$={class:"form-control-plaintext mb-0"},q=["value"],B={class:"mb-3"},C={class:"input-group"},F={class:"mb-3"},j={class:"d-flex gap-2"},L=["disabled"],O={key:0,class:"spinner-border spinner-border-sm me-1"},z=["href"],K={class:"d-flex flex-wrap gap-2 mt-3"},Q=["href"],G={__name:"AdminArticleEditPage",setup(H){const a=u(null),d=u(null),r=u(""),c=u(!1),l=u({prix:"",unite:""}),f=k(()=>window.CSRF_TOKEN||"");y(()=>{const s=window.INITIAL_DATA||{};a.value=s.article||null,d.value=s.catalogueId||s.catalogue_id||null,r.value=s.error||"",s.article&&(l.value.prix=s.article.prix??"",l.value.unite=s.article.unite??"")});async function _(){if(!(!a.value||!d.value)){r.value="",c.value=!0;try{const s=new URLSearchParams({_csrf:f.value,prix:String(l.value.prix??""),unite:String(l.value.unite??"")}),i=await(await fetch(`/admin/catalogues/${d.value}/articles/${a.value.id}/edit`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:s.toString()})).json().catch(()=>({}));if(i.success&&i.redirect){window.location.href=i.redirect;return}r.value=i.error||"Une erreur est survenue."}catch{r.value="Erreur de connexion. Veuillez réessayer."}finally{c.value=!1}}}return(s,t)=>(o(),n("div",T,[a.value?(o(),n(w,{key:1},[t[13]||(t[13]=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h2",{class:"mb-4"},"Éditer un article")])],-1)),e("div",P,[e("div",V,[r.value?(o(),n("div",E,[t[2]||(t[2]=e("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),m(v(r.value),1)])):p("",!0),e("div",N,[t[11]||(t[11]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Informations de l'article")],-1)),e("div",U,[a.value.produit?(o(),n("div",D,[t[3]||(t[3]=e("label",{class:"form-label"},"Produit",-1)),e("p",M,v(a.value.produit),1),t[4]||(t[4]=e("small",{class:"form-text text-muted"},"Modifiable dans la fiche produit",-1))])):p("",!0),a.value.description!=null?(o(),n("div",R,[t[5]||(t[5]=e("label",{class:"form-label"},"Description",-1)),e("p",$,v(a.value.description||"-"),1)])):p("",!0),e("form",{onSubmit:h(_,["prevent"])},[e("input",{type:"hidden",name:"_csrf",value:f.value},null,8,q),e("div",B,[t[7]||(t[7]=e("label",{for:"prix",class:"form-label"},[m("Prix "),e("span",{class:"text-danger"},"*")],-1)),e("div",C,[b(e("input",{id:"prix","onUpdate:modelValue":t[0]||(t[0]=i=>l.value.prix=i),type:"number",step:"0.01",class:"form-control",required:"",placeholder:"0.00"},null,512),[[x,l.value.prix,void 0,{number:!0}]]),t[6]||(t[6]=e("span",{class:"input-group-text"},"€",-1))])]),e("div",F,[t[8]||(t[8]=e("label",{for:"unite",class:"form-label"},[m("Qté mini "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{id:"unite","onUpdate:modelValue":t[1]||(t[1]=i=>l.value.unite=i),type:"text",class:"form-control",required:"",placeholder:"1"},null,512),[[x,l.value.unite]]),t[9]||(t[9]=e("div",{class:"form-text"},"Unité ou quantité minimale commandable",-1))]),e("div",j,[e("button",{type:"submit",class:"btn btn-success",disabled:c.value},[c.value?(o(),n("span",O)):p("",!0),t[10]||(t[10]=m(" Enregistrer les modifications ",-1))],8,L),e("a",{href:`/admin/catalogues/${d.value}/edit`,class:"btn btn-secondary"},"Annuler",8,z)])],32)])]),e("div",K,[e("a",{href:`/admin/catalogues/${d.value}/edit`,class:"btn btn-outline-secondary"}," Retour à l'édition du catalogue ",8,Q),t[12]||(t[12]=e("a",{href:"/admin/catalogues/vue",class:"btn btn-outline-secondary"}," Retour à la liste des catalogues ",-1))])])])],64)):(o(),n("div",I,"Article non trouvé."))]))}},g=A(G);g.use(S());g.mount("#admin-article-edit-app");
