import{i as k,o as i,c as o,a as t,b as u,j as w,u as d,t as l,d as b,F as x,e as C,v as $,p as h,w as f,n as g,l as v,h as D}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as T,c as E}from"./chunks/pinia-gLxYYWQL.js";import{h as B,A as I}from"./chunks/index-CQL6Akic.js";import{_ as A}from"./chunks/BackButton-DzFd1NqY.js";import{_ as L}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const P=T("catalogues",{state:()=>({loading:!1,error:null,authRequired:!1,catalogues:[],searchTerm:"",sortColumn:"expiration_date",sortDirection:"asc"}),getters:{sortedCatalogues(a){let r=[...a.catalogues||[]];if(a.searchTerm){const p=a.searchTerm.toLowerCase();r=r.filter(c=>c.originalname&&c.originalname.toLowerCase().includes(p)||c.username&&c.username.toLowerCase().includes(p)||c.description&&c.description.toLowerCase().includes(p))}const m=a.sortColumn,_=a.sortDirection;return r.sort((p,c)=>{let n=p[m],s=c[m];if(m==="id"?(n=Number(n)||0,s=Number(s)||0):m&&m.includes("date")&&(n=n?new Date(n).getTime():0,s=s?new Date(s).getTime():0),n===s)return 0;const e=n>s?1:-1;return _==="asc"?e:-e})},sortIcon(a){return r=>a.sortColumn!==r?"arrow-down-up":a.sortDirection==="asc"?"arrow-up":"arrow-down"}},actions:{async loadAll(){this.loading=!0,this.error=null,this.authRequired=!1;try{const a=await B();if(a.success)this.catalogues=a.catalogues||[];else throw new Error(a.error||"Erreur chargement")}catch(a){this.error=a.message,a.code===I&&(this.authRequired=!0),console.error("catalogues loadAll:",a)}finally{this.loading=!1}},setSearchTerm(a){this.searchTerm=a},sortBy(a){this.sortColumn===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=a,this.sortDirection="asc")}}}),j={class:"admin-content-wrapper"},N={class:"container-fluid mt-4"},V={class:"d-flex justify-content-between align-items-center mb-4"},R={key:0,class:"alert alert-danger alert-dismissible fade show"},S={key:1,class:"text-center py-5"},q={class:"row mb-3"},F={class:"col-md-6"},M={class:"input-group"},H={key:0,class:"text-center py-5"},K={class:"card border-0 shadow-sm d-none d-md-block"},z={class:"card-body p-0"},U={class:"table-responsive"},G={class:"table table-hover mb-0 catalogues-table"},J={class:"thead-precommandes"},O={class:"text-muted catalogue-col-id"},Q={class:"d-flex align-items-center"},W={key:0,class:"catalogue-thumbnail me-2"},X=["src"],Y={key:0},Z={key:1,class:"text-muted"},ss={key:0},ts={class:"text-muted"},es={class:"text-center"},is={key:0,class:"badge bg-warning text-dark me-1",title:"Paniers en cours"},os={key:1,class:"badge bg-success",title:"Commandes validées"},rs={key:2,class:"text-muted"},ns={class:"text-end"},as=["href"],ls={key:1,class:"badge bg-secondary"},ds={class:"d-md-none"},us={class:"card-body"},ms={key:0,class:"flex-shrink-0"},bs=["src"],cs={class:"flex-grow-1"},ps={class:"card-title mb-2"},gs={class:"text-muted"},_s={key:0,class:"card-text text-muted small mb-0 mt-1"},xs={class:"row g-2 mb-3"},fs={class:"col-6"},hs={key:0},vs={class:"col-6"},ys={class:"col-6"},ks={class:"col-6"},ws={key:0,class:"badge bg-warning text-dark me-1"},Cs={key:1,class:"badge bg-success"},$s={key:2,class:"text-muted"},Ds=["href"],Ts={key:1,class:"alert alert-secondary mb-0 text-center"},Es={class:"mt-3 text-muted small"},Bs={__name:"CataloguesPage",setup(a){const r=P();function m(n){if(!n)return-1;const s=new Date;s.setHours(0,0,0,0);const e=new Date(n);return e.setHours(0,0,0,0),Math.ceil((e-s)/(1e3*60*60*24))}function _(n){return n<0?"bg-secondary":n===0?"bg-danger":n===1?"bg-warning text-dark":n<=3?"bg-info":"bg-success"}function p(n){return n<0?"Expiré":n===0?"Expire aujourd'hui":n===1?"Expire demain":`${n} jour${n>1?"s":""} restant${n>1?"s":""}`}function c(n){r.sortBy(n)}return k(()=>{r.loadAll()}),(n,s)=>(i(),o("div",j,[t("div",N,[t("div",V,[s[9]||(s[9]=t("h2",{class:"text-precommandes mb-0"},[t("i",{class:"bi bi-book me-2"}),u("Catalogues disponibles")],-1)),w(A)]),d(r).error?(i(),o("div",R,[s[10]||(s[10]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),s[11]||(s[11]=t("strong",null,"Erreur :",-1)),u(" "+l(d(r).error)+" ",1),t("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=e=>d(r).error=null)})])):b("",!0),d(r).loading?(i(),o("div",S,[...s[12]||(s[12]=[t("div",{class:"spinner-border text-precommandes",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),t("p",{class:"mt-3 text-muted"},"Chargement des catalogues...",-1)])])):(i(),o(x,{key:2},[t("div",q,[t("div",F,[t("div",M,[s[13]||(s[13]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),C(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>d(r).searchTerm=e),type:"text",class:"form-control",placeholder:"Rechercher par nom, description ou auteur..."},null,512),[[$,d(r).searchTerm]])])])]),d(r).sortedCatalogues.length===0?(i(),o("div",H,[...s[14]||(s[14]=[t("i",{class:"bi bi-inbox fs-1 text-muted mb-3 d-block"},null,-1),t("p",{class:"text-muted"},"Aucun catalogue trouvé",-1)])])):(i(),o(x,{key:1},[t("div",K,[s[27]||(s[27]=t("div",{class:"card-header card-header-precommandes"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-journal-text me-2"}),u("Liste des catalogues")])],-1)),t("div",z,[t("div",U,[t("table",G,[t("thead",J,[t("tr",null,[t("th",{class:"sortable text-nowrap catalogue-col-id",style:{cursor:"pointer","user-select":"none"},role:"button",tabindex:"0",onClick:s[2]||(s[2]=f(e=>c("id"),["prevent"])),onKeydown:[s[3]||(s[3]=h(f(e=>c("id"),["prevent"]),["enter"])),s[4]||(s[4]=h(f(e=>c("id"),["prevent"]),["space"]))]},[s[15]||(s[15]=u(" ID ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("id")+" ms-1"])},null,2)],32),t("th",{class:"sortable",style:{width:"28%",cursor:"pointer"},onClick:s[5]||(s[5]=e=>d(r).sortBy("originalname"))},[s[16]||(s[16]=u(" Nom du catalogue ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("originalname")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[6]||(s[6]=e=>d(r).sortBy("expiration_date"))},[s[17]||(s[17]=u(" Expiration ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("expiration_date")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[7]||(s[7]=e=>d(r).sortBy("date_livraison"))},[s[18]||(s[18]=u(" Livraison ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("date_livraison")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[8]||(s[8]=e=>d(r).sortBy("username"))},[s[19]||(s[19]=u(" Publié par ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("username")+" ms-1"])},null,2)]),s[20]||(s[20]=t("th",{class:"text-center",style:{width:"10%"}},"Statut",-1)),s[21]||(s[21]=t("th",{class:"text-end",style:{width:"15%"}},"Actions",-1))])]),t("tbody",null,[(i(!0),o(x,null,v(d(r).sortedCatalogues,e=>(i(),o("tr",{key:e.id},[t("td",O,[t("strong",null,l(e.id),1)]),t("td",null,[t("div",Q,[e.image_filename?(i(),o("span",W,[t("img",{src:`/uploads/catalogue-images/${e.image_filename}`,alt:"Photo",style:{width:"50px",height:"50px","object-fit":"cover","border-radius":"4px"}},null,8,X)])):b("",!0),t("div",null,[t("strong",null,l(e.originalname),1),e.description?(i(),o("br",Y)):b("",!0),e.description?(i(),o("small",Z,l(e.description),1)):b("",!0)])])]),t("td",null,[u(l(e.expiration_formatted||"-")+" ",1),m(e.expiration_date)>=0?(i(),o("br",ss)):b("",!0),m(e.expiration_date)>=0?(i(),o("span",{key:1,class:g(["badge",_(m(e.expiration_date))])},l(p(m(e.expiration_date))),3)):b("",!0)]),t("td",null,l(e.livraison_formatted||"-"),1),t("td",null,[s[22]||(s[22]=t("i",{class:"bi bi-person-circle me-1"},null,-1)),u(l(e.username)+" ",1),s[23]||(s[23]=t("br",null,null,-1)),t("small",ts,l(e.upload_formatted||"-"),1)]),t("td",es,[e.nb_paniers_non_submis>0?(i(),o("span",is,[s[24]||(s[24]=t("i",{class:"bi bi-cart3"},null,-1)),u(" "+l(e.nb_paniers_non_submis),1)])):b("",!0),e.nb_paniers_submis>0?(i(),o("span",os,[s[25]||(s[25]=t("i",{class:"bi bi-check-circle"},null,-1)),u(" "+l(e.nb_paniers_submis),1)])):b("",!0),!e.nb_paniers_non_submis&&!e.nb_paniers_submis?(i(),o("span",rs,"-")):b("",!0)]),t("td",ns,[m(e.expiration_date)>=0?(i(),o("a",{key:0,href:`/catalogues/${e.id}/vue?nouveau=1`,class:"btn btn-sm btn-precommandes"},[...s[26]||(s[26]=[t("i",{class:"bi bi-cart-plus me-1"},null,-1),u("Faire un panier ",-1)])],8,as)):(i(),o("span",ls,"Expiré"))])]))),128))])])])])]),t("div",ds,[(i(!0),o(x,null,v(d(r).sortedCatalogues,e=>(i(),o("div",{key:"m-"+e.id,class:"card mb-3 shadow-sm"},[t("div",us,[t("div",{class:g(["d-flex mb-3",{"gap-3":e.image_filename}])},[e.image_filename?(i(),o("div",ms,[t("img",{src:`/uploads/catalogue-images/${e.image_filename}`,alt:"Photo",style:{width:"66px",height:"66px","object-fit":"cover","border-radius":"4px"}},null,8,bs)])):b("",!0),t("div",cs,[t("h5",ps,l(e.originalname),1),t("small",gs,"ID : "+l(e.id),1),e.description?(i(),o("p",_s,l(e.description),1)):b("",!0)])],2),t("div",xs,[t("div",fs,[s[28]||(s[28]=t("small",{class:"text-muted d-block"},"Expiration",-1)),t("strong",null,l(e.expiration_formatted||"-"),1),m(e.expiration_date)>=0?(i(),o("div",hs,[t("span",{class:g(["badge mt-1",_(m(e.expiration_date))])},l(p(m(e.expiration_date))),3)])):b("",!0)]),t("div",vs,[s[29]||(s[29]=t("small",{class:"text-muted d-block"},"Livraison",-1)),t("strong",null,l(e.livraison_formatted||"-"),1)]),t("div",ys,[s[30]||(s[30]=t("small",{class:"text-muted d-block"},"Publié par",-1)),t("strong",null,l(e.username),1)]),t("div",ks,[s[33]||(s[33]=t("small",{class:"text-muted d-block"},"Statut",-1)),e.nb_paniers_non_submis>0?(i(),o("span",ws,[s[31]||(s[31]=t("i",{class:"bi bi-cart3"},null,-1)),u(" "+l(e.nb_paniers_non_submis),1)])):b("",!0),e.nb_paniers_submis>0?(i(),o("span",Cs,[s[32]||(s[32]=t("i",{class:"bi bi-check-circle"},null,-1)),u(" "+l(e.nb_paniers_submis),1)])):b("",!0),!e.nb_paniers_non_submis&&!e.nb_paniers_submis?(i(),o("span",$s,"-")):b("",!0)])]),m(e.expiration_date)>=0?(i(),o("a",{key:0,href:`/catalogues/${e.id}/vue?nouveau=1`,class:"btn btn-precommandes w-100"},[...s[34]||(s[34]=[t("i",{class:"bi bi-cart-plus me-2"},null,-1),u("Faire un panier ",-1)])],8,Ds)):(i(),o("div",Ts,[...s[35]||(s[35]=[t("i",{class:"bi bi-clock-history me-2"},null,-1),u("Catalogue expiré ",-1)])]))])]))),128))]),t("div",Es,[s[36]||(s[36]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),u(" "+l(d(r).sortedCatalogues.length)+" catalogue(s) affiché(s) ",1)])],64))],64))])]))}},Is=L(Bs,[["__scopeId","data-v-caa6784a"]]),y=D(Is);y.use(E());y.mount("#catalogues-app");
