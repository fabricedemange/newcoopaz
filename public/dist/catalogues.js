import{i as k,o as i,c as o,a as t,b as u,u as d,t as a,d as b,F as x,e as w,v as C,m as v,w as f,n as g,k as y,h as $}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as D,c as T}from"./chunks/pinia-BNknc8Vm.js";import{g as E,A as B}from"./chunks/index-BkeVkIvb.js";import{_ as I}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const A=D("catalogues",{state:()=>({loading:!1,error:null,authRequired:!1,catalogues:[],searchTerm:"",sortColumn:"expiration_date",sortDirection:"asc"}),getters:{sortedCatalogues(l){let r=[...l.catalogues||[]];if(l.searchTerm){const p=l.searchTerm.toLowerCase();r=r.filter(c=>c.originalname&&c.originalname.toLowerCase().includes(p)||c.username&&c.username.toLowerCase().includes(p)||c.description&&c.description.toLowerCase().includes(p))}const m=l.sortColumn,_=l.sortDirection;return r.sort((p,c)=>{let n=p[m],s=c[m];if(m==="id"?(n=Number(n)||0,s=Number(s)||0):m&&m.includes("date")&&(n=n?new Date(n).getTime():0,s=s?new Date(s).getTime():0),n===s)return 0;const e=n>s?1:-1;return _==="asc"?e:-e})},sortIcon(l){return r=>l.sortColumn!==r?"arrow-down-up":l.sortDirection==="asc"?"arrow-up":"arrow-down"}},actions:{async loadAll(){this.loading=!0,this.error=null,this.authRequired=!1;try{const l=await E();if(l.success)this.catalogues=l.catalogues||[];else throw new Error(l.error||"Erreur chargement")}catch(l){this.error=l.message,l.code===B&&(this.authRequired=!0),console.error("catalogues loadAll:",l)}finally{this.loading=!1}},setSearchTerm(l){this.searchTerm=l},sortBy(l){this.sortColumn===l?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=l,this.sortDirection="asc")}}}),P={class:"admin-content-wrapper"},L={class:"container-fluid mt-4"},R={key:0,class:"alert alert-danger alert-dismissible fade show"},N={key:1,class:"text-center py-5"},S={class:"row mb-3"},V={class:"col-md-6"},j={class:"input-group"},q={key:0,class:"text-center py-5"},F={class:"card border-0 shadow-sm d-none d-md-block"},M={class:"card-body p-0"},H={class:"table-responsive"},K={class:"table table-hover mb-0 catalogues-table"},z={class:"table-light"},U={class:"text-muted catalogue-col-id"},G={class:"d-flex align-items-center"},J={key:0,class:"catalogue-thumbnail me-2"},O=["src"],Q={key:0},W={key:1,class:"text-muted"},X={key:0},Y={class:"text-muted"},Z={class:"text-center"},ss={key:0,class:"badge bg-warning text-dark me-1",title:"Paniers en cours"},ts={key:1,class:"badge bg-success",title:"Commandes validées"},es={key:2,class:"text-muted"},is={class:"text-end"},os=["href"],rs={key:1,class:"badge bg-secondary"},ns={class:"d-md-none"},ls={class:"card-body"},as={key:0,class:"flex-shrink-0"},ds=["src"],us={class:"flex-grow-1"},ms={class:"card-title mb-2"},bs={class:"text-muted"},cs={key:0,class:"card-text text-muted small mb-0 mt-1"},ps={class:"row g-2 mb-3"},gs={class:"col-6"},_s={key:0},xs={class:"col-6"},fs={class:"col-6"},vs={class:"col-6"},ys={key:0,class:"badge bg-warning text-dark me-1"},hs={key:1,class:"badge bg-success"},ks={key:2,class:"text-muted"},ws=["href"],Cs={key:1,class:"alert alert-secondary mb-0 text-center"},$s={class:"mt-3 text-muted small"},Ds={__name:"CataloguesPage",setup(l){const r=A();function m(n){if(!n)return-1;const s=new Date;s.setHours(0,0,0,0);const e=new Date(n);return e.setHours(0,0,0,0),Math.ceil((e-s)/(1e3*60*60*24))}function _(n){return n<0?"bg-secondary":n===0?"bg-danger":n===1?"bg-warning text-dark":n<=3?"bg-info":"bg-success"}function p(n){return n<0?"Expiré":n===0?"Expire aujourd'hui":n===1?"Expire demain":`${n} jour${n>1?"s":""} restant${n>1?"s":""}`}function c(n){r.sortBy(n)}return k(()=>{r.loadAll()}),(n,s)=>(i(),o("div",P,[t("div",L,[t("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:s[0]||(s[0]=e=>n.history.back())},[...s[10]||(s[10]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),u("Retour ",-1)])]),s[37]||(s[37]=t("div",{class:"d-flex justify-content-between align-items-center mb-4"},[t("h2",null,[t("i",{class:"bi bi-book me-2"}),u("Catalogues disponibles")])],-1)),d(r).error?(i(),o("div",R,[s[11]||(s[11]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),s[12]||(s[12]=t("strong",null,"Erreur :",-1)),u(" "+a(d(r).error)+" ",1),t("button",{type:"button",class:"btn-close",onClick:s[1]||(s[1]=e=>d(r).error=null)})])):b("",!0),d(r).loading?(i(),o("div",N,[...s[13]||(s[13]=[t("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),t("p",{class:"mt-3 text-muted"},"Chargement des catalogues...",-1)])])):(i(),o(x,{key:2},[t("div",S,[t("div",V,[t("div",j,[s[14]||(s[14]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),w(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>d(r).searchTerm=e),type:"text",class:"form-control",placeholder:"Rechercher par nom, description ou auteur..."},null,512),[[C,d(r).searchTerm]])])])]),d(r).sortedCatalogues.length===0?(i(),o("div",q,[...s[15]||(s[15]=[t("i",{class:"bi bi-inbox fs-1 text-muted mb-3 d-block"},null,-1),t("p",{class:"text-muted"},"Aucun catalogue trouvé",-1)])])):(i(),o(x,{key:1},[t("div",F,[t("div",M,[t("div",H,[t("table",K,[t("thead",z,[t("tr",null,[t("th",{class:"sortable text-nowrap catalogue-col-id",style:{cursor:"pointer","user-select":"none"},role:"button",tabindex:"0",onClick:s[3]||(s[3]=f(e=>c("id"),["prevent"])),onKeydown:[s[4]||(s[4]=v(f(e=>c("id"),["prevent"]),["enter"])),s[5]||(s[5]=v(f(e=>c("id"),["prevent"]),["space"]))]},[s[16]||(s[16]=u(" ID ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("id")+" ms-1"])},null,2)],32),t("th",{class:"sortable",style:{width:"28%",cursor:"pointer"},onClick:s[6]||(s[6]=e=>d(r).sortBy("originalname"))},[s[17]||(s[17]=u(" Nom du catalogue ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("originalname")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[7]||(s[7]=e=>d(r).sortBy("expiration_date"))},[s[18]||(s[18]=u(" Expiration ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("expiration_date")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[8]||(s[8]=e=>d(r).sortBy("date_livraison"))},[s[19]||(s[19]=u(" Livraison ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("date_livraison")+" ms-1"])},null,2)]),t("th",{class:"sortable",style:{width:"15%",cursor:"pointer"},onClick:s[9]||(s[9]=e=>d(r).sortBy("username"))},[s[20]||(s[20]=u(" Publié par ",-1)),t("i",{class:g(["bi","bi-"+d(r).sortIcon("username")+" ms-1"])},null,2)]),s[21]||(s[21]=t("th",{class:"text-center",style:{width:"10%"}},"Statut",-1)),s[22]||(s[22]=t("th",{class:"text-end",style:{width:"15%"}},"Actions",-1))])]),t("tbody",null,[(i(!0),o(x,null,y(d(r).sortedCatalogues,e=>(i(),o("tr",{key:e.id},[t("td",U,[t("strong",null,a(e.id),1)]),t("td",null,[t("div",G,[e.image_filename?(i(),o("span",J,[t("img",{src:`/uploads/catalogue-images/${e.image_filename}`,alt:"Photo",style:{width:"50px",height:"50px","object-fit":"cover","border-radius":"4px"}},null,8,O)])):b("",!0),t("div",null,[t("strong",null,a(e.originalname),1),e.description?(i(),o("br",Q)):b("",!0),e.description?(i(),o("small",W,a(e.description),1)):b("",!0)])])]),t("td",null,[u(a(e.expiration_formatted||"-")+" ",1),m(e.expiration_date)>=0?(i(),o("br",X)):b("",!0),m(e.expiration_date)>=0?(i(),o("span",{key:1,class:g(["badge",_(m(e.expiration_date))])},a(p(m(e.expiration_date))),3)):b("",!0)]),t("td",null,a(e.livraison_formatted||"-"),1),t("td",null,[s[23]||(s[23]=t("i",{class:"bi bi-person-circle me-1"},null,-1)),u(a(e.username)+" ",1),s[24]||(s[24]=t("br",null,null,-1)),t("small",Y,a(e.upload_formatted||"-"),1)]),t("td",Z,[e.nb_paniers_non_submis>0?(i(),o("span",ss,[s[25]||(s[25]=t("i",{class:"bi bi-cart3"},null,-1)),u(" "+a(e.nb_paniers_non_submis),1)])):b("",!0),e.nb_paniers_submis>0?(i(),o("span",ts,[s[26]||(s[26]=t("i",{class:"bi bi-check-circle"},null,-1)),u(" "+a(e.nb_paniers_submis),1)])):b("",!0),!e.nb_paniers_non_submis&&!e.nb_paniers_submis?(i(),o("span",es,"-")):b("",!0)]),t("td",is,[m(e.expiration_date)>=0?(i(),o("a",{key:0,href:`/catalogues/${e.id}/vue?nouveau=1`,class:"btn btn-sm btn-primary"},[...s[27]||(s[27]=[t("i",{class:"bi bi-cart-plus me-1"},null,-1),u("Faire un panier ",-1)])],8,os)):(i(),o("span",rs,"Expiré"))])]))),128))])])])])]),t("div",ns,[(i(!0),o(x,null,y(d(r).sortedCatalogues,e=>(i(),o("div",{key:"m-"+e.id,class:"card mb-3 shadow-sm"},[t("div",ls,[t("div",{class:g(["d-flex mb-3",{"gap-3":e.image_filename}])},[e.image_filename?(i(),o("div",as,[t("img",{src:`/uploads/catalogue-images/${e.image_filename}`,alt:"Photo",style:{width:"66px",height:"66px","object-fit":"cover","border-radius":"4px"}},null,8,ds)])):b("",!0),t("div",us,[t("h5",ms,a(e.originalname),1),t("small",bs,"ID : "+a(e.id),1),e.description?(i(),o("p",cs,a(e.description),1)):b("",!0)])],2),t("div",ps,[t("div",gs,[s[28]||(s[28]=t("small",{class:"text-muted d-block"},"Expiration",-1)),t("strong",null,a(e.expiration_formatted||"-"),1),m(e.expiration_date)>=0?(i(),o("div",_s,[t("span",{class:g(["badge mt-1",_(m(e.expiration_date))])},a(p(m(e.expiration_date))),3)])):b("",!0)]),t("div",xs,[s[29]||(s[29]=t("small",{class:"text-muted d-block"},"Livraison",-1)),t("strong",null,a(e.livraison_formatted||"-"),1)]),t("div",fs,[s[30]||(s[30]=t("small",{class:"text-muted d-block"},"Publié par",-1)),t("strong",null,a(e.username),1)]),t("div",vs,[s[33]||(s[33]=t("small",{class:"text-muted d-block"},"Statut",-1)),e.nb_paniers_non_submis>0?(i(),o("span",ys,[s[31]||(s[31]=t("i",{class:"bi bi-cart3"},null,-1)),u(" "+a(e.nb_paniers_non_submis),1)])):b("",!0),e.nb_paniers_submis>0?(i(),o("span",hs,[s[32]||(s[32]=t("i",{class:"bi bi-check-circle"},null,-1)),u(" "+a(e.nb_paniers_submis),1)])):b("",!0),!e.nb_paniers_non_submis&&!e.nb_paniers_submis?(i(),o("span",ks,"-")):b("",!0)])]),m(e.expiration_date)>=0?(i(),o("a",{key:0,href:`/catalogues/${e.id}/vue?nouveau=1`,class:"btn btn-primary w-100"},[...s[34]||(s[34]=[t("i",{class:"bi bi-cart-plus me-2"},null,-1),u("Faire un panier ",-1)])],8,ws)):(i(),o("div",Cs,[...s[35]||(s[35]=[t("i",{class:"bi bi-clock-history me-2"},null,-1),u("Catalogue expiré ",-1)])]))])]))),128))]),t("div",$s,[s[36]||(s[36]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),u(" "+a(d(r).sortedCatalogues.length)+" catalogue(s) affiché(s) ",1)])],64))],64))])]))}},Ts=I(Ds,[["__scopeId","data-v-899d39d0"]]),h=$(Ts);h.use(T());h.mount("#catalogues-app");
