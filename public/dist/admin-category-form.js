import{i as P,o as a,c as i,a as e,b as r,t as n,d,w as x,e as v,v as g,q as E,F as A,k as T,n as k,j as F,p as U,r as u,g as C,h as z}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{c as L}from"./chunks/pinia-BNknc8Vm.js";const O={class:"container-fluid px-3 mt-4"},R={key:0,class:"alert alert-danger alert-dismissible fade show"},D={key:1,class:"alert alert-success alert-dismissible fade show"},q={key:2,class:"alert alert-danger"},j={class:"mb-4"},$={class:"row"},G={class:"col-12 col-lg-8"},K={class:"card"},Z={class:"card-body"},H=["value"],J={class:"mb-3"},Q={class:"mb-3"},W=["value"],X={class:"row"},Y={class:"col-md-6 mb-3"},ee={class:"col-md-6 mb-3"},te={class:"mb-3"},le={class:"dropdown"},se={class:"btn btn-outline-secondary dropdown-toggle w-100 text-start d-flex align-items-center justify-content-between",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},oe={key:0},ae={class:"text-muted small"},ie={key:1,class:"text-muted"},re={class:"dropdown-menu w-100",style:{"max-height":"400px","overflow-y":"auto"}},ne=["onClick"],ue={class:"mb-3"},de={class:"mb-3"},ce={class:"form-check"},ve={class:"d-flex gap-2"},me=["disabled"],be={key:0,class:"spinner-border spinner-border-sm me-1"},pe={key:0,class:"col-12 col-lg-4 mt-3 mt-lg-0"},fe={class:"card mb-3"},ge={class:"card-body"},ye={class:"card"},_e={class:"card-body"},we=["action"],xe=["value"],ke={__name:"AdminCategoryFormPage",setup(Ce){const l=u({nom:"",description:"",parent_id:"",ordre:0,couleur:"#6c757d",icon:"",is_active:1}),h=u([]),c=u(null),S=u("add"),m=u(""),y=u(""),_=u(""),p=u(!1),w=C(()=>window.CSRF_TOKEN||""),f=C(()=>S.value==="edit"),M=C(()=>{const s=h.value||[];return c.value?s.filter(t=>Number(t.id)!==Number(c.value)):s}),V=[{value:"bi bi-basket",label:"Panier (fruits/légumes)"},{value:"bi bi-apple",label:"Pomme (fruits)"},{value:"bi bi-egg",label:"Œuf"},{value:"bi bi-cup-hot",label:"Tasse chaude"},{value:"bi bi-cup-straw",label:"Boisson"},{value:"bi bi-droplet",label:"Goutte"},{value:"bi bi-flower1",label:"Fleur (aromates)"},{value:"bi bi-tree",label:"Arbre (fruits à coque)"},{value:"bi bi-snow",label:"Flocon (surgelés)"},{value:"bi bi-fire",label:"Feu"},{value:"bi bi-box-seam",label:"Boîte"},{value:"bi bi-bag",label:"Sac (vrac)"},{value:"bi bi-cart",label:"Caddie"},{value:"bi bi-star",label:"Étoile"},{value:"bi bi-tag",label:"Étiquette"},{value:"bi bi-shop",label:"Boutique"},{value:"bi bi-truck",label:"Camion"}];P(()=>{var t;const s=window.INITIAL_DATA||{};S.value=s.action||"add",h.value=s.allCategories||[],c.value=s.categoryId||((t=s.category)==null?void 0:t.id)||null,y.value=s.errorMessage||"",_.value=s.successMessage||"",s.category&&(l.value.nom=s.category.nom||"",l.value.description=s.category.description||"",l.value.parent_id=s.category.parent_id!=null?String(s.category.parent_id):"",l.value.ordre=s.category.ordre??0,l.value.couleur=s.category.couleur||"#6c757d",l.value.icon=s.category.icon||"",l.value.is_active=s.category.is_active?1:0)});function B(s){confirm(`⚠️ ATTENTION : Êtes-vous sûr de vouloir SUPPRIMER définitivement cette catégorie ?

Cette action est IRRÉVERSIBLE.`)||s.preventDefault()}async function I(){m.value="",p.value=!0;try{const s=new URLSearchParams({nom:l.value.nom.trim(),description:l.value.description||"",parent_id:l.value.parent_id||"",ordre:String(l.value.ordre??0),couleur:l.value.couleur||"",icon:l.value.icon||"",is_active:l.value.is_active?"1":"0",_csrf:w.value}),t=f.value?`/admin/categories/${c.value}`:"/admin/categories",b=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:s.toString(),credentials:"include"})).json().catch(()=>({}));if(b.success&&b.redirect){window.location.href=b.redirect;return}m.value=b.error||"Une erreur est survenue."}catch{m.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}return(s,t)=>(a(),i("div",O,[y.value?(a(),i("div",R,[t[7]||(t[7]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),r(n(y.value)+" ",1),t[8]||(t[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Fermer"},null,-1))])):d("",!0),_.value?(a(),i("div",D,[t[9]||(t[9]=e("i",{class:"bi bi-check-circle me-2"},null,-1)),r(n(_.value)+" ",1),t[10]||(t[10]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Fermer"},null,-1))])):d("",!0),m.value?(a(),i("div",q,n(m.value),1)):d("",!0),e("h2",j,n(f.value?"Modifier une catégorie":"Créer une nouvelle catégorie"),1),e("div",$,[e("div",G,[e("div",K,[e("div",Z,[e("form",{onSubmit:x(I,["prevent"])},[e("input",{type:"hidden",name:"_csrf",value:w.value},null,8,H),e("div",J,[t[11]||(t[11]=e("label",{for:"nom",class:"form-label"},[r("Nom de la catégorie "),e("span",{class:"text-danger"},"*")],-1)),v(e("input",{id:"nom","onUpdate:modelValue":t[0]||(t[0]=o=>l.value.nom=o),type:"text",class:"form-control",required:""},null,512),[[g,l.value.nom]])]),e("div",Q,[t[13]||(t[13]=e("label",{for:"parent_id",class:"form-label"},"Catégorie parente",-1)),v(e("select",{id:"parent_id","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.parent_id=o),class:"form-select"},[t[12]||(t[12]=e("option",{value:""},"Aucune (catégorie principale)",-1)),(a(!0),i(A,null,T(M.value,o=>(a(),i("option",{key:o.id,value:o.id},n(o.nom),9,W))),128))],512),[[E,l.value.parent_id]]),t[14]||(t[14]=e("small",{class:"form-text text-muted"},"Laissez vide pour créer une catégorie principale",-1))]),e("div",X,[e("div",Y,[t[15]||(t[15]=e("label",{for:"couleur",class:"form-label"},"Couleur",-1)),v(e("input",{id:"couleur","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.couleur=o),type:"color",class:"form-control form-control-color"},null,512),[[g,l.value.couleur]]),t[16]||(t[16]=e("small",{class:"form-text text-muted"},"Couleur d'affichage du badge",-1))]),e("div",ee,[t[17]||(t[17]=e("label",{for:"ordre",class:"form-label"},"Ordre d'affichage",-1)),v(e("input",{id:"ordre","onUpdate:modelValue":t[3]||(t[3]=o=>l.value.ordre=o),type:"number",class:"form-control",min:"0"},null,512),[[g,l.value.ordre,void 0,{number:!0}]]),t[18]||(t[18]=e("small",{class:"form-text text-muted"},"Plus le nombre est petit, plus la catégorie apparaît en haut",-1))])]),e("div",te,[t[21]||(t[21]=e("label",{class:"form-label"},"Icône Bootstrap",-1)),e("div",le,[e("button",se,[l.value.icon?(a(),i("span",oe,[e("i",{class:k([l.value.icon,"me-2"]),style:{"font-size":"1.2rem"}},null,2),e("span",ae,n(l.value.icon),1)])):(a(),i("span",ie,"Choisir une icône..."))]),e("ul",re,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[4]||(t[4]=x(o=>l.value.icon="",["prevent"]))},"Aucune icône")]),t[19]||(t[19]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),t[20]||(t[20]=e("li",{class:"dropdown-header"},"Aliments et Nature",-1)),(a(),i(A,null,T(V,o=>e("li",{key:o.value},[e("a",{class:"dropdown-item",href:"#",onClick:x(b=>l.value.icon=o.value,["prevent"])},[o.value?(a(),i("i",{key:0,class:k([o.value,"me-2"]),style:{"font-size":"1.2rem"}},null,2)):d("",!0),r(" "+n(o.label),1)],8,ne)])),64))])]),t[22]||(t[22]=e("small",{class:"form-text text-muted d-block mt-2"},[e("a",{href:"https://icons.getbootstrap.com/",target:"_blank",rel:"noopener"},"Consulter toutes les icônes Bootstrap")],-1))]),e("div",ue,[t[23]||(t[23]=e("label",{for:"description",class:"form-label"},"Description",-1)),v(e("textarea",{id:"description","onUpdate:modelValue":t[5]||(t[5]=o=>l.value.description=o),class:"form-control",rows:"3"},null,512),[[g,l.value.description]])]),e("div",de,[e("div",ce,[v(e("input",{id:"is_active","onUpdate:modelValue":t[6]||(t[6]=o=>l.value.is_active=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[F,l.value.is_active]]),t[24]||(t[24]=e("label",{class:"form-check-label",for:"is_active"},"Catégorie active",-1))])]),e("div",ve,[e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},[p.value?(a(),i("span",be)):d("",!0),t[25]||(t[25]=e("i",{class:"bi bi-check-lg me-2"},null,-1)),r(" "+n(f.value?"Enregistrer les modifications":"Créer la catégorie"),1)],8,me),t[26]||(t[26]=e("a",{href:"/admin/categories",class:"btn btn-outline-secondary"},[e("i",{class:"bi bi-x-lg me-2"}),r("Annuler ")],-1))])],32)])])]),f.value&&c.value?(a(),i("div",pe,[e("div",fe,[t[28]||(t[28]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Aperçu")],-1)),e("div",ge,[t[27]||(t[27]=e("p",null,"Badge:",-1)),e("span",{class:"badge",style:U({backgroundColor:l.value.couleur||"#6c757d",fontSize:"1rem"})},[l.value.icon?(a(),i("i",{key:0,class:k([l.value.icon,"me-1"])},null,2)):d("",!0),r(" "+n(l.value.nom||"Nom"),1)],4)])]),e("div",ye,[t[32]||(t[32]=e("div",{class:"card-header bg-danger text-white"},[e("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),e("div",_e,[t[30]||(t[30]=e("p",{class:"text-muted"},[e("strong",null,"Attention :"),r(" La suppression d'une catégorie est irréversible. ")],-1)),t[31]||(t[31]=e("p",{class:"text-muted small"},"La suppression sera refusée si des produits ou sous-catégories y sont rattachés.",-1)),e("form",{method:"POST",action:`/admin/categories/${c.value}/delete`,onSubmit:B},[e("input",{type:"hidden",name:"_csrf",value:w.value},null,8,xe),t[29]||(t[29]=e("button",{type:"submit",class:"btn btn-danger w-100"},[e("i",{class:"bi bi-trash me-2"}),r("Supprimer la catégorie ")],-1))],40,we)])])])):d("",!0)])]))}},N=z(ke);N.use(L());N.mount("#admin-category-form-app");
