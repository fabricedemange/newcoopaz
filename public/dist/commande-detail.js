import{m as E,i as D,o as r,c as a,a as e,b as c,u as o,t as n,d as b,F as v,j as F,n as R,l as w,q as _,e as I,v as q,p as S,r as x,h as $}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as P,c as T}from"./chunks/pinia-gLxYYWQL.js";import{r as V,k as B,l as K,A}from"./chunks/index-fBysSQKd.js";import{_ as j}from"./chunks/BackButton-DzFd1NqY.js";const L=P("commandeDetail",{state:()=>({loading:!1,error:null,authRequired:!1,commande:null,articles:[],editingNoteId:null}),getters:{articlesByCategory(d){const s={};return(d.articles||[]).forEach(m=>{const u=m.categorie||"Sans catégorie";s[u]||(s[u]={name:u,color:m.categorie_couleur||"#6c757d",ordre:m.categorie_ordre??999,articles:[]}),s[u].articles.push(m)}),Object.values(s).sort((m,u)=>m.ordre-u.ordre)},totalCommande(d){return(d.articles||[]).reduce((s,m)=>s+(parseFloat(m.prix)||0)*(parseFloat(m.quantity)||0),0)}},actions:{async loadDetail(d){this.loading=!0,this.error=null,this.authRequired=!1,this.commande=null,this.articles=[];try{const s=await K(d);if(s.success)this.commande=s.commande,this.articles=s.articles||[];else throw new Error(s.error||"Erreur chargement")}catch(s){this.error=s.message,s.code===A&&(this.authRequired=!0),console.error("commandeDetail loadDetail:",s)}finally{this.loading=!1}},setEditingNoteId(d){this.editingNoteId=this.editingNoteId===d?null:d},async saveNote(d,s,m){await B(d,s,m);const u=this.articles.find(g=>g.id===d);u&&(u.note=s),this.editingNoteId=null},async reopenCommande(d,s){await V(d,s),typeof window<"u"&&(window.location.href=`/panier/${d}/modifier/vue`)}}}),M={class:"admin-content-wrapper"},O={class:"container-fluid mt-4"},z={key:0,class:"alert alert-danger alert-dismissible fade show"},U={key:1,class:"text-center py-5"},Q={class:"d-flex justify-content-between align-items-center mb-4"},G={class:"mb-0"},H={class:"d-flex gap-2"},J={class:"card mb-4"},W={class:"card-body"},X={class:"row"},Y={class:"col-md-6"},Z={key:0},ee={class:"col-md-6"},te={key:0,class:"badge bg-danger ms-2"},se={key:0,class:"alert alert-info mt-3"},oe={key:0,class:"mb-4"},ne={class:"mb-0"},ie={class:"badge bg-secondary ms-2"},le={class:"card-body p-0"},re={class:"table-responsive"},ae={class:"table table-hover mb-0"},de={key:0},me={key:1,class:"text-muted"},ue={class:"text-end"},ce={class:"text-center"},pe={class:"badge bg-primary"},be={class:"text-end"},fe={key:0,class:"input-group input-group-sm"},ge=["onKeyup"],ye=["onClick"],ve={key:1,class:"d-flex align-items-center gap-2"},he={class:"flex-grow-1"},we=["onClick"],_e={class:"card bg-light"},xe={class:"card-body"},ke={class:"row"},Ce={class:"col-md-6 text-end"},Ne={class:"text-primary"},Ee={__name:"CommandeDetailPage",setup(d){const s=L(),m=x(null),u=x("");function g(){return(typeof window<"u"?window.location.pathname.split("/"):[])[2]||null}function y(i){return i==null?"0,00 €":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i)}function C(i){s.setEditingNoteId(i.id),u.value=i.note||""}function h(i){const t=u.value;s.saveNote(i.id,t,typeof window<"u"?window.CSRF_TOKEN:"").catch(p=>{console.error("saveNote:",p),typeof window<"u"&&alert("Erreur lors de la sauvegarde de la note")})}function N(){m.value&&confirm("Confirmer la réouverture de cette commande en panier ?")&&s.reopenCommande(m.value,typeof window<"u"?window.CSRF_TOKEN:"")}return E(()=>s.editingNoteId,i=>{i||(u.value="")}),D(()=>{const i=g();m.value=i,i&&s.loadDetail(i)}),(i,t)=>(r(),a("div",M,[e("div",O,[e("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:t[0]||(t[0]=p=>i.history.back())},[...t[4]||(t[4]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),c("Retour ",-1)])]),o(s).error?(r(),a("div",z,[t[5]||(t[5]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),t[6]||(t[6]=e("strong",null,"Erreur :",-1)),c(" "+n(o(s).error)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=p=>o(s).error=null)})])):b("",!0),o(s).loading?(r(),a("div",U,[...t[7]||(t[7]=[e("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),e("p",{class:"mt-3 text-muted"},"Chargement de la commande...",-1)])])):o(s).commande?(r(),a(v,{key:2},[e("div",Q,[e("h2",G,[t[8]||(t[8]=e("i",{class:"bi bi-receipt me-2"},null,-1)),c("Commande #"+n(o(s).commande.id),1)]),e("div",H,[F(j),t[9]||(t[9]=e("a",{href:"/commandes/vue",class:"btn btn-secondary"},"Liste des commandes",-1))])]),e("div",J,[t[21]||(t[21]=e("div",{class:"card-header bg-primary text-white"},[e("h5",{class:"mb-0"},[e("i",{class:"bi bi-info-circle me-2"}),c("Informations")])],-1)),e("div",W,[e("div",X,[e("div",Y,[e("p",null,[t[10]||(t[10]=e("strong",null,"Demandeur :",-1)),t[11]||(t[11]=c()),t[12]||(t[12]=e("i",{class:"bi bi-person-circle"},null,-1)),c(" "+n(o(s).commande.username),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"Catalogue :",-1)),c(" "+n(o(s).commande.originalname),1)]),o(s).commande.catalog_description?(r(),a("p",Z,[t[14]||(t[14]=e("strong",null,"Description :",-1)),c(" "+n(o(s).commande.catalog_description),1)])):b("",!0),e("p",null,[t[15]||(t[15]=e("strong",null,"Date de commande :",-1)),c(" "+n(o(s).commande.created_formatted),1)])]),e("div",ee,[e("p",null,[t[16]||(t[16]=e("strong",null,"Date d'expiration :",-1)),c(" "+n(o(s).commande.expiration_formatted)+" ",1),o(s).commande.isExpired?(r(),a("span",te,"Expiré")):b("",!0)]),e("p",null,[t[17]||(t[17]=e("strong",null,"Date de livraison :",-1)),c(" "+n(o(s).commande.livraison_formatted),1)]),e("p",null,[t[18]||(t[18]=e("strong",null,"Statut :",-1)),t[19]||(t[19]=c()),e("span",{class:R(o(s).commande.modifiable?"badge bg-warning":"badge bg-secondary")},n(o(s).commande.modifiable?"Modifiable":"Non modifiable"),3)])])]),o(s).commande.note?(r(),a("div",se,[t[20]||(t[20]=e("strong",null,"Note :",-1)),c(" "+n(o(s).commande.note),1)])):b("",!0)])]),o(s).commande.modifiable?(r(),a("div",oe,[e("button",{class:"btn btn-warning",onClick:N},[...t[22]||(t[22]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),c("Repasser en panier ",-1)])])])):b("",!0),(r(!0),a(v,null,w(o(s).articlesByCategory,p=>(r(),a("div",{key:p.name,class:"card mb-4"},[e("div",{class:"card-header",style:_({backgroundColor:p.color+"20",borderLeft:"4px solid "+p.color})},[e("h5",ne,[e("i",{class:"bi bi-tag-fill me-2",style:_({color:p.color})},null,4),c(n(p.name)+" ",1),e("span",ie,n(p.articles.length)+" article(s)",1)])],4),e("div",le,[e("div",re,[e("table",ae,[t[26]||(t[26]=e("thead",{class:"thead-precommandes"},[e("tr",null,[e("th",{style:{width:"40%"}},"Produit"),e("th",{style:{width:"10%"}},"Fournisseur"),e("th",{style:{width:"10%"},class:"text-end"},"Prix unitaire"),e("th",{style:{width:"10%"},class:"text-center"},"Quantité"),e("th",{style:{width:"10%"},class:"text-end"},"Total"),e("th",{style:{width:"20%"}},"Note")])],-1)),e("tbody",null,[(r(!0),a(v,null,w(p.articles,l=>(r(),a("tr",{key:l.id},[e("td",null,[e("strong",null,n(l.produit),1),l.description?(r(),a("br",de)):b("",!0),l.description?(r(),a("small",me,n(l.description),1)):b("",!0)]),e("td",null,n(l.fournisseur||"-"),1),e("td",ue,n(y(l.prix))+" / "+n(l.unite),1),e("td",ce,[e("span",pe,n(l.quantity),1)]),e("td",be,[e("strong",null,n(y((parseFloat(l.prix)||0)*(parseFloat(l.quantity)||0))),1)]),e("td",null,[o(s).editingNoteId===l.id?(r(),a("div",fe,[I(e("input",{"onUpdate:modelValue":t[2]||(t[2]=f=>u.value=f),type:"text",class:"form-control",placeholder:"Note optionnelle",onKeyup:S(f=>h(l),["enter"])},null,40,ge),[[q,u.value]]),e("button",{class:"btn btn-success",onClick:f=>h(l)},[...t[23]||(t[23]=[e("i",{class:"bi bi-check"},null,-1)])],8,ye),e("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=f=>o(s).setEditingNoteId(null))},[...t[24]||(t[24]=[e("i",{class:"bi bi-x"},null,-1)])])])):(r(),a("div",ve,[e("span",he,n(l.note||"-"),1),e("button",{class:"btn btn-sm btn-outline-primary",onClick:f=>C(l)},[...t[25]||(t[25]=[e("i",{class:"bi bi-pencil"},null,-1)])],8,we)]))])]))),128))])])])])]))),128)),e("div",_e,[e("div",xe,[e("div",ke,[t[27]||(t[27]=e("div",{class:"col-md-6"},[e("h5",null,"Total de la commande")],-1)),e("div",Ce,[e("h4",Ne,n(y(o(s).totalCommande)),1)])])])])],64)):b("",!0)])]))}},k=$(Ee);k.use(T());k.mount("#commande-detail-app");
