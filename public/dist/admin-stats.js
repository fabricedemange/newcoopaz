import{i as F,o as d,c as u,u as o,a as t,t as n,b as r,e as L,v as T,n as c,d as p,F as C,k,g as D,h as Q}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{d as M,c as I}from"./chunks/pinia-8wUEIqj_.js";import{a5 as E,a6 as P,a7 as R,a8 as U,a9 as j}from"./chunks/index-zlPV8JO4.js";import{_ as q}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const O=M("adminStats",{state:()=>({stats:{total_commandes:0,total_utilisateurs:0,total_catalogues:0},loading:!0,error:null,currentView:null,detailsLoading:!1,detailsData:[],searchQuery:"",sortColumn:null,sortDirection:"desc"}),getters:{filteredDetails(l){if(!l.searchQuery)return l.detailsData;const e=l.searchQuery.toLowerCase();return l.detailsData.filter(v=>Object.values(v).some(y=>y&&String(y).toLowerCase().includes(e)))},sortedDetails(l){const e=l.searchQuery?l.detailsData.filter(y=>Object.values(y).some(h=>h&&String(h).toLowerCase().includes(l.searchQuery.toLowerCase()))):l.detailsData;if(!l.sortColumn)return e;const v=[...e];return v.sort((y,h)=>{let b=y[l.sortColumn],m=h[l.sortColumn];return b==null?1:m==null?-1:((l.sortColumn.includes("date")||l.sortColumn.includes("login")||l.sortColumn==="created_at"||l.sortColumn==="last_login")&&(b=new Date(b).getTime(),m=new Date(m).getTime()),(typeof b=="number"||!Number.isNaN(parseFloat(b)))&&(b=parseFloat(b)||0,m=parseFloat(m)||0),b<m?l.sortDirection==="asc"?-1:1:b>m?l.sortDirection==="asc"?1:-1:0)}),v}},actions:{async loadStats(){this.loading=!0,this.error=null;try{const l=await j();if(l.success)this.stats=l.stats||this.stats;else throw new Error(l.error)}catch(l){this.error=l.message||"Erreur lors du chargement des statistiques"}finally{this.loading=!1}},async showDetails(l){this.currentView=l,this.detailsLoading=!0,this.detailsData=[],this.searchQuery="",this.sortColumn=null,l==="commandes"?this.sortColumn="commande_id":l==="utilisateurs"?this.sortColumn="id":l==="catalogues"?this.sortColumn="catalogue_id":l==="periodes"&&(this.sortColumn="periode_label"),this.error=null;try{let e;if(l==="commandes")e=await E();else if(l==="utilisateurs")e=await P();else if(l==="catalogues")e=await R();else if(l==="periodes")e=await U();else return;if(e.success)this.detailsData=e[l]||e.commandes||e.utilisateurs||e.catalogues||e.periodes||[];else throw new Error(e.error)}catch(e){this.error=e.message||"Erreur lors du chargement des détails"}finally{this.detailsLoading=!1}},closeDetails(){this.currentView=null,this.detailsData=[],this.searchQuery=""},sortBy(l){this.sortColumn===l?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=l,this.sortDirection="desc")}}}),G={class:"container-fluid mt-4"},K={key:0,class:"text-center py-5"},W={key:1,class:"alert alert-danger"},H={key:2},J={class:"d-flex justify-content-between align-items-center mb-4"},X={class:"row g-4 mb-4"},Y={class:"col-md-3"},Z={class:"card-body text-center"},tt={class:"stat-value",style:{"font-size":"2.2rem","font-weight":"600",color:"#4e54c8"}},st={class:"col-md-3"},et={class:"card-body text-center"},it={class:"stat-value",style:{"font-size":"2.2rem","font-weight":"600",color:"#4e54c8"}},ot={class:"col-md-3"},lt={class:"card-body text-center"},nt={class:"stat-value",style:{"font-size":"2.2rem","font-weight":"600",color:"#4e54c8"}},rt={class:"col-md-3"},at={class:"card-body text-center"},dt={class:"stat-value",style:{"font-size":"2.2rem","font-weight":"600",color:"#4e54c8"}},ut={key:0,class:"mt-4"},mt={class:"d-flex justify-content-between align-items-center mb-3"},ct={class:"mb-0 text-muted"},bt={key:0,class:"text-center py-5"},pt={key:1},gt={class:"mb-3"},yt={key:0,class:"card"},ft={class:"table-responsive"},vt={class:"table table-hover mb-0"},ht={class:"thead-admin-site"},_t={key:0},wt=["href"],Ct={class:"text-muted"},kt={key:1,class:"card"},Dt={class:"table-responsive"},xt={class:"table table-hover mb-0"},St={class:"thead-admin-site"},$t={key:0},Bt={href:"/admin/users/vue",class:"btn btn-outline-primary btn-sm"},Nt={class:"text-muted"},Vt=["href"],At={key:2,class:"card"},zt={class:"table-responsive"},Ft={class:"table table-hover mb-0"},Lt={class:"thead-admin-site"},Tt={key:0},Qt=["href"],Mt={class:"text-muted"},It={class:"badge bg-primary"},Et={class:"text-end"},Pt={key:0,class:"table-light"},Rt={class:"badge bg-primary"},Ut={class:"text-end"},jt={key:3,class:"card"},qt={class:"table-responsive"},Ot={class:"table table-hover mb-0"},Gt={key:0},Kt={key:0,class:"me-2",title:"Mois"},Wt={key:1,class:"periodes-week-branch me-2",title:"Semaine du mois"},Ht={__name:"AdminStatsPage",setup(l){const e=O(),v=D(()=>({commandes:"Commandes validées",utilisateurs:"Utilisateurs inscrits",catalogues:"Catalogues",periodes:"Commandes par période"})[e.currentView]||""),y=D(()=>e.currentView!=="catalogues"?0:e.sortedDetails.reduce((a,s)=>a+(Number(s.nombre_commandes)||0),0)),h=D(()=>e.currentView!=="catalogues"?0:e.sortedDetails.reduce((a,s)=>a+(parseFloat(s.montant_total)||0),0)),b=D(()=>{if(e.currentView!=="periodes"||!e.sortedDetails.length)return[];const a=e.sortedDetails,s=a.filter(g=>g.periode_type==="mois").sort((g,x)=>(x.periode_label||"").localeCompare(g.periode_label||"")),i=a.filter(g=>g.periode_type==="semaine"),_=[];for(const g of s){_.push(g);const x=g.periode_label,B=i.filter(S=>{const f=S.date_debut;return f?(typeof f=="string"?f:f.toISOString?f.toISOString().slice(0,7):String(f).slice(0,7)).slice(0,7)===x:!1});B.sort((S,f)=>(f.periode_label||"").localeCompare(S.periode_label||"")),_.push(...B)}return _});F(()=>{e.loadStats()});function m(a){return e.sortColumn!==a?"":e.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}function w(a){if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?a:s.toLocaleDateString("fr-FR")}function V(a){if(!a)return"—";const s=new Date(a);return Number.isNaN(s.getTime())?a:s.toLocaleString("fr-FR")}function $(a){if(!a)return"0,00";const s=parseFloat(a);return Number.isNaN(s)?"0,00":s.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g," ")}function A(a){return{SuperAdmin:"bg-dark",admin:"bg-danger",referent:"bg-warning text-dark",utilisateur:"bg-primary",epicier:"bg-info text-dark"}[a]||"bg-secondary"}function z(a,s){if(a==="mois"){const[i,_]=s.split("-");return new Date(i,parseInt(_,10)-1,1).toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}if(a==="semaine"){const i=s.split("-");return`Semaine ${i[1]} · ${i[0]}`}return s}return(a,s)=>(d(),u("div",G,[o(e).loading?(d(),u("div",K,[...s[20]||(s[20]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Chargement...")],-1),t("p",{class:"mt-3 text-muted"},"Chargement des statistiques...",-1)])])):o(e).error?(d(),u("div",W,n(o(e).error),1)):(d(),u("div",H,[t("div",J,[s[22]||(s[22]=t("h2",null,[t("i",{class:"bi bi-bar-chart-fill me-2"}),r("Statistiques générales")],-1)),t("button",{type:"button",class:"btn btn-outline-primary",onClick:s[0]||(s[0]=i=>o(e).loadStats())},[...s[21]||(s[21]=[t("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),r("Actualiser ",-1)])])]),t("div",X,[t("div",Y,[t("div",{class:"card stat-card",style:{cursor:"pointer"},onClick:s[1]||(s[1]=i=>o(e).showDetails("commandes"))},[t("div",Z,[s[23]||(s[23]=t("div",{class:"stat-icon text-primary mb-2"},[t("i",{class:"bi bi-bag-check-fill",style:{"font-size":"2.5rem"}})],-1)),t("div",tt,n(o(e).stats.total_commandes||0),1),s[24]||(s[24]=t("div",{class:"stat-label",style:{color:"#888","margin-top":"0.2rem","font-size":"1.05rem"}}," Commandes validées ",-1))])])]),t("div",st,[t("div",{class:"card stat-card",style:{cursor:"pointer"},onClick:s[2]||(s[2]=i=>o(e).showDetails("utilisateurs"))},[t("div",et,[s[25]||(s[25]=t("div",{class:"stat-icon text-warning mb-2"},[t("i",{class:"bi bi-people-fill",style:{"font-size":"2.5rem"}})],-1)),t("div",it,n(o(e).stats.total_utilisateurs||0),1),s[26]||(s[26]=t("div",{class:"stat-label",style:{color:"#888","margin-top":"0.2rem","font-size":"1.05rem"}}," Utilisateurs inscrits ",-1))])])]),t("div",ot,[t("div",{class:"card stat-card",style:{cursor:"pointer"},onClick:s[3]||(s[3]=i=>o(e).showDetails("catalogues"))},[t("div",lt,[s[27]||(s[27]=t("div",{class:"stat-icon text-info mb-2"},[t("i",{class:"bi bi-book-fill",style:{"font-size":"2.5rem"}})],-1)),t("div",nt,n(o(e).stats.total_catalogues||0),1),s[28]||(s[28]=t("div",{class:"stat-label",style:{color:"#888","margin-top":"0.2rem","font-size":"1.05rem"}}," Catalogues ",-1))])])]),t("div",rt,[t("div",{class:"card stat-card",style:{cursor:"pointer"},onClick:s[4]||(s[4]=i=>o(e).showDetails("periodes"))},[t("div",at,[s[29]||(s[29]=t("div",{class:"stat-icon text-success mb-2"},[t("i",{class:"bi bi-calendar-week",style:{"font-size":"2.5rem"}})],-1)),t("div",dt,n(o(e).stats.total_commandes||0),1),s[30]||(s[30]=t("div",{class:"stat-label",style:{color:"#888","margin-top":"0.2rem","font-size":"1.05rem"}}," Commandes par période ",-1))])])])]),o(e).currentView?(d(),u("div",ut,[t("div",mt,[t("h5",ct,[s[31]||(s[31]=t("i",{class:"bi bi-table me-2"},null,-1)),r("Détail : "+n(v.value),1)]),t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:s[5]||(s[5]=i=>o(e).closeDetails())},[...s[32]||(s[32]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),r("Fermer ",-1)])])]),o(e).detailsLoading?(d(),u("div",bt,[...s[33]||(s[33]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Chargement...")],-1)])])):(d(),u("div",pt,[t("div",gt,[L(t("input",{"onUpdate:modelValue":s[6]||(s[6]=i=>o(e).searchQuery=i),type:"text",class:"form-control",placeholder:"Rechercher..."},null,512),[[T,o(e).searchQuery]])]),o(e).currentView==="commandes"?(d(),u("div",yt,[s[40]||(s[40]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-bag-check-fill me-2"}),r("Détail des commandes validées")])],-1)),t("div",ft,[t("table",vt,[t("thead",ht,[t("tr",null,[t("th",{style:{cursor:"pointer"},onClick:s[7]||(s[7]=i=>o(e).sortBy("commande_id"))},[s[34]||(s[34]=r(" ID ",-1)),t("i",{class:c("bi ms-1 "+m("commande_id"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[8]||(s[8]=i=>o(e).sortBy("username"))},[s[35]||(s[35]=r(" Utilisateur ",-1)),t("i",{class:c("bi ms-1 "+m("username"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[9]||(s[9]=i=>o(e).sortBy("catalogue"))},[s[36]||(s[36]=r(" Catalogue ",-1)),t("i",{class:c("bi ms-1 "+m("catalogue"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[10]||(s[10]=i=>o(e).sortBy("created_at"))},[s[37]||(s[37]=r(" Date ",-1)),t("i",{class:c("bi ms-1 "+m("created_at"))},null,2)])])]),t("tbody",null,[o(e).sortedDetails.length===0?(d(),u("tr",_t,[...s[38]||(s[38]=[t("td",{colspan:"4",class:"text-center text-muted py-4"},"Aucune commande",-1)])])):p("",!0),(d(!0),u(C,null,k(o(e).sortedDetails,i=>(d(),u("tr",{key:i.commande_id},[t("td",null,[t("a",{href:"/commandes/"+i.commande_id+"/vue",class:"btn btn-outline-primary btn-sm"},[s[39]||(s[39]=t("i",{class:"bi bi-eye me-1"},null,-1)),r(n(i.commande_id),1)],8,wt)]),t("td",null,[r(n(i.username)+" ",1),t("span",Ct,n(i.organization_name),1)]),t("td",null,n(i.catalogue),1),t("td",null,n(w(i.created_at)),1)]))),128))])])])])):p("",!0),o(e).currentView==="utilisateurs"?(d(),u("div",kt,[s[48]||(s[48]=t("div",{class:"card-header bg-warning"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-people-fill me-2"}),r("Détail des utilisateurs inscrits")])],-1)),t("div",Dt,[t("table",xt,[t("thead",St,[t("tr",null,[t("th",{style:{cursor:"pointer"},onClick:s[11]||(s[11]=i=>o(e).sortBy("id"))},[s[41]||(s[41]=r(" ID ",-1)),t("i",{class:c("bi ms-1 "+m("id"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[12]||(s[12]=i=>o(e).sortBy("username"))},[s[42]||(s[42]=r(" Nom d'utilisateur ",-1)),t("i",{class:c("bi ms-1 "+m("username"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[13]||(s[13]=i=>o(e).sortBy("email"))},[s[43]||(s[43]=r(" Email ",-1)),t("i",{class:c("bi ms-1 "+m("email"))},null,2)]),s[45]||(s[45]=t("th",null,"Rôle",-1)),t("th",{style:{cursor:"pointer"},onClick:s[14]||(s[14]=i=>o(e).sortBy("last_login"))},[s[44]||(s[44]=r(" Dernière connexion ",-1)),t("i",{class:c("bi ms-1 "+m("last_login"))},null,2)])])]),t("tbody",null,[o(e).sortedDetails.length===0?(d(),u("tr",$t,[...s[46]||(s[46]=[t("td",{colspan:"5",class:"text-center text-muted py-4"},"Aucun utilisateur",-1)])])):p("",!0),(d(!0),u(C,null,k(o(e).sortedDetails,i=>(d(),u("tr",{key:i.id},[t("td",null,[t("a",Bt,[s[47]||(s[47]=t("i",{class:"bi bi-eye me-1"},null,-1)),r(n(i.id),1)])]),t("td",null,[r(n(i.username)+" ",1),t("span",Nt,"("+n(i.organization_name||"N/A")+")",1)]),t("td",null,[t("a",{href:"mailto:"+i.email},n(i.email),9,Vt)]),t("td",null,[t("span",{class:c(["badge",A(i.role)])},n(i.role),3)]),t("td",null,n(V(i.last_login)),1)]))),128))])])])])):p("",!0),o(e).currentView==="catalogues"?(d(),u("div",At,[s[57]||(s[57]=t("div",{class:"card-header bg-info"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-book-fill me-2"}),r("Détail des catalogues")])],-1)),t("div",zt,[t("table",Ft,[t("thead",Lt,[t("tr",null,[t("th",{style:{cursor:"pointer"},onClick:s[15]||(s[15]=i=>o(e).sortBy("catalogue_id"))},[s[49]||(s[49]=r(" Action ",-1)),t("i",{class:c("bi ms-1 "+m("catalogue_id"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[16]||(s[16]=i=>o(e).sortBy("originalname_id"))},[s[50]||(s[50]=r(" Nom du catalogue ",-1)),t("i",{class:c("bi ms-1 "+m("originalname_id"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[17]||(s[17]=i=>o(e).sortBy("expiration_date"))},[s[51]||(s[51]=r(" Date d'expiration ",-1)),t("i",{class:c("bi ms-1 "+m("expiration_date"))},null,2)]),t("th",{style:{cursor:"pointer"},onClick:s[18]||(s[18]=i=>o(e).sortBy("nombre_commandes"))},[s[52]||(s[52]=r(" Commandes ",-1)),t("i",{class:c("bi ms-1 "+m("nombre_commandes"))},null,2)]),t("th",{style:{cursor:"pointer"},class:"text-end",onClick:s[19]||(s[19]=i=>o(e).sortBy("montant_total"))},[s[53]||(s[53]=r(" Montant total ",-1)),t("i",{class:c("bi ms-1 "+m("montant_total"))},null,2)])])]),t("tbody",null,[o(e).sortedDetails.length===0?(d(),u("tr",Tt,[...s[54]||(s[54]=[t("td",{colspan:"5",class:"text-center text-muted py-4"},"Aucun catalogue",-1)])])):p("",!0),(d(!0),u(C,null,k(o(e).sortedDetails,i=>(d(),u("tr",{key:i.catalogue_id},[t("td",null,[t("a",{href:"/admin/catalogues/"+i.catalogue_id+"/synthese-detaillee/vue",class:"btn btn-outline-primary btn-sm"},[s[55]||(s[55]=t("i",{class:"bi bi-eye me-1"},null,-1)),r(n(i.catalogue_id),1)],8,Qt)]),t("td",null,[r(n(i.originalname_id)+" ",1),t("span",Mt,"("+n(i.organization_name||"N/A")+")",1)]),t("td",null,n(w(i.expiration_date)),1),t("td",null,[t("span",It,n(i.nombre_commandes),1)]),t("td",Et,[t("strong",null,n($(i.montant_total))+" €",1)])]))),128))]),o(e).currentView==="catalogues"&&o(e).sortedDetails.length>0?(d(),u("tfoot",Pt,[t("tr",null,[s[56]||(s[56]=t("td",{colspan:"3",class:"text-end fw-bold"},"Total",-1)),t("td",null,[t("span",Rt,n(y.value),1)]),t("td",Ut,[t("strong",null,n($(h.value))+" €",1)])])])):p("",!0)])])])):p("",!0),o(e).currentView==="periodes"?(d(),u("div",jt,[s[62]||(s[62]=t("div",{class:"card-header bg-success text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-calendar-week me-2"}),r("Commandes par semaine et par mois")])],-1)),t("div",qt,[t("table",Ot,[s[61]||(s[61]=t("thead",{class:"thead-admin-site"},[t("tr",null,[t("th",null,"Type"),t("th",null,"Période"),t("th",null,"Début"),t("th",null,"Fin"),t("th",null,"Commandes")])],-1)),t("tbody",null,[b.value.length===0?(d(),u("tr",Gt,[...s[58]||(s[58]=[t("td",{colspan:"5",class:"text-center text-muted py-4"},"Aucune données",-1)])])):p("",!0),(d(!0),u(C,null,k(b.value,i=>(d(),u("tr",{key:i.periode_type+"-"+i.periode_label+(i.date_debut||""),class:c({"table-primary":i.periode_type==="mois","periodes-week-row":i.periode_type==="semaine"})},[t("td",{class:c({"periodes-semaine-cell":i.periode_type==="semaine"})},[i.periode_type==="mois"?(d(),u("span",Kt,[...s[59]||(s[59]=[t("i",{class:"bi bi-calendar3 text-secondary"},null,-1)])])):(d(),u("span",Wt,[...s[60]||(s[60]=[t("i",{class:"bi bi-arrow-return-right text-info"},null,-1)])])),t("span",{class:c(["badge",i.periode_type==="mois"?"bg-secondary":"bg-info"])},n(i.periode_type==="mois"?"Mois":"Semaine"),3)],2),t("td",{class:c({"periodes-semaine-cell":i.periode_type==="semaine"})},n(z(i.periode_type,i.periode_label)),3),t("td",null,n(w(i.date_debut)),1),t("td",null,n(w(i.date_fin)),1),t("td",null,[t("span",{class:c(["badge",i.periode_type==="mois"?"bg-primary":"bg-light text-dark"])},n(i.nombre_commandes),3)])],2))),128))])])])])):p("",!0)]))])):p("",!0)]))]))}},Jt=q(Ht,[["__scopeId","data-v-6b6cff42"]]),N=Q(Jt);N.use(I());N.mount("#admin-stats-app");
