import{i as F,o as l,c as n,f as I,b as C,t as a,a as t,d as _,F as h,k as w,n as N,r,h as B}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{c as L}from"./chunks/pinia-8wUEIqj_.js";import{N as P,O as V}from"./chunks/index-BwM03k9W.js";const A={class:"container-fluid px-3 mt-4"},E={key:0,class:"alert alert-danger alert-dismissible show"},T={key:1,class:"text-center py-5"},$={key:2,class:"card"},H={class:"card-header"},M={class:"mb-0"},R={class:"card-body p-0"},j={key:0,class:"p-4 text-center text-muted"},z={key:1,class:"table-responsive"},O={class:"table table-hover mb-0"},Q=["onClick"],G={key:3,class:"modal d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},J={class:"modal-dialog modal-lg"},K={class:"modal-content"},U={class:"modal-header"},W={class:"modal-title"},X={class:"modal-body"},Y={key:0,class:"text-muted"},Z={class:"small text-muted"},tt={class:"table-responsive"},et={class:"table table-sm"},st={class:"text-end"},at={class:"text-end"},lt={class:"small text-muted"},nt={__name:"InventaireHistoriquePage",setup(it){const c=r([]),p=r(0),u=r(!1),d=r(""),v=r(!1),o=r(null),m=r(!1);function b(i){if(!i)return"—";const s=new Date(i);return isNaN(s.getTime())?i:s.toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}async function D(){u.value=!0,d.value="";try{const i=await P({limit:100,offset:0});c.value=i.inventaires||[],p.value=i.total??0}catch(i){d.value=i.message||"Erreur chargement"}finally{u.value=!1}}async function q(i){v.value=!0,o.value=null,m.value=!0;try{const s=await V(i);o.value=s}catch(s){d.value=s.message||"Erreur détail"}finally{m.value=!1}}return F(()=>{D()}),(i,s)=>{var y,f,g,x,k;return l(),n("div",A,[s[6]||(s[6]=I('<div class="row mb-3"><div class="col-12"><div class="d-flex justify-content-between align-items-center flex-wrap gap-2"><h2 class="mb-0"><i class="bi bi-clipboard-data me-2"></i>Historique des inventaires</h2><div class="d-flex gap-2"><a href="/caisse/inventaire" class="btn btn-primary"><i class="bi bi-plus me-2"></i>Nouvel inventaire </a><a href="/caisse" class="btn btn-outline-primary"><i class="bi bi-arrow-left me-2"></i>Retour caisse </a></div></div><p class="text-muted small mb-0 mt-2"> Liste des sessions d&#39;inventaire (draft ou complétées). </p></div></div>',1)),d.value?(l(),n("div",E,[C(a(d.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=e=>d.value=null),"aria-label":"Fermer"})])):_("",!0),u.value?(l(),n("div",T,[...s[2]||(s[2]=[t("div",{class:"spinner-border text-primary"},null,-1)])])):(l(),n("div",$,[t("div",H,[t("h5",M,"Sessions ("+a(p.value)+")",1)]),t("div",R,[c.value.length===0?(l(),n("div",j," Aucune session d'inventaire. ")):(l(),n("div",z,[t("table",O,[s[4]||(s[4]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Statut"),t("th",null,"Créé le"),t("th",null,"Par"),t("th",null,"Nb lignes"),t("th",null,"Clôturé le"),t("th",null,"Actions")])],-1)),t("tbody",null,[(l(!0),n(h,null,w(c.value,e=>(l(),n("tr",{key:e.id},[t("td",null,"#"+a(e.id),1),t("td",null,[t("span",{class:N(["badge",e.statut==="complete"?"bg-success":"bg-secondary"])},a(e.statut==="complete"?"Terminé":"Brouillon"),3)]),t("td",null,a(b(e.created_at)),1),t("td",null,a(e.created_by_username||"—"),1),t("td",null,a(e.nb_lignes??0),1),t("td",null,a(e.completed_at?b(e.completed_at):"—"),1),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:ot=>q(e.id)},[...s[3]||(s[3]=[t("i",{class:"bi bi-eye me-1"},null,-1),C("Détail ",-1)])],8,Q)])]))),128))])])]))])])),v.value?(l(),n("div",G,[t("div",J,[t("div",K,[t("div",U,[t("h5",W,"Inventaire #"+a((f=(y=o.value)==null?void 0:y.inventaire)==null?void 0:f.id),1),t("button",{type:"button",class:"btn-close",onClick:s[1]||(s[1]=e=>v.value=!1),"aria-label":"Fermer"})]),t("div",X,[m.value?(l(),n("p",Y,"Chargement...")):o.value?(l(),n(h,{key:1},[t("p",Z," Statut: "+a((g=o.value.inventaire)==null?void 0:g.statut)+" — Créé le "+a(b((x=o.value.inventaire)==null?void 0:x.created_at))+" par "+a((k=o.value.inventaire)==null?void 0:k.created_by_username),1),t("div",tt,[t("table",et,[s[5]||(s[5]=t("thead",null,[t("tr",null,[t("th",null,"Produit"),t("th",{class:"text-end"},"Qté comptée"),t("th",{class:"text-end"},"Stock théorique"),t("th",{class:"text-end"},"Écart"),t("th",null,"Commentaire (écart)")])],-1)),t("tbody",null,[(l(!0),n(h,null,w(o.value.lignes||[],e=>(l(),n("tr",{key:e.product_id},[t("td",null,a(e.product_nom),1),t("td",st,a(e.quantite_comptee),1),t("td",at,a(e.stock_theorique),1),t("td",{class:N(["text-end",e.ecart>0?"text-success":e.ecart<0?"text-danger":""])},a(e.ecart>0?"+":"")+a(e.ecart),3),t("td",lt,a(e.comment||"—"),1)]))),128))])])])],64)):_("",!0)])])])])):_("",!0)])}}},S=B(nt);S.use(L());S.mount("#inventaires-historique-app");
