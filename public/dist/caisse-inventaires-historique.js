import{i as F,o as l,c as n,a as t,b as c,j as I,t as a,d as p,F as h,l as w,n as D,r,h as B}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as L}from"./chunks/pinia-gLxYYWQL.js";import{_ as P}from"./chunks/BackButton-DzFd1NqY.js";import{Q as V,R as $}from"./chunks/index-nogkb2JM.js";const A={class:"container-fluid px-3 mt-4"},E={class:"row mb-3"},R={class:"col-12"},T={class:"d-flex justify-content-between align-items-center flex-wrap gap-2"},j={class:"d-flex gap-2"},H={key:0,class:"alert alert-danger alert-dismissible show"},M={key:1,class:"text-center py-5"},Q={key:2,class:"card"},z={class:"card-header"},G={class:"mb-0"},J={class:"card-body p-0"},K={key:0,class:"p-4 text-center text-muted"},O={key:1,class:"table-responsive"},U={class:"table table-hover mb-0"},W=["onClick"],X={key:3,class:"modal d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},Y={class:"modal-dialog modal-lg"},Z={class:"modal-content"},tt={class:"modal-header"},et={class:"modal-title"},st={class:"modal-body"},at={key:0,class:"text-muted"},lt={class:"small text-muted"},nt={class:"table-responsive"},ot={class:"table table-sm"},it={class:"text-end"},rt={class:"text-end"},dt={class:"small text-muted"},ct={__name:"InventaireHistoriquePage",setup(ut){const u=r([]),y=r(0),m=r(!1),d=r(""),v=r(!1),i=r(null),_=r(!1);function b(o){if(!o)return"—";const e=new Date(o);return isNaN(e.getTime())?o:e.toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}async function S(){m.value=!0,d.value="";try{const o=await V({limit:100,offset:0});u.value=o.inventaires||[],y.value=o.total??0}catch(o){d.value=o.message||"Erreur chargement"}finally{m.value=!1}}async function q(o){v.value=!0,i.value=null,_.value=!0;try{const e=await $(o);i.value=e}catch(e){d.value=e.message||"Erreur détail"}finally{_.value=!1}}return F(()=>{S()}),(o,e)=>{var f,g,x,k,C;return l(),n("div",A,[t("div",E,[t("div",R,[t("div",T,[e[4]||(e[4]=t("h2",{class:"mb-0"},[t("i",{class:"bi bi-clipboard-data me-2"}),c("Historique des inventaires")],-1)),t("div",j,[I(P),e[2]||(e[2]=t("a",{href:"/caisse/inventaire",class:"btn btn-primary"},[t("i",{class:"bi bi-plus me-2"}),c("Nouvel inventaire ")],-1)),e[3]||(e[3]=t("a",{href:"/caisse",class:"btn btn-outline-primary"},[t("i",{class:"bi bi-arrow-left me-2"}),c("Retour caisse ")],-1))])]),e[5]||(e[5]=t("p",{class:"text-muted small mb-0 mt-2"}," Liste des sessions d'inventaire (draft ou complétées). ",-1))])]),d.value?(l(),n("div",H,[c(a(d.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=s=>d.value=null),"aria-label":"Fermer"})])):p("",!0),m.value?(l(),n("div",M,[...e[6]||(e[6]=[t("div",{class:"spinner-border text-primary"},null,-1)])])):(l(),n("div",Q,[t("div",z,[t("h5",G,"Sessions ("+a(y.value)+")",1)]),t("div",J,[u.value.length===0?(l(),n("div",K," Aucune session d'inventaire. ")):(l(),n("div",O,[t("table",U,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Statut"),t("th",null,"Créé le"),t("th",null,"Par"),t("th",null,"Nb lignes"),t("th",null,"Clôturé le"),t("th",null,"Actions")])],-1)),t("tbody",null,[(l(!0),n(h,null,w(u.value,s=>(l(),n("tr",{key:s.id},[t("td",null,"#"+a(s.id),1),t("td",null,[t("span",{class:D(["badge",s.statut==="complete"?"bg-success":"bg-secondary"])},a(s.statut==="complete"?"Terminé":"Brouillon"),3)]),t("td",null,a(b(s.created_at)),1),t("td",null,a(s.created_by_username||"—"),1),t("td",null,a(s.nb_lignes??0),1),t("td",null,a(s.completed_at?b(s.completed_at):"—"),1),t("td",null,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:mt=>q(s.id)},[...e[7]||(e[7]=[t("i",{class:"bi bi-eye me-1"},null,-1),c("Détail ",-1)])],8,W)])]))),128))])])]))])])),v.value?(l(),n("div",X,[t("div",Y,[t("div",Z,[t("div",tt,[t("h5",et,"Inventaire #"+a((g=(f=i.value)==null?void 0:f.inventaire)==null?void 0:g.id),1),t("button",{type:"button",class:"btn-close",onClick:e[1]||(e[1]=s=>v.value=!1),"aria-label":"Fermer"})]),t("div",st,[_.value?(l(),n("p",at,"Chargement...")):i.value?(l(),n(h,{key:1},[t("p",lt," Statut: "+a((x=i.value.inventaire)==null?void 0:x.statut)+" — Créé le "+a(b((k=i.value.inventaire)==null?void 0:k.created_at))+" par "+a((C=i.value.inventaire)==null?void 0:C.created_by_username),1),t("div",nt,[t("table",ot,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Produit"),t("th",{class:"text-end"},"Qté comptée"),t("th",{class:"text-end"},"Stock théorique"),t("th",{class:"text-end"},"Écart"),t("th",null,"Commentaire (écart)")])],-1)),t("tbody",null,[(l(!0),n(h,null,w(i.value.lignes||[],s=>(l(),n("tr",{key:s.product_id},[t("td",null,a(s.product_nom),1),t("td",it,a(s.quantite_comptee),1),t("td",rt,a(s.stock_theorique),1),t("td",{class:D(["text-end",s.ecart>0?"text-success":s.ecart<0?"text-danger":""])},a(s.ecart>0?"+":"")+a(s.ecart),3),t("td",dt,a(s.comment||"—"),1)]))),128))])])])],64)):p("",!0)])])])])):p("",!0)])}}},N=B(ct);N.use(L());N.mount("#inventaires-historique-app");
