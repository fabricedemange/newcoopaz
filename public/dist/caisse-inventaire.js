import{i as B,x as V,o as n,c as i,a as t,f as O,b as r,t as c,d as h,F as P,k as F,r as o,g as T,h as z}from"./chunks/runtime-dom.esm-bundler-CYnru-If.js";import{c as A}from"./chunks/pinia-B_riBLOF.js";import{I as L}from"./chunks/index-BOkuCSO3.js";import{_ as M}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"admin-content-wrapper"},W={class:"container-fluid px-3 mt-4 ms-280"},H={key:0,class:"alert alert-danger alert-dismissible show"},R={key:1,class:"alert alert-warning"},$={class:"row"},q={class:"col-lg-5 mb-4"},G={class:"card"},J={class:"card-body"},K={class:"mb-3"},Q={key:0,class:"alert alert-warning mt-2 mb-0"},X={class:"d-flex gap-2"},Y=["disabled"],Z={class:"col-lg-7 mb-4"},ee={class:"card"},ae={class:"card-header d-flex justify-content-between align-items-center"},te={class:"badge bg-primary"},se={class:"card-body p-0"},ne={key:0,class:"p-4 text-center text-muted"},ie={key:1,class:"list-group list-group-flush"},oe={class:"me-2"},le={key:0,class:"text-success"},re={key:1,class:"text-muted"},ce={class:"small text-muted mt-1"},de=1500,ue={__name:"CaisseInventairePage",setup(me){const s=o(null),d=o(null),u=o(null),f=o(null),b=o(!1),y=o(0),v=o(""),m=o(""),_=o(!1),w=o([]),p=o([]),g=T(()=>typeof window<"u"&&typeof window.BarcodeDetector=="function");function k(e){return String(e||"").trim().replace(/\s/g,"")}function D(e){const a=k(e);return w.value.find(l=>l.code_ean&&k(l.code_ean)===a)}function E(e){const a=D(e),l=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});p.value.unshift({code:e,productName:a?a.nom:null,time:l})}function x(){var e;if(!(!u.value||!((e=s.value)!=null&&e.srcObject)||s.value.readyState<2)){if(s.value.videoWidth===0||s.value.videoHeight===0){setTimeout(x,100);return}f.value=setInterval(I,350)}}function I(){var e;!u.value||!((e=s.value)!=null&&e.srcObject)||s.value.readyState<2||s.value.videoWidth===0||s.value.videoHeight===0||Date.now()-y.value<de||b.value||(b.value=!0,u.value.detect(s.value).then(a=>{(a==null?void 0:a.length)>0&&a[0].rawValue&&(y.value=Date.now(),E(a[0].rawValue))}).catch(()=>{}).finally(()=>{b.value=!1}))}async function N(){if(v.value="",!!g.value)try{if(u.value=typeof window.BarcodeDetector<"u"?new window.BarcodeDetector({formats:["ean_13","ean_8","upc_a","code_128","codabar"]}):null,!u.value)throw new Error("BarcodeDetector non disponible");const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});d.value=e,s.value&&(s.value.srcObject=e,await s.value.play(),x())}catch(e){v.value=e.message||"Impossible d’accéder à la caméra"}}function S(){f.value&&(clearInterval(f.value),f.value=null),d.value&&(d.value.getTracks().forEach(e=>e.stop()),d.value=null),s.value&&(s.value.srcObject=null),v.value=""}return B(async()=>{_.value=!0,m.value="";try{const e=await L();e.success&&e.produits&&(w.value=e.produits)}catch(e){m.value=e.message||"Erreur chargement produits"}finally{_.value=!1}}),V(()=>{S()}),(e,a)=>(n(),i("div",U,[t("div",W,[a[6]||(a[6]=O('<div class="row mb-3" data-v-a4fea37b><div class="col-12" data-v-a4fea37b><div class="d-flex justify-content-between align-items-center flex-wrap gap-2" data-v-a4fea37b><h2 class="mb-0" data-v-a4fea37b><i class="bi bi-upc-scan me-2" data-v-a4fea37b></i>Inventaire</h2><a href="/caisse" class="btn btn-outline-primary" data-v-a4fea37b><i class="bi bi-arrow-left me-2" data-v-a4fea37b></i>Retour caisse </a></div><p class="text-muted small mb-0 mt-2" data-v-a4fea37b> Scan caméra pour inventaire en magasin (smartphone). Utilisez Chrome ou Edge. </p></div></div>',1)),m.value?(n(),i("div",H,[r(c(m.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=l=>m.value=null),"aria-label":"Fermer"})])):h("",!0),g.value?h("",!0):(n(),i("div",R,[...a[1]||(a[1]=[t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),r(" Votre navigateur ne supporte pas le scan par caméra. Utilisez Chrome ou Edge (sur smartphone ou PC). ",-1)])])),t("div",$,[t("div",q,[t("div",G,[a[4]||(a[4]=t("div",{class:"card-header bg-success text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-camera-video me-2"}),r("Caméra")])],-1)),t("div",J,[t("div",K,[t("video",{ref_key:"videoEl",ref:s,class:"rounded border w-100",style:{"max-width":"100%",background:"#000","aspect-ratio":"4/3"},playsinline:"",muted:""},null,512),v.value?(n(),i("div",Q,c(v.value),1)):h("",!0)]),t("div",X,[d.value?(n(),i("button",{key:1,type:"button",class:"btn btn-secondary",onClick:S},[...a[3]||(a[3]=[t("i",{class:"bi bi-stop-circle me-1"},null,-1),r("Arrêter ",-1)])])):(n(),i("button",{key:0,type:"button",class:"btn btn-success",disabled:!g.value||_.value,onClick:N},[...a[2]||(a[2]=[t("i",{class:"bi bi-camera-video me-1"},null,-1),r("Démarrer la caméra ",-1)])],8,Y))])])])]),t("div",Z,[t("div",ee,[t("div",ae,[a[5]||(a[5]=t("h5",{class:"mb-0"},[t("i",{class:"bi bi-list-ul me-2"}),r("Articles scannés")],-1)),t("span",te,c(p.value.length),1)]),t("div",se,[p.value.length===0?(n(),i("div",ne," Scannez un code-barres pour l’ajouter à la liste. ")):(n(),i("ul",ie,[(n(!0),i(P,null,F(p.value,(l,j)=>(n(),i("li",{key:j,class:"list-group-item d-flex justify-content-between align-items-start"},[t("div",null,[t("code",oe,c(l.code),1),l.productName?(n(),i("span",le,c(l.productName),1)):(n(),i("span",re,"— produit inconnu")),t("div",ce,c(l.time),1)])]))),128))]))])])])])])]))}},ve=M(ue,[["__scopeId","data-v-a4fea37b"]]),C=z(ve);C.use(A());C.mount("#inventaire-app");
