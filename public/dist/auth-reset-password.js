import{i as g,o as n,c as r,a as e,b as m,t as b,d,w as k,e as _,v as y,r as o,g as x,h as R}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";const S={class:"container-fluid px-3 mt-4"},T={class:"row justify-content-center"},V={class:"col-12 col-sm-8 col-md-6 col-lg-4"},E={class:"card"},N={class:"card-body"},P={key:0,class:"alert alert-success"},U={key:1,class:"alert alert-danger"},C=["value"],L=["value"],j={class:"mb-3"},B={class:"mb-3"},M={class:"d-grid gap-2"},O=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-1"},z={key:3,class:"alert alert-warning"},A={__name:"ResetPasswordPage",setup(K){const l=o(""),c=o(""),u=o(""),a=o(""),v=o(""),f=o(!1),p=o(!1),w=x(()=>window.CSRF_TOKEN||"");g(()=>{const i=new URLSearchParams(window.location.search);l.value=i.get("token")||window.RESET_TOKEN||""});async function h(){if(a.value="",c.value!==u.value){a.value="Les mots de passe ne correspondent pas.";return}p.value=!0;try{const i=new URLSearchParams({token:l.value,password:c.value,confirm:u.value,_csrf:w.value}),t=await(await fetch("/reset-password",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:i.toString(),credentials:"include"})).json().catch(()=>({}));if(t.success){if(f.value=!0,v.value=t.message||"Votre mot de passe est bien réinitialisé.",t.redirect){window.location.href=t.redirect;return}}else a.value=t.error||"Une erreur est survenue."}catch{a.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}return(i,s)=>(n(),r("div",S,[e("div",T,[e("div",V,[e("div",E,[s[7]||(s[7]=e("div",{class:"card-header text-center"},[e("h2",{class:"card-title mb-0"},"Réinitialisation du mot de passe")],-1)),e("div",N,[v.value?(n(),r("div",P,[s[2]||(s[2]=e("i",{class:"bi bi-check-circle me-2"},null,-1)),m(b(v.value),1)])):d("",!0),a.value?(n(),r("div",U,[s[3]||(s[3]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),m(b(a.value),1)])):d("",!0),l.value&&!f.value?(n(),r("form",{key:2,onSubmit:k(h,["prevent"])},[e("input",{type:"hidden",name:"_csrf",value:w.value},null,8,C),e("input",{type:"hidden",name:"token",value:l.value},null,8,L),e("div",j,[s[4]||(s[4]=e("label",{for:"password",class:"form-label"},"Nouveau mot de passe",-1)),_(e("input",{id:"password","onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),type:"password",class:"form-control",required:"",autocomplete:"new-password"},null,512),[[y,c.value]])]),e("div",B,[s[5]||(s[5]=e("label",{for:"confirm",class:"form-label"},"Confirmez le mot de passe",-1)),_(e("input",{id:"confirm","onUpdate:modelValue":s[1]||(s[1]=t=>u.value=t),type:"password",class:"form-control",required:"",autocomplete:"new-password"},null,512),[[y,u.value]])]),e("div",M,[e("button",{type:"submit",class:"btn btn-primary",disabled:p.value},[p.value?(n(),r("span",q)):d("",!0),s[6]||(s[6]=m(" Réinitialiser le mot de passe ",-1))],8,O)])],32)):d("",!0),!l.value&&!a.value?(n(),r("div",z," Lien invalide ou expiré. ")):d("",!0)]),s[8]||(s[8]=e("div",{class:"card-footer text-center"},[e("a",{href:"/login",class:"btn btn-link"},"Retour à la connexion")],-1))])])])]))}},D=R(A);D.mount("#auth-reset-password-app");
