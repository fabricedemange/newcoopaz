import{i as _,l as w,o as n,c as i,a as e,b as a,u as r,e as k,j as x,t as l,d,w as h,n as f,F as m,k as b,r as S,h as A}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as C,c as z}from"./chunks/pinia-BNknc8Vm.js";import{a as E,A as $}from"./chunks/index-BkeVkIvb.js";const D=C("adminDashboard",{state:()=>({loading:!1,error:null,authRequired:!1,catalogues:[],commandes:[],totalCommandes:0,paniers:[],referentScopeActive:!1,showAllScope:!1}),actions:{async loadDashboard(p="all"){this.loading=!0,this.error=null,this.authRequired=!1;try{const o=await E(p);if(o.success)this.catalogues=o.catalogues??[],this.commandes=o.commandes??[],this.totalCommandes=o.totalCommandes??0,this.paniers=o.paniers??[],this.referentScopeActive=o.referentScopeActive??!1,this.showAllScope=o.showAllScope??!1;else throw new Error(o.error||"Erreur lors du chargement du dashboard")}catch(o){this.error=o.message,o.code===$&&(this.authRequired=!0),console.error("loadDashboard:",o)}finally{this.loading=!1}},toggleScope(){const p=this.showAllScope?"referent":"all";window.location.href=`?scope=${p}#catalogues`}}}),N={class:"admin-content-wrapper"},V={class:"container-fluid px-3 mt-4"},M={class:"row mb-4"},R={class:"col-12"},P={class:"d-flex justify-content-between align-items-center mb-4"},q={key:0,class:"d-none d-md-block"},L={class:"form-check form-switch mb-0"},j={class:"form-check-label",for:"scopeToggle"},B={key:0,class:"row mb-3 d-md-none"},F={class:"col-12"},U={class:"dropdown"},T={class:"dropdown-menu w-100"},G={key:1,class:"alert alert-warning"},H={key:2,class:"alert alert-danger alert-dismissible fade show"},I={class:"mb-4"},J={class:"d-flex flex-wrap gap-2 justify-content-center justify-md-start"},K={key:3,class:"text-center py-5"},O={key:0,class:"row mb-4"},Q={class:"col-12"},W={key:0,class:"alert alert-info text-center"},X={class:"d-none d-md-block table-responsive"},Y={class:"table table-striped table-hover"},Z=["href"],ee={key:0,class:"badge bg-danger"},te=["href"],se=["href"],le={class:"d-md-none"},oe={class:"card-body p-2",style:{"font-size":"0.7rem"}},ne={key:0,class:"badge bg-danger",style:{"font-size":"0.6rem"}},ie={class:"text-muted",style:{"font-size":"0.65rem"}},ae={class:"mb-1"},re={key:1,class:"text-muted mb-2",style:{"font-size":"0.65rem"}},de={class:"dropdown"},ue={class:"dropdown-menu",style:{"font-size":"0.75rem"}},ce=["href"],me=["href"],be={key:1,class:"row mb-4"},pe={class:"col-12"},he={key:0,class:"alert alert-info text-center"},fe={class:"d-none d-md-block table-responsive"},ge={class:"table table-striped table-hover"},ve={key:0,class:"badge bg-info"},ye={class:"text-muted"},_e={class:"text-center"},we={class:"badge bg-primary"},ke={class:"text-end"},xe=["href"],Se={class:"d-md-none"},Ae={class:"card-body p-2",style:{"font-size":"0.7rem"}},Ce={style:{"font-size":"0.65rem"}},ze={style:{"font-size":"0.65rem"}},Ee={class:"text-center mt-2"},$e=["href"],De={key:2,class:"row mb-4"},Ne={class:"col-12"},Ve={key:0,class:"alert alert-info text-center"},Me={class:"d-none d-md-block table-responsive"},Re={class:"table table-striped table-hover"},Pe={key:0,class:"badge bg-info"},qe={class:"text-muted"},Le={key:0,class:"badge bg-danger"},je=["href"],Be={class:"d-md-none"},Fe={class:"card-body p-2",style:{"font-size":"0.7rem"}},Ue={key:0,class:"badge bg-danger",style:{"font-size":"0.6rem"}},Te={style:{"font-size":"0.65rem"}},Ge={class:"text-center mt-2"},He=["href"],Ie={__name:"AdminDashboardPage",setup(p){const o=D(),u=S("catalogues");function g(c,t){return c?c.length>t?c.slice(0,t)+"...":c:""}function y(){window.history.back()}return _(()=>{const c=window.location.hash.substring(1);c&&["catalogues","commandes","paniers"].includes(c)&&(u.value=c);const t=new URLSearchParams(window.location.search).get("scope")||"all";o.loadDashboard(t)}),w(u,c=>{typeof window<"u"&&(window.location.hash=c)}),(c,t)=>(n(),i("div",N,[e("div",V,[e("button",{class:"btn btn-outline-secondary d-md-none mb-3",type:"button",onClick:y},[...t[7]||(t[7]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),a("Retour ",-1)])]),e("div",M,[e("div",R,[e("div",P,[t[8]||(t[8]=e("h2",{class:"mb-0"},[e("i",{class:"bi bi-speedometer2 me-2"}),a("Dashboard Administrateur")],-1)),r(o).referentScopeActive?(n(),i("div",q,[e("div",L,[k(e("input",{id:"scopeToggle","onUpdate:modelValue":t[0]||(t[0]=s=>r(o).showAllScope=s),class:"form-check-input",type:"checkbox",onChange:t[1]||(t[1]=s=>r(o).toggleScope())},null,544),[[x,r(o).showAllScope]]),e("label",j,l(r(o).showAllScope?"Voir tous":"Mes √©l√©ments"),1)])])):d("",!0)])])]),r(o).referentScopeActive?(n(),i("div",B,[e("div",F,[e("div",U,[t[10]||(t[10]=e("button",{class:"btn btn-primary dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"bi bi-filter me-2"}),a("Vue ")],-1)),e("ul",T,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[2]||(t[2]=h(s=>r(o).toggleScope(),["prevent"]))},[t[9]||(t[9]=e("i",{class:"bi bi-people me-2"},null,-1)),a(l(r(o).showAllScope?"Mes √©l√©ments":"Voir tous"),1)])])])])])])):d("",!0),r(o).authRequired?(n(),i("div",G,[...t[11]||(t[11]=[e("i",{class:"bi bi-lock me-2"},null,-1),a(" Vous devez vous connecter. ",-1),e("a",{href:"/login",class:"alert-link ms-2"},"Se connecter",-1)])])):r(o).error?(n(),i("div",H,[t[12]||(t[12]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),a(l(r(o).error)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[3]||(t[3]=s=>r(o).error=null)})])):d("",!0),e("div",I,[e("div",J,[e("a",{href:"#catalogues",class:f(["badge text-decoration-none fs-6 py-2 px-3",u.value==="catalogues"?"bg-primary":"bg-secondary"]),onClick:t[4]||(t[4]=h(s=>u.value="catalogues",["prevent"]))},[t[13]||(t[13]=e("i",{class:"bi bi-book-fill me-1"},null,-1)),a("Catalogues ("+l(r(o).catalogues.length)+") ",1)],2),e("a",{href:"#commandes",class:f(["badge text-decoration-none fs-6 py-2 px-3",u.value==="commandes"?"bg-success":"bg-secondary"]),onClick:t[5]||(t[5]=h(s=>u.value="commandes",["prevent"]))},[t[14]||(t[14]=e("i",{class:"bi bi-bag-check-fill me-1"},null,-1)),a("Commandes ("+l(r(o).totalCommandes)+") ",1)],2),e("a",{href:"#paniers",class:f(["badge text-decoration-none fs-6 py-2 px-3",u.value==="paniers"?"bg-warning":"bg-secondary"]),onClick:t[6]||(t[6]=h(s=>u.value="paniers",["prevent"]))},[t[15]||(t[15]=e("i",{class:"bi bi-cart-fill me-1"},null,-1)),a("Paniers ("+l(r(o).paniers.length)+") ",1)],2)])]),r(o).loading?(n(),i("div",K,[...t[16]||(t[16]=[e("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),e("p",{class:"mt-3 text-muted"},"Chargement du dashboard...",-1)])])):(n(),i(m,{key:4},[u.value==="catalogues"?(n(),i("div",O,[e("div",Q,[t[25]||(t[25]=e("h3",{id:"catalogues",class:"fs-5"},"Catalogues concern√©s par les commandes",-1)),r(o).catalogues.length===0?(n(),i("div",W,"Aucun catalogue trouv√©")):(n(),i(m,{key:1},[e("div",X,[e("table",Y,[t[19]||(t[19]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"N¬∞"),e("th",null,"Nom"),e("th",null,"Description"),e("th",null,"Expiration"),e("th",null,"Livraison"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(m,null,b(r(o).catalogues,s=>(n(),i("tr",{key:s.id},[e("td",null,[e("strong",null,l(s.id),1)]),e("td",null,[e("a",{href:`/admin/catalogues/${s.id}/edit`,class:"text-decoration-none"},l(s.originalname),9,Z)]),e("td",null,[e("small",null,l(g(s.description,100)),1)]),e("td",null,[a(l(s.expiration_formatted)+" ",1),s.isExpired?(n(),i("span",ee,"Expir√©")):d("",!0)]),e("td",null,l(s.livraison_formatted),1),e("td",null,[e("a",{href:`/admin/catalogues/${s.id}/synthese/vue`,class:"btn btn-sm btn-primary me-1"},[...t[17]||(t[17]=[e("i",{class:"bi bi-file-earmark-spreadsheet"},null,-1),a(" Synth√®se",-1)])],8,te),e("a",{href:`/admin/catalogues/${s.id}/synthese-detaillee/vue`,class:"btn btn-sm btn-info"},[...t[18]||(t[18]=[e("i",{class:"bi bi-file-earmark-text"},null,-1),a(" Synth√®se d√©taill√©e",-1)])],8,se)])]))),128))])])]),e("div",le,[(n(!0),i(m,null,b(r(o).catalogues,s=>(n(),i("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",oe,[e("strong",null,"Cat #"+l(s.id),1),a(" "+l(s.isExpired?" ":""),1),s.isExpired?(n(),i("span",ne,"Expir√©")):d("",!0),e("div",ie,[t[20]||(t[20]=a("Expire le ",-1)),e("strong",null,l(s.expiration_formatted),1),t[21]||(t[21]=a(" ‚Ä¢ Livr√© le ",-1)),e("strong",null,l(s.livraison_formatted),1)]),e("div",ae,[e("strong",null,l(s.originalname),1)]),s.description?(n(),i("div",re,l(g(s.description,80)),1)):d("",!0),e("div",de,[t[24]||(t[24]=e("button",{class:"btn btn-sm btn-secondary dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown",style:{"font-size":"0.7rem"}},"Actions",-1)),e("ul",ue,[e("li",null,[e("a",{class:"dropdown-item",href:`/admin/catalogues/${s.id}/synthese/vue`},[...t[22]||(t[22]=[e("i",{class:"bi bi-file-earmark-spreadsheet me-2"},null,-1),a("Synth√®se",-1)])],8,ce)]),e("li",null,[e("a",{class:"dropdown-item",href:`/admin/catalogues/${s.id}/synthese-detaillee/vue`},[...t[23]||(t[23]=[e("i",{class:"bi bi-file-earmark-text me-2"},null,-1),a("Synth√®se d√©taill√©e",-1)])],8,me)])])])])]))),128))])],64))])])):d("",!0),u.value==="commandes"?(n(),i("div",be,[e("div",pe,[t[32]||(t[32]=e("h3",{id:"commandes",class:"fs-5"},"Commandes valid√©es",-1)),r(o).commandes.length===0?(n(),i("div",he,"Aucune commande trouv√©e")):(n(),i(m,{key:1},[e("div",fe,[e("table",ge,[t[29]||(t[29]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"N¬∞"),e("th",null,"Utilisateur"),e("th",null,"Catalogue"),e("th",null,"Date commande"),e("th",null,"Livraison"),e("th",{class:"text-center"},"Nb produits"),e("th",{class:"text-end"},"Montant"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(m,null,b(r(o).commandes,s=>(n(),i("tr",{key:s.id},[e("td",null,[e("strong",null,l(s.id),1)]),e("td",null,[t[26]||(t[26]=e("i",{class:"bi bi-person-circle"},null,-1)),a(" "+l(s.username)+" ",1),s.note?(n(),i("small",ve,"üìù "+l(s.note),1)):d("",!0)]),e("td",null,[a(l(s.catalogue)+" ",1),t[27]||(t[27]=e("br",null,null,-1)),e("small",ye,"N¬∞"+l(s.catalog_file_id),1)]),e("td",null,l(s.created_formatted),1),e("td",null,l(s.livraison_formatted),1),e("td",_e,[e("span",we,l(s.nb_produits||0),1)]),e("td",ke,[e("strong",null,l((s.montant_total||0).toFixed(2))+" ‚Ç¨",1)]),e("td",null,[e("a",{href:`/commandes/${s.id}/vue`,class:"btn btn-sm btn-info"},[...t[28]||(t[28]=[e("i",{class:"bi bi-eye"},null,-1),a(" Voir",-1)])],8,xe)])]))),128))])])]),e("div",Se,[(n(!0),i(m,null,b(r(o).commandes,s=>(n(),i("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",Ae,[e("strong",null,"Cde #"+l(s.id),1),t[31]||(t[31]=a(" le ",-1)),e("strong",null,l(s.created_formatted),1),e("div",Ce,[t[30]||(t[30]=e("i",{class:"bi bi-person-circle"},null,-1)),a(" "+l(s.username),1)]),e("div",ze,[a(l(s.nb_produits||0)+" produits ‚Ä¢ ",1),e("strong",null,l((s.montant_total||0).toFixed(2))+" ‚Ç¨",1)]),e("div",Ee,[e("a",{href:`/commandes/${s.id}/vue`,class:"btn btn-sm btn-info",style:{"min-width":"150px","font-size":"0.7rem"}},"Voir d√©tails",8,$e)])])]))),128))])],64))])])):d("",!0),u.value==="paniers"?(n(),i("div",De,[e("div",Ne,[t[40]||(t[40]=e("h3",{id:"paniers",class:"fs-5"},"Paniers en cours",-1)),r(o).paniers.length===0?(n(),i("div",Ve,"Aucun panier trouv√©")):(n(),i(m,{key:1},[e("div",Me,[e("table",Re,[t[36]||(t[36]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"N¬∞"),e("th",null,"Utilisateur"),e("th",null,"Catalogue"),e("th",null,"Date cr√©ation"),e("th",null,"Expiration"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),i(m,null,b(r(o).paniers,s=>(n(),i("tr",{key:s.id},[e("td",null,[e("strong",null,l(s.id),1)]),e("td",null,[t[33]||(t[33]=e("i",{class:"bi bi-person-circle"},null,-1)),a(" "+l(s.username)+" ",1),s.note?(n(),i("small",Pe,"üìù "+l(s.note),1)):d("",!0)]),e("td",null,[a(l(s.catalogue)+" ",1),t[34]||(t[34]=e("br",null,null,-1)),e("small",qe,"N¬∞"+l(s.catalog_file_id),1)]),e("td",null,l(s.created_formatted),1),e("td",null,[a(l(s.expiration_formatted)+" ",1),s.isExpired?(n(),i("span",Le,"Expir√©")):d("",!0)]),e("td",null,[e("a",{href:`/panier/${s.id}/modifier/vue`,class:"btn btn-sm btn-primary"},[...t[35]||(t[35]=[e("i",{class:"bi bi-pencil"},null,-1),a(" Modifier",-1)])],8,je)])]))),128))])])]),e("div",Be,[(n(!0),i(m,null,b(r(o).paniers,s=>(n(),i("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",Fe,[e("strong",null,"Panier #"+l(s.id),1),t[38]||(t[38]=a(" cr√©√© le ",-1)),e("strong",null,l(s.created_formatted),1),t[39]||(t[39]=a()),s.isExpired?(n(),i("span",Ue,"Expir√©")):d("",!0),e("div",Te,[t[37]||(t[37]=e("i",{class:"bi bi-person-circle"},null,-1)),a(" "+l(s.username),1)]),e("div",Ge,[e("a",{href:`/panier/${s.id}/modifier/vue`,class:"btn btn-sm btn-primary",style:{"min-width":"150px","font-size":"0.7rem"}},"Modifier",8,He)])])]))),128))])],64))])])):d("",!0)],64))])]))}},v=A(Ie);v.use(z());v.mount("#admin-dashboard-app");
