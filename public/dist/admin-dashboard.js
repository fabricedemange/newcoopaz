import{i as w,m as k,o as i,c as r,a as e,b as l,j as x,u as a,e as C,k as S,t as n,d as c,w as v,n as b,F as p,l as h,r as A,h as $}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as D,c as z}from"./chunks/pinia-gLxYYWQL.js";import{a as E,A as N}from"./chunks/index-fBysSQKd.js";import{_ as V}from"./chunks/BackButton-DzFd1NqY.js";const M=D("adminDashboard",{state:()=>({loading:!1,error:null,authRequired:!1,catalogues:[],commandes:[],totalCommandes:0,paniers:[],referentScopeActive:!1,showAllScope:!1,commandesSortColumn:"created_at",commandesSortDirection:"desc"}),getters:{sortedCommandes(m){const o=[...m.commandes||[]],u=m.commandesSortColumn||"created_at",g=m.commandesSortDirection||"desc";return o.sort((y,f)=>{let d=y[u],t=f[u];if(u==="created_at"||u==="date_livraison")return d=d?new Date(d).getTime():0,t=t?new Date(t).getTime():0,g==="asc"?d-t:t-d;if(u==="nb_produits"||u==="montant_total"||u==="id")return d=Number(d)||0,t=Number(t)||0,g==="asc"?d-t:t-d;d=(d??"").toString().toLowerCase(),t=(t??"").toString().toLowerCase();const s=d.localeCompare(t,"fr");return g==="asc"?s:-s}),o}},actions:{async loadDashboard(m="all"){this.loading=!0,this.error=null,this.authRequired=!1;try{const o=await E(m);if(o.success)this.catalogues=o.catalogues??[],this.commandes=o.commandes??[],this.totalCommandes=o.totalCommandes??0,this.paniers=o.paniers??[],this.referentScopeActive=o.referentScopeActive??!1,this.showAllScope=o.showAllScope??!1;else throw new Error(o.error||"Erreur lors du chargement du dashboard")}catch(o){this.error=o.message,o.code===N&&(this.authRequired=!0),console.error("loadDashboard:",o)}finally{this.loading=!1}},toggleScope(){const m=this.showAllScope?"referent":"all";window.location.href=`?scope=${m}#catalogues`},setCommandesSort(m){this.commandesSortColumn===m?this.commandesSortDirection=this.commandesSortDirection==="asc"?"desc":"asc":(this.commandesSortColumn=m,this.commandesSortDirection=m==="created_at"||m==="id"?"desc":"asc")}}}),L={class:"admin-content-wrapper"},R={class:"container-fluid px-3 mt-4"},P={class:"row mb-4"},q={class:"col-12"},T={class:"d-flex justify-content-between align-items-center mb-4"},j={class:"d-flex gap-2 align-items-center"},B={key:0,class:"d-none d-md-block"},F={class:"form-check form-switch mb-0"},U={class:"form-check-label",for:"scopeToggle"},I={key:0,class:"row mb-3 d-md-none"},G={class:"col-12"},H={class:"dropdown"},J={class:"dropdown-menu w-100"},K={key:1,class:"alert alert-warning"},O={key:2,class:"alert alert-danger alert-dismissible fade show"},Q={class:"mb-4"},W={class:"d-flex flex-wrap gap-2 justify-content-center justify-md-start"},X={key:3,class:"text-center py-5"},Y={key:0,class:"row mb-4"},Z={class:"col-12"},ee={key:0,class:"alert alert-info text-center"},te={class:"d-none d-md-block table-responsive"},se={class:"table table-striped table-hover"},oe=["href"],ne={key:0,class:"badge bg-danger"},le=["href"],ie=["href"],re={class:"d-md-none"},ae={class:"card-body p-2",style:{"font-size":"0.7rem"}},de={key:0,class:"badge bg-danger",style:{"font-size":"0.6rem"}},ue={class:"text-muted",style:{"font-size":"0.65rem"}},me={class:"mb-1"},ce={key:1,class:"text-muted mb-2",style:{"font-size":"0.65rem"}},be={class:"dropdown"},pe={class:"dropdown-menu",style:{"font-size":"0.75rem"}},fe=["href"],ge=["href"],he={key:1,class:"row mb-4"},ve={class:"col-12"},ye={key:0,class:"alert alert-info text-center"},_e={class:"d-none d-md-block table-responsive"},we={class:"table table-striped table-hover"},ke={class:"thead-administration"},xe={key:0,class:"badge bg-info"},Ce={class:"text-muted"},Se={class:"text-center"},Ae={class:"badge bg-primary"},$e={class:"text-end"},De=["href"],ze={class:"d-md-none"},Ee={class:"card-body p-2",style:{"font-size":"0.7rem"}},Ne={style:{"font-size":"0.65rem"}},Ve={style:{"font-size":"0.65rem"}},Me={class:"text-center mt-2"},Le=["href"],Re={key:2,class:"row mb-4"},Pe={class:"col-12"},qe={key:0,class:"alert alert-info text-center"},Te={class:"d-none d-md-block table-responsive"},je={class:"table table-striped table-hover"},Be={key:0,class:"badge bg-info"},Fe={class:"text-muted"},Ue={key:0,class:"badge bg-danger"},Ie=["href"],Ge={class:"d-md-none"},He={class:"card-body p-2",style:{"font-size":"0.7rem"}},Je={key:0,class:"badge bg-danger",style:{"font-size":"0.6rem"}},Ke={style:{"font-size":"0.65rem"}},Oe={class:"text-center mt-2"},Qe=["href"],We={__name:"AdminDashboardPage",setup(m){const o=M(),u=A("catalogues");function g(d,t){return d?d.length>t?d.slice(0,t)+"...":d:""}function y(){window.history.back()}function f(d){return o.commandesSortColumn!==d?"bi-arrow-down-up text-secondary opacity-50":o.commandesSortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}return w(()=>{const d=window.location.hash.substring(1);d&&["catalogues","commandes","paniers"].includes(d)&&(u.value=d);const t=new URLSearchParams(window.location.search).get("scope")||"all";o.loadDashboard(t)}),k(u,d=>{typeof window<"u"&&(window.location.hash=d)}),(d,t)=>(i(),r("div",L,[e("div",R,[e("button",{class:"btn btn-outline-secondary d-md-none mb-3",type:"button",onClick:y},[...t[14]||(t[14]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),l("Retour ",-1)])]),e("div",P,[e("div",q,[e("div",T,[t[15]||(t[15]=e("h2",{class:"mb-0"},[e("i",{class:"bi bi-speedometer2 me-2"}),l("Dashboard Administrateur")],-1)),e("div",j,[x(V),a(o).referentScopeActive?(i(),r("div",B,[e("div",F,[C(e("input",{id:"scopeToggle","onUpdate:modelValue":t[0]||(t[0]=s=>a(o).showAllScope=s),class:"form-check-input",type:"checkbox",onChange:t[1]||(t[1]=s=>a(o).toggleScope())},null,544),[[S,a(o).showAllScope]]),e("label",U,n(a(o).showAllScope?"Voir tous":"Mes √©l√©ments"),1)])])):c("",!0)])])])]),a(o).referentScopeActive?(i(),r("div",I,[e("div",G,[e("div",H,[t[17]||(t[17]=e("button",{class:"btn btn-primary dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"bi bi-filter me-2"}),l("Vue ")],-1)),e("ul",J,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[2]||(t[2]=v(s=>a(o).toggleScope(),["prevent"]))},[t[16]||(t[16]=e("i",{class:"bi bi-people me-2"},null,-1)),l(n(a(o).showAllScope?"Mes √©l√©ments":"Voir tous"),1)])])])])])])):c("",!0),a(o).authRequired?(i(),r("div",K,[...t[18]||(t[18]=[e("i",{class:"bi bi-lock me-2"},null,-1),l(" Vous devez vous connecter. ",-1),e("a",{href:"/login",class:"alert-link ms-2"},"Se connecter",-1)])])):a(o).error?(i(),r("div",O,[t[19]||(t[19]=e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),l(n(a(o).error)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[3]||(t[3]=s=>a(o).error=null)})])):c("",!0),e("div",Q,[e("div",W,[e("a",{href:"#catalogues",class:b(["badge text-decoration-none fs-6 py-2 px-3",u.value==="catalogues"?"bg-primary":"bg-secondary"]),onClick:t[4]||(t[4]=v(s=>u.value="catalogues",["prevent"]))},[t[20]||(t[20]=e("i",{class:"bi bi-book-fill me-1"},null,-1)),l("Catalogues ("+n(a(o).catalogues.length)+") ",1)],2),e("a",{href:"#commandes",class:b(["badge text-decoration-none fs-6 py-2 px-3",u.value==="commandes"?"bg-success":"bg-secondary"]),onClick:t[5]||(t[5]=v(s=>u.value="commandes",["prevent"]))},[t[21]||(t[21]=e("i",{class:"bi bi-bag-check-fill me-1"},null,-1)),l("Commandes ("+n(a(o).totalCommandes)+") ",1)],2),e("a",{href:"#paniers",class:b(["badge text-decoration-none fs-6 py-2 px-3",u.value==="paniers"?"bg-warning":"bg-secondary"]),onClick:t[6]||(t[6]=v(s=>u.value="paniers",["prevent"]))},[t[22]||(t[22]=e("i",{class:"bi bi-cart-fill me-1"},null,-1)),l("Paniers ("+n(a(o).paniers.length)+") ",1)],2)])]),a(o).loading?(i(),r("div",X,[...t[23]||(t[23]=[e("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),e("p",{class:"mt-3 text-muted"},"Chargement du dashboard...",-1)])])):(i(),r(p,{key:4},[u.value==="catalogues"?(i(),r("div",Y,[e("div",Z,[t[32]||(t[32]=e("h3",{id:"catalogues",class:"fs-5"},"Catalogues concern√©s par les commandes",-1)),a(o).catalogues.length===0?(i(),r("div",ee,"Aucun catalogue trouv√©")):(i(),r(p,{key:1},[e("div",te,[e("table",se,[t[26]||(t[26]=e("thead",{class:"thead-administration"},[e("tr",null,[e("th",null,"N¬∞"),e("th",null,"Nom"),e("th",null,"Description"),e("th",null,"Expiration"),e("th",null,"Livraison"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),r(p,null,h(a(o).catalogues,s=>(i(),r("tr",{key:s.id},[e("td",null,[e("strong",null,n(s.id),1)]),e("td",null,[e("a",{href:`/admin/catalogues/${s.id}/edit`,class:"text-decoration-none"},n(s.originalname),9,oe)]),e("td",null,[e("small",null,n(g(s.description,100)),1)]),e("td",null,[l(n(s.expiration_formatted)+" ",1),s.isExpired?(i(),r("span",ne,"Expir√©")):c("",!0)]),e("td",null,n(s.livraison_formatted),1),e("td",null,[e("a",{href:`/admin/catalogues/${s.id}/synthese/vue`,class:"btn btn-sm btn-primary me-1"},[...t[24]||(t[24]=[e("i",{class:"bi bi-file-earmark-spreadsheet"},null,-1),l(" Synth√®se",-1)])],8,le),e("a",{href:`/admin/catalogues/${s.id}/synthese-detaillee/vue`,class:"btn btn-sm btn-info"},[...t[25]||(t[25]=[e("i",{class:"bi bi-file-earmark-text"},null,-1),l(" Synth√®se d√©taill√©e",-1)])],8,ie)])]))),128))])])]),e("div",re,[(i(!0),r(p,null,h(a(o).catalogues,s=>(i(),r("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",ae,[e("strong",null,"Cat #"+n(s.id),1),l(" "+n(s.isExpired?" ":""),1),s.isExpired?(i(),r("span",de,"Expir√©")):c("",!0),e("div",ue,[t[27]||(t[27]=l("Expire le ",-1)),e("strong",null,n(s.expiration_formatted),1),t[28]||(t[28]=l(" ‚Ä¢ Livr√© le ",-1)),e("strong",null,n(s.livraison_formatted),1)]),e("div",me,[e("strong",null,n(s.originalname),1)]),s.description?(i(),r("div",ce,n(g(s.description,80)),1)):c("",!0),e("div",be,[t[31]||(t[31]=e("button",{class:"btn btn-sm btn-secondary dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown",style:{"font-size":"0.7rem"}},"Actions",-1)),e("ul",pe,[e("li",null,[e("a",{class:"dropdown-item",href:`/admin/catalogues/${s.id}/synthese/vue`},[...t[29]||(t[29]=[e("i",{class:"bi bi-file-earmark-spreadsheet me-2"},null,-1),l("Synth√®se",-1)])],8,fe)]),e("li",null,[e("a",{class:"dropdown-item",href:`/admin/catalogues/${s.id}/synthese-detaillee/vue`},[...t[30]||(t[30]=[e("i",{class:"bi bi-file-earmark-text me-2"},null,-1),l("Synth√®se d√©taill√©e",-1)])],8,ge)])])])])]))),128))])],64))])])):c("",!0),u.value==="commandes"?(i(),r("div",he,[e("div",ve,[t[46]||(t[46]=e("h3",{id:"commandes",class:"fs-5"},"Commandes valid√©es",-1)),a(o).commandes.length===0?(i(),r("div",ye,"Aucune commande trouv√©e")):(i(),r(p,{key:1},[e("div",_e,[e("table",we,[e("thead",ke,[e("tr",null,[e("th",{style:{cursor:"pointer"},class:"user-select-none",onClick:t[7]||(t[7]=s=>a(o).setCommandesSort("id"))},[t[33]||(t[33]=l("N¬∞ ",-1)),e("i",{class:b("bi ms-1 "+f("id"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none",onClick:t[8]||(t[8]=s=>a(o).setCommandesSort("username"))},[t[34]||(t[34]=l("Utilisateur ",-1)),e("i",{class:b("bi ms-1 "+f("username"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none",onClick:t[9]||(t[9]=s=>a(o).setCommandesSort("catalogue"))},[t[35]||(t[35]=l("Catalogue ",-1)),e("i",{class:b("bi ms-1 "+f("catalogue"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none",onClick:t[10]||(t[10]=s=>a(o).setCommandesSort("created_at"))},[t[36]||(t[36]=l("Date commande ",-1)),e("i",{class:b("bi ms-1 "+f("created_at"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none",onClick:t[11]||(t[11]=s=>a(o).setCommandesSort("date_livraison"))},[t[37]||(t[37]=l("Livraison ",-1)),e("i",{class:b("bi ms-1 "+f("date_livraison"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none text-center",onClick:t[12]||(t[12]=s=>a(o).setCommandesSort("nb_produits"))},[t[38]||(t[38]=l("Nb produits ",-1)),e("i",{class:b("bi ms-1 "+f("nb_produits"))},null,2)]),e("th",{style:{cursor:"pointer"},class:"user-select-none text-end",onClick:t[13]||(t[13]=s=>a(o).setCommandesSort("montant_total"))},[t[39]||(t[39]=l("Montant ",-1)),e("i",{class:b("bi ms-1 "+f("montant_total"))},null,2)]),t[40]||(t[40]=e("th",null,"Actions",-1))])]),e("tbody",null,[(i(!0),r(p,null,h(a(o).sortedCommandes,s=>(i(),r("tr",{key:s.id},[e("td",null,[e("strong",null,n(s.id),1)]),e("td",null,[t[41]||(t[41]=e("i",{class:"bi bi-person-circle"},null,-1)),l(" "+n(s.username)+" ",1),s.note?(i(),r("small",xe,"üìù "+n(s.note),1)):c("",!0)]),e("td",null,[l(n(s.catalogue)+" ",1),t[42]||(t[42]=e("br",null,null,-1)),e("small",Ce,"N¬∞"+n(s.catalog_file_id),1)]),e("td",null,n(s.created_formatted),1),e("td",null,n(s.livraison_formatted),1),e("td",Se,[e("span",Ae,n(s.nb_produits||0),1)]),e("td",$e,[e("strong",null,n((s.montant_total||0).toFixed(2))+" ‚Ç¨",1)]),e("td",null,[e("a",{href:`/commandes/${s.id}/vue`,class:"btn btn-sm btn-info"},[...t[43]||(t[43]=[e("i",{class:"bi bi-eye"},null,-1),l(" Voir",-1)])],8,De)])]))),128))])])]),e("div",ze,[(i(!0),r(p,null,h(a(o).sortedCommandes,s=>(i(),r("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",Ee,[e("strong",null,"Cde #"+n(s.id),1),t[45]||(t[45]=l(" le ",-1)),e("strong",null,n(s.created_formatted),1),e("div",Ne,[t[44]||(t[44]=e("i",{class:"bi bi-person-circle"},null,-1)),l(" "+n(s.username),1)]),e("div",Ve,[l(n(s.nb_produits||0)+" produits ‚Ä¢ ",1),e("strong",null,n((s.montant_total||0).toFixed(2))+" ‚Ç¨",1)]),e("div",Me,[e("a",{href:`/commandes/${s.id}/vue`,class:"btn btn-sm btn-info",style:{"min-width":"150px","font-size":"0.7rem"}},"Voir d√©tails",8,Le)])])]))),128))])],64))])])):c("",!0),u.value==="paniers"?(i(),r("div",Re,[e("div",Pe,[t[54]||(t[54]=e("h3",{id:"paniers",class:"fs-5"},"Paniers en cours",-1)),a(o).paniers.length===0?(i(),r("div",qe,"Aucun panier trouv√©")):(i(),r(p,{key:1},[e("div",Te,[e("table",je,[t[50]||(t[50]=e("thead",{class:"thead-administration"},[e("tr",null,[e("th",null,"N¬∞"),e("th",null,"Utilisateur"),e("th",null,"Catalogue"),e("th",null,"Date cr√©ation"),e("th",null,"Expiration"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),r(p,null,h(a(o).paniers,s=>(i(),r("tr",{key:s.id},[e("td",null,[e("strong",null,n(s.id),1)]),e("td",null,[t[47]||(t[47]=e("i",{class:"bi bi-person-circle"},null,-1)),l(" "+n(s.username)+" ",1),s.note?(i(),r("small",Be,"üìù "+n(s.note),1)):c("",!0)]),e("td",null,[l(n(s.catalogue)+" ",1),t[48]||(t[48]=e("br",null,null,-1)),e("small",Fe,"N¬∞"+n(s.catalog_file_id),1)]),e("td",null,n(s.created_formatted),1),e("td",null,[l(n(s.expiration_formatted)+" ",1),s.isExpired?(i(),r("span",Ue,"Expir√©")):c("",!0)]),e("td",null,[e("a",{href:`/panier/${s.id}/modifier/vue`,class:"btn btn-sm btn-primary"},[...t[49]||(t[49]=[e("i",{class:"bi bi-pencil"},null,-1),l(" Modifier",-1)])],8,Ie)])]))),128))])])]),e("div",Ge,[(i(!0),r(p,null,h(a(o).paniers,s=>(i(),r("div",{key:s.id,class:"card mb-2 shadow-sm"},[e("div",He,[e("strong",null,"Panier #"+n(s.id),1),t[52]||(t[52]=l(" cr√©√© le ",-1)),e("strong",null,n(s.created_formatted),1),t[53]||(t[53]=l()),s.isExpired?(i(),r("span",Je,"Expir√©")):c("",!0),e("div",Ke,[t[51]||(t[51]=e("i",{class:"bi bi-person-circle"},null,-1)),l(" "+n(s.username),1)]),e("div",Oe,[e("a",{href:`/panier/${s.id}/modifier/vue`,class:"btn btn-sm btn-primary",style:{"min-width":"150px","font-size":"0.7rem"}},"Modifier",8,Qe)])])]))),128))])],64))])])):c("",!0)],64))])]))}},_=$(We);_.use(z());_.mount("#admin-dashboard-app");
