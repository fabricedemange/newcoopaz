import{i as S,o as i,c as n,u as r,a as e,b as u,t as d,F as b,j as T,e as f,v as $,d as _,n as g,l as y,q as w,B as k,C as A,w as C,D,s as x,r as L,g as B,h as N}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as P,c as V}from"./chunks/pinia-gLxYYWQL.js";import{ac as F,ad as E}from"./chunks/index-nogkb2JM.js";import{_ as U}from"./chunks/BackButton-DzFd1NqY.js";import{_ as z}from"./chunks/AdminCategoryFormContent-DyfDarlZ.js";import{_ as R}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const O=P("adminCategories",{state:()=>({categories:[],loading:!0,error:null,sortColumn:"ordre",sortDirection:"asc",searchTerm:"",showMergeModal:!1,mergeSourceId:null,mergeTargetId:null,merging:!1}),getters:{sortedCategories(a){let o=a.searchTerm?a.categories.filter(l=>l.nom&&l.nom.toLowerCase().includes(a.searchTerm.toLowerCase())||l.description&&l.description.toLowerCase().includes(a.searchTerm.toLowerCase())):[...a.categories];return o=[...o],o.sort((l,p)=>{let m=l[a.sortColumn]??"",c=p[a.sortColumn]??"";return typeof m=="string"&&(m=m.toLowerCase()),typeof c=="string"&&(c=c.toLowerCase()),m<c?a.sortDirection==="asc"?-1:1:m>c?a.sortDirection==="asc"?1:-1:0}),o},categoriesAlpha(a){return[...a.categories].sort((o,l)=>{const p=(o.nom||"").toLowerCase(),m=(l.nom||"").toLowerCase();return p.localeCompare(m)})}},actions:{async loadData(){this.loading=!0,this.error=null;try{const a=await E();if(a.success)this.categories=a.categories||[];else throw new Error(a.error||"Erreur inconnue")}catch(a){this.error=a.message||"Erreur lors du chargement des données"}finally{this.loading=!1}},sortBy(a){this.sortColumn===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=a,this.sortDirection="asc")},openMergeModal(){this.showMergeModal=!0,this.mergeSourceId=null,this.mergeTargetId=null},closeMergeModal(){this.showMergeModal=!1,this.mergeSourceId=null,this.mergeTargetId=null},async mergeCategories(){if(!this.mergeSourceId||!this.mergeTargetId){alert("Veuillez sélectionner les deux catégories");return}if(this.mergeSourceId===this.mergeTargetId){alert("Impossible de fusionner une catégorie avec elle-même");return}const a=this.categories.find(l=>l.id===parseInt(this.mergeSourceId,10)),o=this.categories.find(l=>l.id===parseInt(this.mergeTargetId,10));if(confirm(`Êtes-vous sûr de vouloir fusionner "${a==null?void 0:a.nom}" dans "${o==null?void 0:o.nom}" ?

Tous les produits et sous-catégories seront transférés, puis "${a==null?void 0:a.nom}" sera supprimée.`)){this.merging=!0;try{const l=await F({sourceId:this.mergeSourceId,targetId:this.mergeTargetId});if(l.success)alert(`Fusion réussie !
${l.productsUpdated} produit(s) et ${l.subcategoriesUpdated} sous-catégorie(s) transférés.`),this.closeMergeModal(),await this.loadData();else throw new Error(l.error)}catch(l){alert(l.message||"Erreur lors de la fusion")}finally{this.merging=!1}}}}}),j={class:"container-fluid px-3 mt-4"},q={key:0,class:"text-center py-5"},G={key:1,class:"alert alert-danger"},K={class:"mb-0"},H={class:"row"},J={class:"col-12"},Q={class:"d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2"},W={class:"row"},X={class:"col-12"},Y={class:"d-flex flex-column flex-sm-row gap-2 mb-3"},Z={class:"row mb-3"},ee={class:"col-12 col-md-6"},se={class:"input-group"},te={class:"row"},oe={class:"col-12"},re={key:0,class:"alert alert-info text-center"},ie={key:1},ne={class:"card"},le={class:"card-header"},ae={class:"card-title mb-0"},de={class:"card-body"},ue={class:"table-responsive d-none d-md-block"},ce={class:"table table-hover"},me={class:"thead-administration"},ge={class:"text-muted"},be={key:1,class:"text-muted"},pe={key:0,class:"badge bg-secondary"},ve={key:1,class:"badge bg-primary"},fe={class:"badge bg-info"},ye={key:0,class:"badge bg-success"},he={key:1,class:"badge bg-secondary"},_e=["href"],we={class:"d-md-none"},ke={class:"card-body"},Ce={class:"card-title mb-3"},xe={class:"row g-2 mb-3"},Me={class:"col-6"},Ie={key:1,class:"text-muted"},Se={class:"col-6"},Te={key:0,class:"badge bg-secondary"},$e={key:1,class:"badge bg-primary"},Ae={class:"col-6"},De={class:"col-6"},Le={class:"badge bg-info"},Be={class:"col-12"},Ne={key:0,class:"badge bg-success"},Pe={key:1,class:"badge bg-secondary"},Ve=["href"],Fe=["aria-hidden"],Ee={class:"modal-content"},Ue={class:"modal-body"},ze={key:3,class:"modal show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},Re={class:"modal-dialog"},Oe={class:"modal-content"},je={class:"modal-header"},qe={class:"modal-body"},Ge={class:"mb-3"},Ke=["value"],He={class:"mb-3"},Je=["value"],Qe={class:"modal-footer"},We=["disabled"],Xe={key:0,class:"spinner-border spinner-border-sm me-2"},Ye={key:1,class:"bi bi-union me-2"},Ze={__name:"AdminCategoriesPage",setup(a){const o=O(),l=L(!1),p=B(()=>typeof window<"u"&&window.CSRF_TOKEN||"");function m(){l.value=!0}function c(){l.value=!1}function I(){c(),o.loadData()}function v(h){return o.sortColumn!==h?"bi-arrow-down-up":o.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}return S(()=>{if(o.loadData(),new URLSearchParams(window.location.search).get("modal")==="new"){l.value=!0;const s=new URL(window.location.href);s.searchParams.delete("modal"),window.history.replaceState({},"",s.toString())}}),(h,s)=>(i(),n("div",j,[r(o).loading?(i(),n("div",q,[...s[15]||(s[15]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Chargement...")],-1),e("p",{class:"mt-3 text-muted"},"Chargement des catégories...",-1)])])):r(o).error?(i(),n("div",G,[s[17]||(s[17]=e("h4",{class:"alert-heading"},[e("i",{class:"bi bi-exclamation-triangle me-2"}),u("Erreur")],-1)),e("p",K,d(r(o).error),1),e("button",{type:"button",class:"btn btn-primary mt-2",onClick:s[0]||(s[0]=t=>r(o).loadData())},[...s[16]||(s[16]=[e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),u("Réessayer ",-1)])])])):(i(),n(b,{key:2},[e("div",H,[e("div",J,[e("div",Q,[s[18]||(s[18]=e("h2",{class:"mb-0"},"Gestion des catégories",-1)),T(U)]),s[19]||(s[19]=e("p",{class:"text-muted mb-4"},"Organiser les produits par catégories et sous-catégories",-1))])]),e("div",W,[e("div",X,[e("div",Y,[e("button",{type:"button",class:"btn btn-success",onClick:m},[...s[20]||(s[20]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),u("Ajouter une catégorie ",-1)])]),e("button",{type:"button",class:"btn btn-outline-warning",onClick:s[1]||(s[1]=t=>r(o).openMergeModal())},[...s[21]||(s[21]=[e("i",{class:"bi bi-union me-2"},null,-1),u("Fusionner des catégories ",-1)])])])])]),e("div",Z,[e("div",ee,[e("div",se,[s[23]||(s[23]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-search"})],-1)),f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>r(o).searchTerm=t),type:"text",class:"form-control",placeholder:"Rechercher une catégorie..."},null,512),[[$,r(o).searchTerm]]),r(o).searchTerm?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:s[3]||(s[3]=t=>r(o).searchTerm="")},[...s[22]||(s[22]=[e("i",{class:"bi bi-x-lg"},null,-1)])])):_("",!0)])])]),e("div",te,[e("div",oe,[r(o).sortedCategories.length===0?(i(),n("div",re,[s[24]||(s[24]=e("h4",null,"Aucune catégorie trouvée",-1)),e("p",null,d(r(o).searchTerm?"Modifiez votre recherche ou créez une nouvelle catégorie.":"Commencez par créer votre première catégorie."),1),e("button",{type:"button",class:"btn btn-primary",onClick:m},"Créer une catégorie")])):(i(),n("div",ie,[e("div",ne,[e("div",le,[e("h5",ae,[s[25]||(s[25]=e("i",{class:"bi bi-tags me-2"},null,-1)),u(" Liste des catégories ("+d(r(o).sortedCategories.length)+") ",1)])]),e("div",de,[e("div",ue,[e("table",ce,[e("thead",me,[e("tr",null,[e("th",{style:{cursor:"pointer"},onClick:s[4]||(s[4]=t=>r(o).sortBy("nom"))},[s[26]||(s[26]=u(" Catégorie ",-1)),e("i",{class:g("bi ms-1 "+v("nom"))},null,2)]),s[31]||(s[31]=e("th",null,"Icône",-1)),e("th",{style:{cursor:"pointer"},onClick:s[5]||(s[5]=t=>r(o).sortBy("parent_nom"))},[s[27]||(s[27]=u(" Parent ",-1)),e("i",{class:g("bi ms-1 "+v("parent_nom"))},null,2)]),e("th",{style:{cursor:"pointer"},onClick:s[6]||(s[6]=t=>r(o).sortBy("ordre"))},[s[28]||(s[28]=u(" Ordre ",-1)),e("i",{class:g("bi ms-1 "+v("ordre"))},null,2)]),e("th",{style:{cursor:"pointer"},onClick:s[7]||(s[7]=t=>r(o).sortBy("nb_products"))},[s[29]||(s[29]=u(" Produits ",-1)),e("i",{class:g("bi ms-1 "+v("nb_products"))},null,2)]),e("th",{style:{cursor:"pointer"},onClick:s[8]||(s[8]=t=>r(o).sortBy("is_active"))},[s[30]||(s[30]=u(" Statut ",-1)),e("i",{class:g("bi ms-1 "+v("is_active"))},null,2)]),s[32]||(s[32]=e("th",null,"Actions",-1))])]),e("tbody",null,[(i(!0),n(b,null,y(r(o).sortedCategories,t=>(i(),n("tr",{key:t.id},[e("td",null,[e("span",{class:"badge",style:w({backgroundColor:t.couleur||"#6c757d"})},d(t.nom),5)]),e("td",null,[t.icon?(i(),n(b,{key:0},[e("i",{class:g(t.icon)},null,2),e("small",ge,d(t.icon),1)],64)):(i(),n("span",be,"-"))]),e("td",null,[t.parent_nom?(i(),n("span",pe,d(t.parent_nom),1)):(i(),n("span",ve,"Principale"))]),e("td",null,d(t.ordre||0),1),e("td",null,[e("span",fe,d(t.nb_products||0)+" produit(s)",1)]),e("td",null,[t.is_active?(i(),n("span",ye,"Active")):(i(),n("span",he,"Inactive"))]),e("td",null,[e("a",{href:`/admin/categories/${t.id}/edit`,class:"btn btn-outline-secondary btn-sm",title:"Modifier"},[...s[33]||(s[33]=[e("i",{class:"bi bi-pencil"},null,-1)])],8,_e)])]))),128))])])]),e("div",we,[(i(!0),n(b,null,y(r(o).sortedCategories,t=>(i(),n("div",{key:"m-"+t.id,class:"card mb-3 shadow-sm"},[e("div",ke,[e("h5",Ce,[e("span",{class:"badge",style:w({backgroundColor:t.couleur||"#6c757d"})},d(t.nom),5)]),e("div",xe,[e("div",Me,[s[35]||(s[35]=e("small",{class:"text-muted d-block"},"Icône",-1)),t.icon?(i(),n(b,{key:0},[e("i",{class:g(t.icon)},null,2),s[34]||(s[34]=u()),e("small",null,d(t.icon),1)],64)):(i(),n("span",Ie,"-"))]),e("div",Se,[s[36]||(s[36]=e("small",{class:"text-muted d-block"},"Parent",-1)),t.parent_nom?(i(),n("span",Te,d(t.parent_nom),1)):(i(),n("span",$e,"Principale"))]),e("div",Ae,[s[37]||(s[37]=e("small",{class:"text-muted d-block"},"Ordre",-1)),e("strong",null,d(t.ordre||0),1)]),e("div",De,[s[38]||(s[38]=e("small",{class:"text-muted d-block"},"Produits",-1)),e("span",Le,d(t.nb_products||0),1)]),e("div",Be,[s[39]||(s[39]=e("small",{class:"text-muted d-block"},"Statut",-1)),t.is_active?(i(),n("span",Ne,"Active")):(i(),n("span",Pe,"Inactive"))])]),e("a",{href:`/admin/categories/${t.id}/edit`,class:"btn btn-sm btn-outline-secondary w-100"},[...s[40]||(s[40]=[e("i",{class:"bi bi-pencil me-1"},null,-1),u("Modifier ",-1)])],8,Ve)])]))),128))])])])]))])])],64)),(i(),k(D,{to:"body"},[f(e("div",{class:g(["modal fade",{show:l.value}]),"aria-hidden":!l.value,tabindex:"-1",style:w(l.value?{display:"flex",visibility:"visible"}:{display:"none",visibility:"hidden"}),onClick:C(c,["self"])},[e("div",{class:g(["modal-backdrop fade",{show:l.value}]),onClick:c},null,2),e("div",{class:"modal-dialog modal-lg modal-dialog-scrollable",role:"document",onClick:s[9]||(s[9]=C(()=>{},["stop"]))},[e("div",Ee,[e("div",{class:"modal-header"},[s[41]||(s[41]=e("h5",{class:"modal-title"},"Créer une nouvelle catégorie",-1)),e("button",{type:"button",class:"btn-close","aria-label":"Fermer",onClick:c})]),e("div",Ue,[l.value?(i(),k(z,{key:0,"all-categories":r(o).categories,category:null,"category-id":null,modal:!0,"csrf-token":p.value,onSuccess:I,onCancel:c},null,8,["all-categories","csrf-token"])):_("",!0)])])])],14,Fe),[[A,l.value]])])),r(o).showMergeModal?(i(),n("div",ze,[e("div",Re,[e("div",Oe,[e("div",je,[s[42]||(s[42]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-union me-2"}),u("Fusionner des catégories")],-1)),e("button",{type:"button",class:"btn-close",onClick:s[10]||(s[10]=t=>r(o).closeMergeModal())})]),e("div",qe,[s[47]||(s[47]=e("div",{class:"alert alert-warning"},[e("i",{class:"bi bi-exclamation-triangle me-2"}),e("strong",null,"Attention :"),u(" Cette action est irréversible. Tous les produits et sous-catégories de la catégorie source seront transférés vers la cible, puis la source sera supprimée. ")],-1)),e("div",Ge,[s[44]||(s[44]=e("label",{for:"merge-source",class:"form-label"},"Catégorie à fusionner (source) :",-1)),f(e("select",{id:"merge-source",class:"form-select","onUpdate:modelValue":s[11]||(s[11]=t=>r(o).mergeSourceId=t)},[s[43]||(s[43]=e("option",{value:""},"-- Sélectionner --",-1)),(i(!0),n(b,null,y(r(o).categoriesAlpha,t=>(i(),n("option",{key:"s-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,Ke))),128))],512),[[x,r(o).mergeSourceId]])]),e("div",He,[s[46]||(s[46]=e("label",{for:"merge-target",class:"form-label"},"Catégorie de destination (cible) :",-1)),f(e("select",{id:"merge-target",class:"form-select","onUpdate:modelValue":s[12]||(s[12]=t=>r(o).mergeTargetId=t)},[s[45]||(s[45]=e("option",{value:""},"-- Sélectionner --",-1)),(i(!0),n(b,null,y(r(o).categoriesAlpha,t=>(i(),n("option",{key:"t-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,Je))),128))],512),[[x,r(o).mergeTargetId]])])]),e("div",Qe,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[13]||(s[13]=t=>r(o).closeMergeModal())},"Annuler"),e("button",{type:"button",class:"btn btn-warning",disabled:r(o).merging,onClick:s[14]||(s[14]=t=>r(o).mergeCategories())},[r(o).merging?(i(),n("span",Xe)):(i(),n("i",Ye)),u(" "+d(r(o).merging?"Fusion en cours...":"Fusionner"),1)],8,We)])])])])):_("",!0)]))}},es=R(Ze,[["__scopeId","data-v-b351c81a"]]),M=N(es);M.use(V());M.mount("#admin-categories-app");
