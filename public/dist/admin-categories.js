import{i as _,o as i,c as n,u as r,a as s,b as u,t as d,F as c,e as p,v as k,d as v,n as m,k as b,p as y,q as f,h as C}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as w,c as I}from"./chunks/pinia-BNknc8Vm.js";import{a0 as x,a1 as M}from"./chunks/index-BkeVkIvb.js";import{_ as T}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const S=w("adminCategories",{state:()=>({categories:[],loading:!0,error:null,sortColumn:"ordre",sortDirection:"asc",searchTerm:"",showMergeModal:!1,mergeSourceId:null,mergeTargetId:null,merging:!1}),getters:{sortedCategories(l){let o=l.searchTerm?l.categories.filter(a=>a.nom&&a.nom.toLowerCase().includes(l.searchTerm.toLowerCase())||a.description&&a.description.toLowerCase().includes(l.searchTerm.toLowerCase())):[...l.categories];return o=[...o],o.sort((a,g)=>{let e=a[l.sortColumn]??"",t=g[l.sortColumn]??"";return typeof e=="string"&&(e=e.toLowerCase()),typeof t=="string"&&(t=t.toLowerCase()),e<t?l.sortDirection==="asc"?-1:1:e>t?l.sortDirection==="asc"?1:-1:0}),o},categoriesAlpha(l){return[...l.categories].sort((o,a)=>{const g=(o.nom||"").toLowerCase(),e=(a.nom||"").toLowerCase();return g.localeCompare(e)})}},actions:{async loadData(){this.loading=!0,this.error=null;try{const l=await M();if(l.success)this.categories=l.categories||[];else throw new Error(l.error||"Erreur inconnue")}catch(l){this.error=l.message||"Erreur lors du chargement des données"}finally{this.loading=!1}},sortBy(l){this.sortColumn===l?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=l,this.sortDirection="asc")},openMergeModal(){this.showMergeModal=!0,this.mergeSourceId=null,this.mergeTargetId=null},closeMergeModal(){this.showMergeModal=!1,this.mergeSourceId=null,this.mergeTargetId=null},async mergeCategories(){if(!this.mergeSourceId||!this.mergeTargetId){alert("Veuillez sélectionner les deux catégories");return}if(this.mergeSourceId===this.mergeTargetId){alert("Impossible de fusionner une catégorie avec elle-même");return}const l=this.categories.find(a=>a.id===parseInt(this.mergeSourceId,10)),o=this.categories.find(a=>a.id===parseInt(this.mergeTargetId,10));if(confirm(`Êtes-vous sûr de vouloir fusionner "${l==null?void 0:l.nom}" dans "${o==null?void 0:o.nom}" ?

Tous les produits et sous-catégories seront transférés, puis "${l==null?void 0:l.nom}" sera supprimée.`)){this.merging=!0;try{const a=await x({sourceId:this.mergeSourceId,targetId:this.mergeTargetId});if(a.success)alert(`Fusion réussie !
${a.productsUpdated} produit(s) et ${a.subcategoriesUpdated} sous-catégorie(s) transférés.`),this.closeMergeModal(),await this.loadData();else throw new Error(a.error)}catch(a){alert(a.message||"Erreur lors de la fusion")}finally{this.merging=!1}}}}}),$={class:"container-fluid px-3 mt-4"},A={key:0,class:"text-center py-5"},D={key:1,class:"alert alert-danger"},L={class:"mb-0"},B={class:"row"},P={class:"col-12"},V={class:"d-flex flex-column flex-sm-row gap-2 mb-3"},E={class:"row mb-3"},F={class:"col-12 col-md-6"},z={class:"input-group"},N={class:"row"},U={class:"col-12"},O={key:0,class:"alert alert-info text-center"},R={key:1},j={class:"card"},q={class:"card-header"},G={class:"card-title mb-0"},H={class:"card-body"},J={class:"table-responsive d-none d-md-block"},K={class:"table table-hover"},Q={class:"text-muted"},W={key:1,class:"text-muted"},X={key:0,class:"badge bg-secondary"},Y={key:1,class:"badge bg-primary"},Z={class:"badge bg-info"},ss={key:0,class:"badge bg-success"},es={key:1,class:"badge bg-secondary"},ts=["href"],os={class:"d-md-none"},rs={class:"card-body"},is={class:"card-title mb-3"},ns={class:"row g-2 mb-3"},ls={class:"col-6"},as={key:1,class:"text-muted"},ds={class:"col-6"},us={key:0,class:"badge bg-secondary"},cs={key:1,class:"badge bg-primary"},ms={class:"col-6"},gs={class:"col-6"},bs={class:"badge bg-info"},ps={class:"col-12"},vs={key:0,class:"badge bg-success"},ys={key:1,class:"badge bg-secondary"},fs=["href"],hs={key:3,class:"modal show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},_s={class:"modal-dialog"},ks={class:"modal-content"},Cs={class:"modal-header"},ws={class:"modal-body"},Is={class:"mb-3"},xs=["value"],Ms={class:"mb-3"},Ts=["value"],Ss={class:"modal-footer"},$s=["disabled"],As={key:0,class:"spinner-border spinner-border-sm me-2"},Ds={key:1,class:"bi bi-union me-2"},Ls={__name:"AdminCategoriesPage",setup(l){const o=S();function a(g){return o.sortColumn!==g?"bi-arrow-down-up":o.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}return _(()=>{o.loadData()}),(g,e)=>(i(),n("div",$,[r(o).loading?(i(),n("div",A,[...e[14]||(e[14]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Chargement...")],-1),s("p",{class:"mt-3 text-muted"},"Chargement des catégories...",-1)])])):r(o).error?(i(),n("div",D,[e[16]||(e[16]=s("h4",{class:"alert-heading"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),u("Erreur")],-1)),s("p",L,d(r(o).error),1),s("button",{type:"button",class:"btn btn-primary mt-2",onClick:e[0]||(e[0]=t=>r(o).loadData())},[...e[15]||(e[15]=[s("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),u("Réessayer ",-1)])])])):(i(),n(c,{key:2},[e[39]||(e[39]=s("div",{class:"row"},[s("div",{class:"col-12"},[s("h2",{class:"mb-4"},"Gestion des catégories"),s("p",{class:"text-muted mb-4"},"Organiser les produits par catégories et sous-catégories")])],-1)),s("div",B,[s("div",P,[s("div",V,[e[18]||(e[18]=s("a",{href:"/admin/categories/new",class:"btn btn-success"},[s("i",{class:"bi bi-plus-circle me-2"}),u("Ajouter une catégorie ")],-1)),s("button",{type:"button",class:"btn btn-outline-warning",onClick:e[1]||(e[1]=t=>r(o).openMergeModal())},[...e[17]||(e[17]=[s("i",{class:"bi bi-union me-2"},null,-1),u("Fusionner des catégories ",-1)])])])])]),s("div",E,[s("div",F,[s("div",z,[e[20]||(e[20]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-search"})],-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r(o).searchTerm=t),type:"text",class:"form-control",placeholder:"Rechercher une catégorie..."},null,512),[[k,r(o).searchTerm]]),r(o).searchTerm?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=t=>r(o).searchTerm="")},[...e[19]||(e[19]=[s("i",{class:"bi bi-x-lg"},null,-1)])])):v("",!0)])])]),s("div",N,[s("div",U,[r(o).sortedCategories.length===0?(i(),n("div",O,[e[21]||(e[21]=s("h4",null,"Aucune catégorie trouvée",-1)),s("p",null,d(r(o).searchTerm?"Modifiez votre recherche ou créez une nouvelle catégorie.":"Commencez par créer votre première catégorie."),1),e[22]||(e[22]=s("a",{href:"/admin/categories/new",class:"btn btn-primary"},"Créer une catégorie",-1))])):(i(),n("div",R,[s("div",j,[s("div",q,[s("h5",G,[e[23]||(e[23]=s("i",{class:"bi bi-tags me-2"},null,-1)),u(" Liste des catégories ("+d(r(o).sortedCategories.length)+") ",1)])]),s("div",H,[s("div",J,[s("table",K,[s("thead",null,[s("tr",null,[s("th",{style:{cursor:"pointer"},onClick:e[4]||(e[4]=t=>r(o).sortBy("nom"))},[e[24]||(e[24]=u(" Catégorie ",-1)),s("i",{class:m("bi ms-1 "+a("nom"))},null,2)]),e[29]||(e[29]=s("th",null,"Icône",-1)),s("th",{style:{cursor:"pointer"},onClick:e[5]||(e[5]=t=>r(o).sortBy("parent_nom"))},[e[25]||(e[25]=u(" Parent ",-1)),s("i",{class:m("bi ms-1 "+a("parent_nom"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[6]||(e[6]=t=>r(o).sortBy("ordre"))},[e[26]||(e[26]=u(" Ordre ",-1)),s("i",{class:m("bi ms-1 "+a("ordre"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[7]||(e[7]=t=>r(o).sortBy("nb_products"))},[e[27]||(e[27]=u(" Produits ",-1)),s("i",{class:m("bi ms-1 "+a("nb_products"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[8]||(e[8]=t=>r(o).sortBy("is_active"))},[e[28]||(e[28]=u(" Statut ",-1)),s("i",{class:m("bi ms-1 "+a("is_active"))},null,2)]),e[30]||(e[30]=s("th",null,"Actions",-1))])]),s("tbody",null,[(i(!0),n(c,null,b(r(o).sortedCategories,t=>(i(),n("tr",{key:t.id},[s("td",null,[s("span",{class:"badge",style:y({backgroundColor:t.couleur||"#6c757d"})},d(t.nom),5)]),s("td",null,[t.icon?(i(),n(c,{key:0},[s("i",{class:m(t.icon)},null,2),s("small",Q,d(t.icon),1)],64)):(i(),n("span",W,"-"))]),s("td",null,[t.parent_nom?(i(),n("span",X,d(t.parent_nom),1)):(i(),n("span",Y,"Principale"))]),s("td",null,d(t.ordre||0),1),s("td",null,[s("span",Z,d(t.nb_products||0)+" produit(s)",1)]),s("td",null,[t.is_active?(i(),n("span",ss,"Active")):(i(),n("span",es,"Inactive"))]),s("td",null,[s("a",{href:`/admin/categories/${t.id}/edit`,class:"btn btn-outline-secondary btn-sm",title:"Modifier"},[...e[31]||(e[31]=[s("i",{class:"bi bi-pencil"},null,-1)])],8,ts)])]))),128))])])]),s("div",os,[(i(!0),n(c,null,b(r(o).sortedCategories,t=>(i(),n("div",{key:"m-"+t.id,class:"card mb-3 shadow-sm"},[s("div",rs,[s("h5",is,[s("span",{class:"badge",style:y({backgroundColor:t.couleur||"#6c757d"})},d(t.nom),5)]),s("div",ns,[s("div",ls,[e[33]||(e[33]=s("small",{class:"text-muted d-block"},"Icône",-1)),t.icon?(i(),n(c,{key:0},[s("i",{class:m(t.icon)},null,2),e[32]||(e[32]=u()),s("small",null,d(t.icon),1)],64)):(i(),n("span",as,"-"))]),s("div",ds,[e[34]||(e[34]=s("small",{class:"text-muted d-block"},"Parent",-1)),t.parent_nom?(i(),n("span",us,d(t.parent_nom),1)):(i(),n("span",cs,"Principale"))]),s("div",ms,[e[35]||(e[35]=s("small",{class:"text-muted d-block"},"Ordre",-1)),s("strong",null,d(t.ordre||0),1)]),s("div",gs,[e[36]||(e[36]=s("small",{class:"text-muted d-block"},"Produits",-1)),s("span",bs,d(t.nb_products||0),1)]),s("div",ps,[e[37]||(e[37]=s("small",{class:"text-muted d-block"},"Statut",-1)),t.is_active?(i(),n("span",vs,"Active")):(i(),n("span",ys,"Inactive"))])]),s("a",{href:`/admin/categories/${t.id}/edit`,class:"btn btn-sm btn-outline-secondary w-100"},[...e[38]||(e[38]=[s("i",{class:"bi bi-pencil me-1"},null,-1),u("Modifier ",-1)])],8,fs)])]))),128))])])])]))])])],64)),r(o).showMergeModal?(i(),n("div",hs,[s("div",_s,[s("div",ks,[s("div",Cs,[e[40]||(e[40]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-union me-2"}),u("Fusionner des catégories")],-1)),s("button",{type:"button",class:"btn-close",onClick:e[9]||(e[9]=t=>r(o).closeMergeModal())})]),s("div",ws,[e[45]||(e[45]=s("div",{class:"alert alert-warning"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),s("strong",null,"Attention :"),u(" Cette action est irréversible. Tous les produits et sous-catégories de la catégorie source seront transférés vers la cible, puis la source sera supprimée. ")],-1)),s("div",Is,[e[42]||(e[42]=s("label",{for:"merge-source",class:"form-label"},"Catégorie à fusionner (source) :",-1)),p(s("select",{id:"merge-source",class:"form-select","onUpdate:modelValue":e[10]||(e[10]=t=>r(o).mergeSourceId=t)},[e[41]||(e[41]=s("option",{value:""},"-- Sélectionner --",-1)),(i(!0),n(c,null,b(r(o).categoriesAlpha,t=>(i(),n("option",{key:"s-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,xs))),128))],512),[[f,r(o).mergeSourceId]])]),s("div",Ms,[e[44]||(e[44]=s("label",{for:"merge-target",class:"form-label"},"Catégorie de destination (cible) :",-1)),p(s("select",{id:"merge-target",class:"form-select","onUpdate:modelValue":e[11]||(e[11]=t=>r(o).mergeTargetId=t)},[e[43]||(e[43]=s("option",{value:""},"-- Sélectionner --",-1)),(i(!0),n(c,null,b(r(o).categoriesAlpha,t=>(i(),n("option",{key:"t-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,Ts))),128))],512),[[f,r(o).mergeTargetId]])])]),s("div",Ss,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=t=>r(o).closeMergeModal())},"Annuler"),s("button",{type:"button",class:"btn btn-warning",disabled:r(o).merging,onClick:e[13]||(e[13]=t=>r(o).mergeCategories())},[r(o).merging?(i(),n("span",As)):(i(),n("i",Ds)),u(" "+d(r(o).merging?"Fusion en cours...":"Fusionner"),1)],8,$s)])])])])):v("",!0)]))}},Bs=T(Ls,[["__scopeId","data-v-03a45568"]]),h=C(Bs);h.use(I());h.mount("#admin-categories-app");
