import{i as _,o as d,c,u as o,a as t,b as u,t as r,F as p,d as m,e as b,v as f,k as v,p as x,h as w}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{d as k,c as C}from"./chunks/pinia-8wUEIqj_.js";import{as as E}from"./chunks/index-BwM03k9W.js";const L=k("adminCatalogueSynthese",{state:()=>({catalogueId:typeof window<"u"&&window.CATALOGUE_ID||null,catalogueName:"",organizationName:"",organizationEmail:"",synthese:[],loading:!0,error:null,search:""}),getters:{filteredSynthese(a){if(!a.search)return a.synthese;const e=a.search.toLowerCase();return a.synthese.filter(l=>l.produit&&l.produit.toLowerCase().includes(e)||l.categorie&&l.categorie.toLowerCase().includes(e)||l.note&&l.note.toLowerCase().includes(e)||l.note_article&&l.note_article.toLowerCase().includes(e))},statistics(a){const e=a.search?a.synthese.filter(i=>i.produit&&i.produit.toLowerCase().includes(a.search.toLowerCase())||i.categorie&&i.categorie.toLowerCase().includes(a.search.toLowerCase())||i.note&&i.note.toLowerCase().includes(a.search.toLowerCase())||i.note_article&&i.note_article.toLowerCase().includes(a.search.toLowerCase())):a.synthese,l=e.length,h=e.reduce((i,g)=>i+parseFloat(g.total_commande||0),0),s=e.reduce((i,g)=>i+parseFloat(g.prix||0)*parseFloat(g.total_commande||0),0),n=l>0?s/l:0;return{nbProducts:l,totalQuantity:h,totalAmount:s,averageAmount:n}}},actions:{async loadData(){const a=this.catalogueId;if(!a){this.error="ID catalogue manquant",this.loading=!1;return}this.loading=!0,this.error=null;try{const e=await E(a);if(e.success)this.catalogueName=e.catalogueName||"",this.organizationName=e.organizationName||"",this.organizationEmail=e.organizationEmail||"",this.synthese=e.synthese||[];else throw new Error(e.error||"Erreur lors du chargement")}catch(e){this.error=e.message||"Erreur lors du chargement"}finally{this.loading=!1}},formatPrice(a){return parseFloat(a||0).toFixed(2)+" €"},formatQuantity(a){return parseFloat(a||0).toFixed(2)}}}),P={class:"container-fluid mt-4"},S={key:0,class:"text-center py-5"},F={key:1,class:"alert alert-danger"},N={class:"d-flex justify-content-between align-items-center mb-4"},A={class:"text-muted"},z={key:0,class:"text-muted mb-0"},D={class:"card mb-4"},I={class:"card-body"},Q={class:"row g-2"},M={class:"col-md-auto"},T=["href"],B={class:"col-md-auto"},V=["href"],$={key:0,class:"col-md-auto"},R={class:"card mb-4"},j={class:"card-body py-2"},q={class:"row text-center"},G={class:"col"},U={class:"fs-5"},O={class:"col"},H={class:"fs-5"},J={class:"col"},K={class:"fs-5 text-success"},W={class:"col"},X={class:"fs-5"},Y={class:"card mb-4"},Z={class:"card-body"},tt={class:"input-group"},et={class:"card"},st={class:"card-body p-0"},ot={class:"table-responsive"},at={class:"table table-striped table-hover mb-0"},nt={key:0},rt={colspan:"6",class:"text-center text-muted py-4"},lt={key:1},it={class:"text-end"},dt={class:"text-end"},ct={class:"text-end"},ut={key:0,class:"small"},mt={key:1,class:"small text-info"},ht={key:2},gt={__name:"AdminCatalogueSynthesePage",setup(a){const e=L();async function l(){if(confirm(`Envoyer la synthèse par email à ${e.organizationEmail} ?`))try{if((await fetch(`/admin/catalogues/${e.catalogueId}/synthese/export/pdf/M`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).ok)alert("Email envoyé avec succès !");else throw new Error("Erreur lors de l'envoi de l'email")}catch(h){alert(h.message||"Erreur lors de l'envoi de l'email")}}return _(()=>{e.loadData()}),(h,s)=>(d(),c("div",P,[o(e).loading?(d(),c("div",S,[...s[1]||(s[1]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Chargement...")],-1),t("p",{class:"mt-3 text-muted"},"Chargement de la synthèse...",-1)])])):o(e).error?(d(),c("div",F,[s[2]||(s[2]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),u(r(o(e).error)+" ",1),s[3]||(s[3]=t("a",{href:"/admin/catalogues/vue",class:"btn btn-primary ms-2"},[t("i",{class:"bi bi-arrow-left me-1"}),u("Retour")],-1))])):(d(),c(p,{key:2},[t("div",N,[t("div",null,[s[5]||(s[5]=t("h2",null,[t("i",{class:"bi bi-file-earmark-text me-2"}),u("Synthèse du catalogue")],-1)),t("h5",A,r(o(e).catalogueName),1),o(e).organizationName?(d(),c("p",z,[s[4]||(s[4]=t("i",{class:"bi bi-building me-1"},null,-1)),u(r(o(e).organizationName),1)])):m("",!0)]),s[6]||(s[6]=t("a",{href:"/admin/catalogues/vue",class:"btn btn-outline-secondary"},[t("i",{class:"bi bi-arrow-left me-1"}),u("Retour ")],-1))]),t("div",D,[t("div",I,[t("div",Q,[t("div",M,[t("a",{href:`/admin/catalogues/${o(e).catalogueId}/synthese/export/xlsx`,class:"btn btn-success"},[...s[7]||(s[7]=[t("i",{class:"bi bi-file-earmark-excel me-1"},null,-1),u("Export Excel ",-1)])],8,T)]),t("div",B,[t("a",{href:`/admin/catalogues/${o(e).catalogueId}/synthese/export/pdf/S`,class:"btn btn-danger"},[...s[8]||(s[8]=[t("i",{class:"bi bi-file-earmark-pdf me-1"},null,-1),u("Export PDF ",-1)])],8,V)]),o(e).organizationEmail?(d(),c("div",$,[t("button",{type:"button",class:"btn btn-primary",onClick:l},[...s[9]||(s[9]=[t("i",{class:"bi bi-envelope me-1"},null,-1),u("Envoyer par email ",-1)])])])):m("",!0)])])]),t("div",R,[t("div",j,[t("div",q,[t("div",G,[s[10]||(s[10]=t("small",{class:"text-muted d-block"},"Produits",-1)),t("strong",U,r(o(e).statistics.nbProducts),1)]),t("div",O,[s[11]||(s[11]=t("small",{class:"text-muted d-block"},"Quantité totale",-1)),t("strong",H,r(o(e).formatQuantity(o(e).statistics.totalQuantity)),1)]),t("div",J,[s[12]||(s[12]=t("small",{class:"text-muted d-block"},"Montant total",-1)),t("strong",K,r(o(e).formatPrice(o(e).statistics.totalAmount)),1)]),t("div",W,[s[13]||(s[13]=t("small",{class:"text-muted d-block"},"Moyenne/produit",-1)),t("strong",X,r(o(e).formatPrice(o(e).statistics.averageAmount)),1)])])])]),t("div",Y,[t("div",Z,[t("div",tt,[s[14]||(s[14]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),b(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o(e).search=n),type:"text",class:"form-control",placeholder:"Rechercher un produit, catégorie ou note..."},null,512),[[f,o(e).search]])])])]),t("div",et,[s[18]||(s[18]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},"Synthèse des commandes")],-1)),t("div",st,[t("div",ot,[t("table",at,[s[17]||(s[17]=t("thead",{class:"thead-administration"},[t("tr",null,[t("th",null,"Produit"),t("th",null,"Catégorie"),t("th",{class:"text-end"},"Prix unitaire"),t("th",{class:"text-end"},"Quantité"),t("th",{class:"text-end"},"Montant total"),t("th",null,"Notes")])],-1)),t("tbody",null,[o(e).filteredSynthese.length===0?(d(),c("tr",nt,[t("td",rt,r(o(e).search?"Aucun résultat trouvé":"Aucune commande"),1)])):m("",!0),(d(!0),c(p,null,v(o(e).filteredSynthese,(n,i)=>(d(),c("tr",{key:i},[t("td",null,[t("strong",null,r(n.produit),1)]),t("td",null,[n.categorie?(d(),c("span",{key:0,class:"badge",style:x({backgroundColor:n.categorie_couleur||"#6c757d"})},r(n.categorie),5)):(d(),c("span",lt,"-"))]),t("td",it,r(o(e).formatPrice(n.prix)),1),t("td",dt,[t("strong",null,r(o(e).formatQuantity(n.total_commande)),1)]),t("td",ct,[t("strong",null,r(o(e).formatPrice(parseFloat(n.prix||0)*parseFloat(n.total_commande||0))),1)]),t("td",null,[n.note?(d(),c("div",ut,[s[15]||(s[15]=t("i",{class:"bi bi-chat-square-text me-1"},null,-1)),u(r(n.note),1)])):m("",!0),n.note_article?(d(),c("div",mt,[s[16]||(s[16]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),u(r(n.note_article),1)])):m("",!0),!n.note&&!n.note_article?(d(),c("span",ht,"-")):m("",!0)])]))),128))])])])])])],64))]))}},y=w(gt);y.use(C());y.mount("#admin-catalogue-synthese-app");
