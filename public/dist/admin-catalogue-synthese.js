import{i as _,o as d,c,u as o,a as t,b as u,t as r,F as g,d as m,j as b,e as f,v,l as x,q as w,h as C}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as k,c as E}from"./chunks/pinia-gLxYYWQL.js";import{_ as L}from"./chunks/BackButton-DzFd1NqY.js";import{aw as N}from"./chunks/index-nogkb2JM.js";const P=k("adminCatalogueSynthese",{state:()=>({catalogueId:typeof window<"u"&&window.CATALOGUE_ID||null,catalogueName:"",organizationName:"",organizationEmail:"",synthese:[],loading:!0,error:null,search:""}),getters:{filteredSynthese(a){if(!a.search)return a.synthese;const e=a.search.toLowerCase();return a.synthese.filter(l=>l.produit&&l.produit.toLowerCase().includes(e)||l.categorie&&l.categorie.toLowerCase().includes(e)||l.note&&l.note.toLowerCase().includes(e)||l.note_article&&l.note_article.toLowerCase().includes(e))},statistics(a){const e=a.search?a.synthese.filter(i=>i.produit&&i.produit.toLowerCase().includes(a.search.toLowerCase())||i.categorie&&i.categorie.toLowerCase().includes(a.search.toLowerCase())||i.note&&i.note.toLowerCase().includes(a.search.toLowerCase())||i.note_article&&i.note_article.toLowerCase().includes(a.search.toLowerCase())):a.synthese,l=e.length,h=e.reduce((i,p)=>i+parseFloat(p.total_commande||0),0),s=e.reduce((i,p)=>i+parseFloat(p.prix||0)*parseFloat(p.total_commande||0),0),n=l>0?s/l:0;return{nbProducts:l,totalQuantity:h,totalAmount:s,averageAmount:n}}},actions:{async loadData(){const a=this.catalogueId;if(!a){this.error="ID catalogue manquant",this.loading=!1;return}this.loading=!0,this.error=null;try{const e=await N(a);if(e.success)this.catalogueName=e.catalogueName||"",this.organizationName=e.organizationName||"",this.organizationEmail=e.organizationEmail||"",this.synthese=e.synthese||[];else throw new Error(e.error||"Erreur lors du chargement")}catch(e){this.error=e.message||"Erreur lors du chargement"}finally{this.loading=!1}},formatPrice(a){return parseFloat(a||0).toFixed(2)+" €"},formatQuantity(a){return parseFloat(a||0).toFixed(2)}}}),S={class:"container-fluid mt-4"},F={key:0,class:"text-center py-5"},A={key:1,class:"alert alert-danger"},z={class:"d-flex justify-content-between align-items-center mb-4"},D={class:"text-muted"},I={key:0,class:"text-muted mb-0"},Q={class:"card mb-4"},M={class:"card-body"},T={class:"row g-2"},V={class:"col-md-auto"},$=["href"],B={class:"col-md-auto"},j=["href"],q={key:0,class:"col-md-auto"},G={class:"card mb-4"},R={class:"card-body py-2"},U={class:"row text-center"},O={class:"col"},H={class:"fs-5"},J={class:"col"},K={class:"fs-5"},W={class:"col"},X={class:"fs-5 text-success"},Y={class:"col"},Z={class:"fs-5"},tt={class:"card mb-4"},et={class:"card-body"},st={class:"input-group"},ot={class:"card"},at={class:"card-body p-0"},nt={class:"table-responsive"},rt={class:"table table-striped table-hover mb-0"},lt={key:0},it={colspan:"6",class:"text-center text-muted py-4"},dt={key:1},ct={class:"text-end"},ut={class:"text-end"},mt={class:"text-end"},ht={key:0,class:"small"},pt={key:1,class:"small text-info"},gt={key:2},yt={__name:"AdminCatalogueSynthesePage",setup(a){const e=P();async function l(){if(confirm(`Envoyer la synthèse par email à ${e.organizationEmail} ?`))try{if((await fetch(`/admin/catalogues/${e.catalogueId}/synthese/export/pdf/M`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).ok)alert("Email envoyé avec succès !");else throw new Error("Erreur lors de l'envoi de l'email")}catch(h){alert(h.message||"Erreur lors de l'envoi de l'email")}}return _(()=>{e.loadData()}),(h,s)=>(d(),c("div",S,[o(e).loading?(d(),c("div",F,[...s[1]||(s[1]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Chargement...")],-1),t("p",{class:"mt-3 text-muted"},"Chargement de la synthèse...",-1)])])):o(e).error?(d(),c("div",A,[s[2]||(s[2]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),u(r(o(e).error)+" ",1),s[3]||(s[3]=t("a",{href:"/admin/catalogues/vue",class:"btn btn-primary ms-2"},[t("i",{class:"bi bi-arrow-left me-1"}),u("Retour")],-1))])):(d(),c(g,{key:2},[t("div",z,[t("div",null,[s[5]||(s[5]=t("h2",null,[t("i",{class:"bi bi-file-earmark-text me-2"}),u("Synthèse du catalogue")],-1)),t("h5",D,r(o(e).catalogueName),1),o(e).organizationName?(d(),c("p",I,[s[4]||(s[4]=t("i",{class:"bi bi-building me-1"},null,-1)),u(r(o(e).organizationName),1)])):m("",!0)]),b(L)]),t("div",Q,[t("div",M,[t("div",T,[t("div",V,[t("a",{href:`/admin/catalogues/${o(e).catalogueId}/synthese/export/xlsx`,class:"btn btn-success"},[...s[6]||(s[6]=[t("i",{class:"bi bi-file-earmark-excel me-1"},null,-1),u("Export Excel ",-1)])],8,$)]),t("div",B,[t("a",{href:`/admin/catalogues/${o(e).catalogueId}/synthese/export/pdf/S`,class:"btn btn-danger"},[...s[7]||(s[7]=[t("i",{class:"bi bi-file-earmark-pdf me-1"},null,-1),u("Export PDF ",-1)])],8,j)]),o(e).organizationEmail?(d(),c("div",q,[t("button",{type:"button",class:"btn btn-primary",onClick:l},[...s[8]||(s[8]=[t("i",{class:"bi bi-envelope me-1"},null,-1),u("Envoyer par email ",-1)])])])):m("",!0)])])]),t("div",G,[t("div",R,[t("div",U,[t("div",O,[s[9]||(s[9]=t("small",{class:"text-muted d-block"},"Produits",-1)),t("strong",H,r(o(e).statistics.nbProducts),1)]),t("div",J,[s[10]||(s[10]=t("small",{class:"text-muted d-block"},"Quantité totale",-1)),t("strong",K,r(o(e).formatQuantity(o(e).statistics.totalQuantity)),1)]),t("div",W,[s[11]||(s[11]=t("small",{class:"text-muted d-block"},"Montant total",-1)),t("strong",X,r(o(e).formatPrice(o(e).statistics.totalAmount)),1)]),t("div",Y,[s[12]||(s[12]=t("small",{class:"text-muted d-block"},"Moyenne/produit",-1)),t("strong",Z,r(o(e).formatPrice(o(e).statistics.averageAmount)),1)])])])]),t("div",tt,[t("div",et,[t("div",st,[s[13]||(s[13]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o(e).search=n),type:"text",class:"form-control",placeholder:"Rechercher un produit, catégorie ou note..."},null,512),[[v,o(e).search]])])])]),t("div",ot,[s[17]||(s[17]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},"Synthèse des commandes")],-1)),t("div",at,[t("div",nt,[t("table",rt,[s[16]||(s[16]=t("thead",{class:"thead-administration"},[t("tr",null,[t("th",null,"Produit"),t("th",null,"Catégorie"),t("th",{class:"text-end"},"Prix unitaire"),t("th",{class:"text-end"},"Quantité"),t("th",{class:"text-end"},"Montant total"),t("th",null,"Notes")])],-1)),t("tbody",null,[o(e).filteredSynthese.length===0?(d(),c("tr",lt,[t("td",it,r(o(e).search?"Aucun résultat trouvé":"Aucune commande"),1)])):m("",!0),(d(!0),c(g,null,x(o(e).filteredSynthese,(n,i)=>(d(),c("tr",{key:i},[t("td",null,[t("strong",null,r(n.produit),1)]),t("td",null,[n.categorie?(d(),c("span",{key:0,class:"badge",style:w({backgroundColor:n.categorie_couleur||"#6c757d"})},r(n.categorie),5)):(d(),c("span",dt,"-"))]),t("td",ct,r(o(e).formatPrice(n.prix)),1),t("td",ut,[t("strong",null,r(o(e).formatQuantity(n.total_commande)),1)]),t("td",mt,[t("strong",null,r(o(e).formatPrice(parseFloat(n.prix||0)*parseFloat(n.total_commande||0))),1)]),t("td",null,[n.note?(d(),c("div",ht,[s[14]||(s[14]=t("i",{class:"bi bi-chat-square-text me-1"},null,-1)),u(r(n.note),1)])):m("",!0),n.note_article?(d(),c("div",pt,[s[15]||(s[15]=t("i",{class:"bi bi-info-circle me-1"},null,-1)),u(r(n.note_article),1)])):m("",!0),!n.note&&!n.note_article?(d(),c("span",gt,"-")):m("",!0)])]))),128))])])])])])],64))]))}},y=C(yt);y.use(E());y.mount("#admin-catalogue-synthese-app");
