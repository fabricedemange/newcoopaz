import{i as x,o as r,c as n,u as i,a as s,b as a,t as u,F as p,e as m,q as g,k,f as C,v as y,d as v,n as f,p as h,h as w}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as P,c as I}from"./chunks/pinia-BNknc8Vm.js";import{ag as A,ah as B}from"./chunks/index-BkeVkIvb.js";const S=P("adminProducts",{state:()=>({products:[],categories:[],suppliers:[],filters:{categoryId:"",supplierId:"",label:"",search:"",isActive:""},loading:!0,error:null,sortColumn:"nom",sortDirection:"asc",selectedProducts:[],showBulkActions:!1,bulkCategoryId:"",bulkSupplierId:"",bulkUnite:"",bulkQuantiteMin:"",processingBulk:!1}),getters:{filteredProducts(o){let l=[...o.products];if(o.filters.categoryId&&(l=l.filter(d=>d.category_id&&d.category_id.toString()===o.filters.categoryId)),o.filters.supplierId&&(l=l.filter(d=>d.supplier_id&&d.supplier_id.toString()===o.filters.supplierId)),o.filters.label){const d=o.filters.label.toLowerCase();l=l.filter(c=>c.label&&c.label.toLowerCase().includes(d))}if(o.filters.search){const d=o.filters.search.toLowerCase();l=l.filter(c=>c.nom&&c.nom.toLowerCase().includes(d)||c.description&&c.description.toLowerCase().includes(d))}if(o.filters.isActive!==""){const d=o.filters.isActive==="1";l=l.filter(c=>c.is_active===(d?1:0))}return l=[...l],l.sort((d,c)=>{let b=d[o.sortColumn]??"",t=c[o.sortColumn]??"";return typeof b=="string"&&(b=b.toLowerCase()),typeof t=="string"&&(t=t.toLowerCase()),b<t?o.sortDirection==="asc"?-1:1:b>t?o.sortDirection==="asc"?1:-1:0}),l}},actions:{async loadData(){this.loading=!0,this.error=null;try{const o=await B();if(o.success)this.products=o.products||[],this.categories=o.categories||[],this.suppliers=o.suppliers||[];else throw new Error(o.error||"Erreur inconnue")}catch(o){this.error=o.message||"Erreur lors du chargement des données"}finally{this.loading=!1}},sortBy(o){this.sortColumn===o?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=o,this.sortDirection="asc")},resetFilters(){this.filters={categoryId:"",supplierId:"",label:"",search:"",isActive:""}},toggleProductSelection(o){this.selectedProducts.indexOf(o)>-1?this.selectedProducts=this.selectedProducts.filter(d=>d!==o):this.selectedProducts=[...this.selectedProducts,o]},toggleSelectAll(){this.selectedProducts.length===this.filteredProducts.length?this.selectedProducts=[]:this.selectedProducts=this.filteredProducts.map(o=>o.id)},isSelected(o){return this.selectedProducts.includes(o)},async bulkUpdate(){if(!this.bulkCategoryId&&!this.bulkSupplierId&&!this.bulkUnite&&!this.bulkQuantiteMin){alert("Veuillez sélectionner au moins un champ à modifier");return}if(this.selectedProducts.length===0){alert("Veuillez sélectionner au moins un produit");return}let o=`Modifier ${this.selectedProducts.length} produit(s) ?
`;if(this.bulkCategoryId&&(o+=`- Nouvelle catégorie
`),this.bulkSupplierId&&(o+=`- Nouveau fournisseur
`),this.bulkUnite&&(o+=`- Unité: ${this.bulkUnite}
`),this.bulkQuantiteMin&&(o+=`- Quantité minimale: ${this.bulkQuantiteMin}
`),!!confirm(o)){this.processingBulk=!0;try{const l=await A({productIds:this.selectedProducts,categoryId:this.bulkCategoryId||null,supplierId:this.bulkSupplierId||null,unite:this.bulkUnite||null,quantiteMin:this.bulkQuantiteMin||null});if(l.success)alert(`${l.updated} produit(s) mis à jour avec succès`),this.selectedProducts=[],this.bulkCategoryId="",this.bulkSupplierId="",this.bulkUnite="",this.bulkQuantiteMin="",this.showBulkActions=!1,await this.loadData();else throw new Error(l.error)}catch(l){alert(l.message||"Erreur lors de la mise à jour")}finally{this.processingBulk=!1}}},cancelBulkActions(){this.selectedProducts=[],this.bulkCategoryId="",this.bulkSupplierId="",this.bulkUnite="",this.bulkQuantiteMin="",this.showBulkActions=!1}}}),U={class:"container-fluid px-3 mt-4"},$={key:0,class:"text-center py-5"},M={key:1,class:"alert alert-danger"},V={class:"mb-0"},L={class:"row"},D={class:"col-12"},F={class:"d-flex flex-column flex-sm-row gap-2 mb-3"},N={key:0,class:"row mb-3"},Q={class:"col-12"},E={class:"card border-primary"},q={class:"card-body"},z={class:"row align-items-end"},T={class:"col-12 mb-3"},j={class:"card-title mb-0"},G={class:"col-md-3 mb-3 mb-md-0"},R=["value"],K={class:"col-md-3 mb-3 mb-md-0"},O=["value"],H={class:"col-md-2 mb-3 mb-md-0"},J={class:"col-md-2 mb-3 mb-md-0"},W={class:"col-md-2"},X={class:"d-flex gap-2"},Y=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm me-2"},ss={key:1,class:"bi bi-check-lg me-2"},ts=["disabled"],es={class:"row mb-3"},ls={class:"col-12"},is={class:"card"},os={class:"card-body"},rs={class:"row g-3"},ns={class:"col-md-3"},ds={class:"col-md-3"},us=["value"],as={class:"col-md-2"},cs=["value"],bs={class:"col-md-2"},ms={class:"col-md-2"},ps={class:"col-md-12"},fs={class:"row"},gs={class:"col-12"},ks={key:0,class:"alert alert-info text-center"},vs={key:1},ys={class:"card"},hs={class:"card-header"},_s={class:"card-title mb-0"},xs={class:"card-body"},Cs={class:"table-responsive d-none d-md-block"},ws={class:"table table-hover"},Ps={style:{width:"40px"}},Is=["checked"],As=["checked","onChange"],Bs=["src","alt"],Ss={key:1,class:"text-muted"},Us={key:0},$s={key:1,class:"text-muted"},Ms={key:1,class:"text-muted"},Vs={key:0},Ls={key:1,class:"text-muted"},Ds={key:0},Fs={key:1,class:"text-muted"},Ns={class:"badge bg-info"},Qs={key:0,class:"badge bg-success"},Es={key:1,class:"badge bg-secondary"},qs=["href"],zs=["href"],Ts={class:"d-md-none"},js={class:"card-body"},Gs=["src","alt"],Rs={class:"card-title mb-2"},Ks={key:1,class:"card-text text-muted small mb-3"},Os={class:"row g-2 mb-3"},Hs={class:"col-6"},Js={key:1,class:"text-muted"},Ws={class:"col-6"},Xs={class:"col-6"},Ys={class:"text-success"},Zs={class:"col-6"},st={class:"col-6"},tt={class:"badge bg-info"},et={class:"col-12"},lt={key:0,class:"badge bg-success"},it={key:1,class:"badge bg-secondary"},ot={class:"d-flex gap-2"},rt=["href"],nt=["href"],dt={__name:"AdminProductsPage",setup(o){const l=S();function d(b){return l.sortColumn!==b?"bi-arrow-down-up":l.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}function c(b,t=60){return b?b.length>t?b.substring(0,t)+"...":b:""}return x(()=>{l.loadData()}),(b,t)=>(r(),n("div",U,[i(l).loading?(r(),n("div",$,[...t[22]||(t[22]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Chargement...")],-1),s("p",{class:"mt-3 text-muted"},"Chargement des produits...",-1)])])):i(l).error?(r(),n("div",M,[t[24]||(t[24]=s("h4",{class:"alert-heading"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),a("Erreur")],-1)),s("p",V,u(i(l).error),1),s("button",{type:"button",class:"btn btn-primary mt-2",onClick:t[0]||(t[0]=e=>i(l).loadData())},[...t[23]||(t[23]=[s("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),a("Réessayer ",-1)])])])):(r(),n(p,{key:2},[t[69]||(t[69]=s("div",{class:"row"},[s("div",{class:"col-12"},[s("h2",{class:"mb-4"},"Gestion des produits"),s("p",{class:"text-muted mb-4"},"Gérer la bibliothèque de produits réutilisables")])],-1)),s("div",L,[s("div",D,[s("div",F,[t[26]||(t[26]=s("a",{href:"/admin/products/new",class:"btn btn-success"},[s("i",{class:"bi bi-plus-circle me-2"}),a("Ajouter un produit ")],-1)),s("button",{type:"button",class:"btn btn-outline-primary",onClick:t[1]||(t[1]=e=>i(l).showBulkActions=!i(l).showBulkActions)},[t[25]||(t[25]=s("i",{class:"bi bi-list-check me-2"},null,-1)),a("Actions groupées "+u(i(l).selectedProducts.length>0?` (${i(l).selectedProducts.length})`:""),1)])])])]),i(l).showBulkActions?(r(),n("div",N,[s("div",Q,[s("div",E,[s("div",q,[s("div",z,[s("div",T,[s("h5",j,[t[27]||(t[27]=s("i",{class:"bi bi-pencil-square me-2"},null,-1)),a(" Modifier "+u(i(l).selectedProducts.length)+" produit(s) sélectionné(s) ",1)]),t[28]||(t[28]=s("small",{class:"text-muted"},"Modifiez une ou plusieurs propriétés en même temps",-1))]),s("div",G,[t[30]||(t[30]=s("label",{class:"form-label"},"Nouvelle catégorie",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=e=>i(l).bulkCategoryId=e)},[t[29]||(t[29]=s("option",{value:""},"Ne pas modifier",-1)),(r(!0),n(p,null,k(i(l).categories,e=>(r(),n("option",{key:e.id,value:e.id},u(e.nom),9,R))),128))],512),[[g,i(l).bulkCategoryId]])]),s("div",K,[t[32]||(t[32]=s("label",{class:"form-label"},"Nouveau fournisseur",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=e=>i(l).bulkSupplierId=e)},[t[31]||(t[31]=s("option",{value:""},"Ne pas modifier",-1)),(r(!0),n(p,null,k(i(l).suppliers,e=>(r(),n("option",{key:e.id,value:e.id},u(e.nom),9,O))),128))],512),[[g,i(l).bulkSupplierId]])]),s("div",H,[t[34]||(t[34]=s("label",{class:"form-label"},"Unité",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=e=>i(l).bulkUnite=e)},[...t[33]||(t[33]=[C('<option value="">Ne pas modifier</option><option value="Pièce">Pièce</option><option value="Kilo">Kilo</option><option value="Litre">Litre</option><option value="Unite">Unité</option>',5)])],512),[[g,i(l).bulkUnite]])]),s("div",J,[t[35]||(t[35]=s("label",{class:"form-label"},"Qté mini",-1)),m(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i(l).bulkQuantiteMin=e),type:"number",class:"form-control",placeholder:"Ex: 0.5",step:"0.001",min:"0"},null,512),[[y,i(l).bulkQuantiteMin]])]),s("div",W,[s("div",X,[s("button",{type:"button",class:"btn btn-primary flex-fill",disabled:i(l).processingBulk,onClick:t[6]||(t[6]=e=>i(l).bulkUpdate())},[i(l).processingBulk?(r(),n("span",Z)):(r(),n("i",ss)),t[36]||(t[36]=a(" Appliquer ",-1))],8,Y),s("button",{type:"button",class:"btn btn-outline-secondary",disabled:i(l).processingBulk,onClick:t[7]||(t[7]=e=>i(l).cancelBulkActions())},[...t[37]||(t[37]=[s("i",{class:"bi bi-x-lg"},null,-1)])],8,ts)])])])])])])])):v("",!0),s("div",es,[s("div",ls,[s("div",is,[t[47]||(t[47]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-funnel me-2"}),a("Filtres")])],-1)),s("div",os,[s("div",rs,[s("div",ns,[t[38]||(t[38]=s("label",{class:"form-label"},"Recherche",-1)),m(s("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i(l).filters.search=e),type:"text",class:"form-control",placeholder:"Nom ou description..."},null,512),[[y,i(l).filters.search]])]),s("div",ds,[t[40]||(t[40]=s("label",{class:"form-label"},"Catégorie",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[9]||(t[9]=e=>i(l).filters.categoryId=e)},[t[39]||(t[39]=s("option",{value:""},"Toutes les catégories",-1)),(r(!0),n(p,null,k(i(l).categories,e=>(r(),n("option",{key:e.id,value:e.id},u(e.nom),9,us))),128))],512),[[g,i(l).filters.categoryId]])]),s("div",as,[t[42]||(t[42]=s("label",{class:"form-label"},"Fournisseur",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=e=>i(l).filters.supplierId=e)},[t[41]||(t[41]=s("option",{value:""},"Tous les fournisseurs",-1)),(r(!0),n(p,null,k(i(l).suppliers,e=>(r(),n("option",{key:e.id,value:e.id},u(e.nom),9,cs))),128))],512),[[g,i(l).filters.supplierId]])]),s("div",bs,[t[43]||(t[43]=s("label",{class:"form-label"},"Label",-1)),m(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>i(l).filters.label=e),type:"text",class:"form-control",placeholder:"Bio, AOP, IGP..."},null,512),[[y,i(l).filters.label]])]),s("div",ms,[t[45]||(t[45]=s("label",{class:"form-label"},"Statut",-1)),m(s("select",{class:"form-select","onUpdate:modelValue":t[12]||(t[12]=e=>i(l).filters.isActive=e)},[...t[44]||(t[44]=[s("option",{value:""},"Tous",-1),s("option",{value:"1"},"Actifs uniquement",-1),s("option",{value:"0"},"Inactifs uniquement",-1)])],512),[[g,i(l).filters.isActive]])]),s("div",ps,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[13]||(t[13]=e=>i(l).resetFilters())},[...t[46]||(t[46]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),a("Réinitialiser ",-1)])])])])])])])]),s("div",fs,[s("div",gs,[i(l).filteredProducts.length===0?(r(),n("div",ks,[...t[48]||(t[48]=[s("h4",null,"Aucun produit trouvé",-1),s("p",null,"Commencez par créer votre premier produit ou modifiez les filtres.",-1),s("a",{href:"/admin/products/new",class:"btn btn-primary"},"Créer un produit",-1)])])):(r(),n("div",vs,[s("div",ys,[s("div",hs,[s("h5",_s,[t[49]||(t[49]=s("i",{class:"bi bi-box-seam me-2"},null,-1)),a(" Liste des produits ("+u(i(l).filteredProducts.length)+") ",1)])]),s("div",xs,[s("div",Cs,[s("table",ws,[s("thead",null,[s("tr",null,[s("th",Ps,[s("input",{type:"checkbox",class:"form-check-input",checked:i(l).selectedProducts.length===i(l).filteredProducts.length&&i(l).filteredProducts.length>0,onChange:t[14]||(t[14]=e=>i(l).toggleSelectAll()),title:"Tout sélectionner"},null,40,Is)]),t[57]||(t[57]=s("th",null,"Image",-1)),s("th",{style:{cursor:"pointer"},onClick:t[15]||(t[15]=e=>i(l).sortBy("nom"))},[t[50]||(t[50]=a(" Produit ",-1)),s("i",{class:f("bi ms-1 "+d("nom"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[16]||(t[16]=e=>i(l).sortBy("categorie"))},[t[51]||(t[51]=a(" Catégorie ",-1)),s("i",{class:f("bi ms-1 "+d("categorie"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[17]||(t[17]=e=>i(l).sortBy("fournisseur"))},[t[52]||(t[52]=a(" Fournisseur ",-1)),s("i",{class:f("bi ms-1 "+d("fournisseur"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[18]||(t[18]=e=>i(l).sortBy("prix"))},[t[53]||(t[53]=a(" Prix ",-1)),s("i",{class:f("bi ms-1 "+d("prix"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[19]||(t[19]=e=>i(l).sortBy("label"))},[t[54]||(t[54]=a(" Label ",-1)),s("i",{class:f("bi ms-1 "+d("label"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[20]||(t[20]=e=>i(l).sortBy("nb_catalogues"))},[t[55]||(t[55]=a(" Catalogues ",-1)),s("i",{class:f("bi ms-1 "+d("nb_catalogues"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:t[21]||(t[21]=e=>i(l).sortBy("is_active"))},[t[56]||(t[56]=a(" Statut ",-1)),s("i",{class:f("bi ms-1 "+d("is_active"))},null,2)]),t[58]||(t[58]=s("th",null,"Actions",-1))])]),s("tbody",null,[(r(!0),n(p,null,k(i(l).filteredProducts,e=>(r(),n("tr",{key:e.id},[s("td",null,[s("input",{type:"checkbox",class:"form-check-input",checked:i(l).isSelected(e.id),onChange:ut=>i(l).toggleProductSelection(e.id)},null,40,As)]),s("td",null,[e.image_url?(r(),n("img",{key:0,src:e.image_url,alt:e.nom,style:{width:"50px",height:"50px","object-fit":"cover"},class:"rounded"},null,8,Bs)):(r(),n("span",Ss,"-"))]),s("td",null,[s("strong",null,u(e.nom),1),e.description?(r(),n("br",Us)):v("",!0),e.description?(r(),n("small",$s,u(c(e.description,60)),1)):v("",!0)]),s("td",null,[e.categorie?(r(),n("span",{key:0,class:"badge",style:h({backgroundColor:e.categorie_couleur||"#6c757d"})},u(e.categorie),5)):(r(),n("span",Ms,"-"))]),s("td",null,u(e.fournisseur||"-"),1),s("td",null,[e.prix&&e.prix>0?(r(),n("strong",Vs,u(parseFloat(e.prix).toFixed(2))+" €",1)):(r(),n("span",Ls,"-"))]),s("td",null,[e.label?(r(),n("small",Ds,u(e.label),1)):(r(),n("span",Fs,"-"))]),s("td",null,[s("span",Ns,u(e.nb_catalogues||0),1)]),s("td",null,[e.is_active?(r(),n("span",Qs,"Actif")):(r(),n("span",Es,"Inactif"))]),s("td",null,[s("a",{href:`/admin/products/${e.id}`,class:"btn btn-outline-primary btn-sm",title:"Voir"},[...t[59]||(t[59]=[s("i",{class:"bi bi-eye"},null,-1)])],8,qs),s("a",{href:`/admin/products/${e.id}/edit`,class:"btn btn-outline-secondary btn-sm ms-1",title:"Modifier"},[...t[60]||(t[60]=[s("i",{class:"bi bi-pencil"},null,-1)])],8,zs)])]))),128))])])]),s("div",Ts,[(r(!0),n(p,null,k(i(l).filteredProducts,e=>(r(),n("div",{key:"m-"+e.id,class:"card mb-3 shadow-sm"},[s("div",js,[e.image_url?(r(),n("img",{key:0,src:e.image_url,alt:e.nom,style:{width:"100%",height:"150px","object-fit":"cover","margin-bottom":"10px"},class:"rounded"},null,8,Gs)):v("",!0),s("h5",Rs,u(e.nom),1),e.description?(r(),n("p",Ks,u(c(e.description,100)),1)):v("",!0),s("div",Os,[s("div",Hs,[t[61]||(t[61]=s("small",{class:"text-muted d-block"},"Catégorie",-1)),e.categorie?(r(),n("span",{key:0,class:"badge",style:h({backgroundColor:e.categorie_couleur||"#6c757d"})},u(e.categorie),5)):(r(),n("span",Js,"-"))]),s("div",Ws,[t[62]||(t[62]=s("small",{class:"text-muted d-block"},"Fournisseur",-1)),s("strong",null,u(e.fournisseur||"-"),1)]),s("div",Xs,[t[63]||(t[63]=s("small",{class:"text-muted d-block"},"Prix",-1)),s("strong",Ys,u(e.prix&&e.prix>0?parseFloat(e.prix).toFixed(2)+" €":"-"),1)]),s("div",Zs,[t[64]||(t[64]=s("small",{class:"text-muted d-block"},"Label",-1)),s("strong",null,u(e.label||"-"),1)]),s("div",st,[t[65]||(t[65]=s("small",{class:"text-muted d-block"},"Catalogues",-1)),s("span",tt,u(e.nb_catalogues||0),1)]),s("div",et,[t[66]||(t[66]=s("small",{class:"text-muted d-block"},"Statut",-1)),e.is_active?(r(),n("span",lt,"Actif")):(r(),n("span",it,"Inactif"))])]),s("div",ot,[s("a",{href:`/admin/products/${e.id}`,class:"btn btn-sm btn-outline-primary flex-fill"},[...t[67]||(t[67]=[s("i",{class:"bi bi-eye me-1"},null,-1),a("Voir ",-1)])],8,rt),s("a",{href:`/admin/products/${e.id}/edit`,class:"btn btn-sm btn-outline-secondary flex-fill"},[...t[68]||(t[68]=[s("i",{class:"bi bi-pencil me-1"},null,-1),a("Modifier ",-1)])],8,nt)])])]))),128))])])])]))])])],64))]))}},_=w(dt);_.use(I());_.mount("#admin-produits-app");
