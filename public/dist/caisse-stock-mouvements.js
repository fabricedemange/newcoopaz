import{i as w,o,c as i,a as t,b as d,j as S,t as l,d as p,e as f,s as V,v as _,F as D,l as C,n as y,r as m,A as M,h as N}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as T}from"./chunks/pinia-gLxYYWQL.js";import{_ as U}from"./chunks/BackButton-DzFd1NqY.js";import{U as F}from"./chunks/index-CY5spq3H.js";const j={class:"container-fluid px-3 mt-4"},q={class:"row mb-3"},A={class:"col-12"},R={class:"d-flex justify-content-between align-items-center flex-wrap gap-2"},B={class:"d-flex gap-2"},P={key:0,class:"alert alert-danger alert-dismissible show"},z={class:"card mb-3"},E={class:"card-body"},L={class:"row g-2"},$={class:"col-md-2"},H={class:"col-md-2"},I={class:"col-md-2"},Q={key:1,class:"text-center py-5"},G={key:2,class:"card"},J={class:"card-header d-flex justify-content-between align-items-center"},K={class:"mb-0"},O={class:"card-body p-0"},W={key:0,class:"p-4 text-center text-muted"},X={key:1,class:"table-responsive"},Y={class:"table table-hover mb-0"},Z={class:"text-end"},tt={class:"text-end"},et={class:"small text-muted"},st={key:2,class:"p-2 border-top small text-muted"},h=50,at={__name:"StockMouvementsPage",setup(lt){const u=m([]),c=m(0),v=m(!1),r=m(""),n=M({type:"",date_debut:"",date_fin:""});function x(a){if(!a)return"—";const e=new Date(a);return isNaN(e.getTime())?a:e.toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}function k(a){return a==="vente"?"bg-secondary":a==="inventaire"?"bg-info":"bg-light text-dark"}async function b(){v.value=!0,r.value="";try{const a={limit:h,offset:0};n.type&&(a.type=n.type),n.date_debut&&(a.date_debut=n.date_debut),n.date_fin&&(a.date_fin=n.date_fin);const e=await F(a);u.value=e.movements||[],c.value=e.total??0}catch(a){r.value=a.message||"Erreur chargement"}finally{v.value=!1}}return w(()=>{b()}),(a,e)=>(o(),i("div",j,[t("div",q,[t("div",A,[t("div",R,[e[5]||(e[5]=t("h2",{class:"mb-0"},[t("i",{class:"bi bi-arrow-left-right me-2"}),d("Mouvements de stock")],-1)),t("div",B,[S(U),e[4]||(e[4]=t("a",{href:"/caisse",class:"btn btn-outline-primary"},[t("i",{class:"bi bi-arrow-left me-2"}),d("Retour caisse ")],-1))])]),e[6]||(e[6]=t("p",{class:"text-muted small mb-0 mt-2"}," Historique des mouvements de stock (ventes, ajustements, inventaires). ",-1))])]),r.value?(o(),i("div",P,[d(l(r.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=s=>r.value=null),"aria-label":"Fermer"})])):p("",!0),t("div",z,[e[12]||(e[12]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-funnel me-2"}),d("Filtres")])],-1)),t("div",E,[t("div",L,[t("div",$,[e[8]||(e[8]=t("label",{class:"form-label small"},"Type",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.type=s),class:"form-select form-select-sm"},[...e[7]||(e[7]=[t("option",{value:""},"Tous",-1),t("option",{value:"vente"},"Vente",-1),t("option",{value:"inventaire"},"Inventaire",-1)])],512),[[V,n.type]])]),t("div",H,[e[9]||(e[9]=t("label",{class:"form-label small"},"Date début",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.date_debut=s),type:"date",class:"form-control form-control-sm"},null,512),[[_,n.date_debut]])]),t("div",I,[e[10]||(e[10]=t("label",{class:"form-label small"},"Date fin",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.date_fin=s),type:"date",class:"form-control form-control-sm"},null,512),[[_,n.date_fin]])]),t("div",{class:"col-md-2 d-flex align-items-end"},[t("button",{type:"button",class:"btn btn-primary btn-sm",onClick:b},[...e[11]||(e[11]=[t("i",{class:"bi bi-search me-1"},null,-1),d("Rechercher ",-1)])])])])])]),v.value?(o(),i("div",Q,[...e[13]||(e[13]=[t("div",{class:"spinner-border text-primary"},null,-1)])])):(o(),i("div",G,[t("div",J,[t("h5",K,"Résultats ("+l(c.value)+" mouvement"+l(c.value!==1?"s":"")+")",1)]),t("div",O,[u.value.length===0?(o(),i("div",W," Aucun mouvement trouvé. ")):(o(),i("div",X,[t("table",Y,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Produit"),t("th",null,"Type"),t("th",{class:"text-end"},"Quantité"),t("th",{class:"text-end"},"Stock avant"),t("th",{class:"text-end"},"Stock après"),t("th",null,"Commentaire"),t("th",null,"Utilisateur")])],-1)),t("tbody",null,[(o(!0),i(D,null,C(u.value,s=>(o(),i("tr",{key:s.id},[t("td",null,l(x(s.created_at)),1),t("td",null,l(s.product_nom),1),t("td",null,[t("span",{class:y(["badge",k(s.type)])},l(s.type),3)]),t("td",{class:y(["text-end",s.quantite<0?"text-danger":"text-success"])},l(s.quantite>0?"+":"")+l(s.quantite),3),t("td",Z,l(s.stock_avant),1),t("td",tt,l(s.stock_apres),1),t("td",et,l(s.comment||"—"),1),t("td",null,l(s.created_by_username||"—"),1)]))),128))])])])),c.value>h?(o(),i("div",st," Affichage des "+l(u.value.length)+" premiers résultats. Utilisez les filtres pour affiner. ",1)):p("",!0)])]))]))}},g=N(at);g.use(T());g.mount("#stock-mouvements-app");
