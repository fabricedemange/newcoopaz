import{i as D,o as a,c as n,a as e,b as d,j as N,t as i,d as u,e as b,v as k,p as T,s as g,f as w,n as l,F as U,l as $,r as _,A as h,h as j}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as M}from"./chunks/pinia-gLxYYWQL.js";import{_ as R}from"./chunks/BackButton-DzFd1NqY.js";import{U as F}from"./chunks/index-CY5spq3H.js";import{_ as A}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"container-fluid px-3 mt-4"},B={class:"row mb-3"},z={class:"col-12"},E={class:"d-flex justify-content-between align-items-center flex-wrap gap-2"},I={class:"d-flex gap-2"},K={key:0,class:"alert alert-danger alert-dismissible show"},L={class:"card mb-3"},Q={class:"card-body"},H={class:"row g-2 mb-2"},G={class:"col-md-3"},J={class:"col-md-2"},O={class:"col-md-2"},W={class:"col-md-2"},X={class:"col-md-2"},Y={key:1,class:"text-center py-5"},Z={key:2,class:"card"},tt={class:"card-header d-flex justify-content-between align-items-center"},et={class:"mb-0"},st={class:"card-body p-0"},ot={key:0,class:"p-4 text-center text-muted"},rt={key:1,class:"table-responsive"},at={class:"table table-hover mb-0"},nt={class:"table-light"},lt={class:"text-end"},it={class:"text-end"},dt={class:"small text-muted"},ut={key:2,class:"p-2 border-top small text-muted"},x=200,ct={__name:"StockMouvementsPage",setup(pt){const v=_([]),f=_(0),y=_(!1),p=_(""),s=h({product_search:"",type:"",date_debut:"",date_fin:"",sort_by:"created_at",sort_order:"desc"});function c(r){s.sort_by===r?s.sort_order=s.sort_order==="asc"?"desc":"asc":(s.sort_by=r,s.sort_order=r==="created_at"||r==="quantite"||r==="stock_avant"||r==="stock_apres"?"desc":"asc"),m()}function S(){s.product_search="",s.type="",s.date_debut="",s.date_fin="",s.sort_by="created_at",s.sort_order="desc",m()}function V(r){if(!r)return"—";const t=new Date(r);return isNaN(t.getTime())?r:t.toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}function q(r){return r==="vente"?"bg-secondary":r==="inventaire"?"bg-info":r==="reception"?"bg-success":r==="ajustement"?"bg-warning text-dark":"bg-light text-dark"}async function m(){y.value=!0,p.value="";try{const r={limit:x,offset:0,sort_by:s.sort_by,sort_order:s.sort_order};s.product_search&&s.product_search.trim()&&(r.product_search=s.product_search.trim()),s.type&&(r.type=s.type),s.date_debut&&(r.date_debut=s.date_debut),s.date_fin&&(r.date_fin=s.date_fin);const t=await F(r);v.value=t.movements||[],f.value=t.total??0}catch(r){p.value=r.message||"Erreur chargement"}finally{y.value=!1}}return D(()=>{m()}),(r,t)=>(a(),n("div",P,[e("div",B,[e("div",z,[e("div",E,[t[13]||(t[13]=e("h2",{class:"mb-0"},[e("i",{class:"bi bi-arrow-left-right me-2"}),d("Mouvements de stock")],-1)),e("div",I,[N(R),t[12]||(t[12]=e("a",{href:"/caisse",class:"btn btn-outline-primary"},[e("i",{class:"bi bi-arrow-left me-2"}),d("Retour caisse ")],-1))])]),t[14]||(t[14]=e("p",{class:"text-muted small mb-0 mt-2"}," Historique des mouvements de stock (ventes, ajustements, inventaires). ",-1))])]),p.value?(a(),n("div",K,[d(i(p.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=o=>p.value=null),"aria-label":"Fermer"})])):u("",!0),e("div",L,[t[24]||(t[24]=e("div",{class:"card-header"},[e("h5",{class:"mb-0"},[e("i",{class:"bi bi-funnel me-2"}),d("Filtres et tri")])],-1)),e("div",Q,[e("div",H,[e("div",G,[t[15]||(t[15]=e("label",{class:"form-label small"},"Recherche produit",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.product_search=o),type:"text",class:"form-control form-control-sm",placeholder:"Nom du produit...",onKeyup:T(m,["enter"])},null,544),[[k,s.product_search]])]),e("div",J,[t[17]||(t[17]=e("label",{class:"form-label small"},"Type",-1)),b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.type=o),class:"form-select form-select-sm"},[...t[16]||(t[16]=[w('<option value="" data-v-32f9019c>Tous</option><option value="vente" data-v-32f9019c>Vente</option><option value="inventaire" data-v-32f9019c>Inventaire</option><option value="ajustement" data-v-32f9019c>Ajustement</option><option value="reception" data-v-32f9019c>Réception</option>',5)])],512),[[g,s.type]])]),e("div",O,[t[18]||(t[18]=e("label",{class:"form-label small"},"Date début",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.date_debut=o),type:"date",class:"form-control form-control-sm"},null,512),[[k,s.date_debut]])]),e("div",W,[t[19]||(t[19]=e("label",{class:"form-label small"},"Date fin",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.date_fin=o),type:"date",class:"form-control form-control-sm"},null,512),[[k,s.date_fin]])]),e("div",X,[t[21]||(t[21]=e("label",{class:"form-label small"},"Trier par",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.sort_by=o),class:"form-select form-select-sm",onChange:m},[...t[20]||(t[20]=[w('<option value="created_at" data-v-32f9019c>Date</option><option value="product_nom" data-v-32f9019c>Produit</option><option value="type" data-v-32f9019c>Type</option><option value="quantite" data-v-32f9019c>Quantité</option><option value="stock_avant" data-v-32f9019c>Stock avant</option><option value="stock_apres" data-v-32f9019c>Stock après</option>',6)])],544),[[g,s.sort_by]])])]),e("div",{class:"row g-2"},[e("div",{class:"col-12"},[e("button",{type:"button",class:"btn btn-primary btn-sm me-1",onClick:m},[...t[22]||(t[22]=[e("i",{class:"bi bi-search me-1"},null,-1),d("Rechercher ",-1)])]),e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:S},[...t[23]||(t[23]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),d("Réinitialiser ",-1)])])])])])]),y.value?(a(),n("div",Y,[...t[25]||(t[25]=[e("div",{class:"spinner-border text-primary"},null,-1)])])):(a(),n("div",Z,[e("div",tt,[e("h5",et,"Résultats ("+i(f.value)+" mouvement"+i(f.value!==1?"s":"")+")",1)]),e("div",st,[v.value.length===0?(a(),n("div",ot," Aucun mouvement trouvé. ")):(a(),n("div",rt,[e("table",at,[e("thead",nt,[e("tr",null,[e("th",{class:l(["sortable",{sorted:s.sort_by==="created_at"}]),onClick:t[6]||(t[6]=o=>c("created_at"))},[t[26]||(t[26]=d(" Date ",-1)),s.sort_by==="created_at"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),e("th",{class:l(["sortable",{sorted:s.sort_by==="product_nom"}]),onClick:t[7]||(t[7]=o=>c("product_nom"))},[t[27]||(t[27]=d(" Produit ",-1)),s.sort_by==="product_nom"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),e("th",{class:l(["sortable",{sorted:s.sort_by==="type"}]),onClick:t[8]||(t[8]=o=>c("type"))},[t[28]||(t[28]=d(" Type ",-1)),s.sort_by==="type"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),e("th",{class:l(["text-end sortable",{sorted:s.sort_by==="quantite"}]),onClick:t[9]||(t[9]=o=>c("quantite"))},[t[29]||(t[29]=d(" Quantité ",-1)),s.sort_by==="quantite"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),e("th",{class:l(["text-end sortable",{sorted:s.sort_by==="stock_avant"}]),onClick:t[10]||(t[10]=o=>c("stock_avant"))},[t[30]||(t[30]=d(" Stock avant ",-1)),s.sort_by==="stock_avant"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),e("th",{class:l(["text-end sortable",{sorted:s.sort_by==="stock_apres"}]),onClick:t[11]||(t[11]=o=>c("stock_apres"))},[t[31]||(t[31]=d(" Stock après ",-1)),s.sort_by==="stock_apres"?(a(),n("i",{key:0,class:l(["bi ms-1",s.sort_order==="asc"?"bi-arrow-up":"bi-arrow-down"])},null,2)):u("",!0)],2),t[32]||(t[32]=e("th",null,"Commentaire",-1)),t[33]||(t[33]=e("th",null,"Utilisateur",-1))])]),e("tbody",null,[(a(!0),n(U,null,$(v.value,o=>(a(),n("tr",{key:o.id},[e("td",null,i(V(o.created_at)),1),e("td",null,i(o.product_nom),1),e("td",null,[e("span",{class:l(["badge",q(o.type)])},i(o.type),3)]),e("td",{class:l(["text-end",o.quantite<0?"text-danger":"text-success"])},i(o.quantite>0?"+":"")+i(o.quantite),3),e("td",lt,i(o.stock_avant),1),e("td",it,i(o.stock_apres),1),e("td",dt,i(o.comment||"—"),1),e("td",null,i(o.created_by_username||"—"),1)]))),128))])])])),f.value>x?(a(),n("div",ut," Affichage des "+i(v.value.length)+" premiers résultats. Utilisez les filtres pour affiner. ",1)):u("",!0)])]))]))}},mt=A(ct,[["__scopeId","data-v-32f9019c"]]),C=j(mt);C.use(M());C.mount("#stock-mouvements-app");
