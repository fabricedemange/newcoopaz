import{i as w,o,c as i,f as S,b as v,t as l,a as t,d as p,e as b,q as V,v as _,F as D,k as N,n as y,r as c,A as C,h as M}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{c as T}from"./chunks/pinia-8wUEIqj_.js";import{N as q}from"./chunks/index-zlPV8JO4.js";const F={class:"container-fluid px-3 mt-4"},U={key:0,class:"alert alert-danger alert-dismissible show"},A={class:"card mb-3"},R={class:"card-body"},j={class:"row g-2"},B={class:"col-md-2"},P={class:"col-md-2"},z={class:"col-md-2"},E={key:1,class:"text-center py-5"},L={key:2,class:"card"},H={class:"card-header d-flex justify-content-between align-items-center"},I={class:"mb-0"},Q={class:"card-body p-0"},$={key:0,class:"p-4 text-center text-muted"},G={key:1,class:"table-responsive"},J={class:"table table-hover mb-0"},K={class:"text-end"},O={class:"text-end"},W={class:"small text-muted"},X={key:2,class:"p-2 border-top small text-muted"},h=50,Y={__name:"StockMouvementsPage",setup(Z){const d=c([]),u=c(0),m=c(!1),r=c(""),n=C({type:"",date_debut:"",date_fin:""});function x(a){if(!a)return"—";const e=new Date(a);return isNaN(e.getTime())?a:e.toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}function k(a){return a==="vente"?"bg-secondary":a==="inventaire"?"bg-info":"bg-light text-dark"}async function f(){m.value=!0,r.value="";try{const a={limit:h,offset:0};n.type&&(a.type=n.type),n.date_debut&&(a.date_debut=n.date_debut),n.date_fin&&(a.date_fin=n.date_fin);const e=await q(a);d.value=e.movements||[],u.value=e.total??0}catch(a){r.value=a.message||"Erreur chargement"}finally{m.value=!1}}return w(()=>{f()}),(a,e)=>(o(),i("div",F,[e[12]||(e[12]=S('<div class="row mb-3"><div class="col-12"><div class="d-flex justify-content-between align-items-center flex-wrap gap-2"><h2 class="mb-0"><i class="bi bi-arrow-left-right me-2"></i>Mouvements de stock</h2><a href="/caisse" class="btn btn-outline-primary"><i class="bi bi-arrow-left me-2"></i>Retour caisse </a></div><p class="text-muted small mb-0 mt-2"> Historique des mouvements de stock (ventes, ajustements, inventaires). </p></div></div>',1)),r.value?(o(),i("div",U,[v(l(r.value)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=s=>r.value=null),"aria-label":"Fermer"})])):p("",!0),t("div",A,[e[9]||(e[9]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-funnel me-2"}),v("Filtres")])],-1)),t("div",R,[t("div",j,[t("div",B,[e[5]||(e[5]=t("label",{class:"form-label small"},"Type",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.type=s),class:"form-select form-select-sm"},[...e[4]||(e[4]=[t("option",{value:""},"Tous",-1),t("option",{value:"vente"},"Vente",-1),t("option",{value:"inventaire"},"Inventaire",-1)])],512),[[V,n.type]])]),t("div",P,[e[6]||(e[6]=t("label",{class:"form-label small"},"Date début",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.date_debut=s),type:"date",class:"form-control form-control-sm"},null,512),[[_,n.date_debut]])]),t("div",z,[e[7]||(e[7]=t("label",{class:"form-label small"},"Date fin",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.date_fin=s),type:"date",class:"form-control form-control-sm"},null,512),[[_,n.date_fin]])]),t("div",{class:"col-md-2 d-flex align-items-end"},[t("button",{type:"button",class:"btn btn-primary btn-sm",onClick:f},[...e[8]||(e[8]=[t("i",{class:"bi bi-search me-1"},null,-1),v("Rechercher ",-1)])])])])])]),m.value?(o(),i("div",E,[...e[10]||(e[10]=[t("div",{class:"spinner-border text-primary"},null,-1)])])):(o(),i("div",L,[t("div",H,[t("h5",I,"Résultats ("+l(u.value)+" mouvement"+l(u.value!==1?"s":"")+")",1)]),t("div",Q,[d.value.length===0?(o(),i("div",$," Aucun mouvement trouvé. ")):(o(),i("div",G,[t("table",J,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Produit"),t("th",null,"Type"),t("th",{class:"text-end"},"Quantité"),t("th",{class:"text-end"},"Stock avant"),t("th",{class:"text-end"},"Stock après"),t("th",null,"Commentaire"),t("th",null,"Utilisateur")])],-1)),t("tbody",null,[(o(!0),i(D,null,N(d.value,s=>(o(),i("tr",{key:s.id},[t("td",null,l(x(s.created_at)),1),t("td",null,l(s.product_nom),1),t("td",null,[t("span",{class:y(["badge",k(s.type)])},l(s.type),3)]),t("td",{class:y(["text-end",s.quantite<0?"text-danger":"text-success"])},l(s.quantite>0?"+":"")+l(s.quantite),3),t("td",K,l(s.stock_avant),1),t("td",O,l(s.stock_apres),1),t("td",W,l(s.comment||"—"),1),t("td",null,l(s.created_by_username||"—"),1)]))),128))])])])),u.value>h?(o(),i("div",X," Affichage des "+l(d.value.length)+" premiers résultats. Utilisez les filtres pour affiner. ",1)):p("",!0)])]))]))}},g=M(Y);g.use(T());g.mount("#stock-mouvements-app");
