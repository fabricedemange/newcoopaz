import{i as V,o as v,c as b,a,j as C,t as f,d as _,b as w,f as E,w as N,e as d,v as c,k as U,r as n,g as T,h as A}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as P}from"./chunks/pinia-gLxYYWQL.js";import{_ as S}from"./chunks/BackButton-DzFd1NqY.js";const D={class:"container"},j={class:"d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4"},F={key:0,class:"alert alert-danger"},q={key:1,class:"alert alert-success"},B={class:"card mb-4"},L={class:"card-body"},z={class:"text-muted mb-3"},I={id:"accountModal",class:"modal fade",tabindex:"-1","aria-labelledby":"accountModalLabel","aria-hidden":"true"},O={class:"modal-dialog modal-dialog-scrollable modal-lg"},R={class:"modal-content"},K={class:"modal-body"},$=["value"],G={class:"mb-3"},H={class:"mb-3"},J=["value"],Q={class:"form-check form-switch mb-4"},W={class:"mb-3"},X={class:"mb-3"},Y={class:"mb-3"},Z={class:"modal-footer"},ee=["disabled"],ae={key:0,class:"spinner-border spinner-border-sm me-1"},se={__name:"AccountEditPage",setup(oe){const o=n({username:"",email:"",description:"",email_catalogue:0}),u=n(""),i=n(""),r=n(""),t=n(""),m=n(""),p=n(!1),y=T(()=>window.CSRF_TOKEN||"");V(()=>{const l=window.ACCOUNT_DATA;l&&(o.value={username:l.username||"",email:l.email||"",description:l.description||"",email_catalogue:l.email_catalogue?1:0})});async function k(){var l,e;if(t.value="",m.value="",i.value||r.value){if(i.value!==r.value){t.value="Les mots de passe ne correspondent pas.";return}if(!u.value){t.value="Indiquez le mot de passe actuel pour en changer.";return}}p.value=!0;try{const s=new URLSearchParams({email:o.value.email,description:o.value.description||"",email_catalogue:o.value.email_catalogue?"1":"0",current_password:u.value,new_password:i.value,confirm_password:r.value,_csrf:y.value}),g=await(await fetch("/account",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:s.toString(),credentials:"include"})).json().catch(()=>({}));if(g.success){m.value=g.message||"Compte mis à jour.",u.value="",i.value="",r.value="";const x=document.getElementById("accountModal");if(x){const h=(e=(l=window.bootstrap)==null?void 0:l.Modal)==null?void 0:e.getInstance(x);h&&h.hide()}}else t.value=g.error||"Une erreur est survenue."}catch{t.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}return(l,e)=>(v(),b("div",D,[a("div",j,[e[6]||(e[6]=a("h2",{class:"mb-0"},"Mon compte",-1)),C(S)]),t.value?(v(),b("div",F,f(t.value),1)):_("",!0),m.value?(v(),b("div",q,f(m.value),1)):_("",!0),a("div",B,[e[8]||(e[8]=a("div",{class:"card-header"},[a("h5",{class:"mb-0"},[a("i",{class:"bi bi-person-circle me-2"}),w("Mon compte")])],-1)),a("div",L,[a("p",z,f(o.value.username||"—")+" · "+f(o.value.email||"—"),1),e[7]||(e[7]=a("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#accountModal"},[a("i",{class:"bi bi-pencil-square me-2"}),w("Accéder aux données de mon compte ")],-1))])]),e[21]||(e[21]=E('<div class="card mb-4"><div class="card-header"><h5 class="mb-0"><i class="bi bi-box-arrow-right me-2"></i>Déconnexion</h5></div><div class="card-body"><a href="/logout" class="btn btn-outline-danger"><i class="bi bi-box-arrow-right me-2"></i>Déconnexion </a></div></div>',1)),a("div",I,[a("div",O,[a("div",R,[e[20]||(e[20]=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"accountModalLabel"},[a("i",{class:"bi bi-person-circle me-2"}),w("Données de mon compte ")]),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Fermer"})],-1)),a("div",K,[a("form",{id:"accountForm",onSubmit:N(k,["prevent"])},[a("input",{type:"hidden",name:"_csrf",value:y.value},null,8,$),a("div",G,[e[9]||(e[9]=a("label",{for:"username",class:"form-label"},"Nom d'utilisateur",-1)),d(a("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.username=s),type:"text",class:"form-control",disabled:""},null,512),[[c,o.value.username]])]),a("div",H,[e[10]||(e[10]=a("label",{for:"email",class:"form-label"},"Email",-1)),d(a("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.email=s),type:"email",class:"form-control",required:""},null,512),[[c,o.value.email]])]),a("input",{type:"hidden",name:"email_catalogue",value:o.value.email_catalogue?"1":"0"},null,8,J),a("div",Q,[d(a("input",{id:"email_catalogue","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.email_catalogue=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[U,o.value.email_catalogue]]),e[11]||(e[11]=a("label",{class:"form-check-label",for:"email_catalogue"}," Recevoir les notifications des nouveaux catalogues ",-1)),e[12]||(e[12]=a("div",{class:"form-text"}," En cochant cette case, vous serez informé par email dès qu'un catalogue est publié. ",-1))]),e[16]||(e[16]=a("hr",null,null,-1)),e[17]||(e[17]=a("h6",{class:"mb-3"},"Changer de mot de passe",-1)),a("div",W,[e[13]||(e[13]=a("label",{for:"current_password",class:"form-label"},"Mot de passe actuel",-1)),d(a("input",{id:"current_password","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s),type:"password",class:"form-control",autocomplete:"current-password"},null,512),[[c,u.value]])]),a("div",X,[e[14]||(e[14]=a("label",{for:"new_password",class:"form-label"},"Nouveau mot de passe",-1)),d(a("input",{id:"new_password","onUpdate:modelValue":e[4]||(e[4]=s=>i.value=s),type:"password",class:"form-control",autocomplete:"new-password"},null,512),[[c,i.value]])]),a("div",Y,[e[15]||(e[15]=a("label",{for:"confirm_password",class:"form-label"},"Confirmer le nouveau mot de passe",-1)),d(a("input",{id:"confirm_password","onUpdate:modelValue":e[5]||(e[5]=s=>r.value=s),type:"password",class:"form-control",autocomplete:"new-password"},null,512),[[c,r.value]])])],32)]),a("div",Z,[e[19]||(e[19]=a("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Fermer",-1)),a("button",{type:"submit",form:"accountForm",class:"btn btn-primary",disabled:p.value},[p.value?(v(),b("span",ae)):_("",!0),e[18]||(e[18]=w(" Enregistrer ",-1))],8,ee)])])])])]))}},M=A(se);M.use(P());M.mount("#auth-account-app");
