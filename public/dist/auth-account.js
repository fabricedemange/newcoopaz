import{i as k,o as v,c as f,a,j as x,t as _,d as b,e as i,v as m,k as V,b as C,w as U,r as n,g as N,h as T}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as A}from"./chunks/pinia-gLxYYWQL.js";import{_ as E}from"./chunks/BackButton-DzFd1NqY.js";const P={class:"container"},M={class:"d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4"},S={key:0,class:"alert alert-danger"},j={key:1,class:"alert alert-success"},h=["value"],q={class:"mb-3"},z={class:"mb-3"},B=["value"],D={class:"form-check form-switch mb-4"},O={class:"mb-3"},R={class:"mb-3"},L={class:"mb-3"},F=["disabled"],I={key:0,class:"spinner-border spinner-border-sm me-1"},K={__name:"AccountEditPage",setup($){const l=n({username:"",email:"",description:"",email_catalogue:0}),d=n(""),r=n(""),u=n(""),t=n(""),c=n(""),p=n(!1),w=N(()=>window.CSRF_TOKEN||"");k(()=>{const o=window.ACCOUNT_DATA;o&&(l.value={username:o.username||"",email:o.email||"",description:o.description||"",email_catalogue:o.email_catalogue?1:0})});async function y(){if(t.value="",c.value="",r.value||u.value){if(r.value!==u.value){t.value="Les mots de passe ne correspondent pas.";return}if(!d.value){t.value="Indiquez le mot de passe actuel pour en changer.";return}}p.value=!0;try{const o=new URLSearchParams({email:l.value.email,description:l.value.description||"",email_catalogue:l.value.email_catalogue?"1":"0",current_password:d.value,new_password:r.value,confirm_password:u.value,_csrf:w.value}),s=await(await fetch("/account",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:o.toString(),credentials:"include"})).json().catch(()=>({}));s.success?(c.value=s.message||"Compte mis à jour.",d.value="",r.value="",u.value=""):t.value=s.error||"Une erreur est survenue."}catch{t.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}return(o,e)=>(v(),f("div",P,[a("div",M,[e[6]||(e[6]=a("h2",{class:"mb-0"},"Mon compte",-1)),x(E)]),t.value?(v(),f("div",S,_(t.value),1)):b("",!0),c.value?(v(),f("div",j,_(c.value),1)):b("",!0),a("form",{onSubmit:U(y,["prevent"])},[a("input",{type:"hidden",name:"_csrf",value:w.value},null,8,h),a("div",q,[e[7]||(e[7]=a("label",{for:"username",class:"form-label"},"Nom d'utilisateur",-1)),i(a("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=s=>l.value.username=s),type:"text",class:"form-control",disabled:""},null,512),[[m,l.value.username]])]),a("div",z,[e[8]||(e[8]=a("label",{for:"email",class:"form-label"},"Email",-1)),i(a("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.email=s),type:"email",class:"form-control",required:""},null,512),[[m,l.value.email]])]),a("input",{type:"hidden",name:"email_catalogue",value:l.value.email_catalogue?"1":"0"},null,8,B),a("div",D,[i(a("input",{id:"email_catalogue","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.email_catalogue=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[V,l.value.email_catalogue]]),e[9]||(e[9]=a("label",{class:"form-check-label",for:"email_catalogue"}," Recevoir les notifications des nouveaux catalogues ",-1)),e[10]||(e[10]=a("div",{class:"form-text"}," En cochant cette case, vous serez informé par email dès qu'un catalogue est publié. ",-1))]),e[15]||(e[15]=a("hr",null,null,-1)),e[16]||(e[16]=a("h4",null,"Changer de mot de passe",-1)),a("div",O,[e[11]||(e[11]=a("label",{for:"current_password",class:"form-label"},"Mot de passe actuel",-1)),i(a("input",{id:"current_password","onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s),type:"password",class:"form-control",autocomplete:"current-password"},null,512),[[m,d.value]])]),a("div",R,[e[12]||(e[12]=a("label",{for:"new_password",class:"form-label"},"Nouveau mot de passe",-1)),i(a("input",{id:"new_password","onUpdate:modelValue":e[4]||(e[4]=s=>r.value=s),type:"password",class:"form-control",autocomplete:"new-password"},null,512),[[m,r.value]])]),a("div",L,[e[13]||(e[13]=a("label",{for:"confirm_password",class:"form-label"},"Confirmer le nouveau mot de passe",-1)),i(a("input",{id:"confirm_password","onUpdate:modelValue":e[5]||(e[5]=s=>u.value=s),type:"password",class:"form-control",autocomplete:"new-password"},null,512),[[m,u.value]])]),a("button",{type:"submit",class:"btn btn-primary",disabled:p.value},[p.value?(v(),f("span",I)):b("",!0),e[14]||(e[14]=C(" Enregistrer ",-1))],8,F),e[17]||(e[17]=a("a",{href:"/vue",class:"btn btn-secondary ms-2"},"Annuler",-1))],32)]))}},g=T(K);g.use(A());g.mount("#auth-account-app");
