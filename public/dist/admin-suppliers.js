import{i as M,o as n,c as a,u as l,a as s,b as u,t as d,F as g,e as v,v as T,d as w,n as p,k as y,A as k,B as I,w as _,p as $,C as A,q as C,r as D,g as L,h as V}from"./chunks/runtime-dom.esm-bundler-CYnru-If.js";import{d as B,c as F}from"./chunks/pinia-B_riBLOF.js";import{aa as N,ab as E}from"./chunks/index-BOkuCSO3.js";import{_ as P}from"./chunks/AdminSupplierFormContent-CG1ZNjMQ.js";import{_ as z}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const U=B("adminSuppliers",{state:()=>({suppliers:[],loading:!0,error:null,sortColumn:"nom",sortDirection:"asc",searchTerm:"",showMergeModal:!1,mergeSourceId:null,mergeTargetId:null,merging:!1}),getters:{sortedSuppliers(i){let o=i.searchTerm?i.suppliers.filter(r=>r.nom&&r.nom.toLowerCase().includes(i.searchTerm.toLowerCase())||r.email&&r.email.toLowerCase().includes(i.searchTerm.toLowerCase())||r.ville&&r.ville.toLowerCase().includes(i.searchTerm.toLowerCase())):[...i.suppliers];return o=[...o],o.sort((r,f)=>{let c=r[i.sortColumn]??"",m=f[i.sortColumn]??"";return typeof c=="string"&&(c=c.toLowerCase()),typeof m=="string"&&(m=m.toLowerCase()),c<m?i.sortDirection==="asc"?-1:1:c>m?i.sortDirection==="asc"?1:-1:0}),o},suppliersAlpha(i){return[...i.suppliers].sort((o,r)=>{const f=(o.nom||"").toLowerCase(),c=(r.nom||"").toLowerCase();return f.localeCompare(c)})}},actions:{async loadData(){this.loading=!0,this.error=null;try{const i=await E();if(i.success)this.suppliers=i.suppliers||[];else throw new Error(i.error||"Erreur inconnue")}catch(i){this.error=i.message||"Erreur lors du chargement des données"}finally{this.loading=!1}},sortBy(i){this.sortColumn===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=i,this.sortDirection="asc")},openMergeModal(){this.showMergeModal=!0,this.mergeSourceId=null,this.mergeTargetId=null},closeMergeModal(){this.showMergeModal=!1,this.mergeSourceId=null,this.mergeTargetId=null},async mergeSuppliers(){if(!this.mergeSourceId||!this.mergeTargetId){alert("Veuillez sélectionner les deux fournisseurs");return}if(this.mergeSourceId===this.mergeTargetId){alert("Impossible de fusionner un fournisseur avec lui-même");return}const i=this.suppliers.find(r=>r.id===parseInt(this.mergeSourceId,10)),o=this.suppliers.find(r=>r.id===parseInt(this.mergeTargetId,10));if(confirm(`Êtes-vous sûr de vouloir fusionner "${i==null?void 0:i.nom}" dans "${o==null?void 0:o.nom}" ?

Tous les produits seront transférés, puis "${i==null?void 0:i.nom}" sera supprimé.`)){this.merging=!0;try{const r=await N({sourceId:this.mergeSourceId,targetId:this.mergeTargetId});if(r.success)alert(`Fusion réussie !
${r.productsUpdated} produit(s) transféré(s).`),this.closeMergeModal(),await this.loadData();else throw new Error(r.error)}catch(r){alert(r.message||"Erreur lors de la fusion")}finally{this.merging=!1}}}}}),R={class:"container-fluid px-3 mt-4"},G={key:0,class:"text-center py-5"},j={key:1,class:"alert alert-danger"},q={class:"mb-0"},K={class:"row"},O={class:"col-12"},H={class:"d-flex flex-column flex-sm-row gap-2 mb-3"},J={class:"row mb-3"},Q={class:"col-12 col-md-6"},W={class:"input-group"},X={class:"row"},Y={class:"col-12"},Z={key:0,class:"alert alert-info text-center"},ss={key:1},es={class:"card"},ts={class:"card-header"},os={class:"card-title mb-0"},ls={class:"card-body"},rs={class:"table-responsive d-none d-md-block"},is={class:"table table-hover"},ns={class:"thead-administration"},as=["href"],ds={key:1,class:"text-muted"},us={class:"badge bg-info"},ms={key:0,class:"badge bg-success"},cs={key:1,class:"badge bg-secondary"},ps=["href"],bs=["href"],fs={class:"d-md-none"},gs={class:"card-body"},vs={class:"card-title mb-3"},ys={class:"row g-2 mb-3"},hs={class:"col-12"},ws=["href"],ks={key:1,class:"text-muted"},_s={class:"col-6"},Cs={class:"col-6"},Ss={class:"col-6"},xs={class:"badge bg-info"},Ms={class:"col-6"},Ts={key:0,class:"badge bg-success"},Is={key:1,class:"badge bg-secondary"},$s={class:"d-flex gap-2"},As=["href"],Ds=["href"],Ls=["aria-hidden"],Vs={class:"modal-content"},Bs={class:"modal-body"},Fs={key:3,class:"modal show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},Ns={class:"modal-dialog"},Es={class:"modal-content"},Ps={class:"modal-header"},zs={class:"modal-body"},Us={class:"mb-3"},Rs=["value"],Gs={class:"mb-3"},js=["value"],qs={class:"modal-footer"},Ks=["disabled"],Os={key:0,class:"spinner-border spinner-border-sm me-2"},Hs={key:1,class:"bi bi-union me-2"},Js={__name:"AdminSuppliersPage",setup(i){const o=U(),r=D(!1),f=L(()=>typeof window<"u"&&window.CSRF_TOKEN||"");function c(){r.value=!0}function m(){r.value=!1}function x(){m(),o.loadData()}function b(h){return o.sortColumn!==h?"bi-arrow-down-up":o.sortDirection==="asc"?"bi-arrow-up":"bi-arrow-down"}return M(()=>{if(o.loadData(),new URLSearchParams(window.location.search).get("modal")==="new"){r.value=!0;const e=new URL(window.location.href);e.searchParams.delete("modal"),window.history.replaceState({},"",e.toString())}}),(h,e)=>(n(),a("div",R,[l(o).loading?(n(),a("div",G,[...e[16]||(e[16]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Chargement...")],-1),s("p",{class:"mt-3 text-muted"},"Chargement des fournisseurs...",-1)])])):l(o).error?(n(),a("div",j,[e[18]||(e[18]=s("h4",{class:"alert-heading"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),u("Erreur")],-1)),s("p",q,d(l(o).error),1),s("button",{type:"button",class:"btn btn-primary mt-2",onClick:e[0]||(e[0]=t=>l(o).loadData())},[...e[17]||(e[17]=[s("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),u("Réessayer ",-1)])])])):(n(),a(g,{key:2},[e[41]||(e[41]=s("div",{class:"row"},[s("div",{class:"col-12"},[s("h2",{class:"mb-4"},"Gestion des fournisseurs"),s("p",{class:"text-muted mb-4"},"Gérer les fournisseurs de produits")])],-1)),s("div",K,[s("div",O,[s("div",H,[s("button",{type:"button",class:"btn btn-success",onClick:c},[...e[19]||(e[19]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),u("Ajouter un fournisseur ",-1)])]),s("button",{type:"button",class:"btn btn-outline-warning",onClick:e[1]||(e[1]=t=>l(o).openMergeModal())},[...e[20]||(e[20]=[s("i",{class:"bi bi-union me-2"},null,-1),u("Fusionner des fournisseurs ",-1)])])])])]),s("div",J,[s("div",Q,[s("div",W,[e[22]||(e[22]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-search"})],-1)),v(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l(o).searchTerm=t),type:"text",class:"form-control",placeholder:"Rechercher par nom, email ou ville..."},null,512),[[T,l(o).searchTerm]]),l(o).searchTerm?(n(),a("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=t=>l(o).searchTerm="")},[...e[21]||(e[21]=[s("i",{class:"bi bi-x-lg"},null,-1)])])):w("",!0)])])]),s("div",X,[s("div",Y,[l(o).sortedSuppliers.length===0?(n(),a("div",Z,[e[23]||(e[23]=s("h4",null,"Aucun fournisseur trouvé",-1)),s("p",null,d(l(o).searchTerm?"Modifiez votre recherche ou créez un nouveau fournisseur.":"Commencez par créer votre premier fournisseur."),1),s("button",{type:"button",class:"btn btn-primary",onClick:c},"Créer un fournisseur")])):(n(),a("div",ss,[s("div",es,[s("div",ts,[s("h5",os,[e[24]||(e[24]=s("i",{class:"bi bi-truck me-2"},null,-1)),u(" Liste des fournisseurs ("+d(l(o).sortedSuppliers.length)+") ",1)])]),s("div",ls,[s("div",rs,[s("table",is,[s("thead",ns,[s("tr",null,[s("th",{style:{cursor:"pointer"},onClick:e[4]||(e[4]=t=>l(o).sortBy("nom"))},[e[25]||(e[25]=u(" Nom ",-1)),s("i",{class:p("bi ms-1 "+b("nom"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[5]||(e[5]=t=>l(o).sortBy("email"))},[e[26]||(e[26]=u(" Email ",-1)),s("i",{class:p("bi ms-1 "+b("email"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[6]||(e[6]=t=>l(o).sortBy("telephone"))},[e[27]||(e[27]=u(" Téléphone ",-1)),s("i",{class:p("bi ms-1 "+b("telephone"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[7]||(e[7]=t=>l(o).sortBy("ville"))},[e[28]||(e[28]=u(" Ville ",-1)),s("i",{class:p("bi ms-1 "+b("ville"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[8]||(e[8]=t=>l(o).sortBy("nb_products"))},[e[29]||(e[29]=u(" Produits ",-1)),s("i",{class:p("bi ms-1 "+b("nb_products"))},null,2)]),s("th",{style:{cursor:"pointer"},onClick:e[9]||(e[9]=t=>l(o).sortBy("is_active"))},[e[30]||(e[30]=u(" Statut ",-1)),s("i",{class:p("bi ms-1 "+b("is_active"))},null,2)]),e[31]||(e[31]=s("th",null,"Actions",-1))])]),s("tbody",null,[(n(!0),a(g,null,y(l(o).sortedSuppliers,t=>(n(),a("tr",{key:t.id},[s("td",null,[s("strong",null,d(t.nom),1)]),s("td",null,[t.email?(n(),a("a",{key:0,href:"mailto:"+t.email},d(t.email),9,as)):(n(),a("span",ds,"-"))]),s("td",null,d(t.telephone||"-"),1),s("td",null,d(t.ville||"-"),1),s("td",null,[s("span",us,d(t.nb_products||0)+" produit(s)",1)]),s("td",null,[t.is_active?(n(),a("span",ms,"Actif")):(n(),a("span",cs,"Inactif"))]),s("td",null,[s("a",{href:`/admin/suppliers/${t.id}`,class:"btn btn-outline-primary btn-sm",title:"Voir les détails"},[...e[32]||(e[32]=[s("i",{class:"bi bi-eye"},null,-1)])],8,ps),s("a",{href:`/admin/suppliers/${t.id}/edit`,class:"btn btn-outline-secondary btn-sm ms-1",title:"Modifier"},[...e[33]||(e[33]=[s("i",{class:"bi bi-pencil"},null,-1)])],8,bs)])]))),128))])])]),s("div",fs,[(n(!0),a(g,null,y(l(o).sortedSuppliers,t=>(n(),a("div",{key:"m-"+t.id,class:"card mb-3 shadow-sm"},[s("div",gs,[s("h5",vs,d(t.nom),1),s("div",ys,[s("div",hs,[e[34]||(e[34]=s("small",{class:"text-muted d-block"},"Email",-1)),t.email?(n(),a("a",{key:0,href:"mailto:"+t.email},d(t.email),9,ws)):(n(),a("span",ks,"-"))]),s("div",_s,[e[35]||(e[35]=s("small",{class:"text-muted d-block"},"Téléphone",-1)),s("strong",null,d(t.telephone||"-"),1)]),s("div",Cs,[e[36]||(e[36]=s("small",{class:"text-muted d-block"},"Ville",-1)),s("strong",null,d(t.ville||"-"),1)]),s("div",Ss,[e[37]||(e[37]=s("small",{class:"text-muted d-block"},"Produits",-1)),s("span",xs,d(t.nb_products||0),1)]),s("div",Ms,[e[38]||(e[38]=s("small",{class:"text-muted d-block"},"Statut",-1)),t.is_active?(n(),a("span",Ts,"Actif")):(n(),a("span",Is,"Inactif"))])]),s("div",$s,[s("a",{href:`/admin/suppliers/${t.id}`,class:"btn btn-sm btn-outline-primary flex-fill"},[...e[39]||(e[39]=[s("i",{class:"bi bi-eye me-1"},null,-1),u("Voir ",-1)])],8,As),s("a",{href:`/admin/suppliers/${t.id}/edit`,class:"btn btn-sm btn-outline-secondary flex-fill"},[...e[40]||(e[40]=[s("i",{class:"bi bi-pencil me-1"},null,-1),u("Modifier ",-1)])],8,Ds)])])]))),128))])])])]))])])],64)),(n(),k(A,{to:"body"},[v(s("div",{class:p(["modal fade",{show:r.value}]),"aria-hidden":!r.value,tabindex:"-1",style:$(r.value?{display:"flex",visibility:"visible"}:{display:"none",visibility:"hidden"}),onClick:_(m,["self"])},[s("div",{class:p(["modal-backdrop fade",{show:r.value}]),onClick:m},null,2),s("div",{class:"modal-dialog modal-lg modal-dialog-scrollable",role:"document",onClick:e[10]||(e[10]=_(()=>{},["stop"]))},[s("div",Vs,[s("div",{class:"modal-header"},[e[42]||(e[42]=s("h5",{class:"modal-title"},"Créer un nouveau fournisseur",-1)),s("button",{type:"button",class:"btn-close","aria-label":"Fermer",onClick:m})]),s("div",Bs,[r.value?(n(),k(P,{key:0,supplier:null,"supplier-id":null,modal:!0,"csrf-token":f.value,onSuccess:x,onCancel:m},null,8,["csrf-token"])):w("",!0)])])])],14,Ls),[[I,r.value]])])),l(o).showMergeModal?(n(),a("div",Fs,[s("div",Ns,[s("div",Es,[s("div",Ps,[e[43]||(e[43]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-union me-2"}),u("Fusionner des fournisseurs")],-1)),s("button",{type:"button",class:"btn-close",onClick:e[11]||(e[11]=t=>l(o).closeMergeModal())})]),s("div",zs,[e[48]||(e[48]=s("div",{class:"alert alert-warning"},[s("i",{class:"bi bi-exclamation-triangle me-2"}),s("strong",null,"Attention :"),u(" Cette action est irréversible. Tous les produits du fournisseur source seront transférés vers la cible, puis la source sera supprimée. ")],-1)),s("div",Us,[e[45]||(e[45]=s("label",{for:"merge-source",class:"form-label"},"Fournisseur à fusionner (source) :",-1)),v(s("select",{id:"merge-source",class:"form-select","onUpdate:modelValue":e[12]||(e[12]=t=>l(o).mergeSourceId=t)},[e[44]||(e[44]=s("option",{value:""},"-- Sélectionner --",-1)),(n(!0),a(g,null,y(l(o).suppliersAlpha,t=>(n(),a("option",{key:"s-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,Rs))),128))],512),[[C,l(o).mergeSourceId]])]),s("div",Gs,[e[47]||(e[47]=s("label",{for:"merge-target",class:"form-label"},"Fournisseur de destination (cible) :",-1)),v(s("select",{id:"merge-target",class:"form-select","onUpdate:modelValue":e[13]||(e[13]=t=>l(o).mergeTargetId=t)},[e[46]||(e[46]=s("option",{value:""},"-- Sélectionner --",-1)),(n(!0),a(g,null,y(l(o).suppliersAlpha,t=>(n(),a("option",{key:"t-"+t.id,value:t.id},d(t.nom)+" ("+d(t.nb_products||0)+" produits) ",9,js))),128))],512),[[C,l(o).mergeTargetId]])])]),s("div",qs,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[14]||(e[14]=t=>l(o).closeMergeModal())},"Annuler"),s("button",{type:"button",class:"btn btn-warning",disabled:l(o).merging,onClick:e[15]||(e[15]=t=>l(o).mergeSuppliers())},[l(o).merging?(n(),a("span",Os)):(n(),a("i",Hs)),u(" "+d(l(o).merging?"Fusion en cours...":"Fusionner"),1)],8,Ks)])])])])):w("",!0)]))}},Qs=z(Js,[["__scopeId","data-v-f1b192e0"]]),S=V(Qs);S.use(F());S.mount("#admin-fournisseurs-app");
