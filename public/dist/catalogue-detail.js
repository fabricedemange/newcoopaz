import{i as B,o as a,c as d,a as s,b as y,u as i,t as b,d as f,F as T,n as S,e as D,v as z,q as $,k as R,p as K,r as q,h as G}from"./chunks/runtime-dom.esm-bundler-C8CGTSXe.js";import{d as H,c as J}from"./chunks/pinia-DIU_KYYh.js";import{m as W,n as X,o as Y,u as Z,p as ee,q as te,t as se,A as ie}from"./chunks/index-zlPV8JO4.js";import{_ as re}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const oe=H("catalogueDetail",{state:()=>({loading:!1,error:null,authRequired:!1,catalogue:null,products:[],panier:null,panierArticles:{},searchTerm:"",selectedCategory:"all",canChangeOwner:!1,users:[],selectedUserId:null,changingOwner:!1,sortColumn:"produit",sortDirection:"asc"}),getters:{categories(o){const e=new Map;return(o.products||[]).forEach(r=>{const n=(r.categorie||"").trim();n?e.set(n,{id:r.category_id,nom:n,couleur:r.categorie_couleur,ordre:r.categorie_ordre}):r.category_id==null&&(e.has("Sans catégorie")||e.set("Sans catégorie",{id:null,nom:"Sans catégorie",couleur:"#6c757d",ordre:999}))}),Array.from(e.values()).sort((r,n)=>(r.ordre??999)-(n.ordre??999))},filteredProducts(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const r=String(o.selectedCategory).trim();r==="Sans catégorie"?e=e.filter(n=>n.category_id==null&&!(n.categorie||"").trim()):e=e.filter(n=>n.category_id!=null&&String(n.category_id)===r||(n.categorie||"").trim()===r)}if(o.searchTerm){const r=o.searchTerm.toLowerCase();e=e.filter(n=>n.produit&&n.produit.toLowerCase().includes(r)||n.description&&n.description.toLowerCase().includes(r))}return e},getProductQuantity:o=>e=>{var r;return((r=o.panierArticles[e])==null?void 0:r.quantity)??0},getProductNote:o=>e=>{var r;return((r=o.panierArticles[e])==null?void 0:r.note)??""},totalArticles(o){return Object.values(o.panierArticles||{}).reduce((e,r)=>e+(r.quantity||0),0)},totalPrice(o){let e=0;return(o.products||[]).forEach(r=>{var u,w;const n=((w=(u=o.panierArticles)==null?void 0:u[r.id])==null?void 0:w.quantity)??0;n>0&&(e+=n*(r.prix||0)*(r.unite||1))}),e},productsByCategory(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const n=String(o.selectedCategory).trim();n==="Sans catégorie"?e=e.filter(u=>u.category_id==null&&!(u.categorie||"").trim()):e=e.filter(u=>u.category_id!=null&&String(u.category_id)===n||(u.categorie||"").trim()===n)}if(o.searchTerm){const n=o.searchTerm.toLowerCase();e=e.filter(u=>u.produit&&u.produit.toLowerCase().includes(n)||u.description&&u.description.toLowerCase().includes(n))}const r={};return e.forEach(n=>{const u=n.categorie||"Sans catégorie";r[u]||(r[u]={name:u,color:n.categorie_couleur||"#6c757d",ordre:n.categorie_ordre??999,products:[]}),r[u].products.push(n)}),Object.values(r).sort((n,u)=>n.ordre-u.ordre)},sortedProductsByCategory(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const p=String(o.selectedCategory).trim();p==="Sans catégorie"?e=e.filter(m=>m.category_id==null&&!(m.categorie||"").trim()):e=e.filter(m=>m.category_id!=null&&String(m.category_id)===p||(m.categorie||"").trim()===p)}if(o.searchTerm){const p=o.searchTerm.toLowerCase();e=e.filter(m=>m.produit&&m.produit.toLowerCase().includes(p)||m.description&&m.description.toLowerCase().includes(p))}const r={};e.forEach(p=>{const m=p.categorie||"Sans catégorie";r[m]||(r[m]={name:m,color:p.categorie_couleur||"#6c757d",ordre:p.categorie_ordre??999,products:[]}),r[m].products.push(p)});const n=Object.values(r).sort((p,m)=>p.ordre-m.ordre),u=o.sortColumn||"produit",w=o.sortDirection||"asc",x=o.panierArticles||{},v=p=>{var m;return((m=x[p])==null?void 0:m.quantity)??0},A=p=>{var m;return((m=x[p])==null?void 0:m.note)??""};return n.map(p=>{const m=[...p.products].sort((P,C)=>{const N=v(P.id)>0?1:0,O=v(C.id)>0?1:0;if(O!==N)return O-N;let E=0;switch(u){case"produit":E=(P.produit||"").localeCompare(C.produit||"","fr");break;case"prix":E=(P.prix||0)*(P.unite||1)-(C.prix||0)*(C.unite||1);break;case"quantite":E=v(P.id)-v(C.id);break;case"note":E=(A(P.id)||"").localeCompare(A(C.id)||"","fr");break;default:E=0}return w==="asc"?E:-E});return{...p,products:m}})}},actions:{async loadDetail(o,e=!1){this.loading=!0,this.error=null,this.authRequired=!1,this.catalogue=null,this.products=[],this.panier=null,this.panierArticles={};try{const r=await se(o,e);if(r.success)this.catalogue=r.catalogue,this.products=r.products||[],this.panier=r.panier||null,this.panierArticles=r.panierArticles||{},this.canChangeOwner=r.canChangeOwner===!0,this.users=r.users||[],this.selectedUserId=null;else throw new Error(r.error||"Erreur chargement catalogue")}catch(r){this.error=r.message,r.code===ie&&(this.authRequired=!0),console.error("catalogueDetail loadDetail:",r)}finally{this.loading=!1}},async updateQuantity(o,e,r,n,u){const w=parseInt(e)||0,x=!this.panier&&n===!0;try{const v=await te(r,o,w,x,u);if(v.success){if(w===0){const{[o]:A,...p}=this.panierArticles;this.panierArticles=p}else this.panierArticles[o]||(this.panierArticles={...this.panierArticles,[o]:{}}),this.panierArticles[o]={...this.panierArticles[o],quantity:w};v.panier_id&&!this.panier&&(this.panier={id:v.panier_id})}else throw new Error(v.error||"Erreur mise à jour")}catch(v){throw console.error("updateQuantity:",v),v}},async updateNote(o,e,r,n){try{const u=await ee(r,o,e??"",n);if(u.success)this.panierArticles[o]||(this.panierArticles={...this.panierArticles,[o]:{}}),this.panierArticles[o]={...this.panierArticles[o],note:e??""};else throw new Error(u.error||"Erreur mise à jour note")}catch(u){throw console.error("updateNote:",u),u}},async updatePanierNote(o,e){var r;if((r=this.panier)!=null&&r.id)try{const n=await Z(this.panier.id,o??"",e);if(n.success)this.panier={...this.panier,note:o??""};else throw new Error(n.error||"Erreur mise à jour note panier")}catch(n){throw console.error("updatePanierNote:",n),n}},async validerPanier(o){var r;if(!((r=this.panier)!=null&&r.id))throw new Error("Aucun panier à valider");if(this.totalArticles===0)throw new Error("Votre panier est vide");const e=await Y(this.panier.id,o);if(!e.success)throw new Error(e.error||"Erreur validation");typeof window<"u"&&(window.location.href="/commandes/vue")},setSort(o){this.sortColumn===o?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=o,this.sortDirection="asc")},async changeOwner(o,e){var r;if(!((r=this.panier)!=null&&r.id))throw new Error("Aucun panier");this.changingOwner=!0;try{const n=await X(this.panier.id,o,e);if(!n.success)throw new Error(n.error||"Erreur changement propriétaire");this.panier={...this.panier,user_id:o,username:(this.users.find(u=>u.id===o)||{}).username}}finally{this.changingOwner=!1}},async prefillFromRecentOrders(o,e,r){var v;const n=await W(o);if(!n.success||!Array.isArray(n.catalog_product_ids))return 0;const u=n.catalog_product_ids;if(u.length===0)return 0;let w=0,x=!this.panier&&e===!0;for(const A of u){const p=((v=this.panierArticles[A])==null?void 0:v.quantity)??0,m=Math.max(p,1);m!==p&&(await this.updateQuantity(A,m,o,x,r),w+=1,x=!1)}return w}}}),ne={class:"admin-content-wrapper"},le={class:"container-fluid mt-4"},ae={key:0,class:"alert alert-danger alert-dismissible fade show"},de={key:1,class:"text-center py-5"},ue={class:"mb-4"},ce={class:"mb-1"},me={key:0,class:"text-muted mb-2"},pe={class:"d-flex flex-wrap gap-3 align-items-center small text-muted"},ge={key:0},fe={key:0,class:"badge bg-danger ms-1"},be={class:"row mb-3 catalogue-detail-row-equal"},ye={class:"col-12 col-md-4 mb-3 mb-md-0 d-flex"},he={class:"catalogue-detail-side catalogue-detail-side-left w-100 h-100"},we={key:0,class:"card mb-2"},ve={class:"card-body py-2"},_e=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm me-1"},Ce={key:1,class:"bi bi-arrow-repeat me-1"},ke={class:"alert alert-info py-2 mb-2"},Ae={class:"d-block mt-1"},Ee={class:"col-12 col-md-8 d-flex"},Pe={class:"catalogue-detail-side catalogue-detail-side-right w-100 h-100"},Ne={class:"catalogue-detail-note-wrapper"},Se=["value","disabled"],Te={class:"d-grid"},Oe=["disabled"],Re={class:"row mb-3"},qe={class:"col-12 col-md-4 mb-3 mb-md-0"},De={class:"card h-100"},Qe={class:"card-body"},je={class:"input-group mb-2"},$e=["value"],Fe={key:0,class:"col-12 col-md-8"},Le={class:"card h-100"},Ie={class:"card-body"},Ue={class:"card-title mb-3"},Me={key:0,class:"text-muted fw-normal"},Ve={class:"d-flex flex-column flex-md-row gap-2 align-items-md-center flex-wrap"},Be={class:"form-label mb-0 text-nowrap"},ze=["disabled"],Ke=["value"],Ge=["disabled"],He={key:0,class:"spinner-border spinner-border-sm me-1"},Je={key:0,class:"text-center py-5"},We={class:"mb-0"},Xe={class:"card-body p-0"},Ye={class:"d-none d-md-block"},Ze={class:"table-responsive"},et={class:"table table-hover mb-0"},tt={class:"thead-precommandes"},st={class:"d-flex align-items-center"},it=["src","alt"],rt={key:0},ot={key:1,class:"text-muted"},nt={class:"text-center"},lt={key:0},at={key:1,class:"text-muted"},dt={class:"text-center"},ut={class:"d-flex align-items-center justify-content-center gap-1"},ct=["disabled","onClick"],mt=["value","disabled","onInput"],pt=["disabled","onClick"],gt=["value","disabled","onInput"],ft={key:1,class:"text-muted"},bt={class:"d-md-none"},yt={class:"d-flex align-items-start mb-2"},ht=["src","alt"],wt={class:"flex-grow-1"},vt={class:"d-block"},_t={key:0,class:"text-muted d-block"},xt={class:"mb-2"},Ct={class:"fs-5"},kt={key:0,class:"text-muted"},At={class:"mb-2"},Et={class:"d-flex align-items-center gap-2"},Pt=["disabled","onClick"],Nt=["value","disabled","onInput"],St=["disabled","onClick"],Tt={key:0,class:"mb-2"},Ot=["value","disabled","onInput"],Rt={key:2,class:"alert alert-warning"},qt={__name:"CatalogueDetailPage",setup(o){const e=oe(),r=q(null),n=q(!1),u=q(!1),w=q(""),x=q("success");let v=null,A=null,p=null;function m(){return typeof window>"u"?null:window.location.pathname.split("/")[2]||null}function P(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("nouveau")==="1"}function C(c){return c==null?"0,00 €":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(c)}function N(c,t){const h=e.getProductQuantity(c.id),k=Math.max(0,h+t);O(c.id,k)}function O(c,t){const h=r.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.updateQuantity(c,t,h,n.value,k).catch(g=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la quantité")})}function E(c,t){const h=r.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.updateNote(c,t,h,k).catch(g=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la note")})}function L(c){const t=typeof window<"u"?window.CSRF_TOKEN:"";e.updatePanierNote(c,t).catch(h=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la note du panier")})}function Q(c,t){clearTimeout(v),v=setTimeout(()=>{O(c,parseInt(t)||0)},500)}function j(c,t){clearTimeout(A),A=setTimeout(()=>{E(c,t)},1e3)}function I(c){clearTimeout(p),p=setTimeout(()=>{L(c)},1e3)}function U(){const c=e.totalArticles,t=e.totalPrice;if(typeof window<"u"&&!confirm(`Confirmer la transformation du panier en commande ?

${c} article${c>1?"s":""} - Total : ${C(t)}`))return;const h=r.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.validerPanier(k).catch(g=>{typeof window<"u"&&alert(g.message||"Erreur lors de la validation du panier")})}function M(){if(!e.selectedUserId||typeof window<"u"&&!confirm("Merci de confirmer le changement de propriétaire de ce panier !"))return;const c=typeof window<"u"?window.CSRF_TOKEN:"";e.changeOwner(e.selectedUserId,c).catch(t=>{typeof window<"u"&&alert(t.message||"Erreur lors du changement")})}async function V(){const c=r.value,t=typeof window<"u"?window.CSRF_TOKEN:"";if(c){w.value="",u.value=!0;try{const h=await e.prefillFromRecentOrders(c,n.value,t);x.value="success",h>0?w.value=`${h} article${h>1?"s":""} ajouté${h>1?"s":""} avec une quantité de 1.`:w.value="Aucun produit commandé dans les 60 derniers jours pour ce catalogue."}catch(h){x.value="error",w.value=h.message||"Erreur lors du préremplissage."}finally{u.value=!1}}}return B(()=>{const c=m();r.value=c,n.value=P(),c&&e.loadDetail(c,n.value)}),(c,t)=>{var h,k;return a(),d("div",ne,[s("div",le,[s("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:t[0]||(t[0]=g=>c.history.back())},[...t[12]||(t[12]=[s("i",{class:"bi bi-arrow-left me-2"},null,-1),y("Retour ",-1)])]),i(e).error?(a(),d("div",ae,[t[13]||(t[13]=s("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),t[14]||(t[14]=s("strong",null,"Erreur :",-1)),y(" "+b(i(e).error)+" ",1),s("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=g=>i(e).error=null)})])):f("",!0),i(e).loading?(a(),d("div",de,[...t[15]||(t[15]=[s("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),s("p",{class:"mt-3 text-muted"},"Chargement du catalogue...",-1)])])):i(e).catalogue?(a(),d(T,{key:2},[s("div",ue,[s("h2",ce,[t[16]||(t[16]=s("i",{class:"bi bi-book me-2"},null,-1)),y(b(i(e).catalogue.originalname),1)]),i(e).catalogue.description?(a(),d("p",me,b(i(e).catalogue.description),1)):f("",!0),s("div",pe,[s("span",null,[t[17]||(t[17]=s("i",{class:"bi bi-hash me-1",title:"ID catalogue"},null,-1)),t[18]||(t[18]=y("ID catalogue : ",-1)),s("strong",null,b(i(e).catalogue.id),1)]),i(e).catalogue.referent_username?(a(),d("span",ge,[t[19]||(t[19]=s("i",{class:"bi bi-person-badge me-1",title:"Référent"},null,-1)),t[20]||(t[20]=y("Référent : ",-1)),s("strong",null,b(i(e).catalogue.referent_username),1)])):f("",!0),s("span",null,[t[21]||(t[21]=s("i",{class:"bi bi-calendar-x me-1",title:"Expiration"},null,-1)),t[22]||(t[22]=y("Expiration : ",-1)),s("strong",null,b(i(e).catalogue.expiration_formatted),1),i(e).catalogue.isExpired?(a(),d("span",fe,"Expiré")):f("",!0)]),s("span",null,[t[23]||(t[23]=s("i",{class:"bi bi-truck me-1",title:"Livraison"},null,-1)),t[24]||(t[24]=y("Livraison : ",-1)),s("strong",null,b(i(e).catalogue.livraison_formatted),1)])])]),s("div",be,[s("div",ye,[s("div",he,[i(e).catalogue.modifiable?(a(),d("div",we,[s("div",ve,[t[26]||(t[26]=s("h6",{class:"card-title mb-2"},[s("i",{class:"bi bi-arrow-repeat me-2"}),y("Préremplir le panier")],-1)),s("button",{type:"button",class:"btn btn-outline-primary btn-sm w-100",disabled:u.value,onClick:V},[u.value?(a(),d("span",xe)):(a(),d("i",Ce)),t[25]||(t[25]=y("Mes dernières commandes (60 jours) ",-1))],8,_e),w.value?(a(),d("p",{key:0,class:S(["small mb-0 mt-2",x.value==="success"?"text-success":x.value==="error"?"text-danger":"text-muted"])},b(w.value),3)):f("",!0)])])):f("",!0),s("div",ke,[t[28]||(t[28]=s("i",{class:"bi bi-cart3 me-2"},null,-1)),s("strong",null,b(i(e).totalArticles),1),y(" article"+b(i(e).totalArticles>1?"s":"")+" ",1),s("span",Ae,[t[27]||(t[27]=s("strong",null,"Total :",-1)),y(" "+b(C(i(e).totalPrice)),1)])])])]),s("div",Ee,[s("div",Pe,[s("div",Ne,[t[30]||(t[30]=s("h6",{class:"mb-2"},[s("i",{class:"bi bi-sticky me-2"}),y("Note pour ce panier "),s("small",{class:"text-muted ms-2"},"(optionnel)")],-1)),s("textarea",{value:((h=i(e).panier)==null?void 0:h.note)||"",class:"form-control mb-2",rows:"2",placeholder:"Ajoutez une note pour ce panier...",disabled:!i(e).catalogue.modifiable||i(e).totalArticles===0,onInput:t[2]||(t[2]=g=>I(g.target.value))},null,40,Se),t[31]||(t[31]=s("small",{class:"text-muted d-block mb-2"},"Cette note sera editable sur la commande après validation",-1)),s("div",Te,[i(e).catalogue.modifiable?(a(),d("button",{key:0,type:"button",class:"btn btn-success btn-lg",disabled:i(e).totalArticles===0,onClick:U},[...t[29]||(t[29]=[s("i",{class:"bi bi-check-circle me-2"},null,-1),y("Transformer en commande ",-1)])],8,Oe)):f("",!0)])])])])]),s("div",Re,[s("div",qe,[s("div",De,[s("div",Qe,[t[34]||(t[34]=s("h5",{class:"card-title mb-2"},[s("i",{class:"bi bi-search me-2"}),y("Recherche")],-1)),s("div",je,[t[32]||(t[32]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-search"})],-1)),D(s("input",{"onUpdate:modelValue":t[3]||(t[3]=g=>i(e).searchTerm=g),type:"text",class:"form-control",placeholder:"Rechercher un produit..."},null,512),[[z,i(e).searchTerm]])]),i(e).categories.length>0?D((a(),d("select",{key:0,"onUpdate:modelValue":t[4]||(t[4]=g=>i(e).selectedCategory=g),class:"form-select"},[t[33]||(t[33]=s("option",{value:"all"},"Toutes les catégories",-1)),(a(!0),d(T,null,R(i(e).categories,g=>(a(),d("option",{key:g.nom,value:g.nom},b(g.nom),9,$e))),128))],512)),[[$,i(e).selectedCategory]]):f("",!0)])])]),i(e).canChangeOwner&&i(e).users.length>0?(a(),d("div",Fe,[s("div",Le,[s("div",Ie,[s("h5",Ue,[t[35]||(t[35]=y(" Changement de propriétaire ",-1)),i(e).totalArticles===0?(a(),d("span",Me,"(Ajoutez au moins un article pour activer.)")):f("",!0)]),s("div",Ve,[s("label",Be,[t[36]||(t[36]=y("Propriétaire actuel : ",-1)),s("strong",null,b(((k=i(e).panier)==null?void 0:k.username)||"—"),1)]),D(s("select",{"onUpdate:modelValue":t[5]||(t[5]=g=>i(e).selectedUserId=g),class:"form-select form-select-sm",style:{width:"auto","min-width":"200px"},disabled:i(e).changingOwner||i(e).totalArticles===0},[t[37]||(t[37]=s("option",{value:null},"-- Sélectionner un utilisateur --",-1)),(a(!0),d(T,null,R(i(e).users,g=>(a(),d("option",{key:g.id,value:g.id},b(g.username),9,Ke))),128))],8,ze),[[$,i(e).selectedUserId]]),s("button",{type:"button",class:"btn btn-warning btn-sm",disabled:i(e).changingOwner||!i(e).selectedUserId||i(e).totalArticles===0,onClick:M},[i(e).changingOwner?(a(),d("span",He)):f("",!0),t[38]||(t[38]=s("i",{class:"bi bi-person-fill-gear me-1"},null,-1)),t[39]||(t[39]=y("Changer le propriétaire ",-1))],8,Ge)])])])])):f("",!0)]),i(e).productsByCategory.length===0?(a(),d("div",Je,[...t[40]||(t[40]=[s("i",{class:"bi bi-inbox fs-1 text-muted mb-3 d-block"},null,-1),s("p",{class:"text-muted"},"Aucun produit trouvé",-1)])])):(a(!0),d(T,{key:1},R(i(e).sortedProductsByCategory,g=>(a(),d("div",{key:g.name,class:"card mb-3 border-0 shadow-sm"},[s("div",{class:"card-header",style:K({backgroundColor:g.color,color:"white"})},[s("h5",We,b(g.name),1)],4),s("div",Xe,[s("div",Ye,[s("div",Ze,[s("table",et,[s("thead",tt,[s("tr",null,[s("th",{style:{width:"35%"},class:"sortable",onClick:t[6]||(t[6]=l=>i(e).setSort("produit"))},[t[41]||(t[41]=y(" Produit ",-1)),i(e).sortColumn==="produit"?(a(),d("i",{key:0,class:S([i(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{class:"text-center sortable",style:{width:"15%"},onClick:t[7]||(t[7]=l=>i(e).setSort("prix"))},[t[42]||(t[42]=y(" Prix ",-1)),i(e).sortColumn==="prix"?(a(),d("i",{key:0,class:S([i(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{class:"text-center sortable",style:{width:"20%"},onClick:t[8]||(t[8]=l=>i(e).setSort("quantite"))},[t[43]||(t[43]=y(" Quantité ",-1)),i(e).sortColumn==="quantite"?(a(),d("i",{key:0,class:S([i(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{style:{width:"30%"},class:"sortable",onClick:t[9]||(t[9]=l=>i(e).setSort("note"))},[t[44]||(t[44]=y(" Note ",-1)),i(e).sortColumn==="note"?(a(),d("i",{key:0,class:S([i(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)])])]),s("tbody",null,[(a(!0),d(T,null,R(g.products,l=>(a(),d("tr",{key:l.id,class:S({"table-success":i(e).getProductQuantity(l.id)>0})},[s("td",null,[s("div",st,[l.image_filename?(a(),d("img",{key:0,src:`/images/products/${l.image_filename}`,alt:l.produit,class:"me-2",style:{width:"40px",height:"40px","object-fit":"cover","border-radius":"4px"},onError:t[10]||(t[10]=_=>_.target.style.display="none")},null,40,it)):f("",!0),s("div",null,[s("strong",null,b(l.produit),1),l.description?(a(),d("br",rt)):f("",!0),l.description?(a(),d("small",ot,b(l.description),1)):f("",!0)])])]),s("td",nt,[s("strong",null,b(C((l.prix||0)*(l.unite||1))),1),l.unite>1?(a(),d("br",lt)):f("",!0),l.unite>1?(a(),d("small",at,"par "+b(l.unite),1)):f("",!0)]),s("td",dt,[s("div",ut,[s("button",{type:"button",class:"btn btn-sm btn-outline-secondary",style:{width:"32px",height:"32px",padding:"0"},disabled:!i(e).catalogue.modifiable,onClick:_=>N(l,-1)},[...t[45]||(t[45]=[s("i",{class:"bi bi-dash"},null,-1)])],8,ct),s("input",{type:"number",class:"form-control form-control-sm text-center quantity-input",style:{width:"60px"},value:i(e).getProductQuantity(l.id),min:"0",step:"1",disabled:!i(e).catalogue.modifiable,onInput:_=>Q(l.id,_.target.value)},null,40,mt),s("button",{type:"button",class:"btn btn-sm btn-outline-secondary",style:{width:"32px",height:"32px",padding:"0"},disabled:!i(e).catalogue.modifiable,onClick:_=>N(l,1)},[...t[46]||(t[46]=[s("i",{class:"bi bi-plus"},null,-1)])],8,pt)])]),s("td",null,[i(e).getProductQuantity(l.id)>0?(a(),d("input",{key:0,type:"text",class:"form-control form-control-sm note-input",value:i(e).getProductNote(l.id),placeholder:"Note optionnelle",disabled:!i(e).catalogue.modifiable,onInput:_=>j(l.id,_.target.value)},null,40,gt)):(a(),d("span",ft,"-"))])],2))),128))])])])]),s("div",bt,[(a(!0),d(T,null,R(g.products,l=>(a(),d("div",{key:"m-"+l.id,class:S(["product-card-mobile p-3 border-bottom",{"bg-success-subtle":i(e).getProductQuantity(l.id)>0}])},[s("div",yt,[l.image_filename?(a(),d("img",{key:0,src:`/images/products/${l.image_filename}`,alt:l.produit,class:"me-2",style:{width:"50px",height:"50px","object-fit":"cover","border-radius":"4px"},onError:t[11]||(t[11]=_=>_.target.style.display="none")},null,40,ht)):f("",!0),s("div",wt,[s("strong",vt,b(l.produit),1),l.description?(a(),d("small",_t,b(l.description),1)):f("",!0)])]),s("div",xt,[t[47]||(t[47]=s("span",{class:"text-muted"},"Prix : ",-1)),s("strong",Ct,b(C((l.prix||0)*(l.unite||1))),1),l.unite>1?(a(),d("small",kt," par "+b(l.unite),1)):f("",!0)]),s("div",At,[t[50]||(t[50]=s("label",{class:"form-label mb-1 text-muted"},"Quantité",-1)),s("div",Et,[s("button",{type:"button",class:"btn btn-outline-secondary",style:{width:"44px",height:"44px",padding:"0"},disabled:!i(e).catalogue.modifiable,onClick:_=>N(l,-1)},[...t[48]||(t[48]=[s("i",{class:"bi bi-dash fs-5"},null,-1)])],8,Pt),s("input",{type:"number",class:"form-control form-control-lg text-center quantity-input",style:{width:"80px"},value:i(e).getProductQuantity(l.id),min:"0",step:"1",disabled:!i(e).catalogue.modifiable,onInput:_=>Q(l.id,_.target.value)},null,40,Nt),s("button",{type:"button",class:"btn btn-outline-secondary",style:{width:"44px",height:"44px",padding:"0"},disabled:!i(e).catalogue.modifiable,onClick:_=>N(l,1)},[...t[49]||(t[49]=[s("i",{class:"bi bi-plus fs-5"},null,-1)])],8,St)])]),i(e).getProductQuantity(l.id)>0?(a(),d("div",Tt,[t[51]||(t[51]=s("label",{class:"form-label mb-1 text-muted"},"Note (optionnel)",-1)),s("input",{type:"text",class:"form-control note-input",value:i(e).getProductNote(l.id),placeholder:"Ajoutez une note...",disabled:!i(e).catalogue.modifiable,onInput:_=>j(l.id,_.target.value)},null,40,Ot)])):f("",!0)],2))),128))])])]))),128)),i(e).catalogue&&!i(e).catalogue.modifiable?(a(),d("div",Rt,[...t[52]||(t[52]=[s("i",{class:"bi bi-lock me-2"},null,-1),y(" Ce catalogue est expiré. Vous ne pouvez plus modifier votre panier. ",-1)])])):f("",!0)],64)):f("",!0)])])}}},Dt=re(qt,[["__scopeId","data-v-a438abb6"]]),F=G(Dt);F.use(J());F.mount("#catalogue-detail-app");
