import{i as z,o as a,c as d,a as s,b as y,u as r,t as b,d as f,F as O,j as K,n as S,e as Q,v as G,s as U,l as q,q as H,r as D,h as J}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as W,c as X}from"./chunks/pinia-gLxYYWQL.js";import{n as Y,o as Z,p as ee,u as te,q as se,t as ie,v as re,A as oe}from"./chunks/index-CY5spq3H.js";import{_ as ne}from"./chunks/BackButton-DzFd1NqY.js";import{_ as le}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const ae=W("catalogueDetail",{state:()=>({loading:!1,error:null,authRequired:!1,catalogue:null,products:[],panier:null,panierArticles:{},currentUser:null,searchTerm:"",selectedCategory:"all",canChangeOwner:!1,users:[],selectedUserId:null,changingOwner:!1,sortColumn:"produit",sortDirection:"asc"}),getters:{categories(o){const e=new Map;return(o.products||[]).forEach(n=>{const i=(n.categorie||"").trim();i?e.set(i,{id:n.category_id,nom:i,couleur:n.categorie_couleur,ordre:n.categorie_ordre}):n.category_id==null&&(e.has("Sans catégorie")||e.set("Sans catégorie",{id:null,nom:"Sans catégorie",couleur:"#6c757d",ordre:999}))}),Array.from(e.values()).sort((n,i)=>(n.ordre??999)-(i.ordre??999))},filteredProducts(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const n=String(o.selectedCategory).trim();n==="Sans catégorie"?e=e.filter(i=>i.category_id==null&&!(i.categorie||"").trim()):e=e.filter(i=>i.category_id!=null&&String(i.category_id)===n||(i.categorie||"").trim()===n)}if(o.searchTerm){const n=o.searchTerm.toLowerCase();e=e.filter(i=>i.produit&&i.produit.toLowerCase().includes(n)||i.description&&i.description.toLowerCase().includes(n))}return e},getProductQuantity:o=>e=>{var n;return((n=o.panierArticles[e])==null?void 0:n.quantity)??0},getProductNote:o=>e=>{var n;return((n=o.panierArticles[e])==null?void 0:n.note)??""},totalArticles(o){return Object.values(o.panierArticles||{}).reduce((e,n)=>e+(n.quantity||0),0)},totalPrice(o){let e=0;return(o.products||[]).forEach(n=>{var u,w;const i=((w=(u=o.panierArticles)==null?void 0:u[n.id])==null?void 0:w.quantity)??0;i>0&&(e+=i*(n.prix||0)*(n.unite||1))}),e},productsByCategory(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const i=String(o.selectedCategory).trim();i==="Sans catégorie"?e=e.filter(u=>u.category_id==null&&!(u.categorie||"").trim()):e=e.filter(u=>u.category_id!=null&&String(u.category_id)===i||(u.categorie||"").trim()===i)}if(o.searchTerm){const i=o.searchTerm.toLowerCase();e=e.filter(u=>u.produit&&u.produit.toLowerCase().includes(i)||u.description&&u.description.toLowerCase().includes(i))}const n={};return e.forEach(i=>{const u=i.categorie||"Sans catégorie";n[u]||(n[u]={name:u,color:i.categorie_couleur||"#6c757d",ordre:i.categorie_ordre??999,products:[]}),n[u].products.push(i)}),Object.values(n).sort((i,u)=>i.ordre-u.ordre)},sortedProductsByCategory(o){let e=[...o.products||[]];if(o.selectedCategory!=="all"&&o.selectedCategory!=null&&o.selectedCategory!==""){const p=String(o.selectedCategory).trim();p==="Sans catégorie"?e=e.filter(m=>m.category_id==null&&!(m.categorie||"").trim()):e=e.filter(m=>m.category_id!=null&&String(m.category_id)===p||(m.categorie||"").trim()===p)}if(o.searchTerm){const p=o.searchTerm.toLowerCase();e=e.filter(m=>m.produit&&m.produit.toLowerCase().includes(p)||m.description&&m.description.toLowerCase().includes(p))}const n={};e.forEach(p=>{const m=p.categorie||"Sans catégorie";n[m]||(n[m]={name:m,color:p.categorie_couleur||"#6c757d",ordre:p.categorie_ordre??999,products:[]}),n[m].products.push(p)});const i=Object.values(n).sort((p,m)=>p.ordre-m.ordre),u=o.sortColumn||"produit",w=o.sortDirection||"asc",x=o.panierArticles||{},v=p=>{var m;return((m=x[p])==null?void 0:m.quantity)??0},A=p=>{var m;return((m=x[p])==null?void 0:m.note)??""};return i.map(p=>{const m=[...p.products].sort((P,C)=>{const N=v(P.id)>0?1:0,R=v(C.id)>0?1:0;if(R!==N)return R-N;let E=0;switch(u){case"produit":E=(P.produit||"").localeCompare(C.produit||"","fr");break;case"prix":E=(P.prix||0)*(P.unite||1)-(C.prix||0)*(C.unite||1);break;case"quantite":E=v(P.id)-v(C.id);break;case"note":E=(A(P.id)||"").localeCompare(A(C.id)||"","fr");break;default:E=0}return w==="asc"?E:-E});return{...p,products:m}})}},actions:{async loadDetail(o,e=!1){var n;this.loading=!0,this.error=null,this.authRequired=!1,this.catalogue=null,this.products=[],this.panier=null,this.panierArticles={};try{const i=await re(o,e);if(i.success)this.catalogue=i.catalogue,this.products=i.products||[],this.panier=i.panier||null,this.panierArticles=i.panierArticles||{},this.currentUser=i.currentUser||null,this.canChangeOwner=i.canChangeOwner===!0,this.users=i.users||[],this.selectedUserId=i.panier?i.panier.user_id:((n=i.currentUser)==null?void 0:n.id)??null;else throw new Error(i.error||"Erreur chargement catalogue")}catch(i){this.error=i.message,i.code===oe&&(this.authRequired=!0),console.error("catalogueDetail loadDetail:",i)}finally{this.loading=!1}},async updateQuantity(o,e,n,i,u){const w=parseInt(e)||0,x=!this.panier&&i===!0;try{const v=await ie(n,o,w,x,u);if(v.success){if(w===0){const{[o]:A,...p}=this.panierArticles;this.panierArticles=p}else this.panierArticles[o]||(this.panierArticles={...this.panierArticles,[o]:{}}),this.panierArticles[o]={...this.panierArticles[o],quantity:w};v.panier_id&&!this.panier&&(this.panier={id:v.panier_id})}else throw new Error(v.error||"Erreur mise à jour")}catch(v){throw console.error("updateQuantity:",v),v}},async updateNote(o,e,n,i){try{const u=await se(n,o,e??"",i);if(u.success)this.panierArticles[o]||(this.panierArticles={...this.panierArticles,[o]:{}}),this.panierArticles[o]={...this.panierArticles[o],note:e??""};else throw new Error(u.error||"Erreur mise à jour note")}catch(u){throw console.error("updateNote:",u),u}},async updatePanierNote(o,e){var n;if((n=this.panier)!=null&&n.id)try{const i=await te(this.panier.id,o??"",e);if(i.success)this.panier={...this.panier,note:o??""};else throw new Error(i.error||"Erreur mise à jour note panier")}catch(i){throw console.error("updatePanierNote:",i),i}},async validerPanier(o){var n;if(!((n=this.panier)!=null&&n.id))throw new Error("Aucun panier à valider");if(this.totalArticles===0)throw new Error("Votre panier est vide");const e=await ee(this.panier.id,o);if(!e.success)throw new Error(e.error||"Erreur validation");typeof window<"u"&&(window.location.href="/commandes/vue")},setSort(o){this.sortColumn===o?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=o,this.sortDirection="asc")},async changeOwner(o,e){var n;if(!((n=this.panier)!=null&&n.id))throw new Error("Aucun panier");this.changingOwner=!0;try{const i=await Z(this.panier.id,o,e);if(!i.success)throw new Error(i.error||"Erreur changement propriétaire");this.panier={...this.panier,user_id:o,username:(this.users.find(u=>u.id===o)||{}).username}}finally{this.changingOwner=!1}},async prefillFromRecentOrders(o,e,n){var v;const i=await Y(o);if(!i.success||!Array.isArray(i.catalog_product_ids))return 0;const u=i.catalog_product_ids;if(u.length===0)return 0;let w=0,x=!this.panier&&e===!0;for(const A of u){const p=((v=this.panierArticles[A])==null?void 0:v.quantity)??0,m=Math.max(p,1);m!==p&&(await this.updateQuantity(A,m,o,x,n),w+=1,x=!1)}return w}}}),de={class:"admin-content-wrapper"},ue={class:"container-fluid mt-4"},ce={key:0,class:"alert alert-danger alert-dismissible fade show"},me={key:1,class:"text-center py-5"},pe={class:"mb-4"},fe={class:"d-flex justify-content-between align-items-start flex-wrap gap-2 mb-2"},ge={class:"mb-1"},be={key:0,class:"text-muted mb-2"},ye={class:"d-flex flex-wrap gap-3 align-items-center small text-muted"},he={key:0},we={key:0,class:"badge bg-danger ms-1"},ve={class:"row mb-3 catalogue-detail-row-equal"},_e={class:"col-12 col-md-4 mb-3 mb-md-0 d-flex"},xe={class:"catalogue-detail-side catalogue-detail-side-left w-100 h-100"},Ce={key:0,class:"card mb-2"},ke={class:"card-body py-2"},Ae=["disabled"],Ee={key:0,class:"spinner-border spinner-border-sm me-1"},Pe={key:1,class:"bi bi-arrow-repeat me-1"},Ne={class:"alert alert-info py-2 mb-2"},Se={class:"d-block mt-1"},Te={class:"col-12 col-md-8 d-flex"},Oe={class:"catalogue-detail-side catalogue-detail-side-right w-100 h-100"},Re={class:"catalogue-detail-note-wrapper"},qe=["value","disabled"],De={class:"d-grid"},Qe=["disabled"],je={class:"row mb-3"},$e={class:"col-12 col-md-4 mb-3 mb-md-0"},Ue={class:"card h-100"},Fe={class:"card-body"},Le={class:"input-group mb-2"},Ie=["value"],Me={key:0,class:"col-12 col-md-8"},Ve={class:"card h-100"},Be={class:"card-body"},ze={class:"card-title mb-3"},Ke={key:0,class:"text-muted fw-normal"},Ge={class:"d-flex flex-column flex-md-row gap-2 align-items-md-center flex-wrap"},He={class:"form-label mb-0 text-nowrap"},Je=["disabled"],We=["value"],Xe=["disabled"],Ye={key:0,class:"spinner-border spinner-border-sm me-1"},Ze={key:0,class:"text-center py-5"},et={class:"mb-0"},tt={class:"card-body p-0"},st={class:"d-none d-md-block"},it={class:"table-responsive"},rt={class:"table table-hover mb-0"},ot={class:"thead-precommandes"},nt={class:"d-flex align-items-center"},lt=["src","alt"],at={key:0},dt={key:1,class:"text-muted"},ut={class:"text-center"},ct={key:0},mt={key:1,class:"text-muted"},pt={class:"text-center"},ft={class:"d-flex align-items-center justify-content-center gap-1"},gt=["disabled","onClick"],bt=["value","disabled","onInput"],yt=["disabled","onClick"],ht=["value","disabled","onInput"],wt={key:1,class:"text-muted"},vt={class:"d-md-none"},_t={class:"d-flex align-items-start mb-2"},xt=["src","alt"],Ct={class:"flex-grow-1"},kt={class:"d-block"},At={key:0,class:"text-muted d-block"},Et={class:"mb-2"},Pt={class:"fs-5"},Nt={key:0,class:"text-muted"},St={class:"mb-2"},Tt={class:"d-flex align-items-center gap-2"},Ot=["disabled","onClick"],Rt=["value","disabled","onInput"],qt=["disabled","onClick"],Dt={key:0,class:"mb-2"},Qt=["value","disabled","onInput"],jt={key:2,class:"alert alert-warning"},$t={__name:"CatalogueDetailPage",setup(o){const e=ae(),n=D(null),i=D(!1),u=D(!1),w=D(""),x=D("success");let v=null,A=null,p=null;function m(){return typeof window>"u"?null:window.location.pathname.split("/")[2]||null}function P(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("nouveau")==="1"}function C(c){return c==null?"0,00 €":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(c)}function N(c,t){const h=e.getProductQuantity(c.id),k=Math.max(0,h+t);R(c.id,k)}function R(c,t){const h=n.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.updateQuantity(c,t,h,i.value,k).catch(T=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la quantité")})}function E(c,t){const h=n.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.updateNote(c,t,h,k).catch(T=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la note")})}function L(c){const t=typeof window<"u"?window.CSRF_TOKEN:"";e.updatePanierNote(c,t).catch(h=>{typeof window<"u"&&alert("Erreur lors de la mise à jour de la note du panier")})}function j(c,t){clearTimeout(v),v=setTimeout(()=>{R(c,parseInt(t)||0)},500)}function $(c,t){clearTimeout(A),A=setTimeout(()=>{E(c,t)},1e3)}function I(c){clearTimeout(p),p=setTimeout(()=>{L(c)},1e3)}function M(){const c=e.totalArticles,t=e.totalPrice;if(typeof window<"u"&&!confirm(`Confirmer la transformation du panier en commande ?

${c} article${c>1?"s":""} - Total : ${C(t)}`))return;const h=n.value,k=typeof window<"u"?window.CSRF_TOKEN:"";h&&e.validerPanier(k).catch(T=>{typeof window<"u"&&alert(T.message||"Erreur lors de la validation du panier")})}function V(){if(!e.selectedUserId||typeof window<"u"&&!confirm("Merci de confirmer le changement de propriétaire de ce panier !"))return;const c=typeof window<"u"?window.CSRF_TOKEN:"";e.changeOwner(e.selectedUserId,c).catch(t=>{typeof window<"u"&&alert(t.message||"Erreur lors du changement")})}async function B(){const c=n.value,t=typeof window<"u"?window.CSRF_TOKEN:"";if(c){w.value="",u.value=!0;try{const h=await e.prefillFromRecentOrders(c,i.value,t);x.value="success",h>0?w.value=`${h} article${h>1?"s":""} ajouté${h>1?"s":""} avec une quantité de 1.`:w.value="Aucun produit commandé dans les 60 derniers jours pour ce catalogue."}catch(h){x.value="error",w.value=h.message||"Erreur lors du préremplissage."}finally{u.value=!1}}}return z(()=>{const c=m();n.value=c,i.value=P(),c&&e.loadDetail(c,i.value)}),(c,t)=>{var h,k,T;return a(),d("div",de,[s("div",ue,[s("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:t[0]||(t[0]=g=>c.history.back())},[...t[12]||(t[12]=[s("i",{class:"bi bi-arrow-left me-2"},null,-1),y("Retour ",-1)])]),r(e).error?(a(),d("div",ce,[t[13]||(t[13]=s("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),t[14]||(t[14]=s("strong",null,"Erreur :",-1)),y(" "+b(r(e).error)+" ",1),s("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=g=>r(e).error=null)})])):f("",!0),r(e).loading?(a(),d("div",me,[...t[15]||(t[15]=[s("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),s("p",{class:"mt-3 text-muted"},"Chargement du catalogue...",-1)])])):r(e).catalogue?(a(),d(O,{key:2},[s("div",pe,[s("div",fe,[s("h2",ge,[t[16]||(t[16]=s("i",{class:"bi bi-book me-2"},null,-1)),y(b(r(e).catalogue.originalname),1)]),K(ne)]),r(e).catalogue.description?(a(),d("p",be,b(r(e).catalogue.description),1)):f("",!0),s("div",ye,[s("span",null,[t[17]||(t[17]=s("i",{class:"bi bi-hash me-1",title:"ID catalogue"},null,-1)),t[18]||(t[18]=y("ID catalogue : ",-1)),s("strong",null,b(r(e).catalogue.id),1)]),r(e).catalogue.referent_username?(a(),d("span",he,[t[19]||(t[19]=s("i",{class:"bi bi-person-badge me-1",title:"Référent"},null,-1)),t[20]||(t[20]=y("Référent : ",-1)),s("strong",null,b(r(e).catalogue.referent_username),1)])):f("",!0),s("span",null,[t[21]||(t[21]=s("i",{class:"bi bi-calendar-x me-1",title:"Expiration"},null,-1)),t[22]||(t[22]=y("Expiration : ",-1)),s("strong",null,b(r(e).catalogue.expiration_formatted),1),r(e).catalogue.isExpired?(a(),d("span",we,"Expiré")):f("",!0)]),s("span",null,[t[23]||(t[23]=s("i",{class:"bi bi-truck me-1",title:"Livraison"},null,-1)),t[24]||(t[24]=y("Livraison : ",-1)),s("strong",null,b(r(e).catalogue.livraison_formatted),1)])])]),s("div",ve,[s("div",_e,[s("div",xe,[r(e).catalogue.modifiable?(a(),d("div",Ce,[s("div",ke,[t[26]||(t[26]=s("h6",{class:"card-title mb-2"},[s("i",{class:"bi bi-arrow-repeat me-2"}),y("Préremplir le panier")],-1)),s("button",{type:"button",class:"btn btn-outline-primary btn-sm w-100",disabled:u.value,onClick:B},[u.value?(a(),d("span",Ee)):(a(),d("i",Pe)),t[25]||(t[25]=y("Mes dernières commandes (60 jours) ",-1))],8,Ae),w.value?(a(),d("p",{key:0,class:S(["small mb-0 mt-2",x.value==="success"?"text-success":x.value==="error"?"text-danger":"text-muted"])},b(w.value),3)):f("",!0)])])):f("",!0),s("div",Ne,[t[28]||(t[28]=s("i",{class:"bi bi-cart3 me-2"},null,-1)),s("strong",null,b(r(e).totalArticles),1),y(" article"+b(r(e).totalArticles>1?"s":"")+" ",1),s("span",Se,[t[27]||(t[27]=s("strong",null,"Total :",-1)),y(" "+b(C(r(e).totalPrice)),1)])])])]),s("div",Te,[s("div",Oe,[s("div",Re,[t[30]||(t[30]=s("h6",{class:"mb-2"},[s("i",{class:"bi bi-sticky me-2"}),y("Note pour ce panier "),s("small",{class:"text-muted ms-2"},"(optionnel)")],-1)),s("textarea",{value:((h=r(e).panier)==null?void 0:h.note)||"",class:"form-control mb-2",rows:"2",placeholder:"Ajoutez une note pour ce panier...",disabled:!r(e).catalogue.modifiable||r(e).totalArticles===0,onInput:t[2]||(t[2]=g=>I(g.target.value))},null,40,qe),t[31]||(t[31]=s("small",{class:"text-muted d-block mb-2"},"Cette note sera editable sur la commande après validation",-1)),s("div",De,[r(e).catalogue.modifiable?(a(),d("button",{key:0,type:"button",class:"btn btn-success btn-lg",disabled:r(e).totalArticles===0,onClick:M},[...t[29]||(t[29]=[s("i",{class:"bi bi-check-circle me-2"},null,-1),y("Transformer en commande ",-1)])],8,Qe)):f("",!0)])])])])]),s("div",je,[s("div",$e,[s("div",Ue,[s("div",Fe,[t[34]||(t[34]=s("h5",{class:"card-title mb-2"},[s("i",{class:"bi bi-search me-2"}),y("Recherche")],-1)),s("div",Le,[t[32]||(t[32]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-search"})],-1)),Q(s("input",{"onUpdate:modelValue":t[3]||(t[3]=g=>r(e).searchTerm=g),type:"text",class:"form-control",placeholder:"Rechercher un produit..."},null,512),[[G,r(e).searchTerm]])]),r(e).categories.length>0?Q((a(),d("select",{key:0,"onUpdate:modelValue":t[4]||(t[4]=g=>r(e).selectedCategory=g),class:"form-select"},[t[33]||(t[33]=s("option",{value:"all"},"Toutes les catégories",-1)),(a(!0),d(O,null,q(r(e).categories,g=>(a(),d("option",{key:g.nom,value:g.nom},b(g.nom),9,Ie))),128))],512)),[[U,r(e).selectedCategory]]):f("",!0)])])]),r(e).canChangeOwner&&r(e).users.length>0?(a(),d("div",Me,[s("div",Ve,[s("div",Be,[s("h5",ze,[t[35]||(t[35]=y(" Changement de propriétaire ",-1)),r(e).totalArticles===0?(a(),d("span",Ke,"(Ajoutez au moins un article pour activer.)")):f("",!0)]),s("div",Ge,[s("label",He,[t[36]||(t[36]=y("Propriétaire actuel : ",-1)),s("strong",null,b(((k=r(e).panier)==null?void 0:k.username)||((T=r(e).currentUser)==null?void 0:T.username)||"—"),1)]),Q(s("select",{"onUpdate:modelValue":t[5]||(t[5]=g=>r(e).selectedUserId=g),class:"form-select form-select-sm",style:{width:"auto","min-width":"200px"},disabled:r(e).changingOwner||r(e).totalArticles===0},[t[37]||(t[37]=s("option",{value:null},"-- Sélectionner un utilisateur --",-1)),(a(!0),d(O,null,q(r(e).users,g=>(a(),d("option",{key:g.id,value:g.id},b(g.username),9,We))),128))],8,Je),[[U,r(e).selectedUserId]]),s("button",{type:"button",class:"btn btn-warning btn-sm",disabled:r(e).changingOwner||!r(e).selectedUserId||r(e).totalArticles===0,onClick:V},[r(e).changingOwner?(a(),d("span",Ye)):f("",!0),t[38]||(t[38]=s("i",{class:"bi bi-person-fill-gear me-1"},null,-1)),t[39]||(t[39]=y("Changer le propriétaire ",-1))],8,Xe)])])])])):f("",!0)]),r(e).productsByCategory.length===0?(a(),d("div",Ze,[...t[40]||(t[40]=[s("i",{class:"bi bi-inbox fs-1 text-muted mb-3 d-block"},null,-1),s("p",{class:"text-muted"},"Aucun produit trouvé",-1)])])):(a(!0),d(O,{key:1},q(r(e).sortedProductsByCategory,g=>(a(),d("div",{key:g.name,class:"card mb-3 border-0 shadow-sm"},[s("div",{class:"card-header",style:H({backgroundColor:g.color,color:"white"})},[s("h5",et,b(g.name),1)],4),s("div",tt,[s("div",st,[s("div",it,[s("table",rt,[s("thead",ot,[s("tr",null,[s("th",{style:{width:"35%"},class:"sortable",onClick:t[6]||(t[6]=l=>r(e).setSort("produit"))},[t[41]||(t[41]=y(" Produit ",-1)),r(e).sortColumn==="produit"?(a(),d("i",{key:0,class:S([r(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{class:"text-center sortable",style:{width:"15%"},onClick:t[7]||(t[7]=l=>r(e).setSort("prix"))},[t[42]||(t[42]=y(" Prix ",-1)),r(e).sortColumn==="prix"?(a(),d("i",{key:0,class:S([r(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{class:"text-center sortable",style:{width:"20%"},onClick:t[8]||(t[8]=l=>r(e).setSort("quantite"))},[t[43]||(t[43]=y(" Quantité ",-1)),r(e).sortColumn==="quantite"?(a(),d("i",{key:0,class:S([r(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)]),s("th",{style:{width:"30%"},class:"sortable",onClick:t[9]||(t[9]=l=>r(e).setSort("note"))},[t[44]||(t[44]=y(" Note ",-1)),r(e).sortColumn==="note"?(a(),d("i",{key:0,class:S([r(e).sortDirection==="asc"?"bi bi-arrow-up":"bi bi-arrow-down","ms-1"])},null,2)):f("",!0)])])]),s("tbody",null,[(a(!0),d(O,null,q(g.products,l=>(a(),d("tr",{key:l.id,class:S({"table-success":r(e).getProductQuantity(l.id)>0})},[s("td",null,[s("div",nt,[l.image_filename?(a(),d("img",{key:0,src:`/images/products/${l.image_filename}`,alt:l.produit,class:"me-2",style:{width:"40px",height:"40px","object-fit":"cover","border-radius":"4px"},onError:t[10]||(t[10]=_=>_.target.style.display="none")},null,40,lt)):f("",!0),s("div",null,[s("strong",null,b(l.produit),1),l.description?(a(),d("br",at)):f("",!0),l.description?(a(),d("small",dt,b(l.description),1)):f("",!0)])])]),s("td",ut,[s("strong",null,b(C((l.prix||0)*(l.unite||1))),1),l.unite>1?(a(),d("br",ct)):f("",!0),l.unite>1?(a(),d("small",mt,"par "+b(l.unite),1)):f("",!0)]),s("td",pt,[s("div",ft,[s("button",{type:"button",class:"btn btn-sm btn-outline-secondary",style:{width:"32px",height:"32px",padding:"0"},disabled:!r(e).catalogue.modifiable,onClick:_=>N(l,-1)},[...t[45]||(t[45]=[s("i",{class:"bi bi-dash"},null,-1)])],8,gt),s("input",{type:"number",class:"form-control form-control-sm text-center quantity-input",style:{width:"60px"},value:r(e).getProductQuantity(l.id),min:"0",step:"1",disabled:!r(e).catalogue.modifiable,onInput:_=>j(l.id,_.target.value)},null,40,bt),s("button",{type:"button",class:"btn btn-sm btn-outline-secondary",style:{width:"32px",height:"32px",padding:"0"},disabled:!r(e).catalogue.modifiable,onClick:_=>N(l,1)},[...t[46]||(t[46]=[s("i",{class:"bi bi-plus"},null,-1)])],8,yt)])]),s("td",null,[r(e).getProductQuantity(l.id)>0?(a(),d("input",{key:0,type:"text",class:"form-control form-control-sm note-input",value:r(e).getProductNote(l.id),placeholder:"Note optionnelle",disabled:!r(e).catalogue.modifiable,onInput:_=>$(l.id,_.target.value)},null,40,ht)):(a(),d("span",wt,"-"))])],2))),128))])])])]),s("div",vt,[(a(!0),d(O,null,q(g.products,l=>(a(),d("div",{key:"m-"+l.id,class:S(["product-card-mobile p-3 border-bottom",{"bg-success-subtle":r(e).getProductQuantity(l.id)>0}])},[s("div",_t,[l.image_filename?(a(),d("img",{key:0,src:`/images/products/${l.image_filename}`,alt:l.produit,class:"me-2",style:{width:"50px",height:"50px","object-fit":"cover","border-radius":"4px"},onError:t[11]||(t[11]=_=>_.target.style.display="none")},null,40,xt)):f("",!0),s("div",Ct,[s("strong",kt,b(l.produit),1),l.description?(a(),d("small",At,b(l.description),1)):f("",!0)])]),s("div",Et,[t[47]||(t[47]=s("span",{class:"text-muted"},"Prix : ",-1)),s("strong",Pt,b(C((l.prix||0)*(l.unite||1))),1),l.unite>1?(a(),d("small",Nt," par "+b(l.unite),1)):f("",!0)]),s("div",St,[t[50]||(t[50]=s("label",{class:"form-label mb-1 text-muted"},"Quantité",-1)),s("div",Tt,[s("button",{type:"button",class:"btn btn-outline-secondary",style:{width:"44px",height:"44px",padding:"0"},disabled:!r(e).catalogue.modifiable,onClick:_=>N(l,-1)},[...t[48]||(t[48]=[s("i",{class:"bi bi-dash fs-5"},null,-1)])],8,Ot),s("input",{type:"number",class:"form-control form-control-lg text-center quantity-input",style:{width:"80px"},value:r(e).getProductQuantity(l.id),min:"0",step:"1",disabled:!r(e).catalogue.modifiable,onInput:_=>j(l.id,_.target.value)},null,40,Rt),s("button",{type:"button",class:"btn btn-outline-secondary",style:{width:"44px",height:"44px",padding:"0"},disabled:!r(e).catalogue.modifiable,onClick:_=>N(l,1)},[...t[49]||(t[49]=[s("i",{class:"bi bi-plus fs-5"},null,-1)])],8,qt)])]),r(e).getProductQuantity(l.id)>0?(a(),d("div",Dt,[t[51]||(t[51]=s("label",{class:"form-label mb-1 text-muted"},"Note (optionnel)",-1)),s("input",{type:"text",class:"form-control note-input",value:r(e).getProductNote(l.id),placeholder:"Ajoutez une note...",disabled:!r(e).catalogue.modifiable,onInput:_=>$(l.id,_.target.value)},null,40,Qt)])):f("",!0)],2))),128))])])]))),128)),r(e).catalogue&&!r(e).catalogue.modifiable?(a(),d("div",jt,[...t[52]||(t[52]=[s("i",{class:"bi bi-lock me-2"},null,-1),y(" Ce catalogue est expiré. Vous ne pouvez plus modifier votre panier. ",-1)])])):f("",!0)],64)):f("",!0)])])}}},Ut=le($t,[["__scopeId","data-v-8c6a8f52"]]),F=J(Ut);F.use(X());F.mount("#catalogue-detail-app");
