import{i as T,o as r,c as n,a as t,b as d,t as k,d as u,w as $,e as b,v as f,F as V,q as h,k as U,r as c,g as A,h as F}from"./chunks/runtime-dom.esm-bundler-CPobOing.js";import{c as P}from"./chunks/pinia-8wUEIqj_.js";const N={class:"container-fluid px-3 mt-4"},R={class:"row"},M={class:"col-12 col-md-10 offset-md-1"},B={key:0,class:"alert alert-danger"},L={key:1,class:"row g-3 mb-4"},O={class:"col-12 col-md-6"},q={class:"col-12 col-md-6"},J={key:2,class:"card mb-4"},K={class:"card-header bg-success text-white d-flex justify-content-between align-items-center"},G={class:"card-body"},H=["value"],Q={class:"mb-3"},W={class:"mb-3"},X={class:"mb-3"},Y=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm me-1"},ee={key:0,class:"card mb-4"},te={class:"card-header bg-primary text-white d-flex justify-content-between align-items-center"},ae={class:"card-body"},se={class:"mb-3"},le={class:"row"},oe={class:"col-md-6 mb-3"},ie={class:"col-md-6 mb-3"},re={class:"mb-3"},ne={key:1,class:"card mb-4"},de={class:"card-body"},ue={class:"row g-3 mb-4"},ce={class:"col-12 col-md-6"},pe={class:"col-12 col-md-6"},me={key:0,class:"mb-3"},ve=["value"],be=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-1"},xe={key:1,class:"mb-3"},ge=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm me-1"},we={__name:"AdminCatalogueNewPage",setup(_e){const v=c("choice"),x=c(1),g=c(null),l=c(""),y=c(!1),p=c(!1),C=c([]),m=c({expiration_date:"",description:""}),s=c({name:"",expiration_date:"",date_livraison:"",description:"",source_catalog_id:""}),E=c(null),w=A(()=>window.CSRF_TOKEN||"");T(()=>{const i=window.INITIAL_DATA||{};l.value=i.error||"",I()});async function I(){try{const e=await(await fetch("/api/admin/catalogues",{credentials:"include"})).json();e.success&&e.catalogues&&(C.value=e.catalogues)}catch(i){console.error("Erreur chargement catalogues:",i)}}async function S(){var e,a;const i=(a=(e=E.value)==null?void 0:e.files)==null?void 0:a[0];if(!i){l.value="Veuillez sélectionner un fichier Excel.";return}l.value="",y.value=!0;try{const o=new FormData;o.append("_csrf",w.value),o.append("excel",i),m.value.expiration_date&&o.append("expiration_date",m.value.expiration_date),m.value.description&&o.append("description",m.value.description);const _=await(await fetch("/admin/catalogues/upload",{method:"POST",credentials:"include",headers:{Accept:"application/json"},body:o})).json().catch(()=>({}));if(_.success&&_.redirect){window.location.href=_.redirect;return}l.value=_.error||"Erreur lors de l'import."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{y.value=!1}}async function j(){var i;if(!((i=s.value.name)!=null&&i.trim())){l.value="Veuillez renseigner le nom du catalogue.";return}l.value="",p.value=!0;try{const e=new URLSearchParams({_csrf:w.value,name:s.value.name.trim(),expiration_date:s.value.expiration_date||"",date_livraison:s.value.date_livraison||"",description:s.value.description||""}),o=await(await fetch("/admin/catalogues/create-empty",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:e.toString()})).json().catch(()=>({}));if(o.success&&o.catalogId){window.location.href=`/admin/catalogues/${o.catalogId}/edit`;return}l.value=o.error||"Erreur lors de la création."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}async function D(){var i;if(!((i=s.value.name)!=null&&i.trim())){l.value="Veuillez renseigner le nom du catalogue.";return}if(!s.value.source_catalog_id){l.value="Veuillez sélectionner un catalogue source.";return}if(confirm(`Créer le catalogue "${s.value.name}" en important tous les produits du catalogue #${s.value.source_catalog_id} ?`)){l.value="",p.value=!0;try{const e=new URLSearchParams({_csrf:w.value,name:s.value.name.trim(),expiration_date:s.value.expiration_date||"",date_livraison:s.value.date_livraison||"",description:s.value.description||"",source_catalog_id:s.value.source_catalog_id}),o=await(await fetch("/admin/catalogues/create-from-catalog",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:e.toString()})).json().catch(()=>({}));if(o.success&&o.catalogId){window.location.href=`/admin/catalogues/${o.catalogId}/edit`;return}l.value=o.error||"Erreur lors de la création."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}}return(i,e)=>(r(),n("div",N,[e[44]||(e[44]=t("div",{class:"row"},[t("div",{class:"col-12"},[t("h2",{class:"mb-4"},"Ajouter un nouveau catalogue")])],-1)),t("div",R,[t("div",M,[l.value?(r(),n("div",B,[e[15]||(e[15]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),d(k(l.value),1)])):u("",!0),v.value==="choice"?(r(),n("div",L,[t("div",O,[t("div",{class:"card h-100 border-primary",style:{cursor:"pointer"},onClick:e[0]||(e[0]=a=>v.value="excel")},[...e[16]||(e[16]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-file-earmark-excel text-success",style:{"font-size":"3rem"}}),t("h5",{class:"card-title mt-3"},"Importer depuis Excel"),t("p",{class:"card-text text-muted"},"Chargez un fichier Excel existant (.xls, .xlsx)")],-1)])])]),t("div",q,[t("div",{class:"card h-100 border-primary",style:{cursor:"pointer"},onClick:e[1]||(e[1]=a=>v.value="new")},[...e[17]||(e[17]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-file-earmark-plus text-primary",style:{"font-size":"3rem"}}),t("h5",{class:"card-title mt-3"},"Créer un nouveau catalogue"),t("p",{class:"card-text text-muted"},"Depuis un ancien catalogue ou la base produits")],-1)])])])])):u("",!0),v.value==="excel"?(r(),n("div",J,[t("div",K,[e[19]||(e[19]=t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-file-earmark-excel me-2"}),d("Importer un catalogue depuis Excel ")],-1)),t("button",{type:"button",class:"btn btn-light btn-sm",onClick:e[2]||(e[2]=a=>v.value="choice")},[...e[18]||(e[18]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour au choix ",-1)])])]),t("div",G,[t("form",{onSubmit:$(S,["prevent"])},[t("input",{type:"hidden",name:"_csrf",value:w.value},null,8,H),t("div",Q,[e[20]||(e[20]=t("label",{for:"excel",class:"form-label"},[d("Fichier Excel du catalogue "),t("span",{class:"text-danger"},"*")],-1)),t("input",{id:"excel",ref_key:"excelInput",ref:E,type:"file",class:"form-control",accept:".xls,.xlsx",required:""},null,512),e[21]||(e[21]=t("div",{class:"form-text"},"Formats acceptés : .xls, .xlsx (Maximum 10 Mo)",-1))]),t("div",W,[e[22]||(e[22]=t("label",{for:"excel_expiration",class:"form-label"},"Date d'expiration",-1)),b(t("input",{id:"excel_expiration","onUpdate:modelValue":e[3]||(e[3]=a=>m.value.expiration_date=a),type:"date",class:"form-control"},null,512),[[f,m.value.expiration_date]])]),t("div",X,[e[23]||(e[23]=t("label",{for:"excel_description",class:"form-label"},"Description",-1)),b(t("textarea",{id:"excel_description","onUpdate:modelValue":e[4]||(e[4]=a=>m.value.description=a),class:"form-control",rows:"3",placeholder:"Description du catalogue (optionnel)"},null,512),[[f,m.value.description]])]),t("button",{type:"submit",class:"btn btn-success",disabled:y.value},[y.value?(r(),n("span",Z)):u("",!0),e[24]||(e[24]=t("i",{class:"bi bi-upload me-2"},null,-1)),e[25]||(e[25]=d("Importer le catalogue ",-1))],8,Y)],32)])])):u("",!0),v.value==="new"?(r(),n(V,{key:3},[x.value===1?(r(),n("div",ee,[t("div",te,[e[27]||(e[27]=t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-1-circle me-2"}),d("Informations générales du catalogue ")],-1)),t("button",{type:"button",class:"btn btn-light btn-sm",onClick:e[5]||(e[5]=a=>v.value="choice")},[...e[26]||(e[26]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour au choix ",-1)])])]),t("div",ae,[t("div",se,[e[28]||(e[28]=t("label",{for:"catalogue_name",class:"form-label"},[d("Nom du catalogue "),t("span",{class:"text-danger"},"*")],-1)),b(t("input",{id:"catalogue_name","onUpdate:modelValue":e[6]||(e[6]=a=>s.value.name=a),type:"text",class:"form-control",required:"",placeholder:"Ex: Catalogue Bio Janvier 2026"},null,512),[[f,s.value.name]])]),t("div",le,[t("div",oe,[e[29]||(e[29]=t("label",{for:"catalogue_expiration",class:"form-label"},"Date d'expiration",-1)),b(t("input",{id:"catalogue_expiration","onUpdate:modelValue":e[7]||(e[7]=a=>s.value.expiration_date=a),type:"date",class:"form-control"},null,512),[[f,s.value.expiration_date]])]),t("div",ie,[e[30]||(e[30]=t("label",{for:"catalogue_livraison",class:"form-label"},"Date de livraison",-1)),b(t("input",{id:"catalogue_livraison","onUpdate:modelValue":e[8]||(e[8]=a=>s.value.date_livraison=a),type:"date",class:"form-control"},null,512),[[f,s.value.date_livraison]])])]),t("div",re,[e[31]||(e[31]=t("label",{for:"catalogue_description",class:"form-label"},"Description",-1)),b(t("textarea",{id:"catalogue_description","onUpdate:modelValue":e[9]||(e[9]=a=>s.value.description=a),class:"form-control",rows:"3",placeholder:"Description du catalogue (optionnel)"},null,512),[[f,s.value.description]])]),t("button",{type:"button",class:"btn btn-primary",onClick:e[10]||(e[10]=a=>x.value=2)},[...e[32]||(e[32]=[t("i",{class:"bi bi-arrow-right me-2"},null,-1),d("Étape suivante : Choisir la source des produits ",-1)])])])])):u("",!0),x.value===2?(r(),n("div",ne,[e[43]||(e[43]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-2-circle me-2"}),d("Choisir la source des produits ")])],-1)),t("div",de,[t("div",ue,[t("div",ce,[t("div",{class:"card h-100 border-success",style:{cursor:"pointer"},onClick:e[11]||(e[11]=a=>g.value="catalog")},[...e[33]||(e[33]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-files text-success",style:{"font-size":"2.5rem"}}),t("h5",{class:"card-title mt-3"},"Reprendre un ancien catalogue"),t("p",{class:"card-text text-muted"},"Importez tous les produits (avec prix) depuis un catalogue existant")],-1)])])]),t("div",pe,[t("div",{class:"card h-100 border-success",style:{cursor:"pointer"},onClick:e[12]||(e[12]=a=>g.value="empty")},[...e[34]||(e[34]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-basket text-success",style:{"font-size":"2.5rem"}}),t("h5",{class:"card-title mt-3"},"Base de produits"),t("p",{class:"card-text text-muted"},"Créer un catalogue vierge et ajouter des produits ensuite")],-1)])])])]),g.value==="catalog"?(r(),n("div",me,[e[38]||(e[38]=t("label",{for:"source_catalog_id",class:"form-label"},[d("Catalogue source "),t("span",{class:"text-danger"},"*")],-1)),b(t("select",{id:"source_catalog_id","onUpdate:modelValue":e[13]||(e[13]=a=>s.value.source_catalog_id=a),class:"form-select"},[e[35]||(e[35]=t("option",{value:""},"-- Sélectionner un catalogue --",-1)),(r(!0),n(V,null,U(C.value,a=>(r(),n("option",{key:a.id,value:a.id}," #"+k(a.id)+" - "+k(a.originalname)+" - Exp: "+k(a.expiration_formatted||"Pas d'expiration"),9,ve))),128))],512),[[h,s.value.source_catalog_id]]),t("button",{type:"button",class:"btn btn-success mt-2",disabled:p.value||!s.value.source_catalog_id,onClick:D},[p.value?(r(),n("span",fe)):u("",!0),e[36]||(e[36]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),e[37]||(e[37]=d("Créer le catalogue ",-1))],8,be)])):u("",!0),g.value==="empty"?(r(),n("div",xe,[e[41]||(e[41]=t("p",{class:"text-muted"},"Un catalogue vierge sera créé. Vous pourrez ensuite ajouter des produits depuis la base de données dans la page d'édition.",-1)),t("button",{type:"button",class:"btn btn-success",disabled:p.value,onClick:j},[p.value?(r(),n("span",ye)):u("",!0),e[39]||(e[39]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),e[40]||(e[40]=d("Créer le catalogue vierge ",-1))],8,ge)])):u("",!0),t("button",{type:"button",class:"btn btn-outline-secondary mt-2",onClick:e[14]||(e[14]=a=>x.value=1)},[...e[42]||(e[42]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour aux informations ",-1)])])])])):u("",!0)],64)):u("",!0)])])]))}},z=F(we);z.use(P());z.mount("#admin-catalogue-new-app");
