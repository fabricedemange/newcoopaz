import{i as $,o as r,c as n,a as t,j as D,b as d,t as k,d as u,w as T,e as b,v as f,F as E,s as U,l as A,r as c,g as F,h as N}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{c as P}from"./chunks/pinia-gLxYYWQL.js";import{_ as R}from"./chunks/BackButton-DzFd1NqY.js";const M={class:"container-fluid px-3 mt-4"},B={class:"row"},L={class:"col-12"},O={class:"d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4"},q={class:"row"},J={class:"col-12 col-md-10 offset-md-1"},K={key:0,class:"alert alert-danger"},G={key:1,class:"row g-3 mb-4"},H={class:"col-12 col-md-6"},Q={class:"col-12 col-md-6"},W={key:2,class:"card mb-4"},X={class:"card-header bg-success text-white d-flex justify-content-between align-items-center"},Y={class:"card-body"},Z=["value"],ee={class:"mb-3"},te={class:"mb-3"},se={class:"mb-3"},ae=["disabled"],le={key:0,class:"spinner-border spinner-border-sm me-1"},oe={key:0,class:"card mb-4"},ie={class:"card-header bg-primary text-white d-flex justify-content-between align-items-center"},re={class:"card-body"},ne={class:"mb-3"},de={class:"row"},ue={class:"col-md-6 mb-3"},ce={class:"col-md-6 mb-3"},pe={class:"mb-3"},me={key:1,class:"card mb-4"},ve={class:"card-body"},be={class:"row g-3 mb-4"},fe={class:"col-12 col-md-6"},xe={class:"col-12 col-md-6"},ge={key:0,class:"mb-3"},ye=["value"],_e=["disabled"],we={key:0,class:"spinner-border spinner-border-sm me-1"},ke={key:1,class:"mb-3"},Ce=["disabled"],Ve={key:0,class:"spinner-border spinner-border-sm me-1"},Ee={__name:"AdminCatalogueNewPage",setup(je){const v=c("choice"),x=c(1),g=c(null),l=c(""),y=c(!1),p=c(!1),C=c([]),m=c({expiration_date:"",description:""}),a=c({name:"",expiration_date:"",date_livraison:"",description:"",source_catalog_id:""}),V=c(null),_=F(()=>window.CSRF_TOKEN||"");$(()=>{const i=window.INITIAL_DATA||{};l.value=i.error||"",z()});async function z(){try{const e=await(await fetch("/api/admin/catalogues",{credentials:"include"})).json();e.success&&e.catalogues&&(C.value=e.catalogues)}catch(i){console.error("Erreur chargement catalogues:",i)}}async function I(){var e,s;const i=(s=(e=V.value)==null?void 0:e.files)==null?void 0:s[0];if(!i){l.value="Veuillez sélectionner un fichier Excel.";return}l.value="",y.value=!0;try{const o=new FormData;o.append("_csrf",_.value),o.append("excel",i),m.value.expiration_date&&o.append("expiration_date",m.value.expiration_date),m.value.description&&o.append("description",m.value.description);const w=await(await fetch("/admin/catalogues/upload",{method:"POST",credentials:"include",headers:{Accept:"application/json"},body:o})).json().catch(()=>({}));if(w.success&&w.redirect){window.location.href=w.redirect;return}l.value=w.error||"Erreur lors de l'import."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{y.value=!1}}async function h(){var i;if(!((i=a.value.name)!=null&&i.trim())){l.value="Veuillez renseigner le nom du catalogue.";return}l.value="",p.value=!0;try{const e=new URLSearchParams({_csrf:_.value,name:a.value.name.trim(),expiration_date:a.value.expiration_date||"",date_livraison:a.value.date_livraison||"",description:a.value.description||""}),o=await(await fetch("/admin/catalogues/create-empty",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:e.toString()})).json().catch(()=>({}));if(o.success&&o.catalogId){window.location.href=`/admin/catalogues/${o.catalogId}/edit`;return}l.value=o.error||"Erreur lors de la création."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}async function S(){var i;if(!((i=a.value.name)!=null&&i.trim())){l.value="Veuillez renseigner le nom du catalogue.";return}if(!a.value.source_catalog_id){l.value="Veuillez sélectionner un catalogue source.";return}if(confirm(`Créer le catalogue "${a.value.name}" en important tous les produits du catalogue #${a.value.source_catalog_id} ?`)){l.value="",p.value=!0;try{const e=new URLSearchParams({_csrf:_.value,name:a.value.name.trim(),expiration_date:a.value.expiration_date||"",date_livraison:a.value.date_livraison||"",description:a.value.description||"",source_catalog_id:a.value.source_catalog_id}),o=await(await fetch("/admin/catalogues/create-from-catalog",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:e.toString()})).json().catch(()=>({}));if(o.success&&o.catalogId){window.location.href=`/admin/catalogues/${o.catalogId}/edit`;return}l.value=o.error||"Erreur lors de la création."}catch{l.value="Erreur de connexion. Veuillez réessayer."}finally{p.value=!1}}}return(i,e)=>(r(),n("div",M,[t("div",B,[t("div",L,[t("div",O,[e[15]||(e[15]=t("h2",{class:"mb-0"},"Ajouter un nouveau catalogue",-1)),D(R)])])]),t("div",q,[t("div",J,[l.value?(r(),n("div",K,[e[16]||(e[16]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),d(k(l.value),1)])):u("",!0),v.value==="choice"?(r(),n("div",G,[t("div",H,[t("div",{class:"card h-100 border-primary",style:{cursor:"pointer"},onClick:e[0]||(e[0]=s=>v.value="excel")},[...e[17]||(e[17]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-file-earmark-excel text-success",style:{"font-size":"3rem"}}),t("h5",{class:"card-title mt-3"},"Importer depuis Excel"),t("p",{class:"card-text text-muted"},"Chargez un fichier Excel existant (.xls, .xlsx)")],-1)])])]),t("div",Q,[t("div",{class:"card h-100 border-primary",style:{cursor:"pointer"},onClick:e[1]||(e[1]=s=>v.value="new")},[...e[18]||(e[18]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-file-earmark-plus text-primary",style:{"font-size":"3rem"}}),t("h5",{class:"card-title mt-3"},"Créer un nouveau catalogue"),t("p",{class:"card-text text-muted"},"Depuis un ancien catalogue ou la base produits")],-1)])])])])):u("",!0),v.value==="excel"?(r(),n("div",W,[t("div",X,[e[20]||(e[20]=t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-file-earmark-excel me-2"}),d("Importer un catalogue depuis Excel ")],-1)),t("button",{type:"button",class:"btn btn-light btn-sm",onClick:e[2]||(e[2]=s=>v.value="choice")},[...e[19]||(e[19]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour au choix ",-1)])])]),t("div",Y,[t("form",{onSubmit:T(I,["prevent"])},[t("input",{type:"hidden",name:"_csrf",value:_.value},null,8,Z),t("div",ee,[e[21]||(e[21]=t("label",{for:"excel",class:"form-label"},[d("Fichier Excel du catalogue "),t("span",{class:"text-danger"},"*")],-1)),t("input",{id:"excel",ref_key:"excelInput",ref:V,type:"file",class:"form-control",accept:".xls,.xlsx",required:""},null,512),e[22]||(e[22]=t("div",{class:"form-text"},"Formats acceptés : .xls, .xlsx (Maximum 10 Mo)",-1))]),t("div",te,[e[23]||(e[23]=t("label",{for:"excel_expiration",class:"form-label"},"Date d'expiration",-1)),b(t("input",{id:"excel_expiration","onUpdate:modelValue":e[3]||(e[3]=s=>m.value.expiration_date=s),type:"date",class:"form-control"},null,512),[[f,m.value.expiration_date]])]),t("div",se,[e[24]||(e[24]=t("label",{for:"excel_description",class:"form-label"},"Description",-1)),b(t("textarea",{id:"excel_description","onUpdate:modelValue":e[4]||(e[4]=s=>m.value.description=s),class:"form-control",rows:"3",placeholder:"Description du catalogue (optionnel)"},null,512),[[f,m.value.description]])]),t("button",{type:"submit",class:"btn btn-success",disabled:y.value},[y.value?(r(),n("span",le)):u("",!0),e[25]||(e[25]=t("i",{class:"bi bi-upload me-2"},null,-1)),e[26]||(e[26]=d("Importer le catalogue ",-1))],8,ae)],32)])])):u("",!0),v.value==="new"?(r(),n(E,{key:3},[x.value===1?(r(),n("div",oe,[t("div",ie,[e[28]||(e[28]=t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-1-circle me-2"}),d("Informations générales du catalogue ")],-1)),t("button",{type:"button",class:"btn btn-light btn-sm",onClick:e[5]||(e[5]=s=>v.value="choice")},[...e[27]||(e[27]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour au choix ",-1)])])]),t("div",re,[t("div",ne,[e[29]||(e[29]=t("label",{for:"catalogue_name",class:"form-label"},[d("Nom du catalogue "),t("span",{class:"text-danger"},"*")],-1)),b(t("input",{id:"catalogue_name","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.name=s),type:"text",class:"form-control",required:"",placeholder:"Ex: Catalogue Bio Janvier 2026"},null,512),[[f,a.value.name]])]),t("div",de,[t("div",ue,[e[30]||(e[30]=t("label",{for:"catalogue_expiration",class:"form-label"},"Date d'expiration",-1)),b(t("input",{id:"catalogue_expiration","onUpdate:modelValue":e[7]||(e[7]=s=>a.value.expiration_date=s),type:"date",class:"form-control"},null,512),[[f,a.value.expiration_date]])]),t("div",ce,[e[31]||(e[31]=t("label",{for:"catalogue_livraison",class:"form-label"},"Date de livraison",-1)),b(t("input",{id:"catalogue_livraison","onUpdate:modelValue":e[8]||(e[8]=s=>a.value.date_livraison=s),type:"date",class:"form-control"},null,512),[[f,a.value.date_livraison]])])]),t("div",pe,[e[32]||(e[32]=t("label",{for:"catalogue_description",class:"form-label"},"Description",-1)),b(t("textarea",{id:"catalogue_description","onUpdate:modelValue":e[9]||(e[9]=s=>a.value.description=s),class:"form-control",rows:"3",placeholder:"Description du catalogue (optionnel)"},null,512),[[f,a.value.description]])]),t("button",{type:"button",class:"btn btn-primary",onClick:e[10]||(e[10]=s=>x.value=2)},[...e[33]||(e[33]=[t("i",{class:"bi bi-arrow-right me-2"},null,-1),d("Étape suivante : Choisir la source des produits ",-1)])])])])):u("",!0),x.value===2?(r(),n("div",me,[e[44]||(e[44]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-2-circle me-2"}),d("Choisir la source des produits ")])],-1)),t("div",ve,[t("div",be,[t("div",fe,[t("div",{class:"card h-100 border-success",style:{cursor:"pointer"},onClick:e[11]||(e[11]=s=>g.value="catalog")},[...e[34]||(e[34]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-files text-success",style:{"font-size":"2.5rem"}}),t("h5",{class:"card-title mt-3"},"Reprendre un ancien catalogue"),t("p",{class:"card-text text-muted"},"Importez tous les produits (avec prix) depuis un catalogue existant")],-1)])])]),t("div",xe,[t("div",{class:"card h-100 border-success",style:{cursor:"pointer"},onClick:e[12]||(e[12]=s=>g.value="empty")},[...e[35]||(e[35]=[t("div",{class:"card-body text-center"},[t("i",{class:"bi bi-basket text-success",style:{"font-size":"2.5rem"}}),t("h5",{class:"card-title mt-3"},"Base de produits"),t("p",{class:"card-text text-muted"},"Créer un catalogue vierge et ajouter des produits ensuite")],-1)])])])]),g.value==="catalog"?(r(),n("div",ge,[e[39]||(e[39]=t("label",{for:"source_catalog_id",class:"form-label"},[d("Catalogue source "),t("span",{class:"text-danger"},"*")],-1)),b(t("select",{id:"source_catalog_id","onUpdate:modelValue":e[13]||(e[13]=s=>a.value.source_catalog_id=s),class:"form-select"},[e[36]||(e[36]=t("option",{value:""},"-- Sélectionner un catalogue --",-1)),(r(!0),n(E,null,A(C.value,s=>(r(),n("option",{key:s.id,value:s.id}," #"+k(s.id)+" - "+k(s.originalname)+" - Exp: "+k(s.expiration_formatted||"Pas d'expiration"),9,ye))),128))],512),[[U,a.value.source_catalog_id]]),t("button",{type:"button",class:"btn btn-success mt-2",disabled:p.value||!a.value.source_catalog_id,onClick:S},[p.value?(r(),n("span",we)):u("",!0),e[37]||(e[37]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),e[38]||(e[38]=d("Créer le catalogue ",-1))],8,_e)])):u("",!0),g.value==="empty"?(r(),n("div",ke,[e[42]||(e[42]=t("p",{class:"text-muted"},"Un catalogue vierge sera créé. Vous pourrez ensuite ajouter des produits depuis la base de données dans la page d'édition.",-1)),t("button",{type:"button",class:"btn btn-success",disabled:p.value,onClick:h},[p.value?(r(),n("span",Ve)):u("",!0),e[40]||(e[40]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),e[41]||(e[41]=d("Créer le catalogue vierge ",-1))],8,Ce)])):u("",!0),t("button",{type:"button",class:"btn btn-outline-secondary mt-2",onClick:e[14]||(e[14]=s=>x.value=1)},[...e[43]||(e[43]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),d("Retour aux informations ",-1)])])])])):u("",!0)],64)):u("",!0)])])]))}},j=N(Ee);j.use(P());j.mount("#admin-catalogue-new-app");
