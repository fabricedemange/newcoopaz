import{i as k,o as l,c as a,a as t,b as u,u as r,t as d,d as b,F as f,e as x,v as w,n as g,k as y,h as C}from"./chunks/runtime-dom.esm-bundler-C8CGTSXe.js";import{d as P,c as T}from"./chunks/pinia-DIU_KYYh.js";import{i as D,j as E,A}from"./chunks/index-zlPV8JO4.js";const z=P("paniers",{state:()=>({loading:!1,error:null,authRequired:!1,paniers:[],searchTerm:"",sortColumn:"created_at",sortDirection:"desc"}),getters:{sortedPaniers(n){let i=[...n.paniers||[]];if(n.searchTerm){const m=n.searchTerm.toLowerCase();i=i.filter(c=>c.catalogue_nom&&c.catalogue_nom.toLowerCase().includes(m)||c.catalog_description&&c.catalog_description.toLowerCase().includes(m)||c.panier_note&&c.panier_note.toLowerCase().includes(m)||c.articles_notes&&c.articles_notes.toLowerCase().includes(m)||String(c.id).includes(m))}const p=n.sortColumn,_=n.sortDirection;return i.sort((m,c)=>{let o,e;switch(p){case"id":o=m.id,e=c.id;break;case"catalogue":o=(m.catalogue_nom||"").toLowerCase(),e=(c.catalogue_nom||"").toLowerCase();break;case"nb_articles":o=m.nb_articles||0,e=c.nb_articles||0;break;case"total":o=parseFloat(m.total)||0,e=parseFloat(c.total)||0;break;case"expiration_date":o=m.expiration_date?new Date(m.expiration_date).getTime():0,e=c.expiration_date?new Date(c.expiration_date).getTime():0;break;case"created_at":o=m.created_at?new Date(m.created_at).getTime():0,e=c.created_at?new Date(c.created_at).getTime():0;break;default:return 0}if(typeof o=="string"){const s=o.localeCompare(e);return _==="asc"?s:-s}return _==="asc"?o>e?1:o<e?-1:0:o<e?1:o>e?-1:0})},sortIcon(n){return i=>n.sortColumn!==i?"arrow-down-up":n.sortDirection==="asc"?"arrow-up":"arrow-down"}},actions:{async loadAll(){this.loading=!0,this.error=null,this.authRequired=!1;try{const n=await E();if(n.success)this.paniers=n.paniers||[];else throw new Error(n.error||"Erreur chargement")}catch(n){this.error=n.message,n.code===A&&(this.authRequired=!0),console.error("paniers loadAll:",n)}finally{this.loading=!1}},sortBy(n){this.sortColumn===n?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=n,this.sortDirection="asc")},async deletePanier(n,i){await D(n,i),this.paniers=(this.paniers||[]).filter(p=>p.id!==n)}}}),$={class:"admin-content-wrapper"},B={class:"container-fluid mt-4"},L={key:0,class:"alert alert-danger alert-dismissible fade show"},R={key:1,class:"text-center py-5"},S={class:"card mb-3"},F={class:"card-body"},N={class:"input-group"},I={key:0,class:"alert alert-info"},q={class:"card d-none d-md-block"},M={class:"card-body"},V={class:"table-responsive"},j={class:"table table-hover align-middle"},U={class:"thead-precommandes"},K={class:"badge bg-light text-dark"},O={key:0},G={key:1,class:"text-muted"},H={key:2},J={key:3,class:"text-info"},Q={class:"text-center"},W={class:"badge bg-secondary"},X={class:"text-end"},Y={class:"text-muted"},Z={class:"d-flex gap-1"},tt=["href"],et={key:1,class:"text-muted small"},st=["onClick"],it={class:"text-muted small mt-2"},rt={key:0},ot={class:"d-md-none"},nt={class:"card-body p-2"},lt={class:"d-flex justify-content-between align-items-start mb-1"},at={class:"card-title mb-0 small"},dt={class:"badge bg-light text-dark me-1"},ct={key:0,class:"text-muted mb-1",style:{"font-size":"0.75rem"}},ut={key:1,class:"alert alert-info py-1 px-2 mb-1",style:{"font-size":"0.7rem"}},mt={class:"row g-1 mb-2"},bt={class:"col-6"},gt={class:"badge bg-secondary",style:{"font-size":"0.7rem"}},pt={class:"col-6"},ft={style:{"font-size":"0.85rem"}},_t={class:"col-6"},yt={style:{"font-size":"0.75rem"}},ht={class:"col-6"},vt={style:{"font-size":"0.75rem"}},kt={class:"d-grid gap-1"},xt=["href"],wt=["onClick"],Ct={class:"text-muted small text-center mt-3"},Pt={key:0},Tt={__name:"PaniersPage",setup(n){const i=z();function p(o){return o==null?"0,00 €":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o)}function _(o){return o.isExpired?"bg-danger":o.modifiable?"bg-success":"bg-secondary"}function m(o){return o.isExpired?"Expiré":o.modifiable?"Modifiable":"Non modifiable"}function c(o){confirm("Confirmer la suppression de ce panier ?")&&i.deletePanier(o,typeof window<"u"?window.CSRF_TOKEN:"").catch(e=>{console.error("deletePanier:",e),typeof window<"u"&&alert("Erreur lors de la suppression du panier")})}return k(()=>{i.loadAll()}),(o,e)=>(l(),a("div",$,[t("div",B,[t("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:e[0]||(e[0]=s=>o.history.back())},[...e[8]||(e[8]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),u("Retour ",-1)])]),e[35]||(e[35]=t("div",{class:"d-flex justify-content-between align-items-center mb-4"},[t("h2",null,[t("i",{class:"bi bi-cart me-2"}),u("Mes paniers en cours")]),t("a",{href:"/catalogues/vue",class:"btn btn-primary"},[t("i",{class:"bi bi-plus-circle me-1"}),u("Nouveau panier ")])],-1)),r(i).error?(l(),a("div",L,[e[9]||(e[9]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),e[10]||(e[10]=t("strong",null,"Erreur :",-1)),u(" "+d(r(i).error)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[1]||(e[1]=s=>r(i).error=null)})])):b("",!0),r(i).loading?(l(),a("div",R,[...e[11]||(e[11]=[t("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),t("p",{class:"mt-3 text-muted"},"Chargement des paniers...",-1)])])):(l(),a(f,{key:2},[t("div",S,[t("div",F,[t("div",N,[e[12]||(e[12]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r(i).searchTerm=s),type:"text",class:"form-control",placeholder:"Rechercher par catalogue, description, note ou numéro..."},null,512),[[w,r(i).searchTerm]])])])]),r(i).sortedPaniers.length===0?(l(),a("div",I,[e[15]||(e[15]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),r(i).searchTerm?(l(),a(f,{key:0},[u("Aucun panier ne correspond à votre recherche.")],64)):(l(),a(f,{key:1},[e[13]||(e[13]=u(" Aucun panier en cours. ",-1)),e[14]||(e[14]=t("a",{href:"/catalogues/vue",class:"alert-link"},"Commencer un nouveau panier",-1))],64))])):(l(),a(f,{key:1},[t("div",q,[t("div",M,[t("div",V,[t("table",j,[t("thead",U,[t("tr",null,[t("th",{style:{cursor:"pointer"},onClick:e[3]||(e[3]=s=>r(i).sortBy("id"))},[e[16]||(e[16]=u("# ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("id")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer"},onClick:e[4]||(e[4]=s=>r(i).sortBy("catalogue"))},[e[17]||(e[17]=u("Catalogue ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("catalogue")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer","text-align":"center"},onClick:e[5]||(e[5]=s=>r(i).sortBy("nb_articles"))},[e[18]||(e[18]=u("Articles ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("nb_articles")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer","text-align":"right"},onClick:e[6]||(e[6]=s=>r(i).sortBy("total"))},[e[19]||(e[19]=u("Total ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("total")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer"},onClick:e[7]||(e[7]=s=>r(i).sortBy("expiration_date"))},[e[20]||(e[20]=u("Expiration ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("expiration_date")+" ms-1"])},null,2)]),e[21]||(e[21]=t("th",null,"Statut",-1)),e[22]||(e[22]=t("th",{style:{width:"200px"}},"Actions",-1))])]),t("tbody",null,[(l(!0),a(f,null,y(r(i).sortedPaniers,s=>(l(),a("tr",{key:s.id},[t("td",null,[t("span",K,"#"+d(s.id),1)]),t("td",null,[t("strong",null,d(s.catalogue_nom),1),s.catalog_description?(l(),a("br",O)):b("",!0),s.catalog_description?(l(),a("small",G,d(s.catalog_description),1)):b("",!0),s.panier_note?(l(),a("br",H)):b("",!0),s.panier_note?(l(),a("small",J,[e[23]||(e[23]=t("i",{class:"bi bi-sticky"},null,-1)),u(" "+d(s.panier_note),1)])):b("",!0)]),t("td",Q,[t("span",W,d(s.nb_articles||0),1)]),t("td",X,[t("strong",null,d(p(s.total)),1)]),t("td",null,[t("div",null,d(s.expiration_formatted),1),t("small",Y,[e[24]||(e[24]=t("i",{class:"bi bi-truck"},null,-1)),u(" "+d(s.livraison_formatted),1)])]),t("td",null,[t("span",{class:g(["badge",_(s)])},d(m(s)),3)]),t("td",null,[t("div",Z,[s.modifiable?(l(),a("a",{key:0,href:`/catalogues/${s.catalog_file_id}/vue`,class:"btn btn-sm btn-primary",title:"Éditer"},[...e[25]||(e[25]=[t("i",{class:"bi bi-pencil"},null,-1),u(" Éditer",-1)])],8,tt)):(l(),a("span",et,"Catalogue expiré")),t("button",{class:"btn btn-sm btn-outline-danger ms-1",title:"Supprimer",onClick:v=>c(s.id)},[...e[26]||(e[26]=[t("i",{class:"bi bi-trash"},null,-1)])],8,st)])])]))),128))])])]),t("div",it,[u(d(r(i).sortedPaniers.length)+" panier(s) ",1),r(i).searchTerm&&r(i).paniers.length!==r(i).sortedPaniers.length?(l(),a("span",rt," (filtré sur "+d(r(i).paniers.length)+" total)",1)):b("",!0)])])]),t("div",ot,[(l(!0),a(f,null,y(r(i).sortedPaniers,s=>(l(),a("div",{key:"m-"+s.id,class:"card mb-2 shadow-sm"},[t("div",nt,[t("div",lt,[t("h6",at,[t("span",dt,"#"+d(s.id),1),t("strong",null,d(s.catalogue_nom),1)]),t("span",{class:g(["badge",_(s)])},d(m(s)),3)]),s.catalog_description?(l(),a("p",ct,d(s.catalog_description),1)):b("",!0),s.panier_note?(l(),a("div",ut,[e[27]||(e[27]=t("i",{class:"bi bi-sticky me-1"},null,-1)),u(d(s.panier_note),1)])):b("",!0),t("div",mt,[t("div",bt,[e[28]||(e[28]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Articles",-1)),t("span",gt,d(s.nb_articles||0),1)]),t("div",pt,[e[29]||(e[29]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Total",-1)),t("strong",ft,d(p(s.total)),1)]),t("div",_t,[e[30]||(e[30]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Expiration",-1)),t("div",yt,d(s.expiration_formatted),1)]),t("div",ht,[e[32]||(e[32]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Livraison",-1)),t("div",vt,[e[31]||(e[31]=t("i",{class:"bi bi-truck"},null,-1)),u(" "+d(s.livraison_formatted),1)])])]),t("div",kt,[s.modifiable?(l(),a("a",{key:0,href:`/catalogues/${s.catalog_file_id}/vue`,class:"btn btn-sm btn-primary"},[...e[33]||(e[33]=[t("i",{class:"bi bi-pencil me-1"},null,-1),u("Éditer",-1)])],8,xt)):b("",!0),t("button",{class:"btn btn-sm btn-outline-danger",onClick:v=>c(s.id)},[...e[34]||(e[34]=[t("i",{class:"bi bi-trash me-1"},null,-1),u("Supprimer",-1)])],8,wt)])])]))),128)),t("div",Ct,[u(d(r(i).sortedPaniers.length)+" panier(s) ",1),r(i).searchTerm&&r(i).paniers.length!==r(i).sortedPaniers.length?(l(),a("span",Pt," (filtré sur "+d(r(i).paniers.length)+" total)",1)):b("",!0)])])],64))],64))])]))}},h=C(Tt);h.use(T());h.mount("#paniers-list-app");
