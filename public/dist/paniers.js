import{i as k,o as l,c as a,a as t,b as u,j as x,u as r,t as d,d as b,F as p,e as w,v as C,n as g,l as y,h as P}from"./chunks/runtime-dom.esm-bundler-CuNObg1-.js";import{d as T,c as D}from"./chunks/pinia-gLxYYWQL.js";import{i as E,j as A,A as $}from"./chunks/index-CLmjs_4-.js";import{_ as z}from"./chunks/BackButton-DzFd1NqY.js";const B=T("paniers",{state:()=>({loading:!1,error:null,authRequired:!1,paniers:[],searchTerm:"",sortColumn:"created_at",sortDirection:"desc"}),getters:{sortedPaniers(n){let i=[...n.paniers||[]];if(n.searchTerm){const m=n.searchTerm.toLowerCase();i=i.filter(c=>c.catalogue_nom&&c.catalogue_nom.toLowerCase().includes(m)||c.catalog_description&&c.catalog_description.toLowerCase().includes(m)||c.panier_note&&c.panier_note.toLowerCase().includes(m)||c.articles_notes&&c.articles_notes.toLowerCase().includes(m)||String(c.id).includes(m))}const f=n.sortColumn,_=n.sortDirection;return i.sort((m,c)=>{let o,e;switch(f){case"id":o=m.id,e=c.id;break;case"catalogue":o=(m.catalogue_nom||"").toLowerCase(),e=(c.catalogue_nom||"").toLowerCase();break;case"nb_articles":o=m.nb_articles||0,e=c.nb_articles||0;break;case"total":o=parseFloat(m.total)||0,e=parseFloat(c.total)||0;break;case"expiration_date":o=m.expiration_date?new Date(m.expiration_date).getTime():0,e=c.expiration_date?new Date(c.expiration_date).getTime():0;break;case"created_at":o=m.created_at?new Date(m.created_at).getTime():0,e=c.created_at?new Date(c.created_at).getTime():0;break;default:return 0}if(typeof o=="string"){const s=o.localeCompare(e);return _==="asc"?s:-s}return _==="asc"?o>e?1:o<e?-1:0:o<e?1:o>e?-1:0})},sortIcon(n){return i=>n.sortColumn!==i?"arrow-down-up":n.sortDirection==="asc"?"arrow-up":"arrow-down"}},actions:{async loadAll(){this.loading=!0,this.error=null,this.authRequired=!1;try{const n=await A();if(n.success)this.paniers=n.paniers||[];else throw new Error(n.error||"Erreur chargement")}catch(n){this.error=n.message,n.code===$&&(this.authRequired=!0),console.error("paniers loadAll:",n)}finally{this.loading=!1}},sortBy(n){this.sortColumn===n?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=n,this.sortDirection="asc")},async deletePanier(n,i){await E(n,i),this.paniers=(this.paniers||[]).filter(f=>f.id!==n)}}}),L={class:"admin-content-wrapper"},R={class:"container-fluid mt-4"},N={class:"d-flex justify-content-between align-items-center mb-4"},S={class:"d-flex gap-2"},F={key:0,class:"alert alert-danger alert-dismissible fade show"},I={key:1,class:"text-center py-5"},V={class:"card mb-3"},j={class:"card-body"},q={class:"input-group"},M={key:0,class:"alert alert-info"},U={class:"card d-none d-md-block"},K={class:"card-body"},O={class:"table-responsive"},G={class:"table table-hover align-middle"},H={class:"thead-precommandes"},J={class:"badge bg-light text-dark"},Q={key:0},W={key:1,class:"text-muted"},X={key:2},Y={key:3,class:"text-info"},Z={class:"text-center"},tt={class:"badge bg-secondary"},et={class:"text-end"},st={class:"text-muted"},it={class:"d-flex gap-1"},rt=["href"],ot={key:1,class:"text-muted small"},nt=["onClick"],lt={class:"text-muted small mt-2"},at={key:0},dt={class:"d-md-none"},ct={class:"card-body p-2"},ut={class:"d-flex justify-content-between align-items-start mb-1"},mt={class:"card-title mb-0 small"},bt={class:"badge bg-light text-dark me-1"},gt={key:0,class:"text-muted mb-1",style:{"font-size":"0.75rem"}},ft={key:1,class:"alert alert-info py-1 px-2 mb-1",style:{"font-size":"0.7rem"}},pt={class:"row g-1 mb-2"},_t={class:"col-6"},yt={class:"badge bg-secondary",style:{"font-size":"0.7rem"}},ht={class:"col-6"},vt={style:{"font-size":"0.85rem"}},kt={class:"col-6"},xt={style:{"font-size":"0.75rem"}},wt={class:"col-6"},Ct={style:{"font-size":"0.75rem"}},Pt={class:"d-grid gap-1"},Tt=["href"],Dt=["onClick"],Et={class:"text-muted small text-center mt-3"},At={key:0},$t={__name:"PaniersPage",setup(n){const i=B();function f(o){return o==null?"0,00 €":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o)}function _(o){return o.isExpired?"bg-danger":o.modifiable?"bg-success":"bg-secondary"}function m(o){return o.isExpired?"Expiré":o.modifiable?"Modifiable":"Non modifiable"}function c(o){confirm("Confirmer la suppression de ce panier ?")&&i.deletePanier(o,typeof window<"u"?window.CSRF_TOKEN:"").catch(e=>{console.error("deletePanier:",e),typeof window<"u"&&alert("Erreur lors de la suppression du panier")})}return k(()=>{i.loadAll()}),(o,e)=>(l(),a("div",L,[t("div",R,[t("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:e[0]||(e[0]=s=>o.history.back())},[...e[8]||(e[8]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),u("Retour ",-1)])]),t("div",N,[e[10]||(e[10]=t("h2",{class:"mb-0"},[t("i",{class:"bi bi-cart me-2"}),u("Mes paniers en cours")],-1)),t("div",S,[x(z),e[9]||(e[9]=t("a",{href:"/catalogues/vue",class:"btn btn-primary"},[t("i",{class:"bi bi-plus-circle me-1"}),u("Nouveau panier ")],-1))])]),r(i).error?(l(),a("div",F,[e[11]||(e[11]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),e[12]||(e[12]=t("strong",null,"Erreur :",-1)),u(" "+d(r(i).error)+" ",1),t("button",{type:"button",class:"btn-close",onClick:e[1]||(e[1]=s=>r(i).error=null)})])):b("",!0),r(i).loading?(l(),a("div",I,[...e[13]||(e[13]=[t("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},null,-1),t("p",{class:"mt-3 text-muted"},"Chargement des paniers...",-1)])])):(l(),a(p,{key:2},[t("div",V,[t("div",j,[t("div",q,[e[14]||(e[14]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r(i).searchTerm=s),type:"text",class:"form-control",placeholder:"Rechercher par catalogue, description, note ou numéro..."},null,512),[[C,r(i).searchTerm]])])])]),r(i).sortedPaniers.length===0?(l(),a("div",M,[e[17]||(e[17]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),r(i).searchTerm?(l(),a(p,{key:0},[u("Aucun panier ne correspond à votre recherche.")],64)):(l(),a(p,{key:1},[e[15]||(e[15]=u(" Aucun panier en cours. ",-1)),e[16]||(e[16]=t("a",{href:"/catalogues/vue",class:"alert-link"},"Commencer un nouveau panier",-1))],64))])):(l(),a(p,{key:1},[t("div",U,[t("div",K,[t("div",O,[t("table",G,[t("thead",H,[t("tr",null,[t("th",{style:{cursor:"pointer"},onClick:e[3]||(e[3]=s=>r(i).sortBy("id"))},[e[18]||(e[18]=u("# ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("id")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer"},onClick:e[4]||(e[4]=s=>r(i).sortBy("catalogue"))},[e[19]||(e[19]=u("Catalogue ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("catalogue")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer","text-align":"center"},onClick:e[5]||(e[5]=s=>r(i).sortBy("nb_articles"))},[e[20]||(e[20]=u("Articles ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("nb_articles")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer","text-align":"right"},onClick:e[6]||(e[6]=s=>r(i).sortBy("total"))},[e[21]||(e[21]=u("Total ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("total")+" ms-1"])},null,2)]),t("th",{style:{cursor:"pointer"},onClick:e[7]||(e[7]=s=>r(i).sortBy("expiration_date"))},[e[22]||(e[22]=u("Expiration ",-1)),t("i",{class:g(["bi","bi-"+r(i).sortIcon("expiration_date")+" ms-1"])},null,2)]),e[23]||(e[23]=t("th",null,"Statut",-1)),e[24]||(e[24]=t("th",{style:{width:"200px"}},"Actions",-1))])]),t("tbody",null,[(l(!0),a(p,null,y(r(i).sortedPaniers,s=>(l(),a("tr",{key:s.id},[t("td",null,[t("span",J,"#"+d(s.id),1)]),t("td",null,[t("strong",null,d(s.catalogue_nom),1),s.catalog_description?(l(),a("br",Q)):b("",!0),s.catalog_description?(l(),a("small",W,d(s.catalog_description),1)):b("",!0),s.panier_note?(l(),a("br",X)):b("",!0),s.panier_note?(l(),a("small",Y,[e[25]||(e[25]=t("i",{class:"bi bi-sticky"},null,-1)),u(" "+d(s.panier_note),1)])):b("",!0)]),t("td",Z,[t("span",tt,d(s.nb_articles||0),1)]),t("td",et,[t("strong",null,d(f(s.total)),1)]),t("td",null,[t("div",null,d(s.expiration_formatted),1),t("small",st,[e[26]||(e[26]=t("i",{class:"bi bi-truck"},null,-1)),u(" "+d(s.livraison_formatted),1)])]),t("td",null,[t("span",{class:g(["badge",_(s)])},d(m(s)),3)]),t("td",null,[t("div",it,[s.modifiable?(l(),a("a",{key:0,href:`/catalogues/${s.catalog_file_id}/vue`,class:"btn btn-sm btn-primary",title:"Éditer"},[...e[27]||(e[27]=[t("i",{class:"bi bi-pencil"},null,-1),u(" Éditer",-1)])],8,rt)):(l(),a("span",ot,"Catalogue expiré")),t("button",{class:"btn btn-sm btn-outline-danger ms-1",title:"Supprimer",onClick:v=>c(s.id)},[...e[28]||(e[28]=[t("i",{class:"bi bi-trash"},null,-1)])],8,nt)])])]))),128))])])]),t("div",lt,[u(d(r(i).sortedPaniers.length)+" panier(s) ",1),r(i).searchTerm&&r(i).paniers.length!==r(i).sortedPaniers.length?(l(),a("span",at," (filtré sur "+d(r(i).paniers.length)+" total)",1)):b("",!0)])])]),t("div",dt,[(l(!0),a(p,null,y(r(i).sortedPaniers,s=>(l(),a("div",{key:"m-"+s.id,class:"card mb-2 shadow-sm"},[t("div",ct,[t("div",ut,[t("h6",mt,[t("span",bt,"#"+d(s.id),1),t("strong",null,d(s.catalogue_nom),1)]),t("span",{class:g(["badge",_(s)])},d(m(s)),3)]),s.catalog_description?(l(),a("p",gt,d(s.catalog_description),1)):b("",!0),s.panier_note?(l(),a("div",ft,[e[29]||(e[29]=t("i",{class:"bi bi-sticky me-1"},null,-1)),u(d(s.panier_note),1)])):b("",!0),t("div",pt,[t("div",_t,[e[30]||(e[30]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Articles",-1)),t("span",yt,d(s.nb_articles||0),1)]),t("div",ht,[e[31]||(e[31]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Total",-1)),t("strong",vt,d(f(s.total)),1)]),t("div",kt,[e[32]||(e[32]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Expiration",-1)),t("div",xt,d(s.expiration_formatted),1)]),t("div",wt,[e[34]||(e[34]=t("small",{class:"text-muted d-block",style:{"font-size":"0.65rem"}},"Livraison",-1)),t("div",Ct,[e[33]||(e[33]=t("i",{class:"bi bi-truck"},null,-1)),u(" "+d(s.livraison_formatted),1)])])]),t("div",Pt,[s.modifiable?(l(),a("a",{key:0,href:`/catalogues/${s.catalog_file_id}/vue`,class:"btn btn-sm btn-primary"},[...e[35]||(e[35]=[t("i",{class:"bi bi-pencil me-1"},null,-1),u("Éditer",-1)])],8,Tt)):b("",!0),t("button",{class:"btn btn-sm btn-outline-danger",onClick:v=>c(s.id)},[...e[36]||(e[36]=[t("i",{class:"bi bi-trash me-1"},null,-1),u("Supprimer",-1)])],8,Dt)])])]))),128)),t("div",Et,[u(d(r(i).sortedPaniers.length)+" panier(s) ",1),r(i).searchTerm&&r(i).paniers.length!==r(i).sortedPaniers.length?(l(),a("span",At," (filtré sur "+d(r(i).paniers.length)+" total)",1)):b("",!0)])])],64))],64))])]))}},h=P($t);h.use(D());h.mount("#paniers-list-app");
