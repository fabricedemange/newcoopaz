import{i as U,l as $,o as r,c as l,a as s,b as c,f as q,u as n,t as m,d as v,e as y,v as x,F as f,k as _,n as P,q as k,g as S,h as I}from"./chunks/runtime-dom.esm-bundler-BlMAuMpH.js";import{d as j,c as V}from"./chunks/pinia-BNknc8Vm.js";import{y as L,z as E,B as N,C as Q,D,E as T,F as O}from"./chunks/index-BkeVkIvb.js";import{_ as R}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const M="caisse_paniers_sauvegardes";function C(){try{const o=localStorage.getItem(M);return o?JSON.parse(o):[]}catch{return[]}}function w(o){try{localStorage.setItem(M,JSON.stringify(o))}catch(e){console.error("Erreur écriture localStorage:",e)}}function g(o){return Math.round(o*100)/100}function A(o){const e=o.filter(d=>!d.is_avoir).reduce((d,t)=>d+g(t.quantite*t.prix_unitaire),0),a=o.filter(d=>d.is_avoir);if(a.reduce((d,t)=>d+Math.abs(g(t.prix_unitaire)),0)<=e)return;let p=e;for(const d of a){const t=Math.abs(g(d.prix_unitaire)),i=g(Math.min(t,p));d.prix_unitaire=-i,p-=i}}const z=j("caisse",{state:()=>({produits:[],categories:[],searchQuery:"",selectedCategorie:null,produitsLoading:!1,utilisateurs:[],selectedUtilisateur:null,lignes:[],currentPanierId:null,savedPaniers:C(),showPaniersModal:!1,showAvoirModal:!1,avoirMontant:0,avoirCommentaire:"",showPaiementModal:!1,montantPaiement:0,modePaiementId:null,modesPaiement:[],error:null,commandesUtilisateur:[],loadingCommandes:!1,commandeSelectionnee:null,showModalChargerCommande:!1,commandeACharger:null,selectedCommandeId:null}),getters:{produitsFiltrés(o){let e=[...o.produits];if(o.searchQuery){const a=o.searchQuery.toLowerCase();e=e.filter(u=>u.nom.toLowerCase().includes(a))}return o.selectedCategorie&&(e=e.filter(a=>a.category_id===o.selectedCategorie)),e},total(o){const e=o.lignes.reduce((a,u)=>a+g(u.quantite*u.prix_unitaire),0);return g(e)},nombreArticles(o){return o.lignes.length},categoriesFiltrées(o){let e=[...o.produits];if(o.searchQuery){const u=o.searchQuery.toLowerCase();e=e.filter(p=>p.nom.toLowerCase().includes(u))}const a=new Set(e.filter(u=>u.category_id).map(u=>u.category_id));return o.categories.filter(u=>a.has(u.id))}},actions:{async chargerProduits(){this.produitsLoading=!0,this.error=null;try{const o=await O();o.success&&(this.produits=o.produits||[],this.categories=o.categories||[])}catch(o){this.error=o.message}finally{this.produitsLoading=!1}},async chargerUtilisateurs(){var o,e;try{const a=await T();if(a.success&&((o=a.utilisateurs)!=null&&o.length)){this.utilisateurs=a.utilisateurs;const u=a.utilisateurs.find(p=>(p.username||"").toLowerCase()==="anonyme");this.selectedUtilisateur=u?u.id:((e=a.utilisateurs[0])==null?void 0:e.id)??null}}catch(a){console.error("Erreur chargement utilisateurs:",a)}},async chargerModesPaiement(){try{const o=await D();o.success&&(this.modesPaiement=o.modes||[])}catch(o){console.error("Erreur chargement modes paiement:",o)}},ajouterProduit(o){const e=this.lignes.find(a=>a.produit_id===o.id);e?e.quantite+=parseFloat(o.quantite_min)||1:this.lignes.push({produit_id:o.id,nom_produit:o.nom,quantite:parseFloat(o.quantite_min)||1,prix_unitaire:parseFloat(o.prix)||0,unite:o.unite||"Pièce",quantite_min:parseFloat(o.quantite_min)||1,is_avoir:!1})},modifierQuantite(o,e){const a=this.lignes[o];a&&e>0&&(a.quantite=parseFloat(e),a.is_avoir||A(this.lignes))},supprimerLigne(o){const e=this.lignes[o],a=(e==null?void 0:e.is_avoir)===!0;this.lignes.splice(o,1),a||A(this.lignes)},viderPanier(){this.lignes=[],this.currentPanierId=null,this.commandeSelectionnee=null},sauvegarderPanier(){if(this.lignes.length===0)return;const o={id:this.currentPanierId||Date.now(),lignes:JSON.parse(JSON.stringify(this.lignes)),selectedUtilisateur:this.selectedUtilisateur,saved_at:new Date().toISOString(),total:this.total};let e=C();const a=e.findIndex(u=>u.id===o.id);a>=0?e[a]=o:e.push(o),w(e),this.savedPaniers=C(),this.currentPanierId=o.id},chargerPanier(o){const a=C().find(u=>u.id===o);a&&(this.lignes=JSON.parse(JSON.stringify(a.lignes)),this.selectedUtilisateur=a.selectedUtilisateur,this.currentPanierId=a.id,this.showPaniersModal=!1)},supprimerPanier(o){let e=C().filter(a=>a.id!==o);w(e),this.savedPaniers=e,this.currentPanierId===o&&this.viderPanier()},nouveauPanier(){this.lignes.length>0&&!confirm("Effacer le panier actuel ?")||this.viderPanier()},ajouterAvoir(){const o=parseFloat(this.avoirMontant);if(!o||o<=0)return;const e=this.lignes.filter(b=>!b.is_avoir).reduce((b,h)=>b+g(h.quantite*h.prix_unitaire),0),a=this.lignes.filter(b=>b.is_avoir).reduce((b,h)=>b+Math.abs(g(h.prix_unitaire)),0),u=g(e-a);if(u<=0)return;const p=g(o),d=g(Math.min(p,u)),t=this.avoirCommentaire||"Remboursement",i=d<p?`Avoir: ${t} (initial: ${p.toFixed(2)} €, limité à: ${d.toFixed(2)} €)`:`Avoir: ${t} (initial: ${d.toFixed(2)} €)`;this.lignes.push({produit_id:null,nom_produit:i,quantite:1,prix_unitaire:-d,unite:"",quantite_min:1,is_avoir:!0}),this.showAvoirModal=!1,this.avoirMontant=0,this.avoirCommentaire=""},ouvrirPaiement(){this.montantPaiement=this.total,this.showPaiementModal=!0},fermerPaiement(){this.showPaiementModal=!1,this.modePaiementId=null},async chargerCommandesUtilisateur(){if(!this.selectedUtilisateur){this.commandesUtilisateur=[],this.commandeSelectionnee=null;return}this.loadingCommandes=!0;try{const o=await Q(this.selectedUtilisateur);this.commandesUtilisateur=Array.isArray(o)?o:[]}catch(o){console.error("Erreur chargement commandes:",o),this.commandesUtilisateur=[]}finally{this.loadingCommandes=!1}},async chargerCommandeDansPanier(o){this.showModalChargerCommande=!1,this.commandeACharger=null;try{const e=await N(o),a=Array.isArray(e)?e:[];let u=0;for(const p of a){if(!p.product_id_caisse)continue;const d=this.produits.find(b=>b.id===p.product_id_caisse);if(!d)continue;const t=parseFloat(p.quantity)||1,i=this.lignes.find(b=>b.produit_id===d.id&&!b.is_avoir);i?i.quantite+=t:this.lignes.push({produit_id:d.id,nom_produit:d.nom,quantite:t,prix_unitaire:parseFloat(d.prix)||0,unite:d.unite||"Pièce",quantite_min:parseFloat(d.quantite_min)||1,is_avoir:!1}),u++}this.commandeSelectionnee=o,this.selectedCommandeId=null,u>0&&alert(`Commande #${o} ajoutée au panier (${u} articles)`)}catch(e){console.error("Erreur chargement commande:",e),alert(e.message||"Erreur lors du chargement de la commande")}},confirmerChargerCommande(o){o&&this.chargerCommandeDansPanier(o.id)},annulerChargerCommande(){this.showModalChargerCommande=!1,this.commandeACharger=null},async validerVente(){var o;if(!this.modePaiementId){this.error="Veuillez sélectionner un mode de paiement";return}this.error=null;try{const e=((o=this.utilisateurs.find(u=>u.id===this.selectedUtilisateur))==null?void 0:o.username)||"Anonyme",a=await L({adherent_id:this.selectedUtilisateur||null,nom_client:e,lignes:this.lignes,montant_ttc:this.total});if(!a.success)throw new Error(a.error);await E({vente_id:a.vente.id,mode_paiement_id:this.modePaiementId,montant:this.montantPaiement}),this.currentPanierId&&this.supprimerPanier(this.currentPanierId),this.viderPanier(),this.fermerPaiement(),alert(`Vente enregistrée ! Ticket n°${a.vente.numero_ticket}`)}catch(e){this.error=e.message,alert("Erreur : "+e.message)}}}}),J={class:"admin-content-wrapper"},B={class:"container-fluid px-3 mt-4"},G={key:0,class:"alert alert-danger alert-dismissible fade show"},H={class:"row"},K={class:"col-lg-7 col-md-7 mb-4"},Y={class:"mb-3"},W={class:"mb-3"},X={class:"badge bg-secondary fs-6 py-2 px-3"},Z={key:0,class:"mb-3"},tt={class:"d-flex flex-wrap gap-2"},et=["onClick"],st={key:1,class:"text-center py-5"},it={key:2,class:"alert alert-info text-center"},nt={key:3,class:"row g-3"},ot=["onClick"],at=["src","alt"],rt={class:"card-body p-2"},lt={class:"card-title mb-1",style:{"font-size":"0.9rem"}},dt={class:"text-primary"},ut={class:"col-lg-5 col-md-5"},mt={class:"card",style:{"min-height":"calc(100vh - 120px)",display:"flex","flex-direction":"column"}},ct={class:"card-header bg-primary text-white"},bt={class:"d-flex gap-2 flex-wrap mt-2"},pt=["disabled"],vt={class:"badge bg-white text-info ms-1"},gt={class:"mt-3"},ht=["value"],ft={class:"card-body",style:{flex:"1"}},yt={key:0,class:"mb-3 border-bottom pb-3"},_t=["disabled"],Ct=["disabled"],xt=["value"],Pt={key:0,class:"text-muted d-block mt-1"},kt={key:1,class:"alert alert-info py-2 px-3 mb-3",style:{"font-size":"0.85rem"}},wt={key:3,class:"text-center py-4 text-muted"},At={class:"mb-3"},Mt={class:"d-flex justify-content-between align-items-start mb-1"},Ft={key:0,class:"bi bi-receipt me-1"},Ut=["onClick"],$t={key:0,class:"d-flex justify-content-end"},qt={class:"text-warning"},St={key:1,class:"d-flex justify-content-between align-items-center"},It={class:"d-flex align-items-center gap-1"},jt=["onClick"],Vt=["value","onChange"],Lt=["onClick"],Et={class:"text-muted small"},Nt={class:"text-muted"},Qt={class:"text-primary"},Dt={class:"border-top pt-3 mb-3"},Tt={class:"d-flex justify-content-between align-items-center mb-2"},Ot={class:"d-flex justify-content-between align-items-center"},Rt={class:"mb-0 text-primary"},zt={class:"d-grid gap-2"},Jt=["disabled"],Bt={key:0,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},Gt={class:"modal-dialog modal-lg"},Ht={class:"modal-content"},Kt={class:"modal-header"},Yt={class:"modal-body"},Wt={key:0,class:"alert alert-info"},Xt={key:1},Zt={class:"card-body"},te={class:"row align-items-center"},ee={class:"col-md-6"},se={class:"text-muted"},ie={class:"col-md-3 text-end"},ne={class:"mb-0 text-primary"},oe={class:"col-md-3 text-end"},ae=["onClick"],re=["onClick"],le={class:"modal-footer"},de={key:1,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},ue={class:"modal-dialog"},me={class:"modal-content"},ce={class:"modal-header"},be={class:"modal-body"},pe={class:"alert alert-success"},ve={class:"mb-3"},ge=["value"],he={class:"mb-3"},fe={key:0,class:"alert alert-info"},ye={class:"modal-footer"},_e=["disabled"],Ce={key:2,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},xe={class:"modal-dialog"},Pe={class:"modal-content"},ke={class:"modal-header"},we={class:"modal-footer"},Ae={key:3,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0, 0, 0, 0.5)"}},Me={class:"modal-dialog"},Fe={class:"modal-content"},Ue={class:"modal-header"},$e={class:"modal-body"},qe={class:"alert alert-info"},Se={class:"mb-3"},Ie={class:"mb-3"},je={class:"modal-footer"},Ve={__name:"CaissePage",setup(o){const e=z(),a=S(()=>e.lignes.filter(d=>!d.is_avoir).reduce((d,t)=>d+t.quantite*t.prix_unitaire,0));function u(d){confirm("Supprimer ce panier sauvegardé ?")&&e.supprimerPanier(d)}function p(){const d=e.commandesUtilisateur.find(t=>t.id===e.selectedCommandeId);d&&e.confirmerChargerCommande(d)}return U(()=>{e.chargerProduits(),e.chargerUtilisateurs(),e.chargerModesPaiement()}),$(()=>e.selectedUtilisateur,d=>{d?e.chargerCommandesUtilisateur():(e.commandesUtilisateur=[],e.commandeSelectionnee=null,e.selectedCommandeId=null)}),(d,t)=>(r(),l("div",J,[s("div",B,[s("button",{class:"btn btn-outline-secondary d-md-none mb-3",onClick:t[0]||(t[0]=i=>d.history.back())},[...t[27]||(t[27]=[s("i",{class:"bi bi-arrow-left me-2"},null,-1),c("Retour ",-1)])]),t[50]||(t[50]=q('<div class="row mb-4" data-v-069c15c4><div class="col-12" data-v-069c15c4><div class="d-flex justify-content-between align-items-center" data-v-069c15c4><h2 class="mb-0" data-v-069c15c4><i class="bi bi-cart-fill me-2" data-v-069c15c4></i>Caisse</h2><a href="/caisse/historique" class="btn btn-outline-primary" data-v-069c15c4><i class="bi bi-clock-history me-2" data-v-069c15c4></i>Historique des ventes </a></div></div></div>',1)),n(e).error?(r(),l("div",G,[c(m(n(e).error)+" ",1),s("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=i=>n(e).error=null)})])):v("",!0),s("div",H,[s("div",K,[s("div",Y,[y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>n(e).searchQuery=i),type:"text",class:"form-control",placeholder:"Rechercher un produit...",style:{"max-width":"500px"}},null,512),[[x,n(e).searchQuery]])]),s("div",W,[s("span",X,[t[28]||(t[28]=s("i",{class:"bi bi-box-seam me-1"},null,-1)),c(m(n(e).produitsFiltrés.length)+" produits disponibles ",1)])]),n(e).searchQuery&&n(e).categoriesFiltrées.length>0?(r(),l("div",Z,[s("div",tt,[(r(!0),l(f,null,_(n(e).categoriesFiltrées,i=>(r(),l("button",{key:i.id,class:P(["btn btn-sm",n(e).selectedCategorie===i.id?"btn-primary":"btn-outline-primary"]),onClick:b=>n(e).selectedCategorie=n(e).selectedCategorie===i.id?null:i.id},[c(m(i.nom)+" ",1),s("span",{class:P(["badge ms-2",n(e).selectedCategorie===i.id?"bg-light text-primary":"bg-primary"])},m(n(e).produitsFiltrés.filter(b=>b.category_id===i.id).length),3)],10,et))),128))])])):v("",!0),n(e).produitsLoading?(r(),l("div",st,[...t[29]||(t[29]=[s("div",{class:"spinner-border text-primary"},null,-1)])])):n(e).produitsFiltrés.length===0?(r(),l("div",it," Aucun produit disponible ")):(r(),l("div",nt,[(r(!0),l(f,null,_(n(e).produitsFiltrés,i=>(r(),l("div",{key:i.id,class:"col-lg-4 col-md-6 col-sm-4 col-6"},[s("div",{class:"card h-100 produit-card",onClick:b=>n(e).ajouterProduit(i)},[i.image_url?(r(),l("img",{key:0,src:i.image_url,class:"card-img-top",alt:i.nom,style:{height:"120px","object-fit":"cover"}},null,8,at)):v("",!0),s("div",rt,[s("h6",lt,m(i.nom),1),s("strong",dt,m((parseFloat(i.prix)||0).toFixed(2))+" €",1)])],8,ot)]))),128))]))]),s("div",ut,[s("div",mt,[s("div",ct,[t[35]||(t[35]=s("h5",{class:"mb-0"},[s("i",{class:"bi bi-cart3 me-2"}),c("Panier")],-1)),s("div",bt,[s("button",{class:"btn btn-sm btn-outline-light",onClick:t[3]||(t[3]=i=>n(e).nouveauPanier())},[...t[30]||(t[30]=[s("i",{class:"bi bi-file-earmark-plus me-1"},null,-1),c("Nouveau ",-1)])]),s("button",{class:"btn btn-sm btn-light",disabled:n(e).lignes.length===0,onClick:t[4]||(t[4]=i=>n(e).sauvegarderPanier())},[...t[31]||(t[31]=[s("i",{class:"bi bi-save me-1"},null,-1),c("Sauvegarder ",-1)])],8,pt),s("button",{class:"btn btn-sm btn-info",onClick:t[5]||(t[5]=i=>n(e).showPaniersModal=!0)},[t[32]||(t[32]=s("i",{class:"bi bi-folder2-open me-1"},null,-1)),t[33]||(t[33]=c("Charger ",-1)),s("span",vt,m(n(e).savedPaniers.length),1)])]),s("div",gt,[t[34]||(t[34]=s("label",{class:"form-label mb-1 small"},[s("i",{class:"bi bi-person me-1"}),c("Utilisateur")],-1)),y(s("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>n(e).selectedUtilisateur=i),class:"form-select form-select-sm"},[(r(!0),l(f,null,_(n(e).utilisateurs,i=>(r(),l("option",{key:i.id,value:i.id},m(i.username),9,ht))),128))],512),[[k,n(e).selectedUtilisateur]])])]),s("div",ft,[n(e).selectedUtilisateur?(r(),l("div",yt,[t[39]||(t[39]=s("label",{class:"form-label fw-bold small mb-2"},[s("i",{class:"bi bi-basket me-1"}),c("Charger une commande catalogue ")],-1)),s("button",{type:"button",class:"btn btn-sm btn-outline-primary w-100 mb-2",disabled:n(e).loadingCommandes,onClick:t[7]||(t[7]=i=>n(e).chargerCommandesUtilisateur())},[t[36]||(t[36]=s("i",{class:"bi bi-arrow-clockwise me-1"},null,-1)),c(" "+m(n(e).loadingCommandes?"Chargement...":"Actualiser commandes"),1)],8,_t),y(s("select",{"onUpdate:modelValue":t[8]||(t[8]=i=>n(e).selectedCommandeId=i),class:"form-select form-select-sm",disabled:!n(e).commandesUtilisateur.length},[t[37]||(t[37]=s("option",{value:null},"-- Sélectionner une commande --",-1)),(r(!0),l(f,null,_(n(e).commandesUtilisateur,i=>(r(),l("option",{key:i.id,value:i.id}," Cde #"+m(i.id)+" - "+m(i.catalogue_nom||"Catalogue")+" (Cat #"+m(i.catalog_id)+") | "+m(i.nb_articles)+" articles | "+m((parseFloat(i.total)||0).toFixed(2))+" € ",9,xt))),128))],8,Ct),[[k,n(e).selectedCommandeId]]),n(e).commandesUtilisateur.length===0&&!n(e).loadingCommandes?(r(),l("small",Pt," Aucune commande en attente pour cet utilisateur ")):v("",!0),n(e).selectedCommandeId?(r(),l("button",{key:1,type:"button",class:"btn btn-sm btn-primary w-100 mt-2",onClick:p},[...t[38]||(t[38]=[s("i",{class:"bi bi-box-arrow-in-down me-1"},null,-1),c("Charger cette commande ",-1)])])):v("",!0)])):v("",!0),n(e).commandeSelectionnee?(r(),l("div",kt,[t[40]||(t[40]=s("i",{class:"bi bi-info-circle me-1"},null,-1)),c(" Ce panier provient de la commande catalogue #"+m(n(e).commandeSelectionnee),1)])):v("",!0),n(e).lignes.length>0?(r(),l("button",{key:2,class:"btn btn-sm btn-warning w-100 mb-2",onClick:t[9]||(t[9]=i=>n(e).showAvoirModal=!0)},[...t[41]||(t[41]=[s("i",{class:"bi bi-receipt me-1"},null,-1),c("Ajouter un avoir ",-1)])])):v("",!0),n(e).lignes.length===0?(r(),l("div",wt,[...t[42]||(t[42]=[s("i",{class:"bi bi-cart-x",style:{"font-size":"3rem"}},null,-1),s("p",{class:"mt-2 mb-0"},"Panier vide",-1)])])):(r(),l(f,{key:4},[s("div",At,[(r(!0),l(f,null,_(n(e).lignes,(i,b)=>(r(),l("div",{key:b,class:P(["border-bottom pb-2 mb-2",i.is_avoir||!i.produit_id?"bg-warning bg-opacity-10":""])},[s("div",Mt,[s("strong",{class:P([i.is_avoir||!i.produit_id?"text-warning":""]),style:{"font-size":"0.9rem"}},[i.is_avoir||!i.produit_id?(r(),l("i",Ft)):v("",!0),c(" "+m(i.nom_produit),1)],2),s("button",{class:"btn btn-sm btn-outline-danger",onClick:h=>n(e).supprimerLigne(b)},[...t[43]||(t[43]=[s("i",{class:"bi bi-x-lg"},null,-1)])],8,Ut)]),i.is_avoir||!i.produit_id?(r(),l("div",$t,[s("strong",qt,m(i.prix_unitaire.toFixed(2))+" €",1)])):(r(),l("div",St,[s("div",It,[s("button",{class:"btn btn-outline-secondary btn-sm",type:"button",onClick:h=>n(e).modifierQuantite(b,Math.max(.001,i.quantite-(i.quantite_min||.001)))},[...t[44]||(t[44]=[s("i",{class:"bi bi-dash"},null,-1)])],8,jt),s("input",{type:"number",class:"form-control form-control-sm text-center quantite-input",value:i.quantite,min:"0.001",step:"0.001",style:{width:"60px"},onChange:h=>n(e).modifierQuantite(b,parseFloat(h.target.value)||.001)},null,40,Vt),s("button",{class:"btn btn-outline-secondary btn-sm",type:"button",onClick:h=>n(e).modifierQuantite(b,i.quantite+(i.quantite_min||.001))},[...t[45]||(t[45]=[s("i",{class:"bi bi-plus"},null,-1)])],8,Lt),s("span",Et,m(i.unite||"Pièce"),1)]),s("span",Nt,[c(m(i.quantite.toFixed(3))+" × "+m(i.prix_unitaire.toFixed(2))+"€ = ",1),s("strong",Qt,m((i.quantite*i.prix_unitaire).toFixed(2))+" €",1)])]))],2))),128))]),s("div",Dt,[s("div",Tt,[t[46]||(t[46]=s("span",{class:"text-muted"},"Articles:",-1)),s("span",null,m(n(e).nombreArticles),1)]),s("div",Ot,[t[47]||(t[47]=s("h5",{class:"mb-0"},"Total:",-1)),s("h5",Rt,m(n(e).total.toFixed(2))+" €",1)])]),s("div",zt,[s("button",{class:"btn btn-success btn-lg",disabled:n(e).lignes.length===0,onClick:t[10]||(t[10]=i=>n(e).ouvrirPaiement())},[...t[48]||(t[48]=[s("i",{class:"bi bi-check-circle me-2"},null,-1),c("Valider la vente ",-1)])],8,Jt),s("button",{class:"btn btn-outline-danger",onClick:t[11]||(t[11]=i=>n(e).viderPanier())},[...t[49]||(t[49]=[s("i",{class:"bi bi-trash me-2"},null,-1),c("Vider le panier ",-1)])])])],64))])])])])]),n(e).showPaniersModal?(r(),l("div",Bt,[s("div",Gt,[s("div",Ht,[s("div",Kt,[t[51]||(t[51]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-folder2-open me-2"}),c("Paniers sauvegardés")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=i=>n(e).showPaniersModal=!1)})]),s("div",Yt,[n(e).savedPaniers.length===0?(r(),l("div",Wt,"Aucun panier sauvegardé")):(r(),l("div",Xt,[(r(!0),l(f,null,_(n(e).savedPaniers,i=>(r(),l("div",{key:i.id,class:"card mb-2"},[s("div",Zt,[s("div",te,[s("div",ee,[s("strong",null,m((i.lignes||[]).length)+" article(s)",1),t[53]||(t[53]=s("br",null,null,-1)),s("small",se,[t[52]||(t[52]=s("i",{class:"bi bi-clock me-1"},null,-1)),c(m(new Date(i.saved_at).toLocaleString("fr-FR")),1)])]),s("div",ie,[s("h5",ne,m((i.total||0).toFixed(2))+" €",1)]),s("div",oe,[s("button",{class:"btn btn-sm btn-primary me-2",onClick:b=>n(e).chargerPanier(i.id)},[...t[54]||(t[54]=[s("i",{class:"bi bi-box-arrow-in-down me-1"},null,-1),c("Charger ",-1)])],8,ae),s("button",{class:"btn btn-sm btn-outline-danger",onClick:b=>u(i.id)},[...t[55]||(t[55]=[s("i",{class:"bi bi-trash"},null,-1)])],8,re)])])])]))),128))]))]),s("div",le,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=i=>n(e).showPaniersModal=!1)},"Fermer")])])])])):v("",!0),n(e).showPaiementModal?(r(),l("div",de,[s("div",ue,[s("div",me,[s("div",ce,[t[56]||(t[56]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-credit-card me-2"}),c("Valider la vente")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[14]||(t[14]=i=>n(e).fermerPaiement())})]),s("div",be,[s("div",pe,[t[57]||(t[57]=c(" Total à payer: ",-1)),s("strong",null,m(n(e).total.toFixed(2))+" €",1)]),s("div",ve,[t[59]||(t[59]=s("label",{class:"form-label"},"Mode de paiement *",-1)),y(s("select",{"onUpdate:modelValue":t[15]||(t[15]=i=>n(e).modePaiementId=i),class:"form-select"},[t[58]||(t[58]=s("option",{value:null},"-- Sélectionner --",-1)),(r(!0),l(f,null,_(n(e).modesPaiement,i=>(r(),l("option",{key:i.id,value:i.id},m(i.nom),9,ge))),128))],512),[[k,n(e).modePaiementId]])]),s("div",he,[t[60]||(t[60]=s("label",{class:"form-label"},"Montant reçu",-1)),y(s("input",{"onUpdate:modelValue":t[16]||(t[16]=i=>n(e).montantPaiement=i),type:"number",class:"form-control",step:"0.01",min:"0.01"},null,512),[[x,n(e).montantPaiement,void 0,{number:!0}]])]),n(e).montantPaiement>n(e).total?(r(),l("div",fe,[t[61]||(t[61]=c(" Rendu monnaie: ",-1)),s("strong",null,m((n(e).montantPaiement-n(e).total).toFixed(2))+" €",1)])):v("",!0)]),s("div",ye,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[17]||(t[17]=i=>n(e).fermerPaiement())},"Annuler"),s("button",{type:"button",class:"btn btn-success",disabled:!n(e).modePaiementId,onClick:t[18]||(t[18]=i=>n(e).validerVente())},[...t[62]||(t[62]=[s("i",{class:"bi bi-check-circle me-1"},null,-1),c("Valider la vente ",-1)])],8,_e)])])])])):v("",!0),n(e).showModalChargerCommande?(r(),l("div",Ce,[s("div",xe,[s("div",Pe,[s("div",ke,[t[63]||(t[63]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-cart-plus me-2"}),c("Ajouter la commande au panier")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[19]||(t[19]=i=>n(e).annulerChargerCommande())})]),t[64]||(t[64]=s("div",{class:"modal-body"},[s("p",null,"Le panier actuel contient déjà des articles."),s("p",null,[s("strong",null,"Les articles de la commande catalogue seront ajoutés au panier (les quantités des mêmes produits seront fusionnées).")])],-1)),s("div",we,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[20]||(t[20]=i=>n(e).annulerChargerCommande())},"Annuler"),s("button",{type:"button",class:"btn btn-primary",onClick:t[21]||(t[21]=i=>{var b;return n(e).chargerCommandeDansPanier((b=n(e).commandeACharger)==null?void 0:b.id)})}," Ajouter au panier ")])])])])):v("",!0),n(e).showAvoirModal?(r(),l("div",Ae,[s("div",Me,[s("div",Fe,[s("div",Ue,[t[65]||(t[65]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-receipt me-2"}),c("Ajouter un avoir")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[22]||(t[22]=i=>n(e).showAvoirModal=!1)})]),s("div",$e,[s("div",qe,[t[66]||(t[66]=c(" Total panier: ",-1)),s("strong",null,m(a.value.toFixed(2))+" €",1)]),s("div",Se,[t[67]||(t[67]=s("label",{class:"form-label"},"Montant de l'avoir *",-1)),y(s("input",{"onUpdate:modelValue":t[23]||(t[23]=i=>n(e).avoirMontant=i),type:"number",class:"form-control",step:"0.01",min:"0.01"},null,512),[[x,n(e).avoirMontant,void 0,{number:!0}]])]),s("div",Ie,[t[68]||(t[68]=s("label",{class:"form-label"},"Commentaire",-1)),y(s("input",{"onUpdate:modelValue":t[24]||(t[24]=i=>n(e).avoirCommentaire=i),type:"text",class:"form-control",placeholder:"Ex: Remboursement"},null,512),[[x,n(e).avoirCommentaire]])])]),s("div",je,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[25]||(t[25]=i=>n(e).showAvoirModal=!1)},"Annuler"),s("button",{type:"button",class:"btn btn-warning",onClick:t[26]||(t[26]=i=>n(e).ajouterAvoir())},[...t[69]||(t[69]=[s("i",{class:"bi bi-check me-1"},null,-1),c("Ajouter l'avoir ",-1)])])])])])])):v("",!0)]))}},Le=R(Ve,[["__scopeId","data-v-069c15c4"]]),F=I(Le);F.use(V());F.mount("#caisse-app");
