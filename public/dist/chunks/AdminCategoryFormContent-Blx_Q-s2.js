import{l as B,o as i,c as r,t as v,d as p,a as t,b as u,e as m,v as f,q as E,F as x,k,n as C,w as y,j as U,r as w,g as S}from"./runtime-dom.esm-bundler-CPobOing.js";const F={key:0,class:"alert alert-danger"},O=["value"],P={class:"mb-3"},R={class:"mb-3"},L=["value"],$={class:"row"},j={class:"col-md-6 mb-3"},q={class:"col-md-6 mb-3"},z={class:"mb-3"},D={class:"dropdown"},M={class:"btn btn-outline-secondary dropdown-toggle w-100 text-start d-flex align-items-center justify-content-between",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},G={key:0},K={class:"text-muted small"},Z={key:1,class:"text-muted"},H={class:"dropdown-menu w-100",style:{"max-height":"400px","overflow-y":"auto"}},J=["onClick"],Q={class:"mb-3"},W={class:"mb-3"},X={class:"form-check"},Y={class:"d-flex gap-2"},ee=["disabled"],te={key:0,class:"spinner-border spinner-border-sm me-1"},le=["disabled"],oe={key:1,href:"/admin/categories",class:"btn btn-outline-secondary"},se={key:1,class:"card mt-4 border-danger"},ae={class:"card-body"},ie=["action"],re=["value"],ue={__name:"AdminCategoryFormContent",props:{allCategories:{type:Array,default:()=>[]},category:{type:Object,default:null},categoryId:{type:[Number,String],default:null},modal:{type:Boolean,default:!1},csrfToken:{type:String,default:()=>window.CSRF_TOKEN||""}},emits:["success","cancel"],setup(n,{emit:_}){const a=n,T=_,l=w({nom:"",description:"",parent_id:"",ordre:0,couleur:"#6c757d",icon:"",is_active:1}),d=w(""),b=w(!1),g=S(()=>!!a.categoryId&&!!a.category),I=S(()=>{const s=a.allCategories||[];return a.categoryId?s.filter(e=>Number(e.id)!==Number(a.categoryId)):s}),h=[{value:"bi bi-basket",label:"Panier (fruits/légumes)"},{value:"bi bi-apple",label:"Pomme (fruits)"},{value:"bi bi-egg",label:"Œuf"},{value:"bi bi-cup-hot",label:"Tasse chaude"},{value:"bi bi-cup-straw",label:"Boisson"},{value:"bi bi-droplet",label:"Goutte"},{value:"bi bi-flower1",label:"Fleur (aromates)"},{value:"bi bi-tree",label:"Arbre (fruits à coque)"},{value:"bi bi-snow",label:"Flocon (surgelés)"},{value:"bi bi-fire",label:"Feu"},{value:"bi bi-box-seam",label:"Boîte"},{value:"bi bi-bag",label:"Sac (vrac)"},{value:"bi bi-cart",label:"Caddie"},{value:"bi bi-star",label:"Étoile"},{value:"bi bi-tag",label:"Étiquette"},{value:"bi bi-shop",label:"Boutique"},{value:"bi bi-truck",label:"Camion"}];function A(){if(a.category){const s=a.category;l.value={nom:s.nom||"",description:s.description||"",parent_id:s.parent_id!=null?String(s.parent_id):"",ordre:s.ordre??0,couleur:s.couleur||"#6c757d",icon:s.icon||"",is_active:s.is_active?1:0}}else l.value={nom:"",description:"",parent_id:"",ordre:0,couleur:"#6c757d",icon:"",is_active:1};d.value=""}B(()=>[a.category,a.categoryId],A,{immediate:!0});function N(s){confirm(`⚠️ ATTENTION : Êtes-vous sûr de vouloir SUPPRIMER définitivement cette catégorie ?

Cette action est IRRÉVERSIBLE.`)||s.preventDefault()}async function V(){d.value="",b.value=!0;try{const s=new URLSearchParams({nom:l.value.nom.trim(),description:l.value.description||"",parent_id:l.value.parent_id||"",ordre:String(l.value.ordre??0),couleur:l.value.couleur||"",icon:l.value.icon||"",is_active:l.value.is_active?"1":"0",_csrf:a.csrfToken}),e=g.value?`/admin/categories/${a.categoryId}`:"/admin/categories",c=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:s.toString(),credentials:"include"})).json().catch(()=>({}));if(c.success){T("success",c.id??null),!a.modal&&c.redirect&&(window.location.href=c.redirect);return}d.value=c.error||"Une erreur est survenue."}catch{d.value="Erreur de connexion. Veuillez réessayer."}finally{b.value=!1}}return(s,e)=>(i(),r("div",null,[d.value?(i(),r("div",F,v(d.value),1)):p("",!0),t("form",{onSubmit:y(V,["prevent"])},[t("input",{type:"hidden",name:"_csrf",value:n.csrfToken},null,8,O),t("div",P,[e[8]||(e[8]=t("label",{for:"cat-nom",class:"form-label"},[u("Nom de la catégorie "),t("span",{class:"text-danger"},"*")],-1)),m(t("input",{id:"cat-nom","onUpdate:modelValue":e[0]||(e[0]=o=>l.value.nom=o),type:"text",class:"form-control",required:""},null,512),[[f,l.value.nom]])]),t("div",R,[e[10]||(e[10]=t("label",{for:"cat-parent_id",class:"form-label"},"Catégorie parente",-1)),m(t("select",{id:"cat-parent_id","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.parent_id=o),class:"form-select"},[e[9]||(e[9]=t("option",{value:""},"Aucune (catégorie principale)",-1)),(i(!0),r(x,null,k(I.value,o=>(i(),r("option",{key:o.id,value:o.id},v(o.nom),9,L))),128))],512),[[E,l.value.parent_id]]),e[11]||(e[11]=t("small",{class:"form-text text-muted"},"Laissez vide pour créer une catégorie principale",-1))]),t("div",$,[t("div",j,[e[12]||(e[12]=t("label",{for:"cat-couleur",class:"form-label"},"Couleur",-1)),m(t("input",{id:"cat-couleur","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.couleur=o),type:"color",class:"form-control form-control-color"},null,512),[[f,l.value.couleur]]),e[13]||(e[13]=t("small",{class:"form-text text-muted"},"Couleur d'affichage du badge",-1))]),t("div",q,[e[14]||(e[14]=t("label",{for:"cat-ordre",class:"form-label"},"Ordre d'affichage",-1)),m(t("input",{id:"cat-ordre","onUpdate:modelValue":e[3]||(e[3]=o=>l.value.ordre=o),type:"number",class:"form-control",min:"0"},null,512),[[f,l.value.ordre,void 0,{number:!0}]]),e[15]||(e[15]=t("small",{class:"form-text text-muted"},"Plus le nombre est petit, plus la catégorie apparaît en haut",-1))])]),t("div",z,[e[18]||(e[18]=t("label",{class:"form-label"},"Icône Bootstrap",-1)),t("div",D,[t("button",M,[l.value.icon?(i(),r("span",G,[t("i",{class:C([l.value.icon,"me-2"]),style:{"font-size":"1.2rem"}},null,2),t("span",K,v(l.value.icon),1)])):(i(),r("span",Z,"Choisir une icône..."))]),t("ul",H,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:e[4]||(e[4]=y(o=>l.value.icon="",["prevent"]))},"Aucune icône")]),e[16]||(e[16]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),e[17]||(e[17]=t("li",{class:"dropdown-header"},"Aliments et Nature",-1)),(i(),r(x,null,k(h,o=>t("li",{key:o.value},[t("a",{class:"dropdown-item",href:"#",onClick:y(c=>l.value.icon=o.value,["prevent"])},[o.value?(i(),r("i",{key:0,class:C([o.value,"me-2"]),style:{"font-size":"1.2rem"}},null,2)):p("",!0),u(" "+v(o.label),1)],8,J)])),64))])]),e[19]||(e[19]=t("small",{class:"form-text text-muted d-block mt-2"},[t("a",{href:"https://icons.getbootstrap.com/",target:"_blank",rel:"noopener"},"Consulter toutes les icônes Bootstrap")],-1))]),t("div",Q,[e[20]||(e[20]=t("label",{for:"cat-description",class:"form-label"},"Description",-1)),m(t("textarea",{id:"cat-description","onUpdate:modelValue":e[5]||(e[5]=o=>l.value.description=o),class:"form-control",rows:"3"},null,512),[[f,l.value.description]])]),t("div",W,[t("div",X,[m(t("input",{id:"cat-is_active","onUpdate:modelValue":e[6]||(e[6]=o=>l.value.is_active=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[U,l.value.is_active]]),e[21]||(e[21]=t("label",{class:"form-check-label",for:"cat-is_active"},"Catégorie active",-1))])]),t("div",Y,[t("button",{type:"submit",class:"btn btn-primary",disabled:b.value},[b.value?(i(),r("span",te)):p("",!0),e[22]||(e[22]=t("i",{class:"bi bi-check-lg me-2"},null,-1)),u(" "+v(g.value?"Enregistrer les modifications":"Créer la catégorie"),1)],8,ee),n.modal?(i(),r("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:b.value,onClick:e[7]||(e[7]=o=>s.$emit("cancel"))},[...e[23]||(e[23]=[t("i",{class:"bi bi-x-lg me-2"},null,-1),u("Annuler ",-1)])],8,le)):(i(),r("a",oe,[...e[24]||(e[24]=[t("i",{class:"bi bi-x-lg me-2"},null,-1),u("Annuler ",-1)])]))])],32),g.value&&n.categoryId&&!n.modal?(i(),r("div",se,[e[28]||(e[28]=t("div",{class:"card-header bg-danger text-white"},[t("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),t("div",ae,[e[26]||(e[26]=t("p",{class:"text-muted"},[t("strong",null,"Attention :"),u(" La suppression d'une catégorie est irréversible. ")],-1)),e[27]||(e[27]=t("p",{class:"text-muted small"},"La suppression sera refusée si des produits ou sous-catégories y sont rattachés.",-1)),t("form",{method:"POST",action:`/admin/categories/${n.categoryId}/delete`,onSubmit:N},[t("input",{type:"hidden",name:"_csrf",value:n.csrfToken},null,8,re),e[25]||(e[25]=t("button",{type:"submit",class:"btn btn-danger w-100"},[t("i",{class:"bi bi-trash me-2"}),u("Supprimer la catégorie ")],-1))],40,ie)])])):p("",!0)]))}};export{ue as _};
