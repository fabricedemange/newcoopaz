import{l as I,o as m,c as p,t as w,d as b,a as s,b as c,e as n,v as r,j as U,w as E,r as y,g as N}from"./runtime-dom.esm-bundler-C8CGTSXe.js";const C={key:0,class:"alert alert-danger"},h=["value"],R={class:"row"},A={class:"col-md-6 mb-3"},P={class:"col-md-6 mb-3"},B={class:"row"},F={class:"col-md-6 mb-3"},O={class:"col-md-6 mb-3"},$={class:"mb-3"},j={class:"row"},D={class:"col-md-4 mb-3"},M={class:"col-md-8 mb-3"},L={class:"mb-3"},z={class:"mb-3"},q={class:"mb-3"},K={class:"form-check"},Z={class:"d-flex gap-2"},G=["disabled"],H={key:0,class:"spinner-border spinner-border-sm me-1"},J=["disabled"],Q=["href"],W={key:1,class:"card mt-4 border-danger"},X={class:"card-body"},Y=["action"],ee=["value"],le={__name:"AdminSupplierFormContent",props:{supplier:{type:Object,default:null},supplierId:{type:[Number,String],default:null},modal:{type:Boolean,default:!1},csrfToken:{type:String,default:()=>window.CSRF_TOKEN||""}},emits:["success","cancel"],setup(i,{emit:g}){const a=i,k=g,l=y({nom:"",contact_nom:"",email:"",telephone:"",adresse:"",code_postal:"",ville:"",siret:"",notes:"",is_active:1}),u=y(""),v=y(!1),f=N(()=>!!a.supplierId&&!!a.supplier);function _(){if(a.supplier){const o=a.supplier;l.value={nom:o.nom||"",contact_nom:o.contact_nom||"",email:o.email||"",telephone:o.telephone||"",adresse:o.adresse||"",code_postal:o.code_postal||"",ville:o.ville||"",siret:o.siret||"",notes:o.notes||"",is_active:o.is_active?1:0}}else l.value={nom:"",contact_nom:"",email:"",telephone:"",adresse:"",code_postal:"",ville:"",siret:"",notes:"",is_active:1};u.value=""}I(()=>[a.supplier,a.supplierId],_,{immediate:!0});function S(o){confirm(`⚠️ ATTENTION : Êtes-vous sûr de vouloir SUPPRIMER définitivement ce fournisseur ?

Cette action est IRRÉVERSIBLE.`)||o.preventDefault()}async function V(){u.value="",v.value=!0;try{const o=new URLSearchParams({nom:l.value.nom.trim(),contact_nom:l.value.contact_nom||"",email:l.value.email||"",telephone:l.value.telephone||"",adresse:l.value.adresse||"",code_postal:l.value.code_postal||"",ville:l.value.ville||"",siret:l.value.siret||"",notes:l.value.notes||"",is_active:l.value.is_active?"1":"0",_csrf:a.csrfToken}),e=f.value?`/admin/suppliers/${a.supplierId}`:"/admin/suppliers",d=await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:o.toString(),credentials:"include"})).json().catch(()=>({}));if(d.success){const x=d.redirect&&d.redirect.match(/\/admin\/suppliers\/(\d+)/),T=x?parseInt(x[1],10):null;k("success",T),!a.modal&&d.redirect&&(window.location.href=d.redirect);return}u.value=d.error||"Une erreur est survenue."}catch{u.value="Erreur de connexion. Veuillez réessayer."}finally{v.value=!1}}return(o,e)=>(m(),p("div",null,[u.value?(m(),p("div",C,w(u.value),1)):b("",!0),s("form",{onSubmit:E(V,["prevent"])},[s("input",{type:"hidden",name:"_csrf",value:i.csrfToken},null,8,h),s("div",R,[s("div",A,[e[11]||(e[11]=s("label",{for:"sup-nom",class:"form-label"},[c("Nom du fournisseur "),s("span",{class:"text-danger"},"*")],-1)),n(s("input",{id:"sup-nom","onUpdate:modelValue":e[0]||(e[0]=t=>l.value.nom=t),type:"text",class:"form-control",required:""},null,512),[[r,l.value.nom]])]),s("div",P,[e[12]||(e[12]=s("label",{for:"sup-contact_nom",class:"form-label"},"Nom du contact",-1)),n(s("input",{id:"sup-contact_nom","onUpdate:modelValue":e[1]||(e[1]=t=>l.value.contact_nom=t),type:"text",class:"form-control"},null,512),[[r,l.value.contact_nom]])])]),s("div",B,[s("div",F,[e[13]||(e[13]=s("label",{for:"sup-email",class:"form-label"},"Email",-1)),n(s("input",{id:"sup-email","onUpdate:modelValue":e[2]||(e[2]=t=>l.value.email=t),type:"email",class:"form-control"},null,512),[[r,l.value.email]])]),s("div",O,[e[14]||(e[14]=s("label",{for:"sup-telephone",class:"form-label"},"Téléphone",-1)),n(s("input",{id:"sup-telephone","onUpdate:modelValue":e[3]||(e[3]=t=>l.value.telephone=t),type:"text",class:"form-control"},null,512),[[r,l.value.telephone]])])]),s("div",$,[e[15]||(e[15]=s("label",{for:"sup-adresse",class:"form-label"},"Adresse",-1)),n(s("input",{id:"sup-adresse","onUpdate:modelValue":e[4]||(e[4]=t=>l.value.adresse=t),type:"text",class:"form-control"},null,512),[[r,l.value.adresse]])]),s("div",j,[s("div",D,[e[16]||(e[16]=s("label",{for:"sup-code_postal",class:"form-label"},"Code postal",-1)),n(s("input",{id:"sup-code_postal","onUpdate:modelValue":e[5]||(e[5]=t=>l.value.code_postal=t),type:"text",class:"form-control"},null,512),[[r,l.value.code_postal]])]),s("div",M,[e[17]||(e[17]=s("label",{for:"sup-ville",class:"form-label"},"Ville",-1)),n(s("input",{id:"sup-ville","onUpdate:modelValue":e[6]||(e[6]=t=>l.value.ville=t),type:"text",class:"form-control"},null,512),[[r,l.value.ville]])])]),s("div",L,[e[18]||(e[18]=s("label",{for:"sup-siret",class:"form-label"},"SIRET",-1)),n(s("input",{id:"sup-siret","onUpdate:modelValue":e[7]||(e[7]=t=>l.value.siret=t),type:"text",class:"form-control"},null,512),[[r,l.value.siret]])]),s("div",z,[e[19]||(e[19]=s("label",{for:"sup-notes",class:"form-label"},"Notes",-1)),n(s("textarea",{id:"sup-notes","onUpdate:modelValue":e[8]||(e[8]=t=>l.value.notes=t),class:"form-control",rows:"3"},null,512),[[r,l.value.notes]])]),s("div",q,[s("div",K,[n(s("input",{id:"sup-is_active","onUpdate:modelValue":e[9]||(e[9]=t=>l.value.is_active=t),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[U,l.value.is_active]]),e[20]||(e[20]=s("label",{class:"form-check-label",for:"sup-is_active"},"Fournisseur actif",-1))])]),s("div",Z,[s("button",{type:"submit",class:"btn btn-primary",disabled:v.value},[v.value?(m(),p("span",H)):b("",!0),e[21]||(e[21]=s("i",{class:"bi bi-check-lg me-2"},null,-1)),c(" "+w(f.value?"Enregistrer les modifications":"Créer le fournisseur"),1)],8,G),i.modal?(m(),p("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:v.value,onClick:e[10]||(e[10]=t=>o.$emit("cancel"))},[...e[22]||(e[22]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),c("Annuler ",-1)])],8,J)):(m(),p("a",{key:1,href:f.value&&i.supplierId?`/admin/suppliers/${i.supplierId}`:"/admin/suppliers",class:"btn btn-outline-secondary"},[...e[23]||(e[23]=[s("i",{class:"bi bi-x-lg me-2"},null,-1),c("Annuler ",-1)])],8,Q))])],32),f.value&&i.supplierId&&!i.modal?(m(),p("div",W,[e[27]||(e[27]=s("div",{class:"card-header bg-danger text-white"},[s("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),s("div",X,[e[25]||(e[25]=s("p",{class:"text-muted"},[s("strong",null,"Attention :"),c(" La suppression d'un fournisseur est irréversible. ")],-1)),e[26]||(e[26]=s("p",{class:"text-muted small"},' Pour simplement désactiver le fournisseur, utilisez la case à cocher "Fournisseur actif" ci-dessus. ',-1)),s("form",{method:"POST",action:`/admin/suppliers/${i.supplierId}/delete`,onSubmit:S},[s("input",{type:"hidden",name:"_csrf",value:i.csrfToken},null,8,ee),e[24]||(e[24]=s("button",{type:"submit",class:"btn btn-danger w-100"},[s("i",{class:"bi bi-trash me-2"}),c("Supprimer le fournisseur ")],-1))],40,Y)])])):b("",!0)]))}};export{le as _};
