import{m as A,o as u,c as d,t as g,d as k,a as l,b as p,e as s,v as r,s as S,F as w,l as V,k as F,w as D,r as _,g as E}from"./runtime-dom.esm-bundler-CuNObg1-.js";const L={key:0,class:"alert alert-danger"},O=["value"],R={class:"mb-3"},B={class:"mb-3"},M=["placeholder"],$={class:"row"},z={class:"col-md-6 mb-3"},K=["value"],G={class:"col-md-6 mb-3"},Q=["value"],Z={class:"row"},H={class:"col-md-6 mb-3"},J={class:"col-md-6 mb-3"},W={class:"row"},X={class:"col-md-4 mb-3"},Y={class:"col-md-4 mb-3"},h={class:"col-md-4 mb-3"},ee={class:"col-md-4 mb-3"},le={class:"row"},te={class:"col-md-4 mb-3"},ne={class:"col-md-4 mb-3"},ie={class:"row"},oe={class:"col-md-6 mb-3"},se={class:"col-md-6 mb-3"},re={class:"mb-3"},ae={key:0,class:"mb-3"},ue=["src","alt"],de={class:"mb-3"},me={for:"image",class:"form-label"},ce={class:"mb-3"},pe={class:"form-check"},ve={class:"d-flex gap-2"},fe=["disabled"],be={key:0,class:"spinner-border spinner-border-sm me-1"},ge=["disabled"],_e=["href"],ye={key:1,class:"card mt-4 border-danger"},xe={class:"card-body"},ke=["action"],Se=["value"],je={__name:"AdminProductFormContent",props:{categories:{type:Array,default:()=>[]},suppliers:{type:Array,default:()=>[]},product:{type:Object,default:null},productId:{type:[Number,String],default:null},modal:{type:Boolean,default:!1},csrfToken:{type:String,default:()=>window.CSRF_TOKEN||""}},emits:["success","cancel"],setup(a,{emit:j}){const m=a,U=j,t=_({nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,stock_min:null,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1}),c=_(""),f=_(!1),y=_(null),q=_(null),v=E(()=>!!m.productId&&!!m.product);function I(i){var n;const e=(n=i.target.files)==null?void 0:n[0];y.value=e||null}function P(i){confirm("Êtes-vous sûr de vouloir désactiver ce produit ?")||i.preventDefault()}function C(){if(m.product){const i=m.product;t.value={nom:i.nom||"",description:i.description||"",category_id:i.category_id!=null?String(i.category_id):"",supplier_id:i.supplier_id!=null?String(i.supplier_id):"",reference_fournisseur:i.reference_fournisseur||"",code_ean:i.code_ean||"",conditionnement:i.conditionnement||"",unite:i.unite||"Pièce",quantite_min:i.quantite_min??1,stock_min:i.stock_min!=null&&i.stock_min!==""?i.stock_min:null,prix:i.prix??"",dlc_jours:i.dlc_jours??"",origine:i.origine||"",label:i.label||"",allergenes:i.allergenes||"",image_url:i.image_url||"",is_active:i.is_active?1:0}}else t.value={nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,stock_min:null,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1};c.value="",y.value=null}A(()=>[m.product,m.productId],C,{immediate:!0});async function N(){c.value="";const i=t.value.prix!==""&&t.value.prix!=null?Number(t.value.prix):NaN;if(!t.value.supplier_id){c.value="Veuillez sélectionner un fournisseur.";return}if(Number.isNaN(i)){c.value="Veuillez saisir un prix valide.";return}f.value=!0;try{const e=(t.value.description||"").trim()||(i<0?"Retour consigne":""),n=v.value?`/admin/products/${m.productId}`:"/admin/products",x={method:"POST",credentials:"include",headers:{Accept:"application/json"}};if(y.value){const o=new FormData;o.append("_csrf",m.csrfToken),o.append("nom",t.value.nom.trim()),o.append("description",e),o.append("category_id",t.value.category_id||""),o.append("supplier_id",t.value.supplier_id||""),o.append("reference_fournisseur",t.value.reference_fournisseur||""),o.append("code_ean",t.value.code_ean||""),o.append("conditionnement",t.value.conditionnement||""),o.append("unite",t.value.unite||"Pièce"),o.append("quantite_min",String(t.value.quantite_min??1)),o.append("stock_min",t.value.stock_min!=null&&t.value.stock_min!==""?String(t.value.stock_min):""),o.append("prix",String(t.value.prix??0)),o.append("dlc_jours",t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):""),o.append("origine",t.value.origine||""),o.append("label",t.value.label||""),o.append("allergenes",t.value.allergenes||""),o.append("is_active",t.value.is_active?"1":"0"),o.append("image",y.value),x.body=o}else{const o=new URLSearchParams({_csrf:m.csrfToken,nom:t.value.nom.trim(),description:e,category_id:t.value.category_id||"",supplier_id:t.value.supplier_id||"",reference_fournisseur:t.value.reference_fournisseur||"",code_ean:t.value.code_ean||"",conditionnement:t.value.conditionnement||"",unite:t.value.unite||"Pièce",quantite_min:String(t.value.quantite_min??1),stock_min:t.value.stock_min!=null&&t.value.stock_min!==""?String(t.value.stock_min):"",prix:String(t.value.prix??0),dlc_jours:t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):"",origine:t.value.origine||"",label:t.value.label||"",allergenes:t.value.allergenes||"",is_active:t.value.is_active?"1":"0"});x.headers["Content-Type"]="application/x-www-form-urlencoded",x.body=o.toString()}const b=await(await fetch(n,x)).json().catch(()=>({}));if(b.success&&b.redirect){const o=b.redirect.match(/\/admin\/products\/(\d+)/),T=o?parseInt(o[1],10):null;U("success",T),m.modal||(window.location.href=b.redirect);return}c.value=b.error||"Une erreur est survenue."}catch{c.value="Erreur de connexion. Veuillez réessayer."}finally{f.value=!1}}return(i,e)=>(u(),d("div",null,[c.value?(u(),d("div",L,g(c.value),1)):k("",!0),l("form",{onSubmit:D(N,["prevent"])},[l("input",{type:"hidden",name:"_csrf",value:a.csrfToken},null,8,O),e[43]||(e[43]=l("h5",{class:"mb-3"},"Informations principales",-1)),l("div",R,[e[17]||(e[17]=l("label",{for:"nom",class:"form-label"},[p("Nom du produit "),l("span",{class:"text-danger"},"*")],-1)),s(l("input",{id:"nom","onUpdate:modelValue":e[0]||(e[0]=n=>t.value.nom=n),type:"text",class:"form-control",required:""},null,512),[[r,t.value.nom]])]),l("div",B,[e[18]||(e[18]=l("label",{for:"description",class:"form-label"},"Description / Commentaire",-1)),s(l("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=n=>t.value.description=n),class:"form-control",rows:"3",placeholder:t.value.prix<0?"Ex. Retour consigne":""},null,8,M),[[r,t.value.description]])]),l("div",$,[l("div",z,[e[20]||(e[20]=l("label",{for:"category_id",class:"form-label"},[p("Catégorie "),l("span",{class:"text-danger"},"*")],-1)),s(l("select",{id:"category_id","onUpdate:modelValue":e[2]||(e[2]=n=>t.value.category_id=n),class:"form-select",required:""},[e[19]||(e[19]=l("option",{value:""},"Sélectionner une catégorie",-1)),(u(!0),d(w,null,V(a.categories,n=>(u(),d("option",{key:n.id,value:n.id},g(n.nom),9,K))),128))],512),[[S,t.value.category_id]])]),l("div",G,[e[22]||(e[22]=l("label",{for:"supplier_id",class:"form-label"},[p("Fournisseur "),l("span",{class:"text-danger"},"*")],-1)),s(l("select",{id:"supplier_id","onUpdate:modelValue":e[3]||(e[3]=n=>t.value.supplier_id=n),class:"form-select",required:""},[e[21]||(e[21]=l("option",{value:""},"Sélectionner un fournisseur",-1)),(u(!0),d(w,null,V(a.suppliers,n=>(u(),d("option",{key:n.id,value:n.id},g(n.nom),9,Q))),128))],512),[[S,t.value.supplier_id]])])]),e[44]||(e[44]=l("hr",{class:"my-4"},null,-1)),e[45]||(e[45]=l("h5",{class:"mb-3"},"Références et codes",-1)),l("div",Z,[l("div",H,[e[23]||(e[23]=l("label",{for:"reference_fournisseur",class:"form-label"},"Référence fournisseur",-1)),s(l("input",{id:"reference_fournisseur","onUpdate:modelValue":e[4]||(e[4]=n=>t.value.reference_fournisseur=n),type:"text",class:"form-control"},null,512),[[r,t.value.reference_fournisseur]])]),l("div",J,[e[24]||(e[24]=l("label",{for:"code_ean",class:"form-label"},"Code EAN / Code-barres",-1)),s(l("input",{id:"code_ean","onUpdate:modelValue":e[5]||(e[5]=n=>t.value.code_ean=n),type:"text",class:"form-control"},null,512),[[r,t.value.code_ean]])])]),e[46]||(e[46]=l("hr",{class:"my-4"},null,-1)),e[47]||(e[47]=l("h5",{class:"mb-3"},"Informations complémentaires",-1)),l("div",W,[l("div",X,[e[25]||(e[25]=l("label",{for:"conditionnement",class:"form-label"},"Conditionnement",-1)),s(l("input",{id:"conditionnement","onUpdate:modelValue":e[6]||(e[6]=n=>t.value.conditionnement=n),type:"text",class:"form-control",placeholder:"Par 6, Au kilo..."},null,512),[[r,t.value.conditionnement]])]),l("div",Y,[e[27]||(e[27]=l("label",{for:"unite",class:"form-label"},"Unité de mesure",-1)),s(l("select",{id:"unite","onUpdate:modelValue":e[7]||(e[7]=n=>t.value.unite=n),class:"form-select",required:""},[...e[26]||(e[26]=[l("option",{value:"Pièce"},"Pièce",-1),l("option",{value:"Kilo"},"Kilo",-1),l("option",{value:"Litre"},"Litre",-1),l("option",{value:"Unite"},"Unité",-1)])],512),[[S,t.value.unite]])]),l("div",h,[e[28]||(e[28]=l("label",{for:"quantite_min",class:"form-label"},"Quantité minimale (vente)",-1)),s(l("input",{id:"quantite_min","onUpdate:modelValue":e[8]||(e[8]=n=>t.value.quantite_min=n),type:"number",class:"form-control",min:"0.01",step:"0.01",required:""},null,512),[[r,t.value.quantite_min,void 0,{number:!0}]]),e[29]||(e[29]=l("small",{class:"form-text text-muted"},"Minimum de vente, pas d'incrément à la caisse",-1))]),l("div",ee,[e[30]||(e[30]=l("label",{for:"stock_min",class:"form-label"},"Seuil de stock (alerte)",-1)),s(l("input",{id:"stock_min","onUpdate:modelValue":e[9]||(e[9]=n=>t.value.stock_min=n),type:"number",class:"form-control",min:"0",step:"0.001",placeholder:"Optionnel"},null,512),[[r,t.value.stock_min,void 0,{number:!0}]]),e[31]||(e[31]=l("small",{class:"form-text text-muted"},"En dessous → alerte « à recommander » (vide = pas d'alerte)",-1))])]),l("div",le,[l("div",te,[e[32]||(e[32]=l("label",{for:"prix",class:"form-label"},[p("Prix (€) "),l("span",{class:"text-danger"},"*")],-1)),s(l("input",{id:"prix","onUpdate:modelValue":e[10]||(e[10]=n=>t.value.prix=n),type:"number",class:"form-control",step:"0.01",required:""},null,512),[[r,t.value.prix,void 0,{number:!0}]]),e[33]||(e[33]=l("small",{class:"form-text text-muted"},"Négatif autorisé (ex. retours de consignes)",-1))]),l("div",ne,[e[34]||(e[34]=l("label",{for:"dlc_jours",class:"form-label"},"DLC (jours)",-1)),s(l("input",{id:"dlc_jours","onUpdate:modelValue":e[11]||(e[11]=n=>t.value.dlc_jours=n),type:"number",class:"form-control",min:"0"},null,512),[[r,t.value.dlc_jours,void 0,{number:!0}]])])]),l("div",ie,[l("div",oe,[e[35]||(e[35]=l("label",{for:"origine",class:"form-label"},"Origine",-1)),s(l("input",{id:"origine","onUpdate:modelValue":e[12]||(e[12]=n=>t.value.origine=n),type:"text",class:"form-control",placeholder:"France, Italie..."},null,512),[[r,t.value.origine]])]),l("div",se,[e[36]||(e[36]=l("label",{for:"label",class:"form-label"},"Labels",-1)),s(l("input",{id:"label","onUpdate:modelValue":e[13]||(e[13]=n=>t.value.label=n),type:"text",class:"form-control",placeholder:"Bio, AOP, IGP..."},null,512),[[r,t.value.label]])])]),l("div",re,[e[37]||(e[37]=l("label",{for:"allergenes",class:"form-label"},"Allergènes",-1)),s(l("input",{id:"allergenes","onUpdate:modelValue":e[14]||(e[14]=n=>t.value.allergenes=n),type:"text",class:"form-control",placeholder:"Gluten, Lactose..."},null,512),[[r,t.value.allergenes]])]),e[48]||(e[48]=l("hr",{class:"my-4"},null,-1)),e[49]||(e[49]=l("h5",{class:"mb-3"},"Image",-1)),v.value&&t.value.image_url?(u(),d("div",ae,[e[38]||(e[38]=l("label",{class:"form-label"},"Image actuelle",-1)),l("div",null,[l("img",{src:t.value.image_url,alt:t.value.nom,class:"img-thumbnail",style:{"max-width":"200px","max-height":"200px"}},null,8,ue)])])):k("",!0),l("div",de,[l("label",me,g(v.value&&t.value.image_url?"Remplacer l'image":"Ajouter une image"),1),l("input",{ref_key:"imageInput",ref:q,id:"image",type:"file",class:"form-control",accept:"image/*",onChange:I},null,544)]),l("div",ce,[l("div",pe,[s(l("input",{id:"is_active","onUpdate:modelValue":e[15]||(e[15]=n=>t.value.is_active=n),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[F,t.value.is_active]]),e[39]||(e[39]=l("label",{class:"form-check-label",for:"is_active"},"Produit actif",-1))])]),l("div",ve,[l("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(u(),d("span",be)):k("",!0),e[40]||(e[40]=l("i",{class:"bi bi-check-lg me-2"},null,-1)),p(" "+g(v.value?"Enregistrer les modifications":"Créer le produit"),1)],8,fe),a.modal?(u(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:f.value,onClick:e[16]||(e[16]=n=>i.$emit("cancel"))},[...e[41]||(e[41]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),p("Annuler ",-1)])],8,ge)):(u(),d("a",{key:1,href:v.value&&a.productId?`/admin/products/${a.productId}`:"/admin/products",class:"btn btn-outline-secondary"},[...e[42]||(e[42]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),p("Annuler ",-1)])],8,_e))])],32),v.value&&a.productId&&!a.modal?(u(),d("div",ye,[e[52]||(e[52]=l("div",{class:"card-header bg-danger text-white"},[l("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),l("div",xe,[e[51]||(e[51]=l("p",{class:"text-muted"},"La désactivation d'un produit le masquera des catalogues.",-1)),l("form",{method:"POST",action:`/admin/products/${a.productId}/delete`,onSubmit:P},[l("input",{type:"hidden",name:"_csrf",value:a.csrfToken},null,8,Se),e[50]||(e[50]=l("button",{type:"submit",class:"btn btn-danger w-100"},[l("i",{class:"bi bi-trash me-2"}),p("Désactiver le produit ")],-1))],40,ke)])])):k("",!0)]))}};export{je as _};
