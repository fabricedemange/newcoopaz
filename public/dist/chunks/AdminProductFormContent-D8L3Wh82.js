import{l as T,o as a,c as u,t as g,d as x,a as l,b as v,e as s,v as d,q as k,F as w,k as j,j as F,w as D,r as _,g as L}from"./runtime-dom.esm-bundler-CYnru-If.js";const N={key:0,class:"alert alert-danger"},E=["value"],O={class:"mb-3"},B={class:"mb-3"},R={class:"row"},$={class:"col-md-6 mb-3"},M=["value"],K={class:"col-md-6 mb-3"},G=["value"],z={class:"row"},Q={class:"col-md-6 mb-3"},Z={class:"col-md-6 mb-3"},H={class:"row"},J={class:"col-md-4 mb-3"},W={class:"col-md-4 mb-3"},X={class:"col-md-4 mb-3"},Y={class:"row"},h={class:"col-md-4 mb-3"},ee={class:"col-md-4 mb-3"},le={class:"row"},te={class:"col-md-6 mb-3"},ne={class:"col-md-6 mb-3"},ie={class:"mb-3"},oe={key:0,class:"mb-3"},se=["src","alt"],re={class:"mb-3"},ae={for:"image",class:"form-label"},ue={class:"mb-3"},de={class:"form-check"},me={class:"d-flex gap-2"},ce=["disabled"],pe={key:0,class:"spinner-border spinner-border-sm me-1"},ve=["disabled"],fe=["href"],be={key:1,class:"card mt-4 border-danger"},ge={class:"card-body"},_e=["action"],ye=["value"],ke={__name:"AdminProductFormContent",props:{categories:{type:Array,default:()=>[]},suppliers:{type:Array,default:()=>[]},product:{type:Object,default:null},productId:{type:[Number,String],default:null},modal:{type:Boolean,default:!1},csrfToken:{type:String,default:()=>window.CSRF_TOKEN||""}},emits:["success","cancel"],setup(r,{emit:S}){const m=r,U=S,t=_({nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1}),p=_(""),f=_(!1),y=_(null),V=_(null),c=L(()=>!!m.productId&&!!m.product);function q(i){var n;const e=(n=i.target.files)==null?void 0:n[0];y.value=e||null}function I(i){confirm("Êtes-vous sûr de vouloir désactiver ce produit ?")||i.preventDefault()}function P(){if(m.product){const i=m.product;t.value={nom:i.nom||"",description:i.description||"",category_id:i.category_id!=null?String(i.category_id):"",supplier_id:i.supplier_id!=null?String(i.supplier_id):"",reference_fournisseur:i.reference_fournisseur||"",code_ean:i.code_ean||"",conditionnement:i.conditionnement||"",unite:i.unite||"Pièce",quantite_min:i.quantite_min??1,prix:i.prix??"",dlc_jours:i.dlc_jours??"",origine:i.origine||"",label:i.label||"",allergenes:i.allergenes||"",image_url:i.image_url||"",is_active:i.is_active?1:0}}else t.value={nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1};p.value="",y.value=null}T(()=>[m.product,m.productId],P,{immediate:!0});async function C(){p.value="",f.value=!0;try{const i=c.value?`/admin/products/${m.productId}`:"/admin/products",e={method:"POST",credentials:"include",headers:{Accept:"application/json"}};if(c.value&&y.value){const o=new FormData;o.append("_csrf",m.csrfToken),o.append("nom",t.value.nom.trim()),o.append("description",t.value.description||""),o.append("category_id",t.value.category_id||""),o.append("supplier_id",t.value.supplier_id||""),o.append("reference_fournisseur",t.value.reference_fournisseur||""),o.append("code_ean",t.value.code_ean||""),o.append("conditionnement",t.value.conditionnement||""),o.append("unite",t.value.unite||"Pièce"),o.append("quantite_min",String(t.value.quantite_min??1)),o.append("prix",String(t.value.prix??0)),o.append("dlc_jours",t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):""),o.append("origine",t.value.origine||""),o.append("label",t.value.label||""),o.append("allergenes",t.value.allergenes||""),o.append("is_active",t.value.is_active?"1":"0"),o.append("image",y.value),e.body=o}else{const o=new URLSearchParams({_csrf:m.csrfToken,nom:t.value.nom.trim(),description:t.value.description||"",category_id:t.value.category_id||"",supplier_id:t.value.supplier_id||"",reference_fournisseur:t.value.reference_fournisseur||"",code_ean:t.value.code_ean||"",conditionnement:t.value.conditionnement||"",unite:t.value.unite||"Pièce",quantite_min:String(t.value.quantite_min??1),prix:String(t.value.prix??0),dlc_jours:t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):"",origine:t.value.origine||"",label:t.value.label||"",allergenes:t.value.allergenes||"",is_active:t.value.is_active?"1":"0"});e.headers["Content-Type"]="application/x-www-form-urlencoded",e.body=o.toString()}const b=await(await fetch(i,e)).json().catch(()=>({}));if(b.success&&b.redirect){const o=b.redirect.match(/\/admin\/products\/(\d+)/),A=o?parseInt(o[1],10):null;U("success",A),m.modal||(window.location.href=b.redirect);return}p.value=b.error||"Une erreur est survenue."}catch{p.value="Erreur de connexion. Veuillez réessayer."}finally{f.value=!1}}return(i,e)=>(a(),u("div",null,[p.value?(a(),u("div",N,g(p.value),1)):x("",!0),l("form",{onSubmit:D(C,["prevent"])},[l("input",{type:"hidden",name:"_csrf",value:r.csrfToken},null,8,E),e[39]||(e[39]=l("h5",{class:"mb-3"},"Informations principales",-1)),l("div",O,[e[16]||(e[16]=l("label",{for:"nom",class:"form-label"},[v("Nom du produit "),l("span",{class:"text-danger"},"*")],-1)),s(l("input",{id:"nom","onUpdate:modelValue":e[0]||(e[0]=n=>t.value.nom=n),type:"text",class:"form-control",required:""},null,512),[[d,t.value.nom]])]),l("div",B,[e[17]||(e[17]=l("label",{for:"description",class:"form-label"},"Description",-1)),s(l("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=n=>t.value.description=n),class:"form-control",rows:"3"},null,512),[[d,t.value.description]])]),l("div",R,[l("div",$,[e[19]||(e[19]=l("label",{for:"category_id",class:"form-label"},[v("Catégorie "),l("span",{class:"text-danger"},"*")],-1)),s(l("select",{id:"category_id","onUpdate:modelValue":e[2]||(e[2]=n=>t.value.category_id=n),class:"form-select",required:""},[e[18]||(e[18]=l("option",{value:""},"Sélectionner une catégorie",-1)),(a(!0),u(w,null,j(r.categories,n=>(a(),u("option",{key:n.id,value:n.id},g(n.nom),9,M))),128))],512),[[k,t.value.category_id]])]),l("div",K,[e[21]||(e[21]=l("label",{for:"supplier_id",class:"form-label"},"Fournisseur",-1)),s(l("select",{id:"supplier_id","onUpdate:modelValue":e[3]||(e[3]=n=>t.value.supplier_id=n),class:"form-select"},[e[20]||(e[20]=l("option",{value:""},"Aucun fournisseur",-1)),(a(!0),u(w,null,j(r.suppliers,n=>(a(),u("option",{key:n.id,value:n.id},g(n.nom),9,G))),128))],512),[[k,t.value.supplier_id]])])]),e[40]||(e[40]=l("hr",{class:"my-4"},null,-1)),e[41]||(e[41]=l("h5",{class:"mb-3"},"Références et codes",-1)),l("div",z,[l("div",Q,[e[22]||(e[22]=l("label",{for:"reference_fournisseur",class:"form-label"},"Référence fournisseur",-1)),s(l("input",{id:"reference_fournisseur","onUpdate:modelValue":e[4]||(e[4]=n=>t.value.reference_fournisseur=n),type:"text",class:"form-control"},null,512),[[d,t.value.reference_fournisseur]])]),l("div",Z,[e[23]||(e[23]=l("label",{for:"code_ean",class:"form-label"},"Code EAN / Code-barres",-1)),s(l("input",{id:"code_ean","onUpdate:modelValue":e[5]||(e[5]=n=>t.value.code_ean=n),type:"text",class:"form-control"},null,512),[[d,t.value.code_ean]])])]),e[42]||(e[42]=l("hr",{class:"my-4"},null,-1)),e[43]||(e[43]=l("h5",{class:"mb-3"},"Informations complémentaires",-1)),l("div",H,[l("div",J,[e[24]||(e[24]=l("label",{for:"conditionnement",class:"form-label"},"Conditionnement",-1)),s(l("input",{id:"conditionnement","onUpdate:modelValue":e[6]||(e[6]=n=>t.value.conditionnement=n),type:"text",class:"form-control",placeholder:"Par 6, Au kilo..."},null,512),[[d,t.value.conditionnement]])]),l("div",W,[e[26]||(e[26]=l("label",{for:"unite",class:"form-label"},"Unité de mesure",-1)),s(l("select",{id:"unite","onUpdate:modelValue":e[7]||(e[7]=n=>t.value.unite=n),class:"form-select",required:""},[...e[25]||(e[25]=[l("option",{value:"Pièce"},"Pièce",-1),l("option",{value:"Kilo"},"Kilo",-1),l("option",{value:"Litre"},"Litre",-1),l("option",{value:"Unite"},"Unité",-1)])],512),[[k,t.value.unite]])]),l("div",X,[e[27]||(e[27]=l("label",{for:"quantite_min",class:"form-label"},"Quantité minimale",-1)),s(l("input",{id:"quantite_min","onUpdate:modelValue":e[8]||(e[8]=n=>t.value.quantite_min=n),type:"number",class:"form-control",min:"0.001",step:"0.001",required:""},null,512),[[d,t.value.quantite_min,void 0,{number:!0}]]),e[28]||(e[28]=l("small",{class:"form-text text-muted"},"Pas d'incrément (ex: 1, 0.5, 0.001)",-1))])]),l("div",Y,[l("div",h,[e[29]||(e[29]=l("label",{for:"prix",class:"form-label"},"Prix (€)",-1)),s(l("input",{id:"prix","onUpdate:modelValue":e[9]||(e[9]=n=>t.value.prix=n),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[d,t.value.prix,void 0,{number:!0}]])]),l("div",ee,[e[30]||(e[30]=l("label",{for:"dlc_jours",class:"form-label"},"DLC (jours)",-1)),s(l("input",{id:"dlc_jours","onUpdate:modelValue":e[10]||(e[10]=n=>t.value.dlc_jours=n),type:"number",class:"form-control",min:"0"},null,512),[[d,t.value.dlc_jours,void 0,{number:!0}]])])]),l("div",le,[l("div",te,[e[31]||(e[31]=l("label",{for:"origine",class:"form-label"},"Origine",-1)),s(l("input",{id:"origine","onUpdate:modelValue":e[11]||(e[11]=n=>t.value.origine=n),type:"text",class:"form-control",placeholder:"France, Italie..."},null,512),[[d,t.value.origine]])]),l("div",ne,[e[32]||(e[32]=l("label",{for:"label",class:"form-label"},"Labels",-1)),s(l("input",{id:"label","onUpdate:modelValue":e[12]||(e[12]=n=>t.value.label=n),type:"text",class:"form-control",placeholder:"Bio, AOP, IGP..."},null,512),[[d,t.value.label]])])]),l("div",ie,[e[33]||(e[33]=l("label",{for:"allergenes",class:"form-label"},"Allergènes",-1)),s(l("input",{id:"allergenes","onUpdate:modelValue":e[13]||(e[13]=n=>t.value.allergenes=n),type:"text",class:"form-control",placeholder:"Gluten, Lactose..."},null,512),[[d,t.value.allergenes]])]),e[44]||(e[44]=l("hr",{class:"my-4"},null,-1)),e[45]||(e[45]=l("h5",{class:"mb-3"},"Image",-1)),c.value&&t.value.image_url?(a(),u("div",oe,[e[34]||(e[34]=l("label",{class:"form-label"},"Image actuelle",-1)),l("div",null,[l("img",{src:t.value.image_url,alt:t.value.nom,class:"img-thumbnail",style:{"max-width":"200px","max-height":"200px"}},null,8,se)])])):x("",!0),l("div",re,[l("label",ae,g(c.value&&t.value.image_url?"Remplacer l'image":"Ajouter une image"),1),l("input",{ref_key:"imageInput",ref:V,id:"image",type:"file",class:"form-control",accept:"image/*",onChange:q},null,544)]),l("div",ue,[l("div",de,[s(l("input",{id:"is_active","onUpdate:modelValue":e[14]||(e[14]=n=>t.value.is_active=n),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[F,t.value.is_active]]),e[35]||(e[35]=l("label",{class:"form-check-label",for:"is_active"},"Produit actif",-1))])]),l("div",me,[l("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(a(),u("span",pe)):x("",!0),e[36]||(e[36]=l("i",{class:"bi bi-check-lg me-2"},null,-1)),v(" "+g(c.value?"Enregistrer les modifications":"Créer le produit"),1)],8,ce),r.modal?(a(),u("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:f.value,onClick:e[15]||(e[15]=n=>i.$emit("cancel"))},[...e[37]||(e[37]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),v("Annuler ",-1)])],8,ve)):(a(),u("a",{key:1,href:c.value&&r.productId?`/admin/products/${r.productId}`:"/admin/products",class:"btn btn-outline-secondary"},[...e[38]||(e[38]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),v("Annuler ",-1)])],8,fe))])],32),c.value&&r.productId&&!r.modal?(a(),u("div",be,[e[48]||(e[48]=l("div",{class:"card-header bg-danger text-white"},[l("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),l("div",ge,[e[47]||(e[47]=l("p",{class:"text-muted"},"La désactivation d'un produit le masquera des catalogues.",-1)),l("form",{method:"POST",action:`/admin/products/${r.productId}/delete`,onSubmit:I},[l("input",{type:"hidden",name:"_csrf",value:r.csrfToken},null,8,ye),e[46]||(e[46]=l("button",{type:"submit",class:"btn btn-danger w-100"},[l("i",{class:"bi bi-trash me-2"}),v("Désactiver le produit ")],-1))],40,_e)])])):x("",!0)]))}};export{ke as _};
