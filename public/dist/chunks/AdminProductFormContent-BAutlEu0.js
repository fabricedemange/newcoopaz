import{m as A,o as a,c as u,t as g,d as k,a as l,b as c,e as s,v as d,s as w,F as S,l as j,k as F,w as D,r as _,g as L}from"./runtime-dom.esm-bundler-CuNObg1-.js";const E={key:0,class:"alert alert-danger"},R=["value"],O={class:"mb-3"},B={class:"mb-3"},$=["placeholder"],M={class:"row"},z={class:"col-md-6 mb-3"},K=["value"],G={class:"col-md-6 mb-3"},Q=["value"],Z={class:"row"},H={class:"col-md-6 mb-3"},J={class:"col-md-6 mb-3"},W={class:"row"},X={class:"col-md-4 mb-3"},Y={class:"col-md-4 mb-3"},h={class:"col-md-4 mb-3"},ee={class:"row"},le={class:"col-md-4 mb-3"},te={class:"col-md-4 mb-3"},ie={class:"row"},ne={class:"col-md-6 mb-3"},oe={class:"col-md-6 mb-3"},se={class:"mb-3"},re={key:0,class:"mb-3"},ae=["src","alt"],ue={class:"mb-3"},de={for:"image",class:"form-label"},me={class:"mb-3"},pe={class:"form-check"},ce={class:"d-flex gap-2"},ve=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-1"},be=["disabled"],ge=["href"],_e={key:1,class:"card mt-4 border-danger"},ye={class:"card-body"},xe=["action"],ke=["value"],je={__name:"AdminProductFormContent",props:{categories:{type:Array,default:()=>[]},suppliers:{type:Array,default:()=>[]},product:{type:Object,default:null},productId:{type:[Number,String],default:null},modal:{type:Boolean,default:!1},csrfToken:{type:String,default:()=>window.CSRF_TOKEN||""}},emits:["success","cancel"],setup(r,{emit:V}){const m=r,U=V,t=_({nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1}),p=_(""),f=_(!1),y=_(null),q=_(null),v=L(()=>!!m.productId&&!!m.product);function I(n){var i;const e=(i=n.target.files)==null?void 0:i[0];y.value=e||null}function P(n){confirm("Êtes-vous sûr de vouloir désactiver ce produit ?")||n.preventDefault()}function C(){if(m.product){const n=m.product;t.value={nom:n.nom||"",description:n.description||"",category_id:n.category_id!=null?String(n.category_id):"",supplier_id:n.supplier_id!=null?String(n.supplier_id):"",reference_fournisseur:n.reference_fournisseur||"",code_ean:n.code_ean||"",conditionnement:n.conditionnement||"",unite:n.unite||"Pièce",quantite_min:n.quantite_min??1,prix:n.prix??"",dlc_jours:n.dlc_jours??"",origine:n.origine||"",label:n.label||"",allergenes:n.allergenes||"",image_url:n.image_url||"",is_active:n.is_active?1:0}}else t.value={nom:"",description:"",category_id:"",supplier_id:"",reference_fournisseur:"",code_ean:"",conditionnement:"",unite:"Pièce",quantite_min:1,prix:"",dlc_jours:"",origine:"",label:"",allergenes:"",image_url:"",is_active:1};p.value="",y.value=null}A(()=>[m.product,m.productId],C,{immediate:!0});async function N(){p.value="";const n=t.value.prix!==""&&t.value.prix!=null?Number(t.value.prix):NaN;if(!t.value.supplier_id){p.value="Veuillez sélectionner un fournisseur.";return}if(Number.isNaN(n)){p.value="Veuillez saisir un prix valide.";return}f.value=!0;try{const e=(t.value.description||"").trim()||(n<0?"Retour consigne":""),i=v.value?`/admin/products/${m.productId}`:"/admin/products",x={method:"POST",credentials:"include",headers:{Accept:"application/json"}};if(v.value&&y.value){const o=new FormData;o.append("_csrf",m.csrfToken),o.append("nom",t.value.nom.trim()),o.append("description",e),o.append("category_id",t.value.category_id||""),o.append("supplier_id",t.value.supplier_id||""),o.append("reference_fournisseur",t.value.reference_fournisseur||""),o.append("code_ean",t.value.code_ean||""),o.append("conditionnement",t.value.conditionnement||""),o.append("unite",t.value.unite||"Pièce"),o.append("quantite_min",String(t.value.quantite_min??1)),o.append("prix",String(t.value.prix??0)),o.append("dlc_jours",t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):""),o.append("origine",t.value.origine||""),o.append("label",t.value.label||""),o.append("allergenes",t.value.allergenes||""),o.append("is_active",t.value.is_active?"1":"0"),o.append("image",y.value),x.body=o}else{const o=new URLSearchParams({_csrf:m.csrfToken,nom:t.value.nom.trim(),description:e,category_id:t.value.category_id||"",supplier_id:t.value.supplier_id||"",reference_fournisseur:t.value.reference_fournisseur||"",code_ean:t.value.code_ean||"",conditionnement:t.value.conditionnement||"",unite:t.value.unite||"Pièce",quantite_min:String(t.value.quantite_min??1),prix:String(t.value.prix??0),dlc_jours:t.value.dlc_jours!==""&&t.value.dlc_jours!=null?String(t.value.dlc_jours):"",origine:t.value.origine||"",label:t.value.label||"",allergenes:t.value.allergenes||"",is_active:t.value.is_active?"1":"0"});x.headers["Content-Type"]="application/x-www-form-urlencoded",x.body=o.toString()}const b=await(await fetch(i,x)).json().catch(()=>({}));if(b.success&&b.redirect){const o=b.redirect.match(/\/admin\/products\/(\d+)/),T=o?parseInt(o[1],10):null;U("success",T),m.modal||(window.location.href=b.redirect);return}p.value=b.error||"Une erreur est survenue."}catch{p.value="Erreur de connexion. Veuillez réessayer."}finally{f.value=!1}}return(n,e)=>(a(),u("div",null,[p.value?(a(),u("div",E,g(p.value),1)):k("",!0),l("form",{onSubmit:D(N,["prevent"])},[l("input",{type:"hidden",name:"_csrf",value:r.csrfToken},null,8,R),e[40]||(e[40]=l("h5",{class:"mb-3"},"Informations principales",-1)),l("div",O,[e[16]||(e[16]=l("label",{for:"nom",class:"form-label"},[c("Nom du produit "),l("span",{class:"text-danger"},"*")],-1)),s(l("input",{id:"nom","onUpdate:modelValue":e[0]||(e[0]=i=>t.value.nom=i),type:"text",class:"form-control",required:""},null,512),[[d,t.value.nom]])]),l("div",B,[e[17]||(e[17]=l("label",{for:"description",class:"form-label"},"Description / Commentaire",-1)),s(l("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=i=>t.value.description=i),class:"form-control",rows:"3",placeholder:t.value.prix<0?"Ex. Retour consigne":""},null,8,$),[[d,t.value.description]])]),l("div",M,[l("div",z,[e[19]||(e[19]=l("label",{for:"category_id",class:"form-label"},[c("Catégorie "),l("span",{class:"text-danger"},"*")],-1)),s(l("select",{id:"category_id","onUpdate:modelValue":e[2]||(e[2]=i=>t.value.category_id=i),class:"form-select",required:""},[e[18]||(e[18]=l("option",{value:""},"Sélectionner une catégorie",-1)),(a(!0),u(S,null,j(r.categories,i=>(a(),u("option",{key:i.id,value:i.id},g(i.nom),9,K))),128))],512),[[w,t.value.category_id]])]),l("div",G,[e[21]||(e[21]=l("label",{for:"supplier_id",class:"form-label"},[c("Fournisseur "),l("span",{class:"text-danger"},"*")],-1)),s(l("select",{id:"supplier_id","onUpdate:modelValue":e[3]||(e[3]=i=>t.value.supplier_id=i),class:"form-select",required:""},[e[20]||(e[20]=l("option",{value:""},"Sélectionner un fournisseur",-1)),(a(!0),u(S,null,j(r.suppliers,i=>(a(),u("option",{key:i.id,value:i.id},g(i.nom),9,Q))),128))],512),[[w,t.value.supplier_id]])])]),e[41]||(e[41]=l("hr",{class:"my-4"},null,-1)),e[42]||(e[42]=l("h5",{class:"mb-3"},"Références et codes",-1)),l("div",Z,[l("div",H,[e[22]||(e[22]=l("label",{for:"reference_fournisseur",class:"form-label"},"Référence fournisseur",-1)),s(l("input",{id:"reference_fournisseur","onUpdate:modelValue":e[4]||(e[4]=i=>t.value.reference_fournisseur=i),type:"text",class:"form-control"},null,512),[[d,t.value.reference_fournisseur]])]),l("div",J,[e[23]||(e[23]=l("label",{for:"code_ean",class:"form-label"},"Code EAN / Code-barres",-1)),s(l("input",{id:"code_ean","onUpdate:modelValue":e[5]||(e[5]=i=>t.value.code_ean=i),type:"text",class:"form-control"},null,512),[[d,t.value.code_ean]])])]),e[43]||(e[43]=l("hr",{class:"my-4"},null,-1)),e[44]||(e[44]=l("h5",{class:"mb-3"},"Informations complémentaires",-1)),l("div",W,[l("div",X,[e[24]||(e[24]=l("label",{for:"conditionnement",class:"form-label"},"Conditionnement",-1)),s(l("input",{id:"conditionnement","onUpdate:modelValue":e[6]||(e[6]=i=>t.value.conditionnement=i),type:"text",class:"form-control",placeholder:"Par 6, Au kilo..."},null,512),[[d,t.value.conditionnement]])]),l("div",Y,[e[26]||(e[26]=l("label",{for:"unite",class:"form-label"},"Unité de mesure",-1)),s(l("select",{id:"unite","onUpdate:modelValue":e[7]||(e[7]=i=>t.value.unite=i),class:"form-select",required:""},[...e[25]||(e[25]=[l("option",{value:"Pièce"},"Pièce",-1),l("option",{value:"Kilo"},"Kilo",-1),l("option",{value:"Litre"},"Litre",-1),l("option",{value:"Unite"},"Unité",-1)])],512),[[w,t.value.unite]])]),l("div",h,[e[27]||(e[27]=l("label",{for:"quantite_min",class:"form-label"},"Quantité minimale",-1)),s(l("input",{id:"quantite_min","onUpdate:modelValue":e[8]||(e[8]=i=>t.value.quantite_min=i),type:"number",class:"form-control",min:"0.001",step:"0.001",required:""},null,512),[[d,t.value.quantite_min,void 0,{number:!0}]]),e[28]||(e[28]=l("small",{class:"form-text text-muted"},"Pas d'incrément (ex: 1, 0.5, 0.001)",-1))])]),l("div",ee,[l("div",le,[e[29]||(e[29]=l("label",{for:"prix",class:"form-label"},[c("Prix (€) "),l("span",{class:"text-danger"},"*")],-1)),s(l("input",{id:"prix","onUpdate:modelValue":e[9]||(e[9]=i=>t.value.prix=i),type:"number",class:"form-control",step:"0.01",required:""},null,512),[[d,t.value.prix,void 0,{number:!0}]]),e[30]||(e[30]=l("small",{class:"form-text text-muted"},"Négatif autorisé (ex. retours de consignes)",-1))]),l("div",te,[e[31]||(e[31]=l("label",{for:"dlc_jours",class:"form-label"},"DLC (jours)",-1)),s(l("input",{id:"dlc_jours","onUpdate:modelValue":e[10]||(e[10]=i=>t.value.dlc_jours=i),type:"number",class:"form-control",min:"0"},null,512),[[d,t.value.dlc_jours,void 0,{number:!0}]])])]),l("div",ie,[l("div",ne,[e[32]||(e[32]=l("label",{for:"origine",class:"form-label"},"Origine",-1)),s(l("input",{id:"origine","onUpdate:modelValue":e[11]||(e[11]=i=>t.value.origine=i),type:"text",class:"form-control",placeholder:"France, Italie..."},null,512),[[d,t.value.origine]])]),l("div",oe,[e[33]||(e[33]=l("label",{for:"label",class:"form-label"},"Labels",-1)),s(l("input",{id:"label","onUpdate:modelValue":e[12]||(e[12]=i=>t.value.label=i),type:"text",class:"form-control",placeholder:"Bio, AOP, IGP..."},null,512),[[d,t.value.label]])])]),l("div",se,[e[34]||(e[34]=l("label",{for:"allergenes",class:"form-label"},"Allergènes",-1)),s(l("input",{id:"allergenes","onUpdate:modelValue":e[13]||(e[13]=i=>t.value.allergenes=i),type:"text",class:"form-control",placeholder:"Gluten, Lactose..."},null,512),[[d,t.value.allergenes]])]),e[45]||(e[45]=l("hr",{class:"my-4"},null,-1)),e[46]||(e[46]=l("h5",{class:"mb-3"},"Image",-1)),v.value&&t.value.image_url?(a(),u("div",re,[e[35]||(e[35]=l("label",{class:"form-label"},"Image actuelle",-1)),l("div",null,[l("img",{src:t.value.image_url,alt:t.value.nom,class:"img-thumbnail",style:{"max-width":"200px","max-height":"200px"}},null,8,ae)])])):k("",!0),l("div",ue,[l("label",de,g(v.value&&t.value.image_url?"Remplacer l'image":"Ajouter une image"),1),l("input",{ref_key:"imageInput",ref:q,id:"image",type:"file",class:"form-control",accept:"image/*",onChange:I},null,544)]),l("div",me,[l("div",pe,[s(l("input",{id:"is_active","onUpdate:modelValue":e[14]||(e[14]=i=>t.value.is_active=i),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[F,t.value.is_active]]),e[36]||(e[36]=l("label",{class:"form-check-label",for:"is_active"},"Produit actif",-1))])]),l("div",ce,[l("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(a(),u("span",fe)):k("",!0),e[37]||(e[37]=l("i",{class:"bi bi-check-lg me-2"},null,-1)),c(" "+g(v.value?"Enregistrer les modifications":"Créer le produit"),1)],8,ve),r.modal?(a(),u("button",{key:0,type:"button",class:"btn btn-outline-secondary",disabled:f.value,onClick:e[15]||(e[15]=i=>n.$emit("cancel"))},[...e[38]||(e[38]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),c("Annuler ",-1)])],8,be)):(a(),u("a",{key:1,href:v.value&&r.productId?`/admin/products/${r.productId}`:"/admin/products",class:"btn btn-outline-secondary"},[...e[39]||(e[39]=[l("i",{class:"bi bi-x-lg me-2"},null,-1),c("Annuler ",-1)])],8,ge))])],32),v.value&&r.productId&&!r.modal?(a(),u("div",_e,[e[49]||(e[49]=l("div",{class:"card-header bg-danger text-white"},[l("h5",{class:"card-title mb-0"},"Zone de danger")],-1)),l("div",ye,[e[48]||(e[48]=l("p",{class:"text-muted"},"La désactivation d'un produit le masquera des catalogues.",-1)),l("form",{method:"POST",action:`/admin/products/${r.productId}/delete`,onSubmit:P},[l("input",{type:"hidden",name:"_csrf",value:r.csrfToken},null,8,ke),e[47]||(e[47]=l("button",{type:"submit",class:"btn btn-danger w-100"},[l("i",{class:"bi bi-trash me-2"}),c("Désactiver le produit ")],-1))],40,xe)])])):k("",!0)]))}};export{je as _};
